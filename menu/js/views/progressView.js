define([],function(){class e extends Backbone.View{className(){return["progress",this.model.get("_isActive")?"is-active":""].join(" ")}events(){return{"click .js-progress-btn":"onProgressBtnClick","click .js-progress-bar-item":"onProgressBarItemClick","mouseenter .js-progress-bar-item":"onProgressBarItemMouseenter",mouseleave:"onMouseleave",touchmove:"onTouchmove",touchend:"onTouchend"}}initialize(){this.update=_.debounce(this.update.bind(this),0),this.onProgressBarItemClick=_.debounce(this.onProgressBarItemClick.bind(this),10),this.render(),this.setupEventListeners()}setupEventListeners(){this.listenTo(this.model,{"change:_isActive":this.onActiveChange}),this.listenTo(this.model.get("_items"),{"change:_isActive":this.onItemActiveChange,"change:_isComplete":this.onItemCompleteChange}),this.$el.on("transitionend",this.onTransitionEnd.bind(this))}onProgressBarItemClick(e){e=$(e.currentTarget).attr("data-index");this.model.setActiveItem(e)}onProgressBarItemMouseenter(e){e=$(e.currentTarget).attr("data-index");this.showPreview(e)}showPreview(e){var t=this.$(".js-progress-bar-item").filter(`[data-index='${e}']`),s=this.$(".js-progress-preview"),i=(s.toggleClass("is-active",!0),Hybrid.getMenuScale()),r=t.position(),t=t.width();s.css({left:r.left/i+t/2,top:r.top});i=s.find(".js-progress-preview-item").toggleClass("is-active",!1).filter(`[data-index='${e}']`).toggleClass("is-active",!0).find(".js-progress-preview-img");i.hasClass("is-ready")||i.attr("src",i.attr("data-src")).addClass("is-ready")}onMouseleave(e){this.hidePreview()}hidePreview(){this.$(".js-progress-preview").toggleClass("is-active",!1)}onProgressBtnClick(e){this.model.set("_isActive",!0)}onActiveChange(e,t){this.$el.toggleClass("is-active",t),this.update()}onItemActiveChange(e,t){t&&(this.update(),this.hidePreview())}update(){var e,t,s,i,r=this.model.getActiveItem();r&&(e=this.$(".js-progress-bar").width(),(i=this.$(".js-progress-bar-item").toggleClass("is-active",!1).filter(`[data-index='${r.get("_index")}']`)).toggleClass("is-active",!0),t=this.$(".js-progress-bar-cur"),s=Hybrid.getMenuScale(),s=i.position().left/e*(100/s)+"%",i=i.width()/e*100+"%",t.css({left:s,width:i}),t.toggleClass("is-complete",Boolean(r.get("_isComplete"))))}onItemCompleteChange(e,t){this.$(".js-progress-bar-item").filter(`[data-index=${e.get("_index")}]`).toggleClass("is-complete",t),this.$(".js-progress-bar-cur").toggleClass("is-complete",Boolean(t))}render(){var e=this.model.toJSON(),t=Handlebars.templates["hm-progress"];e._items=e._items.toJSON().map(e=>{var t=e;return t.title=$(`<div>${e.title}</div>`).text(),t}),50<=e._items.length&&(e._progressTheme="small"),this.$el.html(new Handlebars.SafeString(t(e)).string),this.$el.hide(0).show(0),this.update()}onTransitionEnd(e){$(e.currentTarget).is(this.$el)&&this.update()}$getTouchedProgressBarItem(e,t){e=$(document.elementFromPoint(e,t));return e.hasClass("js-progress-bar-item")?e:null}onTouchmove(e){var t=this.$(".js-progress-bar-item").first().offset().top,e=(this._lastItemTouchPos=[e.touches[0].clientX,t],this.$getTouchedProgressBarItem(...this._lastItemTouchPos));e?this.showPreview(e.attr("data-index")):this.hidePreview()}onTouchend(e){var t;this.hidePreview(),this._lastItemTouchPos&&(t=this.$getTouchedProgressBarItem(...this._lastItemTouchPos))&&(t=t.attr("data-index"),this.model.setActiveItem(t))}}return e});