require(["backbone","semver","bowser","html-react-parser","react","react-dom","handlebars","libraries/jquery.actual.min","libraries/jquery-ui.interactions","libraries/jquery.ui.touch-punch","libraries/SCORM_API_wrapper","underscore","libraries/jquery-ui.slider","libraries/lottie.min.js","libraries/simplebar/simplebar.min","libraries/jquery-ui.scrollParent.js"],function(Backbone$1,semver,Bowser,HTMLReactParser,React,ReactDOM$1,Handlebars$1,jquery_actual_min,jqueryUi_interactions,jquery_ui_touchPunch,pipwerks,_$1,jqueryUi_slider,Lottie$1,SimpleBar,jqueryUi_scrollParent_js){"use strict";function _interopDefaultLegacy(e){return e&&typeof e==="object"&&"default"in e?e:{"default":e}}var Backbone__default=_interopDefaultLegacy(Backbone$1);var semver__default=_interopDefaultLegacy(semver);var Bowser__default=_interopDefaultLegacy(Bowser);var HTMLReactParser__default=_interopDefaultLegacy(HTMLReactParser);var React__default=_interopDefaultLegacy(React);var ReactDOM__default=_interopDefaultLegacy(ReactDOM$1);var Handlebars__default=_interopDefaultLegacy(Handlebars$1);var pipwerks__default=_interopDefaultLegacy(pipwerks);var ___default=_interopDefaultLegacy(_$1);var Lottie__default=_interopDefaultLegacy(Lottie$1);var SimpleBar__default=_interopDefaultLegacy(SimpleBar);function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_x,_r,_arr=[],_n=!0,_d=!1;try{if(_x=(_i=_i.call(arr)).next,0===i){if(Object(_i)!==_i)return;_n=!1}else for(;!(_n=(_s=_x.call(_i)).done)&&(_arr.push(_s.value),_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{if(!_n&&null!=_i.return&&(_r=_i.return(),Object(_r)!==_r))return}finally{if(_d)throw _e}}return _arr}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _regeneratorRuntime(){_regeneratorRuntime=function(){return exports};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,defineProperty=Object.defineProperty||function(obj,key,desc){obj[key]=desc.value},$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return defineProperty(generator,"_invoke",{value:makeInvokeMethod(innerFn,self,context)}),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,function(){return this});var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){define(prototype,method,function(arg){return this._invoke(method,arg)})})}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==typeof value&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject)},function(err){invoke("throw",err,resolve,reject)}):PromiseImpl.resolve(value).then(function(unwrapped){result.value=unwrapped,resolve(result)},function(error){return invoke("throw",error,resolve,reject)})}reject(record.arg)}var previousPromise;defineProperty(this,"_invoke",{value:function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl(function(resolve,reject){invoke(method,arg,resolve,reject)})}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}function maybeInvokeDelegate(delegate,context){var methodName=context.method,method=delegate.iterator[methodName];if(undefined===method)return context.delegate=null,"throw"===methodName&&delegate.iterator.return&&(context.method="return",context.arg=undefined,maybeInvokeDelegate(delegate,context),"throw"===context.method)||"return"!==methodName&&(context.method="throw",context.arg=new TypeError("The iterator does not provide a '"+methodName+"' method")),ContinueSentinel;var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=undefined),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=undefined,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:undefined,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,defineProperty(Gp,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),defineProperty(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,function(){return this}),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next()})},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,function(){return this}),define(Gp,"toString",function(){return"[object Generator]"}),exports.keys=function(val){var object=Object(val),keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=undefined)},stop:function(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=undefined),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=undefined),ContinueSentinel}},exports}function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,"prototype",{writable:false});if(superClass)_setPrototypeOf(subClass,superClass)}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return _assertThisInitialized(self)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _get(){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get.bind()}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(arguments.length<3?target:receiver)}return desc.value}}return _get.apply(this,arguments)}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toPrimitive(input,hint){if(typeof input!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(typeof res!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return typeof key==="symbol"?key:String(key)}var Wait=__AMD("core/js/wait",function(_Backbone$Controller){_inherits(Wait,_Backbone$Controller);var _super=_createSuper(Wait);function Wait(){_classCallCheck(this,Wait);return _super.apply(this,arguments)}_createClass(Wait,[{key:"initialize",value:function initialize(){this._waitCount=0;this._callbackHandle=null;this.being=this.begin.bind(this);this.end=this.end.bind(this)}},{key:"isWaiting",value:function isWaiting(){return this._waitCount!==0}},{key:"begin",value:function begin(){if(!this.isWaiting())this.trigger("wait");this._waitCount++;if(this._callbackHandle){clearTimeout(this._callbackHandle);this._callbackHandle=null}return this}},{key:"end",value:function end(){if(!this.isWaiting())return this;this._waitCount--;if(this.isWaiting()||this._callbackHandle)return this;this._callbackHandle=setTimeout(function(){this._callbackHandle=null;this.trigger("ready")}.bind(this),0);return this}},{key:"queue",value:function queue(callback){var _this=this;if(!callback){this.begin();return new Promise(function(resolve){_this.once("ready",resolve);_this.end()})}this.begin();this.once("ready",callback);this.end();return this}},{key:"for",value:function _for(callback){var _this2=this;this.begin();_.defer(function(){return callback(_.once(_this2.end))});return this}}]);return Wait}(Backbone.Controller));var LockingModel=__AMD("core/js/models/lockingModel",function(_Backbone$Model){_inherits(LockingModel,_Backbone$Model);var _super=_createSuper(LockingModel);function LockingModel(){_classCallCheck(this,LockingModel);return _super.apply(this,arguments)}_createClass(LockingModel,[{key:"set",value:function set(attrName,attrVal){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var stopProcessing=_typeof(attrName)==="object"||typeof attrVal!=="boolean"||!this.isLocking(attrName);if(stopProcessing)return _get(_getPrototypeOf(LockingModel.prototype),"set",this).apply(this,arguments);var isSettingValueForSpecificPlugin=options===null||options===void 0?void 0:options.pluginName;if(!isSettingValueForSpecificPlugin){console.error("Must supply a pluginName to change a locked attribute");options.pluginName="compatibility"}var pluginName=options.pluginName;if(this.defaults[attrName]!==undefined){this._lockedAttributes[attrName]=!this.defaults[attrName]}var lockingValue=this._lockedAttributes[attrName];var isAttemptingToLock=lockingValue===attrVal;if(isAttemptingToLock){this.setLockState(attrName,true,{pluginName:pluginName,skipcheck:true});return _get(_getPrototypeOf(LockingModel.prototype),"set",this).call(this,attrName,lockingValue)}this.setLockState(attrName,false,{pluginName:pluginName,skipcheck:true});var totalLockValue=this.getLockCount(attrName,{skipcheck:true});if(totalLockValue===0){return _get(_getPrototypeOf(LockingModel.prototype),"set",this).call(this,attrName,!lockingValue)}return this}},{key:"setLocking",value:function setLocking(attrName,defaultLockValue){if(this.isLocking(attrName))return;if(!this._lockedAttributes)this._lockedAttributes={};this._lockedAttributes[attrName]=defaultLockValue}},{key:"unsetLocking",value:function unsetLocking(attrName){if(!this.isLocking(attrName))return;if(!this._lockedAttributes)return;delete this._lockedAttributes[attrName];delete this._lockedAttributesValues[attrName];if(Object.keys(this._lockedAttributes).length===0){delete this._lockedAttributes;delete this._lockedAttributesValues}}},{key:"isLocking",value:function isLocking(attrName){var isCheckingGeneralLockingState=attrName===undefined;var isUsingLockedAttributes=Boolean(this.lockedAttributes||this._lockedAttributes);if(isCheckingGeneralLockingState){return isUsingLockedAttributes}if(!isUsingLockedAttributes)return false;if(!this._lockedAttributes){this._lockedAttributes=_.result(this,"lockedAttributes")}var isAttributeALockingAttribute=this._lockedAttributes.hasOwnProperty(attrName);if(!isAttributeALockingAttribute)return false;if(!this._lockedAttributesValues){this._lockedAttributesValues={}}if(!this._lockedAttributesValues[attrName]){this._lockedAttributesValues[attrName]={}}return true}},{key:"isLocked",value:function isLocked(attrName,options){var shouldSkipCheck=options===null||options===void 0?void 0:options.skipcheck;if(!shouldSkipCheck){var stopProcessing=!this.isLocking(attrName);if(stopProcessing)return}return this.getLockCount(attrName)>0}},{key:"getLockCount",value:function getLockCount(attrName,options){var shouldSkipCheck=options===null||options===void 0?void 0:options.skipcheck;if(!shouldSkipCheck){var stopProcessing=!this.isLocking(attrName);if(stopProcessing)return}var isGettingValueForSpecificPlugin=options===null||options===void 0?void 0:options.pluginName;if(isGettingValueForSpecificPlugin){return this._lockedAttributesValues[attrName][options.pluginName]?1:0}var lockingAttributeValues=Object.values(this._lockedAttributesValues[attrName]);var lockingAttributeValuesSum=lockingAttributeValues.reduce(function(sum,value){return sum+(value?1:0)},0);return lockingAttributeValuesSum}},{key:"setLockState",value:function setLockState(attrName,value,options){var shouldSkipCheck=options===null||options===void 0?void 0:options.skipcheck;if(!shouldSkipCheck){var stopProcessing=!this.isLocking(attrName);if(stopProcessing)return this}var isSettingValueForSpecificPlugin=options===null||options===void 0?void 0:options.pluginName;if(!isSettingValueForSpecificPlugin){console.error("Must supply a pluginName to set a locked attribute lock value");options.pluginName="compatibility"}if(value){this._lockedAttributesValues[attrName][options.pluginName]=value}else{delete this._lockedAttributesValues[attrName][options.pluginName]}return this}}]);return LockingModel}(Backbone.Model));var AdaptSingleton=function(_LockingModel){_inherits(AdaptSingleton,_LockingModel);var _super=_createSuper(AdaptSingleton);function AdaptSingleton(){_classCallCheck(this,AdaptSingleton);return _super.apply(this,arguments)}_createClass(AdaptSingleton,[{key:"initialize",value:function initialize(){this.loadScript=window.__loadScript;this.location={};this.store={};this.setupWait()}},{key:"defaults",value:function defaults(){return{_canScroll:true,_outstandingCompletionChecks:0,_pluginWaitCount:0,_isStarted:false,_shouldDestroyContentObjects:true}}},{key:"lockedAttributes",value:function lockedAttributes(){return{_canScroll:false}}},{key:"componentStore",get:function(){this.log.deprecated("Adapt.componentStore, please use Adapt.store instead");return this.store}},{key:"components",get:function(){this.log.error("Adapt.components, does not return ALL components in the content. Please use Adapt.getAllComponents() instead.\n- DD");return this._components},set:function(val){this._components=val}},{key:"getAllComponents",value:function getAllComponents(){var components=[];this.blocks.each(function(b){b.getChildren().each(function(c){components.push(c)})});return new Backbone__default["default"].Collection(components)}},{key:"init",value:function init(){var _this=this;this.addDirection();this.disableAnimation();this.trigger("adapt:preInitialize");this.deferUntilCompletionChecked(function(){_this.trigger("adapt:start");if(!Backbone__default["default"].History.started){Backbone__default["default"].history.start()}_this.set("_isStarted",true);_this.trigger("adapt:initialize")})}},{key:"checkingCompletion",value:function checkingCompletion(){var outstandingChecks=this.get("_outstandingCompletionChecks");this.set("_outstandingCompletionChecks",outstandingChecks+1)}},{key:"checkedCompletion",value:function checkedCompletion(){var outstandingChecks=this.get("_outstandingCompletionChecks");this.set("_outstandingCompletionChecks",outstandingChecks-1)}},{key:"deferUntilCompletionChecked",value:function(){var _deferUntilCompletionChecked=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(){var _this2=this;var callback,_args=arguments;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:callback=_args.length>0&&_args[0]!==undefined?_args[0]:function(){};if(!(this.get("_outstandingCompletionChecks")===0)){_context.next=3;break}return _context.abrupt("return",callback());case 3:return _context.abrupt("return",new Promise(function(resolve){var checkIfAnyChecksOutstanding=function(model,outstandingChecks){if(outstandingChecks!==0)return;_this2.off("change:_outstandingCompletionChecks",checkIfAnyChecksOutstanding);callback();resolve()};_this2.on("change:_outstandingCompletionChecks",checkIfAnyChecksOutstanding)}));case 4:case"end":return _context.stop();}},_callee,this)}));function deferUntilCompletionChecked(){return _deferUntilCompletionChecked.apply(this,arguments)}return deferUntilCompletionChecked}()},{key:"setupWait",value:function setupWait(){var _this3=this;this.wait=new Wait;var beginWait=function(){_this3.log.deprecated("Use Adapt.wait.begin() as Adapt.trigger('plugin:beginWait') may be removed in the future");_this3.wait.begin()};var endWait=function(){_this3.log.deprecated("Use Adapt.wait.end() as Adapt.trigger('plugin:endWait') may be removed in the future");_this3.wait.end()};var ready=function(){if(_this3.wait.isWaiting()){return}var isEventListening=_this3._events["plugins:ready"];if(!isEventListening){return}_this3.log.deprecated("Use Adapt.wait.queue(callback) as Adapt.on('plugins:ready', callback) may be removed in the future");_this3.trigger("plugins:ready")};this.listenTo(this.wait,"ready",ready);this.listenTo(this,{"plugin:beginWait":beginWait,"plugin:endWait":endWait})}},{key:"isWaitingForPlugins",value:function isWaitingForPlugins(){this.log.deprecated("Use Adapt.wait.isWaiting() as Adapt.isWaitingForPlugins() may be removed in the future");return this.wait.isWaiting()}},{key:"checkPluginsReady",value:function checkPluginsReady(){this.log.deprecated("Use Adapt.wait.isWaiting() as Adapt.checkPluginsReady() may be removed in the future");if(this.isWaitingForPlugins()){return}this.trigger("plugins:ready")}},{key:"navigateToElement",value:function(){var _navigateToElement=_asyncToGenerator(_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:case"end":return _context2.stop();}},_callee2)}));function navigateToElement(){return _navigateToElement.apply(this,arguments)}return navigateToElement}()},{key:"scrollTo",value:function(){var _scrollTo=_asyncToGenerator(_regeneratorRuntime().mark(function _callee3(){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:case"end":return _context3.stop();}},_callee3)}));function scrollTo(){return _scrollTo.apply(this,arguments)}return scrollTo}()},{key:"register",value:function register(name,object){var _this4=this;if(Array.isArray(name)){name.forEach(function(name){return _this4.register(name,object)});return object}if(name.split(" ").length>1){this.register(name.split(" "),object);return object}if(!object.view&&!object.model||object instanceof Backbone__default["default"].View){this.log.deprecated("View-only registrations are no longer supported");object={view:object}}if(object.view&&!object.view.template){object.view.template=name}var isModelSetAndInvalid=object.model&&!(object.model.prototype instanceof Backbone__default["default"].Model)&&!(object.model instanceof Function);if(isModelSetAndInvalid){throw new Error("The registered model is not a Backbone.Model or Function")}var isViewSetAndInvalid=object.view&&!(object.view.prototype instanceof Backbone__default["default"].View)&&!(object.view instanceof Function);if(isViewSetAndInvalid){throw new Error("The registered view is not a Backbone.View or Function")}this.store[name]=Object.assign({},this.store[name],object);return object}},{key:"getViewName",value:function getViewName(nameModelViewOrData){var _this5=this;if(typeof nameModelViewOrData==="string"){return nameModelViewOrData}if(nameModelViewOrData instanceof Backbone__default["default"].Model){nameModelViewOrData=nameModelViewOrData.toJSON()}if(nameModelViewOrData instanceof Backbone__default["default"].View){var foundName;Object.entries(this.store).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],entry=_ref2[1];if(!(entry!==null&&entry!==void 0&&entry.view))return;if(!(nameModelViewOrData instanceof entry.view))return;foundName=key;return true});return foundName}if(nameModelViewOrData instanceof Object){var names=[typeof nameModelViewOrData._view==="string"&&nameModelViewOrData._view,typeof nameModelViewOrData._component==="string"&&nameModelViewOrData._component,typeof nameModelViewOrData._type==="string"&&nameModelViewOrData._type].filter(Boolean);if(names.length){var name=names.find(function(name){var _this5$store$name;return(_this5$store$name=_this5.store[name])===null||_this5$store$name===void 0?void 0:_this5$store$name.view});return name||names.pop()}}throw new Error("Cannot derive view class name from input")}},{key:"getViewClass",value:function getViewClass(nameModelViewOrData){var _object$view;var name=this.getViewName(nameModelViewOrData);var object=this.store[name];if(!object){this.log.warnOnce("A view for '".concat(name,"' isn't registered in your project"));return}var isBackboneView=((_object$view=object.view)===null||_object$view===void 0?void 0:_object$view.prototype)instanceof Backbone__default["default"].View;if(!isBackboneView&&object.view instanceof Function){return object.view()}return object.view}},{key:"getModelName",value:function getModelName(nameModelOrData){var _this6=this;if(typeof nameModelOrData==="string"){return nameModelOrData}if(nameModelOrData instanceof Backbone__default["default"].Model){nameModelOrData=nameModelOrData.toJSON()}if(nameModelOrData instanceof Object){var _entry$view;var name=nameModelOrData._component;var entry=this.store[name];var isViewOnlyQuestion=entry&&!entry.model&&((_entry$view=entry.view)===null||_entry$view===void 0?void 0:_entry$view._isQuestionType);if(isViewOnlyQuestion){this.log.deprecated("Assuming a question model for a view-only question: ".concat(name));return"question"}var names=[typeof nameModelOrData._model==="string"&&nameModelOrData._model,typeof nameModelOrData._component==="string"&&nameModelOrData._component,typeof nameModelOrData._type==="string"&&nameModelOrData._type].filter(Boolean);if(names.length){var _name=names.find(function(name){var _this6$store$name;return(_this6$store$name=_this6.store[name])===null||_this6$store$name===void 0?void 0:_this6$store$name.model});return _name||names.pop()}}throw new Error("Cannot derive model class name from input")}},{key:"getModelClass",value:function getModelClass(nameModelOrData){var _object$model;var name=this.getModelName(nameModelOrData);var object=this.store[name];if(!object){this.log.warnOnce("A model for '".concat(name,"' isn't registered in your project"));return}var isBackboneModel=((_object$model=object.model)===null||_object$model===void 0?void 0:_object$model.prototype)instanceof Backbone__default["default"].Model;if(!isBackboneModel&&object.model instanceof Function){return object.model()}return object.model}},{key:"findById",value:function findById(id){return this.data.findById(id)}},{key:"findViewByModelId",value:function findViewByModelId(id){var model=this.data.findById(id);if(!model)return;if(model===this.parentView.model)return this.parentView;var idPathToView=[id];var currentLocationId=this.location._currentId;var currentLocationModel=model.getAncestorModels().find(function(model){var modelId=model.get("_id");if(modelId===currentLocationId)return true;idPathToView.unshift(modelId)});if(!currentLocationModel){return console.warn("Adapt.findViewByModelId() unable to find view for model id: ".concat(id))}var foundView=idPathToView.reduce(function(view,currentId){if(!view)return;var childViews=view.getChildViews();return childViews===null||childViews===void 0?void 0:childViews.find(function(view){return view.model.get("_id")===currentId})},this.parentView);return foundView}},{key:"findByTrackingPosition",value:function findByTrackingPosition(trackingPosition){return this.data.findByTrackingPosition(trackingPosition)}},{key:"parseRelativeString",value:function parseRelativeString(relativeString){var splitIndex=relativeString.search(/[ +\-\d]{1}/);var type=relativeString.slice(0,splitIndex).replace(/^@/,"");var offset=parseInt(relativeString.slice(splitIndex).trim()||0);return{type:type,offset:offset}}},{key:"addDirection",value:function addDirection(){var defaultDirection=this.config.get("_defaultDirection");$("html").addClass("dir-"+defaultDirection).attr("dir",defaultDirection)}},{key:"disableAnimation",value:function disableAnimation(){var disableAnimationArray=this.config.get("_disableAnimationFor");var disableAnimation=this.config.get("_disableAnimation");if(disableAnimationArray){for(var i=0,l=disableAnimationArray.length;i<l;i++){if(!$("html").is(disableAnimationArray[i]))continue;this.config.set("_disableAnimation",true);$("html").addClass("disable-animation");console.log("Animation disabled.")}return}$("html").toggleClass("disable-animation",disableAnimation===true)}},{key:"remove",value:function(){var _remove=_asyncToGenerator(_regeneratorRuntime().mark(function _callee4(){var currentView;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:currentView=this.parentView;if(currentView){currentView.model.setOnChildren({"_isReady":false,"_isRendered":false})}this.trigger("preRemove",currentView);_context4.next=5;return this.wait.queue();case 5:if(currentView&&this.get("_shouldDestroyContentObjects")){currentView.destroy()}this.trigger("remove",currentView);_.defer(this.trigger.bind(this),"postRemove",currentView);case 8:case"end":return _context4.stop();}},_callee4,this)}));function remove(){return _remove.apply(this,arguments)}return remove}()}]);return AdaptSingleton}(LockingModel);var Adapt=__AMD("core/js/adapt",new AdaptSingleton);var TemplateRenderEvent=__AMD("core/js/templateRenderEvent",function(_Backbone$Controller){_inherits(TemplateRenderEvent,_Backbone$Controller);var _super=_createSuper(TemplateRenderEvent);function TemplateRenderEvent(){_classCallCheck(this,TemplateRenderEvent);return _super.apply(this,arguments)}_createClass(TemplateRenderEvent,[{key:"initialize",value:function initialize(type,name,mode,value,args){this.type=type;this.name=name;this.mode=mode;this.value=value;this.args=args}}]);return TemplateRenderEvent}(Backbone.Controller));function onRender(cb){var intercept=function(object,name,mode,cb){return object[name]=cb.bind(object,object[name],name,mode)};Object.keys(Handlebars.templates).forEach(function(name){intercept(Handlebars.templates,name,"template",cb)});Object.keys(Handlebars.partials).forEach(function(name){intercept(Handlebars.partials,name,"partial",cb)})}onRender(function(template,name,mode){for(var _len=arguments.length,args=new Array(_len>3?_len-3:0),_key=3;_key<_len;_key++){args[_key-3]=arguments[_key]}var preRenderEvent=new TemplateRenderEvent("".concat(mode,":preRender"),name,mode,null,args);Adapt.trigger(preRenderEvent.type,preRenderEvent);var value=template.apply(void 0,_toConsumableArray(preRenderEvent.args));var postRenderEvent=new TemplateRenderEvent("".concat(mode,":postRender"),name,mode,value,preRenderEvent.args);Adapt.trigger(postRenderEvent.type,postRenderEvent);return postRenderEvent.value});Adapt.on("app:dataReady",function(){var config=Adapt.config.get("_fixes");if((config===null||config===void 0?void 0:config._imgLazyLoad)===false)return;applyImgLoadingFix()});function applyImgLoadingFix(){var findImgTag=/<img([^>]*)>/gi;var hasLoadingAttr=/ loading=/gi;Adapt.on("template:postRender partial:postRender",function(event){var imgTagsFound=event.value.match(findImgTag);if(!imgTagsFound){return}event.value=imgTagsFound.reduce(function(value,img){if(hasLoadingAttr.test(img)){return value}return value.replace(img,img.replace(findImgTag,"<img loading=\"eager\"$1>"))},event.value)});Adapt.on("reactElement:preRender",function(event){if(event.name!=="img")return;var options=event.args[1]=event.args[1]||{};if(options&&options.hasOwnProperty("loading"))return;options.loading="eager"})}var BrowserFocus=__AMD("core/js/a11y/browserFocus",function(_Backbone$Controller){_inherits(BrowserFocus,_Backbone$Controller);var _super=_createSuper(BrowserFocus);function BrowserFocus(){_classCallCheck(this,BrowserFocus);return _super.apply(this,arguments)}_createClass(BrowserFocus,[{key:"initialize",value:function initialize(){this._onBlur=this._onBlur.bind(this);this._onClick=this._onClick.bind(this);this.$body=$("body");this.listenTo(Adapt,{"accessibility:ready":this._attachEventListeners})}},{key:"_attachEventListeners",value:function _attachEventListeners(){this.$body.on("blur","*",this._onBlur).on("blur",this._onBlur);this.$body[0].addEventListener("click",this._onClick,true)}},{key:"_onBlur",value:function _onBlur(event){var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isFocusNextOnDisabled){return}var $element=$(event.target);if($element.is("[data-a11y-force-focus]")){_.defer(function(){return $element.removeAttr("tabindex data-a11y-force-focus")})}if(event.target!==event.currentTarget){return}if(!$element.is("[disabled]")){return}Adapt.a11y.focusNext($element)}},{key:"_onClick",value:function _onClick(event){var $element=$(event.target);if($element.is("[aria-disabled=true]")){event.preventDefault();event.stopImmediatePropagation()}var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isFocusOnClickEnabled){return}var $stack=$([].concat(_toConsumableArray($element.toArray()),_toConsumableArray($element.parents().toArray())));var $focusable=$stack.filter(config._options._tabbableElements);if(!$focusable.length){return}$focusable[0].focus({preventScroll:true})}}]);return BrowserFocus}(Backbone.Controller));var FocusOptions=__AMD("core/js/a11y/focusOptions",_createClass(function FocusOptions(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$preventScroll=_ref.preventScroll,preventScroll=_ref$preventScroll===void 0?false:_ref$preventScroll,_ref$defer=_ref.defer,defer=_ref$defer===void 0?false:_ref$defer;_classCallCheck(this,FocusOptions);this.preventScroll=preventScroll;this.defer=defer}));var KeyboardFocusOutline=__AMD("core/js/a11y/keyboardFocusOutline",function(_Backbone$Controller){_inherits(KeyboardFocusOutline,_Backbone$Controller);var _super=_createSuper(KeyboardFocusOutline);function KeyboardFocusOutline(){_classCallCheck(this,KeyboardFocusOutline);return _super.apply(this,arguments)}_createClass(KeyboardFocusOutline,[{key:"initialize",value:function initialize(){this._onKeyDown=this._onKeyDown.bind(this);this.$html=$("html");this.showOnKeys={9:true,13:true,32:true,37:true,38:true,39:true,40:true};this.listenTo(Adapt,{"accessibility:ready":this._attachEventListeners})}},{key:"_attachEventListeners",value:function _attachEventListeners(){document.addEventListener("keydown",this._onKeyDown);this._start()}},{key:"_start",value:function _start(){var config=Adapt.a11y.config;if(config._options._isFocusOutlineDisabled){this.$html.addClass("a11y-disable-focusoutline");return}if(!config._isEnabled||!config._options._isFocusOutlineKeyboardOnlyEnabled){return}this.$html.addClass("a11y-disable-focusoutline")}},{key:"_onKeyDown",value:function _onKeyDown(event){var config=Adapt.a11y.config;if(config._options._isFocusOutlineDisabled){this.$html.addClass("a11y-disable-focusoutline");return}if(!config._isEnabled||!config._options._isFocusOutlineKeyboardOnlyEnabled||!this.showOnKeys[event.keyCode]){return}var $element=$(event.target);if(!$element.is(config._options._tabbableElements)||$element.is(config._options._focusOutlineKeyboardOnlyIgnore)){return}this.$html.removeClass("a11y-disable-focusoutline")}}]);return KeyboardFocusOutline}(Backbone.Controller));var Log=__AMD("core/js/a11y/log",function(_Backbone$Controller){_inherits(Log,_Backbone$Controller);var _super=_createSuper(Log);function Log(){_classCallCheck(this,Log);return _super.apply(this,arguments)}_createClass(Log,[{key:"initialize",value:function initialize(){this._warned={}}},{key:"_hasWarned",value:function _hasWarned(args){var config=Adapt.a11y.config;if(!config._options._warnFirstOnly){return false}var hash=args.map(String).join(":");if(this._warned[hash]){return true}this._warned[hash]=true;return false}},{key:"_canWarn",value:function _canWarn(){var config=Adapt.a11y.config;return Boolean(config._options._warn)}},{key:"removed",value:function removed(){var _Adapt$log;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}if(!this._canWarn){return}args=["A11Y"].concat(args);if(this._hasWarned(args)){return}(_Adapt$log=Adapt.log).removed.apply(_Adapt$log,_toConsumableArray(args));return this}},{key:"deprecated",value:function deprecated(){var _Adapt$log2;for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}if(!this._canWarn){return}args=["A11Y"].concat(args);if(this._hasWarned(args)){return}(_Adapt$log2=Adapt.log).deprecated.apply(_Adapt$log2,_toConsumableArray(args));return this}}]);return Log}(Backbone.Controller));var Scroll=__AMD("core/js/a11y/scroll",function(_Backbone$Controller){_inherits(Scroll,_Backbone$Controller);var _super=_createSuper(Scroll);function Scroll(){_classCallCheck(this,Scroll);return _super.apply(this,arguments)}_createClass(Scroll,[{key:"initialize",value:function initialize(){this._onTouchStart=this._onTouchStart.bind(this);this._onTouchEnd=this._onTouchEnd.bind(this);this._onScrollEvent=this._onScrollEvent.bind(this);this._onKeyDown=this._onKeyDown.bind(this);this._scrollDisabledElements=$([]);this.$window=$(window);this.$body=$("body");this._preventScrollOnKeys={37:true,38:true,39:true,40:true};this._ignoreKeysOnElementsMatching="textarea, input, select";this._isRunning=false;this._touchStartEventObject=null}},{key:"disable",value:function disable($elements){$elements=$($elements);this._scrollDisabledElements=this._scrollDisabledElements.add($elements);this._checkRunning();return this}},{key:"enable",value:function enable($elements){$elements=$($elements);if(!$elements.length){this.clear();return this}this._scrollDisabledElements=this._scrollDisabledElements.not($elements);this._checkRunning();return this}},{key:"clear",value:function clear(){this._scrollDisabledElements=$([]);this._checkRunning();return this}},{key:"_checkRunning",value:function _checkRunning(){if(!this._scrollDisabledElements.length){this._stop();return}this._start()}},{key:"_start",value:function _start(){if(this._isRunning){return}this._isRunning=true;window.addEventListener("touchstart",this._onTouchStart);window.addEventListener("touchend",this._onTouchEnd);window.addEventListener("touchmove",this._onScrollEvent,{passive:false});window.addEventListener("wheel",this._onScrollEvent,{passive:false});document.addEventListener("wheel",this._onScrollEvent,{passive:false});document.addEventListener("keydown",this._onKeyDown)}},{key:"_onTouchStart",value:function _onTouchStart(event){event=$.event.fix(event);this._touchStartEventObject=event;return true}},{key:"_onTouchEnd",value:function _onTouchEnd(){this._touchStartEventObject=null;return true}},{key:"_onScrollEvent",value:function _onScrollEvent(event){event=$.event.fix(event);return this._preventScroll(event)}},{key:"_onKeyDown",value:function _onKeyDown(event){event=$.event.fix(event);if(!this._preventScrollOnKeys[event.keyCode]){return}var $target=$(event.target);if($target.is(this._ignoreKeysOnElementsMatching)){return}return this._preventScroll(event)}},{key:"_preventScroll",value:function _preventScroll(event){var _event$touches;var isGesture=((_event$touches=event.touches)===null||_event$touches===void 0?void 0:_event$touches.length)>1;if(isGesture){return}var $target=$(event.target);if(this._scrollDisabledElements.length){var scrollingParent=this._getScrollingParent(event,$target);if(scrollingParent.filter(this._scrollDisabledElements).length===0){this.$window.scroll();return}}event.preventDefault();return false}},{key:"_getScrollingParent",value:function _getScrollingParent(event,$target){var _this$_touchStartEven;var isTouchEvent=event.type==="touchmove";var hasTouchStartEvent=(_this$_touchStartEven=this._touchStartEventObject)===null||_this$_touchStartEven===void 0?void 0:_this$_touchStartEven.originalEvent;if(isTouchEvent&&!hasTouchStartEvent){return $target}var directionY=this._getScrollDirection(event);if(directionY==="none"){return this.$body}var parents=$target.parents();for(var i=0,l=parents.length;i<l;i++){var $parent=$(parents[i]);if($parent.is("body")){return this.$body}if(!this._isScrollable($parent)){continue}if(!this._isScrolling($parent,directionY)){continue}return $parent}return this.$body}},{key:"_isScrollable",value:function _isScrollable($target){var scrollType=$target.css("overflow-y");if(scrollType!=="auto"&&scrollType!=="scroll"){return false}var pointerEvents=$target.css("pointer-events");if(pointerEvents==="none"){return false}return true}},{key:"_isScrolling",value:function _isScrolling($target,directionY){var scrollTop=Math.ceil($target.scrollTop());var innerHeight=$target.outerHeight();var scrollHeight=$target[0].scrollHeight;var hasScrollingSpace=false;switch(directionY){case"down":hasScrollingSpace=scrollTop+innerHeight<scrollHeight;if(hasScrollingSpace){return true}break;case"up":hasScrollingSpace=scrollTop>0;if(hasScrollingSpace){return true}break;}return false}},{key:"_getScrollDirection",value:function _getScrollDirection(event){var deltaY=this._getScrollDelta(event);if(deltaY===0){return"none"}return deltaY>0?"up":"down"}},{key:"_getScrollDelta",value:function _getScrollDelta(event){var deltaY=0;var isTouchEvent=event.type==="touchmove";var originalEvent=event.originalEvent;if(isTouchEvent){var startOriginalEvent=this._touchStartEventObject.originalEvent;var currentY=originalEvent.pageY;var previousY=startOriginalEvent.pageY;if(currentY===0||currentY===previousY){currentY=originalEvent.touches[0].pageY;previousY=startOriginalEvent.touches[0].pageY}deltaY=currentY-previousY}else{var hasDeltaY=originalEvent.wheelDeltaY||originalEvent.deltaY!==undefined;if(hasDeltaY){deltaY=-originalEvent.deltaY}else{deltaY=originalEvent.wheelDelta||0}}return deltaY}},{key:"_stop",value:function _stop(){if(!this._isRunning){return}this._isRunning=false;window.removeEventListener("touchstart",this._onTouchStart);window.removeEventListener("touchend",this._onTouchEnd);window.removeEventListener("touchmove",this._onScrollEvent,{passive:false});window.removeEventListener("wheel",this._onScrollEvent,{passive:false});document.removeEventListener("wheel",this._onScrollEvent,{passive:false});document.removeEventListener("keydown",this._onKeyDown)}}]);return Scroll}(Backbone.Controller));var WrapFocus=__AMD("core/js/a11y/wrapFocus",function(_Backbone$Controller){_inherits(WrapFocus,_Backbone$Controller);var _super=_createSuper(WrapFocus);function WrapFocus(){_classCallCheck(this,WrapFocus);return _super.apply(this,arguments)}_createClass(WrapFocus,[{key:"initialize",value:function initialize(){_.bindAll(this,"_onWrapAround");this.listenTo(Adapt,{"accessibility:ready":this._attachEventListeners})}},{key:"_attachEventListeners",value:function _attachEventListeners(){var config=Adapt.a11y.config;$("body").on("click focus",config._options._focusguard,this._onWrapAround)}},{key:"_onWrapAround",value:function _onWrapAround(event){var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isPopupWrapFocusEnabled){return}event.preventDefault();event.stopPropagation();Adapt.a11y.focusFirst("body",{defer:false})}}]);return WrapFocus}(Backbone.Controller));var Popup=__AMD("core/js/a11y/popup",function(_Backbone$Controller){_inherits(Popup,_Backbone$Controller);var _super=_createSuper(Popup);function Popup(){_classCallCheck(this,Popup);return _super.apply(this,arguments)}_createClass(Popup,[{key:"initialize",value:function initialize(){this._floorStack=[$("body")];this._focusStack=[];this._tabIndexes={};this._ariaHiddens={};this._elementUIDIndex=0;this.listenTo(Adapt,{"popup:opened":function($element,ignoreInternalTrigger){if(ignoreInternalTrigger){return}Adapt.a11y.log.deprecated("Adapt.trigger(\"popup:opened\", $element) is replaced with Adapt.a11y.popupOpened($element);");this.opened($element,true)},"popup:closed":function($target,ignoreInternalTrigger){if(ignoreInternalTrigger){return}Adapt.a11y.log.deprecated("Adapt.trigger(\"popup:closed\", $target) is replaced with Adapt.a11y.popupClosed($target);");this.closed($target,true)}})}},{key:"opened",value:function opened($popupElement,silent){$popupElement=$popupElement||$(document.activeElement);this._addPopupLayer($popupElement);if(!silent){Adapt.trigger("popup:opened",$popupElement,true)}return this}},{key:"_addPopupLayer",value:function _addPopupLayer($popupElement){var _this=this;$popupElement=$($popupElement);var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled||$popupElement.length===0){return $popupElement}this._floorStack.push($popupElement);this._focusStack.push($(document.activeElement));var $elements=$(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);var $branch=$popupElement.add($popupElement.parents());var $siblings=$branch.siblings().filter(config._options._tabbableElementsExcludes);$elements=$elements.add($siblings);$elements.each(function(index,item){var $item=$(item);var elementUID;if(typeof item.a11y_uid==="undefined"){item.a11y_uid="UID"+ ++_this._elementUIDIndex}elementUID=item.a11y_uid;if(_this._tabIndexes[elementUID]===undefined){_this._tabIndexes[elementUID]=[]}if(_this._ariaHiddens[elementUID]===undefined){_this._ariaHiddens[elementUID]=[]}var tabindex=$item.attr("tabindex");var ariaHidden=$item.attr("aria-hidden");_this._tabIndexes[elementUID].push(tabindex===undefined?"":tabindex);_this._ariaHiddens[elementUID].push(ariaHidden===undefined?"":ariaHidden);if(config._options._isPopupTabIndexManagementEnabled){$item.attr("tabindex",-1)}if(config._options._isPopupAriaHiddenManagementEnabled){$item.attr("aria-hidden",true)}});var $items=$popupElement.find(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);if(config._options._isPopupTabIndexManagementEnabled){$items.attr("tabindex",0)}if(config._options._isPopupAriaHiddenManagementEnabled){$items.removeAttr("aria-hidden").removeClass("aria-hidden").parents(config._options._ariaHiddenExcludes).removeAttr("aria-hidden").removeClass("aria-hidden")}}},{key:"closed",value:function closed($focusElement,silent){var $previousFocusElement=this._removeLastPopupLayer();$focusElement=$focusElement||$previousFocusElement||$("body");if(!silent){Adapt.trigger("popup:closed",$focusElement,true)}Adapt.a11y.focusFirst($($focusElement),{preventScroll:true});return this}},{key:"_removeLastPopupLayer",value:function _removeLastPopupLayer(){var _this2=this;var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled){return $(document.activeElement)}if(this._floorStack.length<=1){return}this._floorStack.pop();$(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes).each(function(index,item){var _this2$_tabIndexes$el,_this2$_tabIndexes$el2;var $item=$(item);var previousTabIndex="";var previousAriaHidden="";var elementUID;if(typeof item.a11y_uid==="undefined"){item.a11y_uid="UID"+ ++_this2._elementUIDIndex}elementUID=item.a11y_uid;if((_this2$_tabIndexes$el=_this2._tabIndexes[elementUID])!==null&&_this2$_tabIndexes$el!==void 0&&_this2$_tabIndexes$el.length){previousTabIndex=_this2._tabIndexes[elementUID].pop();previousAriaHidden=_this2._ariaHiddens[elementUID].pop()}if((_this2$_tabIndexes$el2=_this2._tabIndexes[elementUID])!==null&&_this2$_tabIndexes$el2!==void 0&&_this2$_tabIndexes$el2.length){delete _this2._tabIndexes[elementUID];delete _this2._ariaHiddens[elementUID]}if(config._options._isPopupTabIndexManagementEnabled){if(previousTabIndex===""){$item.removeAttr("tabindex")}else{$item.attr({"tabindex":previousTabIndex})}}if(config._options._isPopupAriaHiddenManagementEnabled){if(previousAriaHidden===""){$item.removeAttr("aria-hidden")}else{$item.attr({"aria-hidden":previousAriaHidden})}}});return this._focusStack.pop()}},{key:"setCloseTo",value:function setCloseTo($focusElement){var $original=this._focusStack.pop();this._focusStack.push($focusElement);return $original}}]);return Popup}(Backbone.Controller));Object.assign($.fn,{isFixedPostion:function(){Adapt.a11y.log.removed("$(\"..\").isFixedPostion was unneeded and has been removed, let us know if you need it back.");return false},a11y_aria_label:function(){Adapt.a11y.log.removed("$(\"..\").a11y_aria_label was incorrect behaviour.");return this},limitedScrollTo:function(){Adapt.a11y.log.removed("$.limitedScrollTo had no impact on the screen reader cursor.");return this},a11y_text:function(){Adapt.a11y.log.removed("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return this},a11y_selected:function(){Adapt.a11y.log.removed("$(\"..\").a11y_selected is removed. Please use aria-live instead.");return this},a11y_on:function(isOn){Adapt.a11y.log.deprecated("$(\"..\").a11y_on, use Adapt.a11y.findTabbable($element); and Adapt.a11y.toggleAccessible($elements, isAccessible); instead.");var $tabbable=Adapt.a11y.findTabbable(this);Adapt.a11y.toggleAccessible($tabbable,isOn);return this},a11y_only:function(){Adapt.a11y.log.removed("$(\"..\").a11y_only, use Adapt.a11y.popupOpened($popupElement); instead.");return this},scrollDisable:function(){if(Adapt.a11y.config._options._isScrollDisableEnabled===false){return this}Adapt.a11y.log.deprecated("$(\"..\").scrollDisable, use Adapt.a11y.scrollDisable($elements); instead.");Adapt.a11y.scrollDisable(this);return this},scrollEnable:function(){if(Adapt.a11y.config._options._isScrollDisableEnabled===false){return this}Adapt.a11y.log.deprecated("$(\"..\").scrollEnable, use Adapt.a11y.scrollEnable($elements); instead.");Adapt.a11y.scrollEnable(this);return this},a11y_popup:function(){Adapt.a11y.log.deprecated("$(\"..\").a11y_popup, use Adapt.a11y.popupOpened($popupElement); instead.");return Adapt.a11y.popupOpened(this)},a11y_cntrl:function(isOn,withDisabled){Adapt.a11y.log.deprecated("$(\"..\").a11y_cntrl, use Adapt.a11y.toggleAccessible($elements, isAccessible); and if needed Adapt.a11y.toggleEnabled($elements, isEnabled); instead.");Adapt.a11y.toggleAccessible(this,isOn);if(withDisabled)Adapt.a11y.toggleEnabled(this,isOn);return this},a11y_cntrl_enabled:function(isOn){Adapt.a11y.log.deprecated("$(\"..\").a11y_cntrl_enabled, use Adapt.a11y.toggleAccessibleEnabled($elements, isAccessibleEnabled); instead.");Adapt.a11y.toggleAccessibleEnabled(this,isOn);return this},isReadable:function(){Adapt.a11y.log.deprecated("$(\"..\").isReadable, use Adapt.a11y.isReadable($element); instead.");return Adapt.a11y.isReadable(this)},findForward:function(selector){Adapt.a11y.log.removed("$(\"..\").findForward has been removed as the use cases are very small, let us know if you need it back.");return Adapt.a11y._findFirstForward(this,selector)},findWalk:function(selector){Adapt.a11y.log.removed("$(\"..\").findWalk has been removed as the use cases are very small, let us know if you need it back.");return Adapt.a11y._findFindForwardDescendant(this,selector)},focusNoScroll:function(){Adapt.a11y.log.deprecated("$(\"..\").focusNoScroll, use Adapt.a11y.focus($element); instead.");return Adapt.a11y.focus(this)},focusNext:function(returnOnly){Adapt.a11y.log.deprecated("$(\"..\").focusNext, use Adapt.a11y.focusNext($element); or if needed Adapt.a11y.findFirstReadable($element); instead.");if(returnOnly){return Adapt.a11y.findFirstReadable(this)}return Adapt.a11y.focusNext(this)},focusOrNext:function(returnOnly){Adapt.a11y.log.deprecated("$(\"..\").focusOrNext, use Adapt.a11y.focusFirst($element); or if needed Adapt.a11y.findFirstReadable($element); or Adapt.a11y.isReadable($element); instead.");if(returnOnly){if(Adapt.a11y.isReadable(this))return this;return Adapt.a11y.findFirstReadable(this)}return Adapt.a11y.focusFirst(this)},a11y_focus:function(dontDefer){Adapt.a11y.log.deprecated("$(\"..\").a11y_focus, use Adapt.a11y.focusFirst($element, { defer: true }); instead.");Adapt.a11y.focusFirst(this,{defer:!dontDefer});return this}});Object.assign($,{a11y_alert:function(){Adapt.a11y.log.removed("$.a11y_alert is removed. Please use aria-live instead.");return this},a11y_update:function(){Adapt.a11y.log.removed("a11y_update is no longer required.");return this},a11y_text:function(text){Adapt.a11y.log.removed("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return text},a11y_on:function(isOn,selector){Adapt.a11y.log.deprecated("$(\"..\").a11y_on, use Adapt.a11y.toggleHidden($elements, isHidden); instead.");return Adapt.a11y.toggleHidden(selector,!isOn)},a11y_popdown:function($focusTarget){Adapt.a11y.log.removed("$.a11y_popdown, use Adapt.a11y.popupClosed($focusTarget); instead.");return Adapt.a11y.popupClosed($focusTarget)},a11y_focus:function(dontDefer){Adapt.a11y.log.deprecated("$.a11y_focus, use Adapt.a11y.focusFirst(\"body\", { defer: true }); instead.");Adapt.a11y.focusFirst("body",{defer:!dontDefer});return this},a11y_normalize:function(html){Adapt.a11y.log.deprecated("$.a11y_normalize, use Adapt.a11y.normalize(\"html\"); instead.");return Adapt.a11y.normalize(html)},a11y_remove_breaks:function(html){Adapt.a11y.log.deprecated("$.a11y_remove_breaks, use Adapt.a11y.removeBreaks(\"html\"); instead.");return Adapt.a11y.removeBreaks(html)}});var A11y=function(_Backbone$Controller){_inherits(A11y,_Backbone$Controller);var _super=_createSuper(A11y);function A11y(){_classCallCheck(this,A11y);return _super.apply(this,arguments)}_createClass(A11y,[{key:"defaults",value:function defaults(){return{_isFocusOutlineKeyboardOnlyEnabled:true,_isFocusOutlineDisabled:false,_isFocusAssignmentEnabled:true,_isFocusOnClickEnabled:true,_isFocusNextOnDisabled:true,_isScrollDisableEnabled:true,_isAriaHiddenManagementEnabled:true,_isPopupManagementEnabled:true,_isPopupWrapFocusEnabled:true,_isPopupAriaHiddenManagementEnabled:true,_isPopupTabIndexManagementEnabled:true,_ariaHiddenExcludes:":not(#wrapper):not(body)",_tabbableElements:"a,button,input,select,textarea,[tabindex]:not([data-a11y-force-focus])",_focusOutlineKeyboardOnlyIgnore:"input,textarea",_tabbableElementsExcludes:":not(.a11y-ignore):not([data-a11y-force-focus])",_focusableElements:"a,button,input,select,textarea,[tabindex],label",_readableElements:"[role=heading],[aria-label],[aria-labelledby],[alt]",_focusguard:".a11y-focusguard",_wrapStyleElements:"b,i,abbr,strong,em,small,sub,sup,ins,del,mark,zw,nb",_warnFirstOnly:true,_warn:true}}},{key:"initialize",value:function initialize(){this.isReadable=this.isReadable.bind(this);this.isTabbable=this.isTabbable.bind(this);this.$html=$("html");this._htmlCharRegex=/&.*;/g;this.config=null;this._browserFocus=new BrowserFocus;this._keyboardFocusOutline=new KeyboardFocusOutline;this._wrapFocus=new WrapFocus;this._popup=new Popup;this._scroll=new Scroll;this.log=new Log;this._removeLegacyElements();this.listenToOnce(Adapt,{"app:dataLoaded":this._onDataLoaded,"navigationView:postRender":this._removeLegacyElements},this);Adapt.on("device:changed",this._setupNoSelect);this.listenTo(Adapt,{"router:location":this._onNavigationStart,"contentObjectView:ready router:plugin":this._onNavigationEnd})}},{key:"_onDataLoaded",value:function _onDataLoaded(){this.config=Adapt.config.get("_accessibility");this.config._isActive=false;this.config._options=_.defaults(this.config._options||{},this.defaults());Adapt.offlineStorage.set("a11y",false);this.$html.toggleClass("has-accessibility",this.isEnabled());this._setupNoSelect();this._addFocuserDiv();if(this._isReady){return}this._isReady=true;Adapt.trigger("accessibility:ready")}},{key:"_setupNoSelect",value:function _setupNoSelect(){var _this$config,_this=this;if(!((_this$config=this.config)!==null&&_this$config!==void 0&&_this$config._disableTextSelectOnClasses)){return}var classes=this.config._disableTextSelectOnClasses.split(" ");var isMatch=classes.some(function(className){return _this.$html.is(className)});this.$html.toggleClass("u-no-select",isMatch)}},{key:"_addFocuserDiv",value:function _addFocuserDiv(){if($("#a11y-focuser").length){return}$("body").append($("<div id=\"a11y-focuser\" class=\"a11y-ignore\" tabindex=\"-1\">&nbsp;</div>"))}},{key:"_removeLegacyElements",value:function _removeLegacyElements(){var $legacyElements=$("body").children("#accessibility-toggle, #accessibility-instructions");var $navigationElements=$(".nav").find("#accessibility-toggle, #accessibility-instructions");if(!$legacyElements.length&&!$navigationElements.length){return}Adapt.log.warn("REMOVED: #accessibility-toggle and #accessibility-instructions have been removed. Please remove them from all of your .html files.");$legacyElements.remove();$navigationElements.remove()}},{key:"_onNavigationStart",value:function _onNavigationStart(){var _this2=this;if(!this.isEnabled()){return}_.defer(function(){return _this2.toggleHidden(".contentobject",true)})}},{key:"_onNavigationEnd",value:function _onNavigationEnd(view){var _view$model;if((view===null||view===void 0?void 0:(_view$model=view.model)===null||_view$model===void 0?void 0:_view$model.get("_id"))!==Adapt.location._currentId||!this.isEnabled()){return}this.toggleHidden(".contentobject",false)}},{key:"isActive",value:function isActive(){this.log.removed("Accessibility is now always active when enabled. Please unify your user experiences.");return false}},{key:"isEnabled",value:function isEnabled(){var _this$config2;return(_this$config2=this.config)===null||_this$config2===void 0?void 0:_this$config2._isEnabled}},{key:"toggleHidden",value:function toggleHidden($elements){var isHidden=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;$elements=$($elements);var config=this.config;if(!config._isEnabled||!config._options._isAriaHiddenManagementEnabled){return this}if(isHidden===true){$elements.attr("aria-hidden",true)}else{$elements.removeAttr("aria-hidden")}return this}},{key:"toggleAccessibleEnabled",value:function toggleAccessibleEnabled($elements,isAccessibleEnabled){this.toggleAccessible($elements,isAccessibleEnabled);this.toggleEnabled($elements,isAccessibleEnabled);return this}},{key:"toggleAccessible",value:function toggleAccessible($elements){var isReadable=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;$elements=$($elements);var config=this.config;if(!config._isEnabled||!config._options._isAriaHiddenManagementEnabled||$elements.length===0){return this}if(!isReadable){$elements.attr({tabindex:"-1","aria-hidden":"true"}).addClass("aria-hidden")}else{$elements.removeAttr("aria-hidden tabindex").removeClass("aria-hidden");$elements.parents(config._options._ariaHiddenExcludes).removeAttr("aria-hidden").removeClass("aria-hidden")}return this}},{key:"toggleEnabled",value:function toggleEnabled($elements){var isEnabled=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;$elements=$($elements);if($elements.length===0){return this}if(!isEnabled){$elements.attr({tabindex:"-1","aria-disabled":"true"}).addClass("is-disabled")}else{$elements.removeAttr("aria-disabled tabindex").removeClass("is-disabled")}return this}},{key:"findFirstTabbable",value:function findFirstTabbable($element){$element=$($element).first();return this._findFirstForward($element,this.isTabbable)}},{key:"findFirstReadable",value:function findFirstReadable($element){$element=$($element).first();return this._findFirstForward($element,this.isReadable)}},{key:"findTabbable",value:function findTabbable($element){var config=this.config;return $($element).find(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes)}},{key:"findReadable",value:function findReadable($element){var _this3=this;return $($element).find("*").filter(function(index,element){return _this3.isReadable(element)})}},{key:"isTabbable",value:function isTabbable($element){var config=this.config;var value=$($element).is(config._options._tabbableElements).is(config._options._tabbableElementsExcludes);if(!value){return undefined}return value}},{key:"isReadable",value:function isReadable($element){var checkParents=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var config=this.config;$element=$($element).first();var $branch=checkParents?$element.add($element.parents()):$element;var isNotVisible=$branch.toArray().some(function(item){var $item=$(item);return $item.css("display")==="none"||$item.css("visibility")==="hidden"||$item.attr("aria-hidden")==="true"});if(isNotVisible){return false}var hasNativeFocusOrIsScreenReadable=$element.is(config._options._focusableElements)||$element.is(config._options._readableElements);if(hasNativeFocusOrIsScreenReadable){return true}var childNodes=$element[0].childNodes;for(var c=0,cl=childNodes.length;c<cl;c++){var childNode=childNodes[c];var isTextNode=childNode.nodeType===3;if(!isTextNode){continue}var isOnlyWhiteSpace=/^\s*$/.test(childNode.nodeValue);if(isOnlyWhiteSpace){continue}return true}return undefined}},{key:"_findFirstForward",value:function _findFirstForward($element,selector){var _this4=this;$element=$($element).first();var iterator;switch(_typeof(selector)){case"string":iterator=function($tag){return $tag.is(selector)||undefined};break;case"function":iterator=selector;break;case"undefined":iterator=Boolean;}if($element.length===0){return $element.not("*")}var $found=this._findFirstForwardDescendant($element,iterator);if($found.length){return $found}$element.nextAll().toArray().some(function(sibling){var $sibling=$(sibling);var value=iterator($sibling);if(value===false){return}if(value){$found=$sibling;return true}$found=_this4._findFirstForwardDescendant($sibling,iterator);if($found.length)return true});if($found.length){return $found}$element.add($element.parents()).toArray().reverse().some(function(parent){var $parent=$(parent);if(iterator($parent)===false){return false}return $parent.nextAll().toArray().some(function(sibling){var $sibling=$(sibling);var value=iterator($sibling);if(value===false){return}if(value){$found=$sibling;return true}$found=_this4._findFirstForwardDescendant($sibling,iterator);if($found.length){return true}})});if(!$found.length){return $element.not("*")}return $found}},{key:"_findFirstForwardDescendant",value:function _findFirstForwardDescendant($element,selector){$element=$($element).first();var iterator;switch(_typeof(selector)){case"string":iterator=function($tag){return $tag.is(selector)||undefined};break;case"function":iterator=selector;break;case"undefined":iterator=Boolean;}var $notFound=$element.not("*");if($element.length===0){return $notFound}var stack=[{item:$element[0],value:undefined}];var stackIndexPosition=0;var childIndexPosition=stackIndexPosition+1;do{var stackEntry=stack[stackIndexPosition];var $stackItem=$(stackEntry.item);switch(stackEntry.value){case true:return $stackItem;case false:return $notFound;}$stackItem.children().toArray().forEach(function(item){var $item=$(item);var value=iterator($item);if(value===false){return}stack.splice(childIndexPosition++,0,{item:item,value:value})});stackIndexPosition++;childIndexPosition=stackIndexPosition+1}while(stackIndexPosition<stack.length);return $notFound}},{key:"focusNext",value:function focusNext($element,options){options=new FocusOptions(options);$element=$($element).first();$element=this.findFirstReadable($element);this.focus($element,options);return this}},{key:"focusFirst",value:function focusFirst($element,options){options=new FocusOptions(options);$element=$($element).first();if(this.isReadable($element)){this.focus($element,options);return $element}$element=this.findFirstReadable($element);this.focus($element,options);return $element}},{key:"focus",value:function focus($element,options){options=new FocusOptions(options);$element=$($element).first();var config=this.config;if(!config._isEnabled||!config._options._isFocusAssignmentEnabled||$element.length===0){return this}function perform(){if($element.attr("tabindex")===undefined){$element.attr({"tabindex":"-1","data-a11y-force-focus":"true"})}if(options.preventScroll){var y=$(window).scrollTop();try{$element[0].focus({preventScroll:true})}catch(e){}switch(Adapt.device.browser){case"internet explorer":case"microsoft edge":case"safari":window.scrollTo(null,y);}}else{$element[0].focus()}}if(options.defer){_.defer(perform)}else{perform()}return this}},{key:"normalize",value:function normalize(htmls){htmls=Array.prototype.slice.call(arguments).filter(Boolean).filter(_.isString).join(" ");var text=$("<div>"+htmls+"</div>").text();return text.replace(this._htmlCharRegex,"")}},{key:"removeBreaks",value:function removeBreaks(htmls){var _this5=this;htmls=Array.prototype.slice.call(arguments).filter(Boolean).filter(_.isString).join(" ");var $div=$("<div>"+htmls+"</div>");var stack=[$div[0]];var stackIndex=0;var outputs=[];do{if(stack[stackIndex].childNodes.length){var nodes=stack[stackIndex].childNodes;var usable=nodes.filter(function(node){var isTextNode=node.nodeType===3;if(isTextNode){return true}var isStyleElement=$(node).is(_this5.config._options._wrapStyleElements);if(isStyleElement){return true}return false});outputs.push.apply(outputs,usable);stack.push.apply(stack,nodes)}stackIndex++}while(stackIndex<stack.length);var rtnText="";outputs.forEach(function(item){rtnText+=item.outerHTML||item.textContent});return rtnText}},{key:"scrollEnable",value:function scrollEnable($elements){this._scroll.enable($elements);return this}},{key:"scrollDisable",value:function scrollDisable($elements){this._scroll.disable($elements);return this}},{key:"popupOpened",value:function popupOpened($popupElement){this._popup.opened($popupElement);return this}},{key:"popupClosed",value:function popupClosed($focusElement){this._popup.closed($focusElement);return this}},{key:"setPopupCloseTo",value:function setPopupCloseTo($focusElement){return this._popup.setCloseTo($focusElement)}}]);return A11y}(Backbone.Controller);var a11y=__AMD("core/js/a11y",Adapt.a11y=new A11y);Object.defineProperty(Adapt,"accessibility",{get:function(){a11y.log.deprecated("Adapt.accessibility has moved to Adapt.a11y");return a11y}});var AdaptCollection=__AMD("core/js/collections/adaptCollection",function(_Backbone$Collection){_inherits(AdaptCollection,_Backbone$Collection);var _super=_createSuper(AdaptCollection);function AdaptCollection(){_classCallCheck(this,AdaptCollection);return _super.apply(this,arguments)}_createClass(AdaptCollection,[{key:"initialize",value:function initialize(models,options){this.once("reset",this.loadedData,this)}},{key:"loadedData",value:function loadedData(){Adapt.trigger("adaptCollection:dataLoaded")}}]);return AdaptCollection}(Backbone.Collection));var LOG_LEVEL=ENUM(["DEBUG","INFO","WARN","ERROR","FATAL"]);var LOG_LEVEL$1=__AMD("core/js/enums/logLevelEnum",LOG_LEVEL);var Logging=function(_Backbone$Controller){_inherits(Logging,_Backbone$Controller);var _super=_createSuper(Logging);function Logging(){_classCallCheck(this,Logging);return _super.apply(this,arguments)}_createClass(Logging,[{key:"initialize",value:function initialize(){this._config={_isEnabled:true,_level:LOG_LEVEL$1.INFO.asLowerCase,_console:true,_warnFirstOnly:true};this._warned={};this.listenToOnce(Adapt,"configModel:dataLoaded",this.onLoadConfigData)}},{key:"onLoadConfigData",value:function onLoadConfigData(){this.loadConfig();this.debug("Logging config loaded");this.trigger("log:ready")}},{key:"loadConfig",value:function loadConfig(){if(Adapt.config.has("_logging")){this._config=Adapt.config.get("_logging")}this.checkQueryStringOverride()}},{key:"checkQueryStringOverride",value:function checkQueryStringOverride(){var matches=window.location.search.match(/[?&]loglevel=([a-z]*)/i);if(!matches||matches.length<2)return;var override=LOG_LEVEL$1(matches[1].toUpperCase());if(!override)return;this._config._level=override.asLowerCase;this.debug("Loglevel override in query string:",this._config._level)}},{key:"debug",value:function debug(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this._log(LOG_LEVEL$1.DEBUG,args)}},{key:"info",value:function info(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}this._log(LOG_LEVEL$1.INFO,args)}},{key:"warn",value:function warn(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3]}this._log(LOG_LEVEL$1.WARN,args)}},{key:"error",value:function error(){for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++){args[_key4]=arguments[_key4]}this._log(LOG_LEVEL$1.ERROR,args)}},{key:"fatal",value:function fatal(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++){args[_key5]=arguments[_key5]}this._log(LOG_LEVEL$1.FATAL,args)}},{key:"removed",value:function removed(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++){args[_key6]=arguments[_key6]}args=["REMOVED"].concat(args);this.warnOnce.apply(this,_toConsumableArray(args))}},{key:"deprecated",value:function deprecated(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++){args[_key7]=arguments[_key7]}args=["DEPRECATED"].concat(args);this.warnOnce.apply(this,_toConsumableArray(args))}},{key:"warnOnce",value:function warnOnce(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++){args[_key8]=arguments[_key8]}if(this._hasWarned(args)){return}this._log(LOG_LEVEL$1.WARN,args)}},{key:"_log",value:function _log(level,data){var isEnabled=this._config._isEnabled;if(!isEnabled)return;var configLevel=LOG_LEVEL$1(this._config._level.toUpperCase());var isLogLevelAllowed=level>=configLevel;if(!isLogLevelAllowed)return;this._logToConsole(level,data);this.trigger("log",level,data);this.trigger("log:"+level.asLowerCase,level,data)}},{key:"_logToConsole",value:function _logToConsole(level,data){var shouldLogToConsole=this._config._console;if(!shouldLogToConsole)return;var log=[level.asUpperCase+":"];data&&log.push.apply(log,_toConsumableArray(data));if(console[level.asLowerCase]){var _console;(_console=console)[level.asLowerCase].apply(_console,log)}else{var _console2;(_console2=console).log.apply(_console2,log)}}},{key:"_hasWarned",value:function _hasWarned(args){if(!this._config._warnFirstOnly){return false}var hash=args.map(String).join(":");if(this._warned[hash]){return true}this._warned[hash]=true;return false}}]);return Logging}(Backbone.Controller);__AMD("core/js/logging",Adapt.log=new Logging);var BuildModel=__AMD("core/js/models/buildModel",function(_LockingModel){_inherits(BuildModel,_LockingModel);var _super=_createSuper(BuildModel);function BuildModel(){_classCallCheck(this,BuildModel);return _super.apply(this,arguments)}_createClass(BuildModel,[{key:"defaults",value:function defaults(){return{jsonext:"json"}}},{key:"initialize",value:function initialize(attrs,options){var _this=this;this.url=options.url;this.fetch({success:function(){_this.isLoaded=true;Adapt.trigger("buildModel:dataLoaded")},error:function(){console.log("Unable to load adapt/js/build.js");Adapt.trigger("buildModel:dataLoaded")}})}},{key:"isFrameworkVersion",value:function isFrameworkVersion(version){return semver__default["default"].satisfies(this.get("package").version,version,{includePrerelease:true})}},{key:"isPluginInstalled",value:function isPluginInstalled(name){var version=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"*";var plugin=this.get("plugins").find(function(plugin){if(plugin.name!==name)return false;return semver__default["default"].satisfies(plugin.version,version,{includePrerelease:true})});return Boolean(plugin)}},{key:"whenReady",value:function whenReady(){if(this.isLoaded)return Promise.resolve();return new Promise(function(resolve){Adapt.once("buildModel:dataLoaded",resolve)})}}]);return BuildModel}(LockingModel));var ConfigModel=__AMD("core/js/models/configModel",function(_LockingModel){_inherits(ConfigModel,_LockingModel);var _super=_createSuper(ConfigModel);function ConfigModel(){_classCallCheck(this,ConfigModel);return _super.apply(this,arguments)}_createClass(ConfigModel,[{key:"defaults",value:function defaults(){return{screenSize:{large:900,medium:760,small:520},_forceRouteLocking:false,_canLoadData:true,_disableAnimation:false}}},{key:"setValuesFromURLParams",value:function setValuesFromURLParams(){var _this=this;var paramMappings={dir:"_defaultDirection",lang:"_defaultLanguage"};var params=new URLSearchParams(window.location.search);Object.entries(paramMappings).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];var passedVal=params.get(key);if(!passedVal)return;_this.set(value,passedVal)})}},{key:"initialize",value:function initialize(attrs,options){var _this2=this;this.url=options.url;this.fetch({success:function(){_this2.setValuesFromURLParams();Adapt.trigger("offlineStorage:prepare");Adapt.wait.queue(function(){Adapt.trigger("configModel:dataLoaded");if(!_this2.get("_canLoadData"))return;Adapt.trigger("configModel:loadCourseData")})},error:function(){return console.log("Unable to load course/config.json")}})}},{key:"loadData",value:function loadData(){}}]);return ConfigModel}(LockingModel));var ModelEvent=__AMD("core/js/modelEvent",function(_Backbone$Controller){_inherits(ModelEvent,_Backbone$Controller);var _super=_createSuper(ModelEvent);function ModelEvent(){_classCallCheck(this,ModelEvent);return _super.apply(this,arguments)}_createClass(ModelEvent,[{key:"initialize",value:function initialize(type,target,value){this.type=type;this.target=target;this.value=value;this.canBubble=true;this.deepPath=[target];this.timeStamp=null}},{key:"stopPropagation",value:function stopPropagation(){this.canBubble=false}},{key:"addPath",value:function addPath(target){this.deepPath.unshift(target)}}]);return ModelEvent}(Backbone.Controller));var AdaptModel=__AMD("core/js/models/adaptModel",function(_LockingModel){_inherits(AdaptModel,_LockingModel);var _super=_createSuper(AdaptModel);function AdaptModel(){_classCallCheck(this,AdaptModel);return _super.apply(this,arguments)}_createClass(AdaptModel,[{key:"toJSON",value:function toJSON(){var json=_objectSpread2({},this.attributes);delete json._children;delete json._parent;return $.extend(true,{},json)}},{key:"get",value:function get(name){switch(name){case"_parent":case"_children":Adapt.log.deprecated("Use model.getChildren() or model.getParent() instead of model.get('_children') or model.get('_parent')");}return _get(_getPrototypeOf(AdaptModel.prototype),"get",this).call(this,name)}},{key:"defaults",value:function defaults(){return{_canShowFeedback:true,_classes:"",_canReset:false,_canRequestChild:false,_isComplete:false,_isInteractionComplete:false,_isA11yRegionEnabled:false,_isA11yCompletionDescriptionEnabled:true,_requireCompletionOf:-1,_isEnabled:true,_isResetOnRevisit:false,_isAvailable:true,_isOptional:false,_isRendered:false,_isReady:false,_isVisible:true,_isLocked:false,_isHidden:false}}},{key:"trackingPosition",get:function(){var _this=this;var firstDescendant=this.getAllDescendantModels(false).concat([this])[0];var nearestTrackingIdModel=[firstDescendant].concat(firstDescendant.getAncestorModels()).find(function(model){return model.has("_trackingId")});if(!nearestTrackingIdModel)return;var trackingId=nearestTrackingIdModel.get("_trackingId");var trackingIdDescendants=[nearestTrackingIdModel].concat(nearestTrackingIdModel.getAllDescendantModels(true));var indexInTrackingIdDescendants=trackingIdDescendants.findIndex(function(descendant){return descendant===_this});if(indexInTrackingIdDescendants>=0){return[trackingId,indexInTrackingIdDescendants]}var trackingIdAncestors=nearestTrackingIdModel.getAncestorModels();var ancestorDistance=trackingIdAncestors.findIndex(function(ancestor){return ancestor===_this});return[trackingId,-(ancestorDistance+1)]}},{key:"parse",value:function parse(data){if(data._isResetOnRevisit==="false"){data._isResetOnRevisit=false}return data}},{key:"trackable",value:function trackable(){return["_id","_isComplete","_isInteractionComplete"]}},{key:"trackableType",value:function trackableType(){return[String,Boolean,Boolean]}},{key:"bubblingEvents",value:function bubblingEvents(){return["change:_isComplete","change:_isInteractionComplete","change:_isActive"]}},{key:"setupModel",value:function setupModel(){var _this2=this;if(this.hasManagedChildren){this.setupChildListeners()}this.init();_.defer(function(){if(_this2.hasManagedChildren){_this2.checkCompletionStatus();_this2.checkInteractionCompletionStatus();_this2.checkLocking()}_this2.setupTrackables()})}},{key:"setupTrackables",value:function setupTrackables(){var _this3=this;var originalTrackableStateFunction=this.triggerTrackableState;this.triggerTrackableState=_.compose(function(){_this3.triggerTrackableState.isQueued=true},_.debounce(function(){originalTrackableStateFunction.apply(_this3);_this3.triggerTrackableState.isQueued=false},17));this.listenTo(this,"change",function(_ref){var changed=_ref.changed;if(_this3.triggerTrackableState.isQueued||!Adapt.attributes._isStarted){return}var trackablePropertyNames=_.result(_this3,"trackable",[]);var changedPropertyNames=Object.keys(changed);var isTrackable=changedPropertyNames.find(function(item){return trackablePropertyNames.includes(item)});if(isTrackable){_this3.triggerTrackableState()}})}},{key:"setupChildListeners",value:function setupChildListeners(){var children=this.getChildren();if(!children.length){return}this.listenTo(children,{"all":this.onAll,"bubble":this.bubble,"change:_isReady":this.checkReadyStatus,"change:_isComplete":this.onIsComplete,"change:_isInteractionComplete":this.checkInteractionCompletionStatus})}},{key:"init",value:function init(){}},{key:"getTrackableState",value:function getTrackableState(){var _ref2;var trackable=this.resultExtend("trackable",[]);var json=this.toJSON();var args=trackable;args.unshift(json);return(_ref2=_).pick.apply(_ref2,_toConsumableArray(args))}},{key:"setTrackableState",value:function setTrackableState(state){var _ref3;var trackable=this.resultExtend("trackable",[]);var args=trackable;args.unshift(state);state=(_ref3=_).pick.apply(_ref3,_toConsumableArray(args));this.set(state);return this}},{key:"triggerTrackableState",value:function triggerTrackableState(){Adapt.trigger("state:change",this,this.getTrackableState())}},{key:"reset",value:function reset(type,force){if(!this.get("_canReset")&&!force)return;type=type||true;switch(type){case"hard":case true:this.set({_isEnabled:true,_isComplete:false,_isInteractionComplete:false});break;case"soft":this.set({_isEnabled:true,_isInteractionComplete:false});break;}}},{key:"checkReadyStatus",value:function checkReadyStatus(model,value){if(value===false){return false}var children=this.getAvailableChildModels();if(children.find(function(child){return child.get("_isReady")===false&&child.get("_isRendered")})){return false}this.set("_isReady",true);return true}},{key:"setCompletionStatus",value:function setCompletionStatus(){if(!this.get("_isVisible"))return;this.set({_isComplete:true,_isInteractionComplete:true})}},{key:"checkCompletionStatus",value:function checkCompletionStatus(){Adapt.checkingCompletion();_.defer(this.checkCompletionStatusFor.bind(this),"_isComplete")}},{key:"checkInteractionCompletionStatus",value:function checkInteractionCompletionStatus(){Adapt.checkingCompletion();_.defer(this.checkCompletionStatusFor.bind(this),"_isInteractionComplete")}},{key:"checkCompletionStatusFor",value:function checkCompletionStatusFor(){var completionAttribute=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"_isComplete";var completed=false;var children=this.getAvailableChildModels();var requireCompletionOf=this.get("_requireCompletionOf");if(requireCompletionOf===-1){completed=children.every(function(child){return child.get(completionAttribute)||child.get("_isOptional")})}else{completed=children.filter(function(child){return child.get(completionAttribute)&&!child.get("_isOptional")}).length>=requireCompletionOf}this.set(completionAttribute,completed);Adapt.checkedCompletion()}},{key:"getTypeGroup",value:function getTypeGroup(){}},{key:"isTypeGroup",value:function isTypeGroup(typeGroup){var hasUpperCase=/[A-Z]+/.test(typeGroup);var isPluralized=typeGroup.slice(-1)==="s";var lowerCased=typeGroup.toLowerCase();var singular=isPluralized&&lowerCased.slice(0,-1);var singularLowerCased=(singular||lowerCased).toLowerCase();if(isPluralized||hasUpperCase){Adapt.log.deprecated("'".concat(typeGroup,"' appears pluralized or contains uppercase characters, suggest using the singular, lowercase type group '").concat(singularLowerCased,"'."))}var pluralizedLowerCaseTypes=[singularLowerCased,!isPluralized&&"".concat(lowerCased,"s")].filter(Boolean);var typeGroups=this.getTypeGroups();if(_.intersection(pluralizedLowerCaseTypes,typeGroups).length){return true}return false}},{key:"getTypeGroups",value:function getTypeGroups(){if(this._typeGroups)return this._typeGroups;var typeGroups=[this.get("_type")];var parentClass=this;while(parentClass=Object.getPrototypeOf(parentClass)){if(!parentClass.hasOwnProperty("getTypeGroup"))continue;typeGroups.push(parentClass.getTypeGroup.call(this))}return this._typeGroups=_.uniq(typeGroups.filter(Boolean).map(function(s){return s.toLowerCase()}))}},{key:"findAncestor",value:function findAncestor(ancestorType){var parent=this.getParent();if(!parent)return;if(!ancestorType||parent.isTypeGroup(ancestorType)){return parent}return parent.findAncestor(ancestorType)}},{key:"findDescendantModels",value:function findDescendantModels(descendants,options){var allDescendantsModels=this.getAllDescendantModels();var returnedDescendants=allDescendantsModels.filter(function(model){return model.isTypeGroup(descendants)});if(!options){return returnedDescendants}if(options.where){return returnedDescendants.filter(function(descendant){for(var property in options.where){var value=options.where[property];if(descendant.get(property)!==value){return false}}return true})}}},{key:"getAllDescendantModels",value:function getAllDescendantModels(isParentFirst){var descendants=[];if(!this.hasManagedChildren){return descendants}var children=this.getChildren();children.models.forEach(function(child){if(!child.hasManagedChildren){descendants.push(child);return}var subDescendants=child.getAllDescendantModels(isParentFirst);if(isParentFirst===true){descendants.push(child)}descendants.push.apply(descendants,_toConsumableArray(subDescendants));if(isParentFirst!==true){descendants.push(child)}});return descendants}},{key:"findRelativeModel",value:function findRelativeModel(relativeString){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var rootModel=options.limitParentId?Adapt.findById(options.limitParentId):Adapt.course;var relativeDescriptor=Adapt.parseRelativeString(relativeString);var searchBackwards=relativeDescriptor.offset<0;var moveBy=Math.abs(relativeDescriptor.offset);var movementCount=0;var hasDescendantsOfType=Boolean(this.findDescendantModels(relativeDescriptor.type).length);if(hasDescendantsOfType){moveBy--}var pageDescendants;if(searchBackwards){var _pageDescendants;pageDescendants=[rootModel];(_pageDescendants=pageDescendants).push.apply(_pageDescendants,_toConsumableArray(rootModel.getAllDescendantModels(true)));pageDescendants.reverse()}else{pageDescendants=rootModel.getAllDescendantModels(false);pageDescendants.push(rootModel)}var modelId=this.get("_id");var modelIndex=pageDescendants.findIndex(function(pageDescendant){if(pageDescendant.get("_id")===modelId){return true}return false});var isFilterFunction=typeof options.filter==="function";if(options.loop){var totalOfType=pageDescendants.reduce(function(count,model){if(!model.isTypeGroup(relativeDescriptor.type))return count;return++count},0);moveBy=moveBy%totalOfType;pageDescendants=pageDescendants.concat(pageDescendants.slice(0))}for(var i=modelIndex,l=pageDescendants.length;i<l;i++){var descendant=pageDescendants[i];if(!descendant.isTypeGroup(relativeDescriptor.type))continue;var isSelf=i===modelIndex;if(!isSelf&&isFilterFunction&&!options.filter(descendant))continue;if(movementCount>moveBy){break}if(movementCount===moveBy){return Adapt.findById(descendant.get("_id"))}movementCount++}}},{key:"hasManagedChildren",get:function(){return true}},{key:"getChildren",value:function getChildren(){if(this._childrenCollection){return this._childrenCollection}var childrenCollection;if(!this.hasManagedChildren){childrenCollection=new Backbone.Collection}else{var id=this.get("_id");var children=Adapt.data.filter(function(model){return model.get("_parentId")===id});childrenCollection=new Backbone.Collection(children)}if(this.get("_type")==="block"&&childrenCollection.length===2&&childrenCollection.models[0].get("_layout")!=="left"){childrenCollection.comparator="_layout";childrenCollection.sort()}this.setChildren(childrenCollection);return this._childrenCollection}},{key:"setChildren",value:function setChildren(children){this._childrenCollection=children;this.set("_children",children)}},{key:"getAvailableChildModels",value:function getAvailableChildModels(){return this.getChildren().where({_isAvailable:true})}},{key:"getParent",value:function getParent(){if(this._parentModel){return this._parentModel}var parentId=this.get("_parentId");if(!parentId)return;this.setParent(Adapt.findById(parentId));return this._parentModel}},{key:"setParent",value:function setParent(parent){this._parentModel=parent;this.set("_parentId",this._parentModel.get("_id"));this.set("_parent",this._parentModel)}},{key:"getAncestorModels",value:function getAncestorModels(shouldIncludeChild){var parents=[];var context=this;if(shouldIncludeChild)parents.push(context);while(context.has("_parentId")){context=context.getParent();parents.push(context)}return parents.length?parents:null}},{key:"getSiblings",value:function getSiblings(passSiblingsAndIncludeSelf){var id=this.get("_id");var parentId=this.get("_parentId");var siblings;if(!passSiblingsAndIncludeSelf){if(this._hasSiblingsAndSelf===false){return this.get("_siblings")}siblings=Adapt.data.filter(function(model){return model.get("_parentId")===parentId&&model.get("_id")!==id});this._hasSiblingsAndSelf=false}else{if(this._hasSiblingsAndSelf){return this.get("_siblings")}siblings=Adapt.data.filter(function(model){return model.get("_parentId")===parentId});this._hasSiblingsAndSelf=true}var siblingsCollection=new Backbone.Collection(siblings);this.set("_siblings",siblingsCollection);return siblingsCollection}},{key:"setOnChildren",value:function setOnChildren(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this.set.apply(this,args);if(!this.hasManagedChildren)return;var children=this.getChildren();children.models.forEach(function(child){return child.setOnChildren.apply(child,args)})}},{key:"setOptional",value:function setOptional(value){Adapt.log.deprecated("Use model.set('_isOptional', value) as setOptional() may be removed in the future");this.set({_isOptional:value})}},{key:"checkLocking",value:function checkLocking(){var lockType=this.get("_lockType");if(!lockType)return;switch(lockType){case"sequential":this.setSequentialLocking();break;case"unlockFirst":this.setUnlockFirstLocking();break;case"lockLast":this.setLockLastLocking();break;case"custom":this.setCustomLocking();break;default:console.warn("AdaptModel.checkLocking: unknown _lockType '".concat(lockType,"' found on ").concat(this.get("_id")));}}},{key:"setSequentialLocking",value:function setSequentialLocking(){var children=this.getAvailableChildModels();for(var i=1,j=children.length;i<j;i++){children[i].set("_isLocked",!children[i-1].get("_isComplete"))}}},{key:"setUnlockFirstLocking",value:function setUnlockFirstLocking(){var children=this.getAvailableChildModels();var isFirstChildComplete=children[0].get("_isComplete");for(var i=1,j=children.length;i<j;i++){children[i].set("_isLocked",!isFirstChildComplete)}}},{key:"setLockLastLocking",value:function setLockLastLocking(){var children=this.getAvailableChildModels();var lastIndex=children.length-1;for(var i=lastIndex-1;i>=0;i--){if(!children[i].get("_isComplete")){return children[lastIndex].set("_isLocked",true)}}children[lastIndex].set("_isLocked",false)}},{key:"setCustomLocking",value:function setCustomLocking(){var _this4=this;var children=this.getAvailableChildModels();children.forEach(function(child){child.set("_isLocked",_this4.shouldLock(child))})}},{key:"shouldLock",value:function shouldLock(child){var lockedBy=child.get("_lockedBy");if(!lockedBy)return false;for(var i=lockedBy.length-1;i>=0;i--){var id=lockedBy[i];try{var model=Adapt.findById(id);if(!model.get("_isAvailable"))continue;if(!model.get("_isComplete"))return true}catch(e){console.warn("AdaptModel.shouldLock: unknown _lockedBy ID '".concat(id,"' found on ").concat(child.get("_id")))}}return false}},{key:"onIsComplete",value:function onIsComplete(){this.checkCompletionStatus();this.checkLocking()}},{key:"checkIfResetOnRevisit",value:function checkIfResetOnRevisit(){var isResetOnRevisit=this.get("_isResetOnRevisit");if(!isResetOnRevisit){return}this.reset(isResetOnRevisit)}},{key:"deepClone",value:function deepClone(){var modifier=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var ModelClass=this.constructor;var clonedModel=new ModelClass(this.toJSON());if(modifier){modifier(clonedModel,this)}var clonedId=clonedModel.get("_id");var hasId=Boolean(clonedId);var shouldAssignUniqueId=this.get("_id")===clonedId;if(hasId&&shouldAssignUniqueId){var cid=_.uniqueId(ModelClass.prototype.cidPrefix||"c");clonedId="".concat(clonedId,"_").concat(cid);clonedModel.set("_id",clonedId)}if(hasId){Adapt.data.add(clonedModel)}if(this.hasManagedChildren){this.getChildren().each(function(child){if(!child.deepClone){throw new Error("Cannot deepClone child.")}child.deepClone(function(clone,child){if(hasId){clone.set("_parentId",clonedId)}if(modifier){modifier(clone,child)}})})}clonedModel.getParent().getChildren().add(clonedModel);clonedModel.setupModel();return clonedModel}},{key:"onAll",value:function onAll(type,model,value){if(!_.result(this,"bubblingEvents").includes(type))return;var event=new ModelEvent(type,model,value);this.bubble(event)}},{key:"bubble",value:function bubble(event){if(!event.canBubble)return;event.addPath(this);this.trigger("bubble:".concat(event.type," bubble"),event)}}]);return AdaptModel}(LockingModel));var ContentObjectModel=__AMD("core/js/models/contentObjectModel",function(_AdaptModel){_inherits(ContentObjectModel,_AdaptModel);var _super=_createSuper(ContentObjectModel);function ContentObjectModel(){_classCallCheck(this,ContentObjectModel);return _super.apply(this,arguments)}_createClass(ContentObjectModel,[{key:"_parent",get:function(){Adapt.log.deprecated("contentObjectModel._parent, use contentObjectModel.getParent() instead, parent models are defined by the JSON");var isParentCourse=this.get("_parentId")===Adapt.course.get("_id");if(isParentCourse){return"course"}return"contentObjects"}},{key:"_siblings",get:function(){Adapt.log.deprecated("contentObjectModel._siblings, use contentObjectModel.getSiblings() instead, sibling models are defined by the JSON");return"contentObjects"}},{key:"_children",get:function(){Adapt.log.deprecated("contentObjectModel._children, use contentObjectModel.hasManagedChildren instead, child models are defined by the JSON");return null}},{key:"getTypeGroup",value:function getTypeGroup(){return"contentobject"}}]);return ContentObjectModel}(AdaptModel));var MenuModel=function(_ContentObjectModel){_inherits(MenuModel,_ContentObjectModel);var _super=_createSuper(MenuModel);function MenuModel(){_classCallCheck(this,MenuModel);return _super.apply(this,arguments)}_createClass(MenuModel,[{key:"_children",get:function(){Adapt.log.deprecated("menuModel._children, use menuModel.hasManagedChildren instead, child models are defined by the JSON");return"contentObjects"}},{key:"getTypeGroup",value:function getTypeGroup(){return"menu"}},{key:"setCustomLocking",value:function setCustomLocking(){var _this=this;var children=this.getAvailableChildModels();children.forEach(function(child){child.set("_isLocked",_this.shouldLock(child));if(!(child instanceof MenuModel))return;child.checkLocking()})}}]);return MenuModel}(ContentObjectModel);Adapt.register("menu",{model:MenuModel});var MenuModel$1=__AMD("core/js/models/menuModel",MenuModel);var CourseModel=function(_MenuModel){_inherits(CourseModel,_MenuModel);var _super=_createSuper(CourseModel);function CourseModel(){_classCallCheck(this,CourseModel);return _super.apply(this,arguments)}_createClass(CourseModel,[{key:"_parent",get:function(){Adapt.log.deprecated("courseModel._parent, use courseModel.getParent() instead, parent models are defined by the JSON");return null}},{key:"_siblings",get:function(){Adapt.log.deprecated("courseModel._siblings, use courseModel.getSiblings() instead, sibling models are defined by the JSON");return null}}]);return CourseModel}(MenuModel$1);Adapt.register("course",{model:CourseModel});var CourseModel$1=__AMD("core/js/models/courseModel",CourseModel);var StartController=function(_Backbone$Controller){_inherits(StartController,_Backbone$Controller);var _super=_createSuper(StartController);function StartController(){_classCallCheck(this,StartController);return _super.apply(this,arguments)}_createClass(StartController,[{key:"initialize",value:function initialize(){var _get2;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}(_get2=_get(_getPrototypeOf(StartController.prototype),"initialize",this)).call.apply(_get2,[this].concat(args));this.model=null}},{key:"loadCourseData",value:function loadCourseData(){this.model=new LockingModel(Adapt.course.get("_start"))}},{key:"setStartLocation",value:function setStartLocation(){if(!this.isEnabled())return;window.history.replaceState("","",this.getStartHash())}},{key:"returnToStartLocation",value:function returnToStartLocation(){var startIds=this.model.get("_startIds");if(startIds){startIds.forEach(function(startId){return startId._skipIfComplete=false})}window.location.hash=this.getStartHash(true)}},{key:"getStartHash",value:function getStartHash(alwaysForce){var startId=this.getStartId();var isRouteSpecified=window.location.href.indexOf("#")>-1;var shouldForceStartId=alwaysForce||this.model.get("_force");var shouldNavigateToStartId=startId&&(!isRouteSpecified||shouldForceStartId);if(shouldNavigateToStartId&&startId!==Adapt.course.get("_id")){return"#/id/"+startId}return window.location.hash||"#/"}},{key:"isEnabled",value:function isEnabled(){var _this$model;return Boolean((_this$model=this.model)===null||_this$model===void 0?void 0:_this$model.get("_isEnabled"))}},{key:"getStartId",value:function getStartId(){var startId=this.model.get("_id");var startIds=this.model.get("_startIds");if(!(startIds!==null&&startIds!==void 0&&startIds.length))return startId;var $html=$("html");for(var i=0,l=startIds.length;i<l;i++){var item=startIds[i];var className=item._className;var skipIfComplete=item._skipIfComplete;var model=Adapt.findById(item._id);if(!model){console.log("startController: cannot find id",item._id);continue}if(skipIfComplete){if(model.get("_isComplete"))continue}if(!className||$html.is(className)||$html.hasClass(className)){startId=item._id;break}}return startId}}]);return StartController}(Backbone.Controller);Adapt.once("adapt:start",function(){Adapt.startController.loadCourseData();Adapt.startController.setStartLocation()});Adapt.on("navigation:returnToStart",function(){Adapt.startController.returnToStartLocation()});__AMD("core/js/startController",Adapt.startController=new StartController);var Data=function(_AdaptCollection){_inherits(Data,_AdaptCollection);var _super=_createSuper(Data);function Data(){_classCallCheck(this,Data);return _super.apply(this,arguments)}_createClass(Data,[{key:"model",value:function model(json){var ModelClass=Adapt.getModelClass(json);if(!ModelClass){return new LockingModel(json)}return new ModelClass(json,{parse:true})}},{key:"initialize",value:function initialize(){_get(_getPrototypeOf(Data.prototype),"initialize",this).call(this);this.on({"add":this.onAdded,"remove":this.onRemoved})}},{key:"init",value:function(){var _init=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:this.reset();this._byAdaptID={};Adapt.build=new BuildModel(null,{url:"adapt/js/build.min.js",reset:true});_context.next=5;return Adapt.build.whenReady();case 5:$("html").attr("data-adapt-framework-version",Adapt.build.get("package").version);this.loadConfigData();case 7:case"end":return _context.stop();}},_callee,this)}));function init(){return _init.apply(this,arguments)}return init}()},{key:"onAdded",value:function onAdded(model){this._byAdaptID[model.get("_id")]=model}},{key:"onRemoved",value:function onRemoved(model){delete this._byAdaptID[model.get("_id")]}},{key:"loadConfigData",value:function loadConfigData(){Adapt.config=new ConfigModel(null,{url:"course/config."+Adapt.build.get("jsonext"),reset:true});this.listenToOnce(Adapt,"configModel:loadCourseData",this.onLoadCourseData);this.listenTo(Adapt.config,{"change:_activeLanguage":this.onLanguageChange,"change:_defaultDirection":this.onDirectionChange})}},{key:"onDirectionChange",value:function onDirectionChange(model,direction){if(direction==="rtl"){$("html").removeClass("dir-ltr").addClass("dir-rtl").attr("dir","rtl")}else{$("html").removeClass("dir-rtl").addClass("dir-ltr").attr("dir","ltr")}}},{key:"onLoadCourseData",value:function onLoadCourseData(){if(!Adapt.config.get("_activeLanguage")){Adapt.config.set("_activeLanguage",Adapt.config.get("_defaultLanguage"));return}this.loadCourseData()}},{key:"onLanguageChange",value:function onLanguageChange(model,language){Adapt.offlineStorage.set("lang",language);if(Adapt.get("_isStarted")){Adapt.set("_isStarted",false)}this.loadCourseData(language)}},{key:"loadCourseData",value:function(){var _loadCourseData=_asyncToGenerator(_regeneratorRuntime().mark(function _callee2(newLanguage){var language,courseFolder;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:language=Adapt.config.get("_activeLanguage");courseFolder="course/"+language+"/";$("html").attr("lang",language);_context2.next=5;return this.loadManifestFiles(courseFolder);case 5:_context2.next=7;return this.triggerDataLoaded();case 7:_context2.next=9;return this.triggerDataReady(newLanguage);case 9:this.triggerInit();case 10:case"end":return _context2.stop();}},_callee2,this)}));function loadCourseData(_x){return _loadCourseData.apply(this,arguments)}return loadCourseData}()},{key:"getJSON",value:function getJSON(path){return new Promise(function(resolve,reject){$.getJSON(path,function(data){data.__path__=path;resolve(data)}).fail(reject)})}},{key:"loadManifestFiles",value:function(){var _loadManifestFiles=_asyncToGenerator(_regeneratorRuntime().mark(function _callee3(languagePath){var _this=this;var manifestPath,manifest,allFileData,allModelData,course;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:this.trigger("loading");this.reset();manifestPath=languagePath+"language_data_manifest.js";_context3.prev=3;_context3.next=6;return this.getJSON(manifestPath);case 6:manifest=_context3.sent;_context3.next=13;break;case 9:_context3.prev=9;_context3.t0=_context3["catch"](3);manifest=["course.json","contentObjects.json","articles.json","blocks.json","components.json"];Adapt.log.warnOnce("Manifest path '".concat(manifestPath," not found. Using traditional files: ").concat(manifest.join(", ")));case 13:_context3.next=15;return Promise.all(manifest.map(function(filePath){return _this.getJSON("".concat(languagePath).concat(filePath))}));case 15:allFileData=_context3.sent;allModelData=allFileData.reduce(function(result,fileData){if(Array.isArray(fileData)){result.push.apply(result,_toConsumableArray(fileData))}else if(fileData instanceof Object){result.push(fileData)}else{Adapt.log.warnOnce("File data isn't an array or object: ".concat(fileData.__path__))}return result},[]);course=allModelData.find(function(modelData){return modelData._type==="course"});if(course){_context3.next=20;break}throw new Error("Expected a model data with \"_type\": \"course\", none found.");case 20:Adapt.trigger("courseModel:dataLoading");Adapt.course=this.push(course);Adapt.trigger("courseModel:dataLoaded");allModelData.forEach(function(modelData){if(modelData._type==="course"){return}_this.push(modelData)});this.trigger("reset");this.trigger("loaded");_context3.next=28;return Adapt.wait.queue();case 28:case"end":return _context3.stop();}},_callee3,this,[[3,9]])}));function loadManifestFiles(_x2){return _loadManifestFiles.apply(this,arguments)}return loadManifestFiles}()},{key:"triggerDataLoaded",value:function(){var _triggerDataLoaded=_asyncToGenerator(_regeneratorRuntime().mark(function _callee4(){return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:Adapt.log.debug("Firing app:dataLoaded");try{this.forEach(function(model){var _model$setupModel;return(_model$setupModel=model.setupModel)===null||_model$setupModel===void 0?void 0:_model$setupModel.call(model)});Adapt.trigger("app:dataLoaded")}catch(e){Adapt.log.error("Error during app:dataLoading trigger",e)}_context4.next=4;return Adapt.wait.queue();case 4:case"end":return _context4.stop();}},_callee4,this)}));function triggerDataLoaded(){return _triggerDataLoaded.apply(this,arguments)}return triggerDataLoaded}()},{key:"triggerDataReady",value:function(){var _triggerDataReady=_asyncToGenerator(_regeneratorRuntime().mark(function _callee5(newLanguage){return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:if(newLanguage){Adapt.trigger("app:languageChanged",newLanguage);_.defer(function(){Adapt.startController.loadCourseData();var hash=Adapt.startController.isEnabled()?Adapt.startController.getStartHash(false):"#/";Adapt.router.navigate(hash,{trigger:true,replace:true})})}Adapt.log.debug("Firing app:dataReady");try{Adapt.trigger("app:dataReady")}catch(e){Adapt.log.error("Error during app:dataReady trigger",e)}_context5.next=5;return Adapt.wait.queue();case 5:case"end":return _context5.stop();}},_callee5)}));function triggerDataReady(_x3){return _triggerDataReady.apply(this,arguments)}return triggerDataReady}()},{key:"triggerInit",value:function triggerInit(){this.isReady=true;this.trigger("ready")}},{key:"whenReady",value:function whenReady(){var _this2=this;if(this.isReady)return Promise.resolve();return new Promise(function(resolve){_this2.once("ready",resolve)})}},{key:"findById",value:function findById(id){var model=this._byAdaptID[id];if(!model){console.warn("Adapt.findById() unable to find id: ".concat(id));return}return model}},{key:"findByTrackingPosition",value:function findByTrackingPosition(trackingPosition){var _trackingPosition=_slicedToArray(trackingPosition,2),trackingId=_trackingPosition[0],indexInTrackingIdDescendants=_trackingPosition[1];var trackingIdModel=this.find(function(model){return model.get("_trackingId")===trackingId});if(!trackingIdModel){console.warn("Adapt.findByTrackingPosition() unable to find trackingPosition: ".concat(trackingPosition));return}if(indexInTrackingIdDescendants>=0){var trackingIdDescendants=[trackingIdModel].concat(trackingIdModel.getAllDescendantModels(true));return trackingIdDescendants[indexInTrackingIdDescendants]}var trackingIdAncestors=trackingIdModel.getAncestorModels();var ancestorDistance=Math.abs(indexInTrackingIdDescendants)-1;return trackingIdAncestors[ancestorDistance]}}]);return Data}(AdaptCollection);var Data$1=__AMD("core/js/data",Adapt.data=new Data);var OfflineStorage$2=function(_Backbone$Controller){_inherits(OfflineStorage,_Backbone$Controller);var _super=_createSuper(OfflineStorage);function OfflineStorage(){_classCallCheck(this,OfflineStorage);return _super.apply(this,arguments)}_createClass(OfflineStorage,[{key:"initialize",value:function initialize(handler){this.ready=true;this._handler=undefined;if(!handler){return}this.ready=false;this._handler=handler}},{key:"hasHandler",value:function hasHandler(){return this._handler!==undefined}},{key:"save",value:function save(){var _this$_handler,_this$_handler$save;Adapt.trigger("tracking:save");return(_this$_handler=this._handler)===null||_this$_handler===void 0?void 0:(_this$_handler$save=_this$_handler.save)===null||_this$_handler$save===void 0?void 0:_this$_handler$save.apply(this._handler,arguments)}},{key:"serialize",value:function serialize(value){var _this$_handler2;if((_this$_handler2=this._handler)!==null&&_this$_handler2!==void 0&&_this$_handler2.serialize){return this._handler.serialize.apply(this._handler,arguments)}return JSON.stringify(value)}},{key:"deserialize",value:function deserialize(value){var _this$_handler3;if((_this$_handler3=this._handler)!==null&&_this$_handler3!==void 0&&_this$_handler3.deserialize){return this._handler.deserialize.apply(this._handler,arguments)}return JSON.parse(value)}},{key:"set",value:function set(name,value){var _this$_handler4;if((_this$_handler4=this._handler)!==null&&_this$_handler4!==void 0&&_this$_handler4.set){return this._handler.set.apply(this._handler,arguments)}this[name]=value}},{key:"get",value:function get(name){var _this$_handler5;if((_this$_handler5=this._handler)!==null&&_this$_handler5!==void 0&&_this$_handler5.get){return this._handler.get.apply(this._handler,arguments)}return this[name]}},{key:"setReadyStatus",value:function setReadyStatus(){this.ready=true;Adapt.trigger("offlineStorage:ready")}}]);return OfflineStorage}(Backbone.Controller);Adapt.offlineStorage=new OfflineStorage$2;__AMD("core/js/offlineStorage",Adapt.offlineStorage);var COMPLETION_STATE=ENUM(["INCOMPLETE","COMPLETED","PASSED","FAILED"]);var COMPLETION_STATE$1=__AMD("core/js/enums/completionStateEnum",COMPLETION_STATE);var Tracking=function(_Backbone$Controller){_inherits(Tracking,_Backbone$Controller);var _super=_createSuper(Tracking);function Tracking(){_classCallCheck(this,Tracking);return _super.apply(this,arguments)}_createClass(Tracking,[{key:"initialize",value:function initialize(){this._config={_requireContentCompleted:true,_requireAssessmentCompleted:false};this._assessmentState=null;Adapt.once("configModel:dataLoaded",this.loadConfig.bind(this));Adapt.on("app:dataReady",this.setupEventListeners.bind(this))}},{key:"setupEventListeners",value:function setupEventListeners(){if(this._config._requireAssessmentCompleted){this.listenTo(Adapt,{"assessment:complete":this.onAssessmentComplete,"assessment:restored":this.onAssessmentRestored})}if(this._config._requireContentCompleted){this.listenTo(Adapt.course,"change:_isComplete",this.checkCompletion)}}},{key:"onAssessmentComplete",value:function onAssessmentComplete(assessmentState){this._assessmentState=assessmentState;this.checkCompletion()}},{key:"onAssessmentRestored",value:function onAssessmentRestored(assessmentState){this._assessmentState=assessmentState}},{key:"checkCompletion",value:function checkCompletion(){var completionData=this.getCompletionData();if(completionData.status===COMPLETION_STATE$1.INCOMPLETE){return}Adapt.trigger("tracking:complete",completionData);Adapt.log.debug("tracking:complete",completionData)}},{key:"getCompletionData",value:function getCompletionData(){var completionData={status:COMPLETION_STATE$1.INCOMPLETE,assessment:null};if(this._config._requireContentCompleted&&!Adapt.course.get("_isComplete")){return completionData}if(this._config._requireAssessmentCompleted){if(!this._assessmentState){return completionData}completionData.status=this._assessmentState.isPass?COMPLETION_STATE$1.PASSED:COMPLETION_STATE$1.FAILED;completionData.assessment=this._assessmentState;return completionData}completionData.status=COMPLETION_STATE$1.COMPLETED;return completionData}},{key:"loadConfig",value:function loadConfig(){if(Adapt.config.has("_completionCriteria")){this._config=Adapt.config.get("_completionCriteria")}}}]);return Tracking}(Backbone.Controller);Adapt.tracking=new Tracking;__AMD("core/js/tracking",Adapt.tracking);var Device=function(_Backbone$Controller){_inherits(Device,_Backbone$Controller);var _super=_createSuper(Device);function Device(){_classCallCheck(this,Device);return _super.apply(this,arguments)}_createClass(Device,[{key:"initialize",value:function initialize(){this.$html=$("html");this.$window=$(window);this.touch=Modernizr.touchevents;this.screenWidth=this.getScreenWidth();this.screenHeight=this.getScreenHeight();this.browser=(Bowser__default["default"].name||"").toLowerCase();this.version=(Bowser__default["default"].version||"").toLowerCase();this.OS=this.getOperatingSystem().toLowerCase();this.osVersion=Bowser__default["default"].osversion||"";this.renderingEngine=this.getRenderingEngine();this.onWindowResize=_.debounce(this.onWindowResize.bind(this),100);this.listenTo(Adapt,{"configModel:dataLoaded":this.onConfigDataLoaded});var browser=this.browser.toLowerCase();var browserString=browser.replace(/msie|internet explorer/,"ie");browserString+=" version-".concat(this.version," OS-").concat(this.OS," ").concat(this.getAppleDeviceType());browserString+=browserString.replace(".","-").toLowerCase();browserString+=" pixel-density-".concat(this.pixelDensity());this.$html.addClass(browserString)}},{key:"orientation",get:function(){return this.screenWidth>=this.screenHeight?"landscape":"portrait"}},{key:"aspectRatio",get:function(){return this.screenWidth/this.screenHeight}},{key:"onConfigDataLoaded",value:function onConfigDataLoaded(){this.screenSize=this.checkScreenSize();this.$html.addClass("size-"+this.screenSize);if(this.orientation){this.$html.addClass("orientation-"+this.orientation)}this.$window.on("resize orientationchange",this.onWindowResize)}},{key:"checkScreenSize",value:function checkScreenSize(){var screenSizeConfig=Adapt.config.get("screenSize");var screenSize;var screensizeEmThreshold=300;var baseFontSize=16;var mediumEmBreakpoint=screenSizeConfig.medium>screensizeEmThreshold?screenSizeConfig.medium/baseFontSize:screenSizeConfig.medium;var smallEmBreakpoint=screenSizeConfig.small>screensizeEmThreshold?screenSizeConfig.small/baseFontSize:screenSizeConfig.small;var fontSize=parseFloat($("html").css("font-size"));var screenSizeEmWidth=this.screenWidth/fontSize;if(screenSizeEmWidth>=mediumEmBreakpoint){screenSize="large"}else if(screenSizeEmWidth>=smallEmBreakpoint){screenSize="medium"}else{screenSize="small"}return screenSize}},{key:"getScreenWidth",value:function getScreenWidth(){return this.isAppleDevice()?this.getAppleScreenWidth():window.innerWidth||this.$window.width()}},{key:"getScreenHeight",value:function getScreenHeight(){return this.isAppleDevice()?this.getAppleScreenHeight():window.innerHeight||this.$window.height()}},{key:"getOperatingSystem",value:function getOperatingSystem(){var flags=["windows","mac","linux","windowsphone","chromeos","android","ios","blackberry","firefoxos","webos","bada","tizen","sailfish"];var os=flags.find(function(name){return Bowser__default["default"][name]})||"";if(os===""){var platform=navigator.platform.toLowerCase();var match=platform.match(/win|mac|linux/);if(match)os=match[0];if(os==="win")os="windows";if(!os)os="PlatformUnknown"}return os}},{key:"getRenderingEngine",value:function getRenderingEngine(){var flags=["webkit","blink","gecko","msie","msedge"];return flags.find(function(name){return Bowser__default["default"][name]})||""}},{key:"onWindowResize",value:function onWindowResize(){var previousWidth=this.screenWidth;var previousHeight=this.screenHeight;this.screenWidth=this.getScreenWidth();this.screenHeight=this.getScreenHeight();if(previousWidth===this.screenWidth&&previousHeight===this.screenHeight){return}var newScreenSize=this.checkScreenSize();if(newScreenSize!==this.screenSize){this.screenSize=newScreenSize;this.$html.removeClass("size-small size-medium size-large").addClass("size-"+this.screenSize);if(this.orientation){this.$html.removeClass("orientation-landscape orientation-portrait").addClass("orientation-"+this.orientation)}Adapt.trigger("device:changed",this.screenSize)}Adapt.trigger("device:preResize device:resize device:postResize",this.screenWidth)}},{key:"isAppleDevice",value:function isAppleDevice(){return /iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}},{key:"getAppleScreenWidth",value:function getAppleScreenWidth(){return Math.abs(window.orientation)===90?window.screen.height:window.screen.width}},{key:"getAppleScreenHeight",value:function getAppleScreenHeight(){return Math.abs(window.orientation)===90?window.screen.width:window.screen.height}},{key:"getAppleDeviceType",value:function getAppleDeviceType(){var flags=["iphone","ipad","ipod"];return flags.find(function(name){return Bowser__default["default"][name]})||""}},{key:"pixelDensity",value:function pixelDensity(){var pixelDensity=window.devicePixelRatio||1;if(pixelDensity>=3){return"ultra-high"}else if(pixelDensity>=2){return"high"}else if(pixelDensity>=1.5){return"medium"}else{return"low"}}}]);return Device}(Backbone.Controller);__AMD("core/js/device",Adapt.device=new Device);var DrawerItemView=function(_Backbone$View){_inherits(DrawerItemView,_Backbone$View);var _super=_createSuper(DrawerItemView);function DrawerItemView(){_classCallCheck(this,DrawerItemView);return _super.apply(this,arguments)}_createClass(DrawerItemView,[{key:"className",value:function className(){return"drawer__menu drawer__item"}},{key:"attributes",value:function attributes(){return{role:"list"}}},{key:"initialize",value:function initialize(){this.listenTo(Adapt,"drawer:empty",this.remove);this.render()}},{key:"events",value:function events(){return{"click .drawer__item-btn":"onDrawerItemClicked"}}},{key:"render",value:function render(){var data=this.model.toJSON();var template=Handlebars.templates["drawerItem"];$(this.el).html(template(data)).appendTo(".drawer__holder");return this}},{key:"onDrawerItemClicked",value:function onDrawerItemClicked(event){event.preventDefault();var eventCallback=this.model.get("eventCallback");Adapt.trigger(eventCallback)}}]);return DrawerItemView}(Backbone.View);DrawerItemView.type="drawerItem";var DrawerItemView$1=__AMD("core/js/views/drawerItemView",DrawerItemView);var DrawerView=function(_Backbone$View){_inherits(DrawerView,_Backbone$View);var _super=_createSuper(DrawerView);function DrawerView(){_classCallCheck(this,DrawerView);return _super.apply(this,arguments)}_createClass(DrawerView,[{key:"className",value:function className(){return"drawer u-display-none"}},{key:"attributes",value:function attributes(){return{"role":"dialog","aria-modal":"true","aria-labelledby":"drawer-heading","aria-hidden":"true"}}},{key:"initialize",value:function initialize(){var _Adapt$config$get$_du,_Adapt$config$get;this._isVisible=false;this.disableAnimation=Adapt.config.has("_disableAnimation")?Adapt.config.get("_disableAnimation"):false;this.drawerDir=Adapt.config.get("_defaultDirection")==="rtl"?"left":"right";this.drawerDuration=(_Adapt$config$get$_du=(_Adapt$config$get=Adapt.config.get("_drawer"))===null||_Adapt$config$get===void 0?void 0:_Adapt$config$get._duration)!==null&&_Adapt$config$get$_du!==void 0?_Adapt$config$get$_du:400;this.setupEventListeners();this.render()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(Adapt,{"navigation:toggleDrawer":this.toggleDrawer,"drawer:triggerCustomView":this.openCustomView,"drawer:closeDrawer":this.onCloseDrawer,"remove":this.onRemove,"drawer:remove":this.remove});this.onKeyUp=this.onKeyUp.bind(this);this.setupEscapeKey()}},{key:"setupEscapeKey",value:function setupEscapeKey(){$(window).on("keyup",this.onKeyUp)}},{key:"onKeyUp",value:function onKeyUp(event){if(event.which!==27)return;event.preventDefault();this.onCloseDrawer()}},{key:"events",value:function events(){return{"click .drawer__back":"onBackButtonClicked","click .drawer__close":"onCloseClicked"}}},{key:"render",value:function render(){var template=Handlebars.templates.drawer;$(this.el).html(template({_globals:Adapt.course.get("_globals")})).prependTo("body");var shadowTemplate=Handlebars.templates.shadow;$(shadowTemplate()).prependTo("body");_.defer(this.postRender.bind(this));return this}},{key:"postRender",value:function postRender(){this.$("a, button, input, select, textarea").attr("tabindex",-1);this.checkIfDrawerIsAvailable()}},{key:"openCustomView",value:function openCustomView(view,hasBackButton){this._hasBackButton=hasBackButton;this._isCustomViewVisible=true;Adapt.trigger("drawer:empty");this.showDrawer();this.$(".drawer__holder").html(view)}},{key:"checkIfDrawerIsAvailable",value:function checkIfDrawerIsAvailable(){var isEmptyDrawer=this.collection.length===0;$(".js-nav-drawer-btn").toggleClass("u-display-none",isEmptyDrawer);if(isEmptyDrawer){Adapt.trigger("drawer:noItems")}}},{key:"onBackButtonClicked",value:function onBackButtonClicked(event){event.preventDefault();this.showDrawer(true)}},{key:"onCloseClicked",value:function onCloseClicked(event){event.preventDefault();this.hideDrawer()}},{key:"onCloseDrawer",value:function onCloseDrawer($toElement){this.hideDrawer($toElement)}},{key:"onRemove",value:function onRemove(){this.hideDrawer()}},{key:"toggleDrawer",value:function toggleDrawer(){if(this._isVisible&&this._isCustomViewVisible===false){this.hideDrawer();return}this.showDrawer(true)}},{key:"showDrawer",value:function showDrawer(emptyDrawer){var _this=this;this.$el.removeClass("u-display-none").removeAttr("aria-hidden");if(!this._isVisible){Adapt.a11y.popupOpened(this.$el);Adapt.a11y.scrollDisable("body");this._isVisible=true}this.$("a, button, input, select, textarea").attr("tabindex",0);if(emptyDrawer){this.$(".drawer__back").addClass("u-display-none");this._isCustomViewVisible=false;this.emptyDrawer();if(this.collection.models.length===1){Adapt.trigger(this.collection.models[0].get("eventCallback"));this._isCustomViewVisible=false}else{this.renderItems();Adapt.trigger("drawer:openedItemView")}}else{var hideDrawerBackButton=!this._hasBackButton||this.collection.models.length<=1;this.$(".drawer__back").toggleClass("u-display-none",hideDrawerBackButton);Adapt.trigger("drawer:openedCustomView")}var complete=function(){_this.addShadowEvent();Adapt.trigger("drawer:opened");Adapt.a11y.focusFirst(_this.$el,{defer:true})};var direction={};if(this.disableAnimation){$(".js-shadow").removeClass("u-display-none");$(".js-drawer-holder").scrollTop(0);direction[this.drawerDir]=0;this.$el.css(direction);complete()}else{var _Adapt$config$get2;$(".js-shadow").velocity({opacity:1},{duration:this.drawerDuration,begin:function(){$(".js-shadow").removeClass("u-display-none");$(".js-drawer-holder").scrollTop(0);complete()}});var easing=((_Adapt$config$get2=Adapt.config.get("_drawer"))===null||_Adapt$config$get2===void 0?void 0:_Adapt$config$get2._showEasing)||"easeOutQuart";direction[this.drawerDir]=0;this.$el.velocity(direction,this.drawerDuration,easing)}}},{key:"emptyDrawer",value:function emptyDrawer(){this.$(".drawer__holder").empty()}},{key:"renderItems",value:function renderItems(){Adapt.trigger("drawer:empty");this.emptyDrawer();this.collection.forEach(function(model){return new DrawerItemView$1({model:model})})}},{key:"hideDrawer",value:function hideDrawer($toElement){var _this2=this;if(!this._isVisible)return;var direction={};Adapt.a11y.popupClosed($toElement);this._isVisible=false;Adapt.a11y.scrollEnable("body");if(this.disableAnimation){direction[this.drawerDir]=-this.$el.width();this.$el.css(direction).addClass("u-display-none").attr("aria-hidden","true");$(".js-shadow").addClass("u-display-none");Adapt.trigger("drawer:closed")}else{var _Adapt$config$get3;var easing=((_Adapt$config$get3=Adapt.config.get("_drawer"))===null||_Adapt$config$get3===void 0?void 0:_Adapt$config$get3._hideEasing)||"easeInQuart";direction[this.drawerDir]=-this.$el.width();this.$el.velocity(direction,this.drawerDuration,easing,function(){_this2.$el.addClass("u-display-none").attr("aria-hidden","true");Adapt.trigger("drawer:closed")});$(".js-shadow").velocity({opacity:0},{duration:this.drawerDuration,complete:function(){$(".js-shadow").addClass("u-display-none")}})}this._isCustomViewVisible=false;this.removeShadowEvent()}},{key:"addShadowEvent",value:function addShadowEvent(){var _this3=this;$(".js-shadow").one("click touchstart",function(){return _this3.onCloseDrawer()})}},{key:"removeShadowEvent",value:function removeShadowEvent(){$(".js-shadow").off("click touchstart")}},{key:"remove",value:function remove(){_get(_getPrototypeOf(DrawerView.prototype),"remove",this).call(this);$(window).off("keyup",this.onKeyUp);Adapt.trigger("drawer:empty");this.collection.reset();$(".js-shadow").remove()}}]);return DrawerView}(Backbone.View);Object.assign(DrawerView,{childContainer:".js-drawer-holder",childView:DrawerItemView$1});var DrawerView$1=__AMD("core/js/views/drawerView",DrawerView);var DrawerCollection=new Backbone.Collection(null,{comparator:"drawerOrder"});var Drawer={};Drawer.addItem=function(drawerObject,eventCallback){drawerObject.eventCallback=eventCallback;DrawerCollection.add(drawerObject)};Drawer.triggerCustomView=function(view,hasBackButton){if(hasBackButton!==false){hasBackButton=true}Adapt.trigger("drawer:triggerCustomView",view,hasBackButton)};Adapt.on({"adapt:start":function(){new DrawerView$1({collection:DrawerCollection})},"app:languageChanged":function(){Adapt.trigger("drawer:remove")}});__AMD("core/js/drawer",Adapt.drawer=Drawer);var NotifyPushView=__AMD("core/js/views/notifyPushView",function(_Backbone$View){_inherits(NotifyPushView,_Backbone$View);var _super=_createSuper(NotifyPushView);function NotifyPushView(){_classCallCheck(this,NotifyPushView);return _super.apply(this,arguments)}_createClass(NotifyPushView,[{key:"className",value:function className(){var classes="notify-push ";classes+=this.model.get("_classes")||"";return classes}},{key:"attributes",value:function attributes(){return{"role":"dialog","aria-labelledby":"notify-push-heading","aria-modal":"false"}}},{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"notify:pushShown notify:pushRemoved":this.updateIndexPosition,"remove":this.remove});this.listenTo(this.model.collection,{"remove":this.updateIndexPosition,"change:_index":this.updatePushPosition});this.preRender();this.render()}},{key:"events",value:function events(){return{"click .js-notify-push-close-btn":"closePush","click .js-notify-push-inner":"triggerEvent"}}},{key:"preRender",value:function preRender(){this.hasBeenRemoved=false}},{key:"render",value:function render(){var data=this.model.toJSON();var template=Handlebars.templates["notifyPush"];this.$el.html(template(data)).appendTo("#wrapper");_.defer(this.postRender.bind(this));return this}},{key:"postRender",value:function postRender(){this.$el.addClass("is-active");_.delay(this.closePush.bind(this),this.model.get("_timeout"));Adapt.trigger("notify:pushShown")}},{key:"closePush",value:function closePush(event){var _this=this;if(event){event.preventDefault()}if(this.hasBeenRemoved===false){this.hasBeenRemoved=true;this.$el.removeClass("is-active");_.delay(function(){_this.model.collection.remove(_this.model);Adapt.trigger("notify:pushRemoved",_this);_this.remove()},600)}}},{key:"triggerEvent",value:function triggerEvent(event){Adapt.trigger(this.model.get("_callbackEvent"));this.closePush()}},{key:"updateIndexPosition",value:function updateIndexPosition(){var _this2=this;if(this.hasBeenRemoved)return;var models=this.model.collection.models;models.forEach(function(model,index){if(!model.get("_isActive"))return;model.set("_index",index);_this2.updatePushPosition()})}},{key:"updatePushPosition",value:function updatePushPosition(){if(this.hasBeenRemoved){return}if(typeof this.model.get("_index")!=="undefined"){var elementHeight=this.$el.height();var offset=20;var navigationHeight=$(".nav").height();var currentIndex=this.model.get("_index");var flippedIndex=currentIndex===0?1:0;if(this.model.collection.where({_isActive:true}).length===1){flippedIndex=0}var positionLowerPush=(elementHeight+offset)*flippedIndex+navigationHeight+offset;this.$el.css("top",positionLowerPush)}}}]);return NotifyPushView}(Backbone.View));var NotifyModel=__AMD("core/js/models/notifyModel",function(_LockingModel){_inherits(NotifyModel,_LockingModel);var _super=_createSuper(NotifyModel);function NotifyModel(){_classCallCheck(this,NotifyModel);return _super.apply(this,arguments)}_createClass(NotifyModel,[{key:"defaults",value:function defaults(){return{_isActive:false,_showIcon:false,_timeout:3000}}}]);return NotifyModel}(LockingModel));var NotifyPushCollection=__AMD("core/js/collections/notifyPushCollection",function(_Backbone$Collection){_inherits(NotifyPushCollection,_Backbone$Collection);var _super=_createSuper(NotifyPushCollection);function NotifyPushCollection(){_classCallCheck(this,NotifyPushCollection);return _super.apply(this,arguments)}_createClass(NotifyPushCollection,[{key:"initialize",value:function initialize(){this.model=NotifyModel;this.listenTo(this,"add",this.onPushAdded);this.listenTo(Adapt,"notify:pushRemoved",this.onRemovePush)}},{key:"onPushAdded",value:function onPushAdded(model){this.checkPushCanShow(model)}},{key:"checkPushCanShow",value:function checkPushCanShow(model){if(!this.canShowPush())return;model.set("_isActive",true);this.showPush(model)}},{key:"canShowPush",value:function canShowPush(){var availablePushNotifications=this.where({_isActive:true});return availablePushNotifications.length<2}},{key:"showPush",value:function showPush(model){new NotifyPushView({model:model})}},{key:"onRemovePush",value:function onRemovePush(view){var inactivePushNotifications=this.where({_isActive:false});if(inactivePushNotifications.length>0){this.checkPushCanShow(inactivePushNotifications[0])}}}]);return NotifyPushCollection}(Backbone.Collection));var ChildEvent=__AMD("core/js/childEvent",function(_Backbone$Controller){_inherits(ChildEvent,_Backbone$Controller);var _super=_createSuper(ChildEvent);function ChildEvent(){_classCallCheck(this,ChildEvent);return _super.apply(this,arguments)}_createClass(ChildEvent,[{key:"initialize",value:function initialize(type,target,model){this.type=type;this.target=target;this.isForced=false;this.isStoppedImmediate=false;this.isStoppedNext=false;this.hasRequestChild=false;this._model=model}},{key:"model",get:function(){return this._model},set:function(model){if(this.type!=="requestChild"){Adapt.log.warn("Cannot change model in ".concat(this.type," event."));return}if(this._model){Adapt.log.warn("Cannot inject two models in one sitting. ".concat(model.get("_id")," attempts to overwrite ").concat(this._model.get("_id")));return}this._model=model;this.hasRequestChild=true}},{key:"reset",value:function reset(){this.isStoppedImmediate=false;this.isStoppedNext=false}},{key:"force",value:function force(){this.isForced=true}},{key:"stop",value:function stop(){var immediate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(!immediate){return this.stopNext()}this.isStoppedImmediate=true}},{key:"stopNext",value:function stopNext(){this.isStoppedNext=true}},{key:"close",value:function close(){this.trigger("closed")}}]);return ChildEvent}(Backbone.Controller));var register=__AMD("core/js/reactHelpers",function register(name,component){templates[name]=function(){var mode="reactTemplate";for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}var preRenderEvent=new TemplateRenderEvent("".concat(mode,":preRender"),name,mode,null,args);Adapt.trigger(preRenderEvent.type,preRenderEvent);var value=component.apply(void 0,_toConsumableArray(preRenderEvent.args));var postRenderEvent=new TemplateRenderEvent("".concat(mode,":postRender"),name,mode,value,preRenderEvent.args);Adapt.trigger(postRenderEvent.type,postRenderEvent);return postRenderEvent.value}});(function(){var original=React__default["default"].createElement;React__default["default"].createElement=function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}var name=args[0];var mode="reactElement";var preRenderEvent=new TemplateRenderEvent("".concat(mode,":preRender"),name,mode,null,args);Adapt.trigger(preRenderEvent.type,preRenderEvent);var value=original.apply(void 0,_toConsumableArray(preRenderEvent.args));var postRenderEvent=new TemplateRenderEvent("".concat(mode,":postRender"),name,mode,value,preRenderEvent.args);Adapt.trigger(postRenderEvent.type,postRenderEvent);return postRenderEvent.value}})();var templates={};function html(html){var ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!html)return;var node=html?HTMLReactParser__default["default"](html):"";if(_typeof(node)==="object"&&ref){node=Array.isArray(node)?node[0]:node;node=React__default["default"].cloneElement(node,{ref:ref})}return node}function compile(template){for(var _len3=arguments.length,args=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){args[_key3-1]=arguments[_key3]}var output=Handlebars.compile(template).apply(void 0,args);return output}function helper(name){var output=Handlebars.helpers[name].call(arguments.length<=1?undefined:arguments[1]);return output&&output.string||output}function classes(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++){args[_key5]=arguments[_key5]}return _.uniq(_.flatten(args).filter(Boolean).join(" ").split(" ")).join(" ")}function prefixClasses(prefixes){for(var _len6=arguments.length,args=new Array(_len6>1?_len6-1:0),_key6=1;_key6<_len6;_key6++){args[_key6-1]=arguments[_key6]}var classes=_.flatten(args).filter(Boolean);var prefixed=_.flatten(prefixes.map(function(prefix){return classes.map(function(className){return"".concat(prefix).concat(className)})}));return _.uniq(prefixed.join(" ").split(" ")).join(" ")}var AdaptView=function(_Backbone$View){_inherits(AdaptView,_Backbone$View);var _super=_createSuper(AdaptView);function AdaptView(){_classCallCheck(this,AdaptView);return _super.apply(this,arguments)}_createClass(AdaptView,[{key:"attributes",value:function attributes(){return{"data-adapt-id":this.model.get("_id")}}},{key:"initialize",value:function initialize(){this.listenTo(this.model,{"change:_isVisible":this.toggleVisibility,"change:_isHidden":this.toggleHidden,"change:_isComplete":this.onIsCompleteChange});this.isJSX=(this.constructor.template||"").includes(".jsx");if(this.isJSX){var _this$model,_this$model$getChildr;this._classSet=new Set(_.result(this,"className").trim().split(/\s+/));this.listenTo(this.model,"all",this.changed);var children=(_this$model=this.model)===null||_this$model===void 0?void 0:(_this$model$getChildr=_this$model.getChildren)===null||_this$model$getChildr===void 0?void 0:_this$model$getChildr.call(_this$model);children&&this.listenTo(children,"all",this.changed);this.listenTo(Adapt,"device:changed",this.changed)}this.model.set({_globals:Adapt.course.get("_globals"),_isReady:false});this._isRemoved=false;if(Adapt.location._currentId===this.model.get("_id")){Adapt.parentView=this}this.preRender();this.render();this.setupOnScreenHandler()}},{key:"preRender",value:function preRender(){}},{key:"postRender",value:function(){var _postRender=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return this.addChildren();case 2:case"end":return _context.stop();}},_callee,this)}));function postRender(){return _postRender.apply(this,arguments)}return postRender}()},{key:"render",value:function render(){var _this=this;var type=this.constructor.type;Adapt.trigger("".concat(type,"View:preRender view:preRender"),this);if(this.isJSX){this.changed()}else{var data=this.model.toJSON();data.view=this;var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))}Adapt.trigger("".concat(type,"View:render view:render"),this);_.defer(_asyncToGenerator(_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(!_this._isRemoved){_context2.next=2;break}return _context2.abrupt("return");case 2:_context2.next=4;return _this.postRender();case 4:Adapt.trigger("".concat(type,"View:postRender view:postRender"),_this);case 5:case"end":return _context2.stop();}},_callee2)})));return this}},{key:"changed",value:function changed(){var eventName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this.isJSX){throw new Error("Cannot call changed on a non-react view")}if(typeof eventName==="string"&&eventName.startsWith("bubble")){return}var props=_objectSpread2(_objectSpread2(_objectSpread2({},this),this.model.toJSON()),{},{_globals:Adapt.course.get("_globals")});var Template=templates[this.constructor.template.replace(".jsx","")];this.updateViewProperties();ReactDOM__default["default"].render(React__default["default"].createElement(Template,props),this.el)}},{key:"updateViewProperties",value:function updateViewProperties(){var _this2=this;var classesToAdd=_.result(this,"className").trim().split(/\s+/);classesToAdd.forEach(function(i){return _this2._classSet.add(i)});var classesToRemove=_toConsumableArray(this._classSet).filter(function(i){return!classesToAdd.includes(i)});classesToRemove.forEach(function(i){return _this2._classSet.delete(i)});this._setAttributes(_objectSpread2(_objectSpread2({},_.result(this,"attributes")),{},{id:_.result(this,"id")}));this.$el.removeClass(classesToRemove).addClass(classesToAdd)}},{key:"setupOnScreenHandler",value:function setupOnScreenHandler(){var _this3=this;var onscreen=this.model.get("_onScreen");if(!(onscreen!==null&&onscreen!==void 0&&onscreen._isEnabled))return;this.$el.addClass("has-animation ".concat(onscreen._classes,"-before"));this.$el.on("onscreen.adaptView",function(e,m){if(!m.onscreen)return;var minVerticalInview=onscreen._percentInviewVertical||33;if(m.percentInviewVertical<minVerticalInview)return;_this3.$el.addClass("".concat(onscreen._classes,"-after")).off("onscreen.adaptView")})}},{key:"addChildren",value:function(){var _addChildren=_asyncToGenerator(_regeneratorRuntime().mark(function _callee3(){var addedCount,models,event,subsequentModels,model,ChildView,childView;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:this.nthChild=this.nthChild||0;_context3.next=3;return this.addDescendants(false);case 3:addedCount=_context3.sent;case 4:models=this.model.getAvailableChildModels();event=this._getAddChildEvent(models[this.nthChild]);if(event){_context3.next=9;break}return _context3.abrupt("break",26);case 9:if(event.isForced){event.reset()}if(!(event.isStoppedImmediate||!event.model)){_context3.next=14;break}subsequentModels=models.slice(this.nthChild);subsequentModels.forEach(function(model){return model.setOnChildren("_isRendered",false)});return _context3.abrupt("break",26);case 14:model=event.model;model.set({_isRendered:true,_nthChild:++this.nthChild});ChildView=this.constructor.childView||Adapt.getViewClass(model);if(ChildView){_context3.next=19;break}throw new Error("The component '".concat(model.attributes._id,"' ('").concat(model.attributes._component,"') has not been installed, and so is not available in your project."));case 19:childView=new ChildView({model:model});this.addChildView(childView);addedCount++;if(!event.isStoppedNext){_context3.next=24;break}return _context3.abrupt("break",26);case 24:_context3.next=4;break;case 26:if(addedCount){_context3.next=28;break}return _context3.abrupt("return",addedCount);case 28:this.model.set("_isReady",false);return _context3.abrupt("return",addedCount);case 30:case"end":return _context3.stop();}},_callee3,this)}));function addChildren(){return _addChildren.apply(this,arguments)}return addChildren}()},{key:"addChildView",value:function addChildView(childView){var childViews=this.getChildViews()||[];childViews.push(childView);this.setChildViews(childViews);var $parentContainer=this.$(this.constructor.childContainer);switch(childView.model.get("_renderPosition")){case"outer-append":this.$el.append(childView.$el);break;case"inner-append":default:$parentContainer.append(childView.$el);break;}Adapt.trigger("view:childAdded",this,childView);return childView}},{key:"addDescendants",value:function(){var _addDescendants=_asyncToGenerator(_regeneratorRuntime().mark(function _callee4(){var addedDescendantCount,childViews,i,l,view;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:addedDescendantCount=0;childViews=this.getChildViews();if(childViews){_context4.next=4;break}return _context4.abrupt("return",addedDescendantCount);case 4:i=0,l=childViews.length;case 5:if(!(i<l)){_context4.next=20;break}view=childViews[i];if(!view.addChildren){_context4.next=13;break}_context4.next=10;return view.addChildren();case 10:_context4.t0=_context4.sent;_context4.next=14;break;case 13:_context4.t0=0;case 14:addedDescendantCount=_context4.t0;if(!addedDescendantCount){_context4.next=17;break}return _context4.abrupt("break",20);case 17:i++;_context4.next=5;break;case 20:if(addedDescendantCount){_context4.next=23;break}this.model.checkReadyStatus();return _context4.abrupt("return",addedDescendantCount);case 23:this.model.set("_isReady",false);return _context4.abrupt("return",addedDescendantCount);case 25:case"end":return _context4.stop();}},_callee4,this)}));function addDescendants(){return _addDescendants.apply(this,arguments)}return addDescendants}()},{key:"whenReady",value:function(){var _whenReady=_asyncToGenerator(_regeneratorRuntime().mark(function _callee5(){var _this4=this;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:if(!this.model.get("_isReady")){_context5.next=2;break}return _context5.abrupt("return");case 2:return _context5.abrupt("return",new Promise(function(resolve){var onReadyChange=function(model,value){if(!value)return;_this4.stopListening(_this4.model,"change:_isReady",onReadyChange);resolve()};_this4.listenTo(_this4.model,"change:_isReady",onReadyChange);_this4.model.checkReadyStatus()}));case 3:case"end":return _context5.stop();}},_callee5,this)}));function whenReady(){return _whenReady.apply(this,arguments)}return whenReady}()},{key:"_getAddChildEvent",value:function _getAddChildEvent(model){var isRequestChild=!model;var event=new ChildEvent(null,this,model);if(isRequestChild){var canRequestChild=this.model.get("_canRequestChild");if(!canRequestChild){return}event.type="requestChild";Adapt.trigger("view:requestChild",event);if(!event.hasRequestChild){event.close();return}}event.type="addChild";Adapt.trigger("view:addChild",event);event.close();return event}},{key:"findDescendantViews",value:function findDescendantViews(isParentFirst){var descendants=[];var childViews=this.getChildViews();childViews===null||childViews===void 0?void 0:childViews.forEach(function(view){var _view$findDescendantV;if(isParentFirst)descendants.push(view);var children=(_view$findDescendantV=view.findDescendantViews)===null||_view$findDescendantV===void 0?void 0:_view$findDescendantV.call(view,isParentFirst);if(children)descendants.push.apply(descendants,_toConsumableArray(children));if(!isParentFirst)descendants.push(view)});return descendants}},{key:"setReadyStatus",value:function setReadyStatus(){this.model.set("_isReady",true)}},{key:"setCompletionStatus",value:function setCompletionStatus(){if(!this.model.get("_isVisible"))return;this.model.set({_isComplete:true,_isInteractionComplete:true})}},{key:"resetCompletionStatus",value:function resetCompletionStatus(type){if(!this.model.get("_canReset"))return;var descendantComponents=this.model.findDescendantModels("component");if(descendantComponents.length===0){this.model.reset(type)}else{descendantComponents.forEach(function(model){return model.reset(type)})}}},{key:"preRemove",value:function preRemove(){var type=this.constructor.type;Adapt.trigger("".concat(type,"View:preRemove view:preRemove"),this)}},{key:"remove",value:function remove(){var _this5=this;var type=this.constructor.type;this.preRemove();Adapt.trigger("".concat(type,"View:remove view:remove"),this);this._isRemoved=true;this.stopListening();Adapt.wait.for(function(end){if(_this5.isJSX){ReactDOM__default["default"].unmountComponentAtNode(_this5.el)}_this5.$el.off("onscreen.adaptView");_get(_getPrototypeOf(AdaptView.prototype),"remove",_this5).call(_this5);_.defer(function(){Adapt.trigger("".concat(type,"View:postRemove view:postRemove"),_this5)});end()});return this}},{key:"setVisibility",value:function setVisibility(){return this.model.get("_isVisible")?"":"u-visibility-hidden"}},{key:"toggleVisibility",value:function toggleVisibility(){this.$el.toggleClass("u-visibility-hidden",!this.model.get("_isVisible"))}},{key:"setHidden",value:function setHidden(){return this.model.get("_isHidden")?"u-display-none":""}},{key:"toggleHidden",value:function toggleHidden(){this.$el.toggleClass("u-display-none",this.model.get("_isHidden"))}},{key:"onIsCompleteChange",value:function onIsCompleteChange(model,isComplete){this.$el.toggleClass("is-complete",isComplete)}},{key:"getChildViews",value:function getChildViews(){if(!this._childViews)return this._childViews;return Object.entries(this._childViews).map(function(_ref2){var _ref3=_slicedToArray(_ref2,2);_ref3[0];var value=_ref3[1];return value})}},{key:"setChildViews",value:function setChildViews(value){this._childViews=value}},{key:"childViews",get:function(){Adapt.log.deprecated("view.childViews use view.getChildViews() and view.setChildViews([])");if(Array.isArray(this._childViews)){return _.indexBy(this._childViews,function(view){return view.model.get("_id")})}return this._childViews},set:function(value){Adapt.log.deprecated("view.childViews use view.getChildViews() and view.setChildViews([])");this.setChildViews(value)}}]);return AdaptView}(Backbone.View);AdaptView.className="";var AdaptView$1=__AMD("core/js/views/adaptView",AdaptView);var NotifyView=__AMD("core/js/views/notifyView",function(_Backbone$View){_inherits(NotifyView,_Backbone$View);var _super=_createSuper(NotifyView);function NotifyView(){_classCallCheck(this,NotifyView);return _super.apply(this,arguments)}_createClass(NotifyView,[{key:"className",value:function className(){return"notify ".concat(this.model.get("_classes")||"")}},{key:"attributes",value:function attributes(){return Object.assign({role:"dialog","aria-labelledby":"notify-heading","aria-modal":"true"},this.model.get("_attributes"))}},{key:"events",value:function events(){return{"click .js-notify-btn-alert":"onAlertButtonClicked","click .js-notify-btn-prompt":"onPromptButtonClicked","click .js-notify-close-btn":"onCloseButtonClicked","click .js-notify-shadow-click":"onShadowClicked"}}},{key:"initialize",value:function initialize(){_.bindAll(this,"resetNotifySize","onKeyUp");this.disableAnimation=Adapt.config.get("_disableAnimation")||false;this.isOpen=false;this.hasOpened=false;this.setupEventListeners();this.render()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(Adapt,{"remove page:scrollTo":this.closeNotify,"notify:resize":this.resetNotifySize,"notify:cancel":this.cancelNotify,"notify:close":this.closeNotify,"device:resize":this.resetNotifySize});this.setupEscapeKey()}},{key:"setupEscapeKey",value:function setupEscapeKey(){$(window).on("keyup",this.onKeyUp)}},{key:"onKeyUp",value:function onKeyUp(event){if(event.which!==27)return;event.preventDefault();this.cancelNotify()}},{key:"render",value:function render(){var data=this.model.toJSON();var template=Handlebars.templates.notify;this.$el.css("visibility","hidden");this.$el.html(template(data)).appendTo("body");this.$(".notify__popup").css("visibility","hidden");this.$el.css("visibility","visible");this.showNotify();return this}},{key:"onAlertButtonClicked",value:function onAlertButtonClicked(event){event.preventDefault();this.closeNotify();Adapt.trigger(this.model.get("_callbackEvent"),this)}},{key:"onPromptButtonClicked",value:function onPromptButtonClicked(event){event.preventDefault();this.closeNotify();Adapt.trigger($(event.currentTarget).attr("data-event"),this)}},{key:"onCloseButtonClicked",value:function onCloseButtonClicked(event){event.preventDefault();this.cancelNotify()}},{key:"onShadowClicked",value:function onShadowClicked(event){event.preventDefault();if(this.model.get("_closeOnShadowClick")===false)return;this.cancelNotify()}},{key:"cancelNotify",value:function cancelNotify(){if(this.model.get("_isCancellable")===false)return;this.closeNotify();Adapt.trigger("notify:cancelled",this)}},{key:"resetNotifySize",value:function resetNotifySize(){if(!this.hasOpened)return;this.resizeNotify()}},{key:"resizeNotify",value:function resizeNotify(){var windowHeight=$(window).height();var notifyHeight=this.$(".notify__popup-inner").outerHeight();var isFullWindow=notifyHeight>=windowHeight;this.$(".notify__popup").css({"height":isFullWindow?"100%":"auto","top":isFullWindow?0:"","margin-top":isFullWindow?"":-(notifyHeight/2),"overflow-y":isFullWindow?"scroll":"","-webkit-overflow-scrolling":isFullWindow?"touch":""})}},{key:"showNotify",value:function(){var _showNotify=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:this.isOpen=true;_context.next=3;return this.addSubView();case 3:Adapt.notify.stack.push(this);this.$previousActiveElement=$(document.activeElement);Adapt.trigger("notify:opened",this);this.$el.imageready(this.onLoaded.bind(this));case 7:case"end":return _context.stop();}},_callee,this)}));function showNotify(){return _showNotify.apply(this,arguments)}return showNotify}()},{key:"onLoaded",value:function onLoaded(){var _this=this;if(this.disableAnimation){this.$(".notify__shadow").css("display","block")}else{this.$(".notify__shadow").velocity({opacity:0},{duration:0}).velocity({opacity:1},{duration:400,begin:function(){_this.$(".notify__shadow").css("display","block")}})}this.resizeNotify();if(this.disableAnimation){this.$(".notify__popup").css("visibility","visible");this.onOpened()}else{this.$(".notify__popup").velocity({opacity:0},{duration:0}).velocity({opacity:1},{duration:400,begin:function(){_this.$(".notify__popup").css("visibility","visible");_this.onOpened()}})}}},{key:"onOpened",value:function onOpened(){$.inview();this.hasOpened=true;Adapt.a11y.popupOpened(this.$(".notify__popup"));Adapt.a11y.scrollDisable("body");$("html").addClass("notify");Adapt.a11y.focusFirst(this.$(".notify__popup"),{defer:false})}},{key:"addSubView",value:function(){var _addSubView=_asyncToGenerator(_regeneratorRuntime().mark(function _callee2(){var _this2=this;var model,View;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:this.subView=this.model.get("_view");if(this.model.get("_id")){model=Adapt.findById(this.model.get("_id"));View=Adapt.getViewClass(model);this.subView=new View({model:model})}if(this.subView){_context2.next=4;break}return _context2.abrupt("return");case 4:this.subView.$el.on("resize",this.resetNotifySize);this.$(".notify__content-inner").prepend(this.subView.$el);if(!(!(this.subView instanceof AdaptView$1)||this.subView.model.get("_isReady"))){_context2.next=8;break}return _context2.abrupt("return");case 8:return _context2.abrupt("return",new Promise(function(resolve){var check=function(model,value){if(!value)return;_this2.subView.model.off("change:_isReady",check);resolve()};_this2.subView.model.on("change:_isReady",check)}));case 9:case"end":return _context2.stop();}},_callee2,this)}));function addSubView(){return _addSubView.apply(this,arguments)}return addSubView}()},{key:"closeNotify",value:function closeNotify(){var _this3=this;var stackItem=Adapt.notify.stack[Adapt.notify.stack.length-1];if(this!==stackItem)return;Adapt.notify.stack.pop();if(!this.isOpen)return;this.isOpen=false;if(this.hasOpened){this.onCloseReady();return}this.listenToOnce(Adapt,"popup:opened",function(){_.defer(_this3.onCloseReady.bind(_this3))})}},{key:"onCloseReady",value:function onCloseReady(){var _this4=this;if(this.disableAnimation){this.$(".notify__popup").css("visibility","hidden");this.$el.css("visibility","hidden");this.remove()}else{this.$(".notify__popup").velocity({opacity:0},{duration:400,complete:function(){_this4.$(".notify__popup").css("visibility","hidden")}});this.$(".notify__shadow").velocity({opacity:0},{duration:400,complete:function(){_this4.$el.css("visibility","hidden");_this4.remove()}})}Adapt.a11y.scrollEnable("body");$("html").removeClass("notify");Adapt.a11y.popupClosed(this.$previousActiveElement);Adapt.trigger("notify:closed",this)}},{key:"remove",value:function remove(){var _get2;this.removeSubView();$(window).off("keyup",this.onKeyUp);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}(_get2=_get(_getPrototypeOf(NotifyView.prototype),"remove",this)).call.apply(_get2,[this].concat(args))}},{key:"removeSubView",value:function removeSubView(){if(!this.subView)return;this.subView.$el.off("resize",this.resetNotifySize);if(this.subView instanceof AdaptView$1){var views=[].concat(_toConsumableArray(this.subView.findDescendantViews()),[this.subView]);views.forEach(function(view){view.model.set("_isReady",false);view.remove()})}else{this.subView.remove()}this.subView=null}}]);return NotifyView}(Backbone.View));var Notify=function(_Backbone$Controller){_inherits(Notify,_Backbone$Controller);var _super=_createSuper(Notify);function Notify(){_classCallCheck(this,Notify);return _super.apply(this,arguments)}_createClass(Notify,[{key:"initialize",value:function initialize(){this._stack=[];this.notifyPushes=new NotifyPushCollection;this.listenTo(Adapt,{"notify:popup":this._deprecated.bind(this,"popup"),"notify:alert":this._deprecated.bind(this,"alert"),"notify:prompt":this._deprecated.bind(this,"prompt"),"notify:push":this._deprecated.bind(this,"push")})}},{key:"stack",get:function(){return this._stack}},{key:"_deprecated",value:function _deprecated(type,notifyObject){Adapt.log.deprecated("NOTIFY DEPRECATED: Adapt.trigger('notify:".concat(type,"', notifyObject); is no longer supported, please use Adapt.notify.").concat(type,"(notifyObject);"));return this.create(notifyObject,{_type:type})}},{key:"create",value:function create(notifyObject,defaults){notifyObject=_.defaults({},notifyObject,defaults,{_type:"popup",_isCancellable:true,_showCloseButton:true,_closeOnShadowClick:true});if(notifyObject._type==="push"){this.notifyPushes.push(notifyObject);return}return new NotifyView({model:new NotifyModel(notifyObject)})}},{key:"popup",value:function popup(notifyObject){return this.create(notifyObject,{_type:"popup"})}},{key:"alert",value:function alert(notifyObject){return this.create(notifyObject,{_type:"alert"})}},{key:"prompt",value:function prompt(notifyObject){return this.create(notifyObject,{_type:"prompt"})}},{key:"push",value:function push(notifyObject){return this.create(notifyObject,{_type:"push"})}}]);return Notify}(Backbone.Controller);__AMD("core/js/notify",Adapt.notify=new Notify);var RouterModel=__AMD("core/js/models/routerModel",function(_LockingModel){_inherits(RouterModel,_LockingModel);var _super=_createSuper(RouterModel);function RouterModel(){_classCallCheck(this,RouterModel);return _super.apply(this,arguments)}_createClass(RouterModel,[{key:"defaults",value:function defaults(){return{_canNavigate:true,_shouldNavigateFocus:true}}},{key:"lockedAttributes",value:function lockedAttributes(){return{_canNavigate:false,_shouldNavigateFocus:false}}}]);return RouterModel}(LockingModel));var Router=function(_Backbone$Router){_inherits(Router,_Backbone$Router);var _super=_createSuper(Router);function Router(){_classCallCheck(this,Router);return _super.apply(this,arguments)}_createClass(Router,[{key:"routes",value:function routes(){return{"":"handleRoute","id/:id":"handleRoute",":pluginName(/*location)(/*action)":"handleRoute"}}},{key:"initialize",value:function initialize(_ref){var model=_ref.model;this._isBackward=false;this.model=model;this._navigationRoot=null;this._isCircularNavigationInProgress=false;this.showLoading();this.$wrapper=$("#wrapper");this.$html=$("html");this.listenToOnce(Adapt,"app:dataReady",this.setDocumentTitle);this.listenTo(Adapt,"router:navigateTo",this.navigateToArguments)}},{key:"rootModel",get:function(){return this._navigationRoot||Adapt.course},set:function(model){this._navigationRoot=model}},{key:"showLoading",value:function showLoading(){$(".js-loading").show()}},{key:"hideLoading",value:function hideLoading(){$(".js-loading").hide()}},{key:"setDocumentTitle",value:function setDocumentTitle(){var currentModel=Adapt.location._currentModel;var hasSubTitle=currentModel&&currentModel!==Adapt.router.rootModel&&currentModel.get("title");var title=[this.rootModel.get("title"),hasSubTitle&&currentModel.get("title")].filter(Boolean).join(" | ");this.listenToOnce(Adapt,"contentObjectView:preRender",function(){var escapedTitle=$("<div>".concat(title,"</div>")).text();document.title=escapedTitle})}},{key:"navigateToArguments",value:function navigateToArguments(args){args=args.filter(function(v){return v!==null});var options={trigger:false,replace:false};if(args.length===1&&Adapt.findById(args[0])){this.navigate("#/id/"+args[0],options);return}if(args.length<=3){this.navigate("#/"+args.join("/"),options);return}Adapt.log.deprecated("Use Backbone.history.navigate or window.location.href instead of Adapt.trigger('router:navigateTo')");this.handleRoute.apply(this,_toConsumableArray(args))}},{key:"handleRoute",value:function handleRoute(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}args=args.filter(function(v){return v!==null});console.log("--- Location --------------------------------");console.log(JSON.stringify(args));console.log("---------------------------------------------");if(this.model.get("_canNavigate")){this._isCircularNavigationInProgress=false}if(this._isCircularNavigationInProgress===false){Adapt.trigger("router:navigate",args)}if(this.model.get("_canNavigate")){this.model.set("_canNavigate",false,{pluginName:"adapt"});this._isBackward=false;if(args.length<=1){return this.handleId.apply(this,_toConsumableArray(args))}return this.handlePluginRouter.apply(this,_toConsumableArray(args))}if(this._isCircularNavigationInProgress){this._isCircularNavigationInProgress=false;return}this._isCircularNavigationInProgress=true;Adapt.trigger("router:navigationCancelled",args);return}},{key:"handlePluginRouter",value:function(){var _handlePluginRouter=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(pluginName,location,action){var pluginLocation;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:pluginLocation=[pluginName,location&&"-".concat(location),action&&"-".concat(action)].filter(Boolean).join("");_context.next=3;return this.updateLocation(pluginLocation,null,null,null);case 3:Adapt.trigger("router:plugin:"+pluginName,pluginName,location,action);Adapt.trigger("router:plugin",pluginName,location,action);this.model.set("_canNavigate",true,{pluginName:"adapt"});case 6:case"end":return _context.stop();}},_callee,this)}));function handlePluginRouter(_x,_x2,_x3){return _handlePluginRouter.apply(this,arguments)}return handlePluginRouter}()},{key:"handleId",value:function(){var _handleId=_asyncToGenerator(_regeneratorRuntime().mark(function _callee2(id){var _this=this;var rootModel,model,isContentObject,navigateToId,isRoot,startController,isCourse,type,location,ViewClass,isMenu;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:rootModel=Adapt.router.rootModel;model=!id?rootModel:Adapt.findById(id);if(model){_context2.next=5;break}this.model.set("_canNavigate",true,{pluginName:"adapt"});return _context2.abrupt("return");case 5:isContentObject=model instanceof ContentObjectModel;navigateToId=model.get("_id");model=isContentObject?model:model.findAncestor("contentobject");id=model.get("_id");isRoot=model===rootModel;if(!(isRoot&&Adapt.course.has("_start"))){_context2.next=14;break}startController=Adapt.course.get("_start");if(!(startController._isEnabled===true&&startController._isMenuDisabled===true)){_context2.next=14;break}return _context2.abrupt("return");case 14:if(!(model.get("_isLocked")&&Adapt.config.get("_forceRouteLocking"))){_context2.next=20;break}Adapt.log.warn("Unable to navigate to locked id: "+id);this.model.set("_canNavigate",true,{pluginName:"adapt"});if(!(Adapt.location._previousId===undefined)){_context2.next=19;break}return _context2.abrupt("return",this.navigate("#/",{trigger:true,replace:true}));case 19:return _context2.abrupt("return",this.navigateBack());case 20:this.showLoading();_context2.next=23;return Adapt.remove();case 23:isCourse=model instanceof CourseModel$1;type=isCourse?"menu":model.get("_type");location=isCourse?"course":"".concat(type,"-").concat(id);model.set("_isVisited",true);_context2.next=29;return this.updateLocation(location,type,id,model);case 29:Adapt.once("contentObjectView:ready",function(){_this.model.set("_canNavigate",true,{pluginName:"adapt"});_this.handleNavigationFocus()});Adapt.trigger("router:".concat(type," router:contentObject"),model);ViewClass=Adapt.getViewClass(model);isMenu=model instanceof MenuModel$1;if(!(!ViewClass&&isMenu)){_context2.next=36;break}Adapt.log.deprecated("Using event based menu view instantiation for '".concat(Adapt.getViewName(model),"'"));return _context2.abrupt("return");case 36:if(isMenu){_context2.next=40;break}_.invoke(model.getAllDescendantModels(),"checkIfResetOnRevisit");_context2.next=40;return Adapt.deferUntilCompletionChecked();case 40:this.$wrapper.append(new ViewClass({model:model}).$el);if(!(!isContentObject&&!this.isScrolling)){_context2.next=44;break}_context2.next=44;return Adapt.navigateToElement("."+navigateToId,{replace:true,duration:400});case 44:case"end":return _context2.stop();}},_callee2,this)}));function handleId(_x4){return _handleId.apply(this,arguments)}return handleId}()},{key:"updateLocation",value:function(){var _updateLocation=_asyncToGenerator(_regeneratorRuntime().mark(function _callee3(currentLocation,type,id,currentModel){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:Adapt.location._previousModel=Adapt.location._currentModel;Adapt.location._previousId=Adapt.location._currentId;Adapt.location._previousContentType=Adapt.location._contentType;Adapt.location._currentModel=currentModel;Adapt.location._currentId=id;Adapt.location._contentType=type;Adapt.location._currentLocation=currentLocation;if(type==="menu"){Adapt.location._lastVisitedType="menu";Adapt.location._lastVisitedMenu=id}else if(type==="page"){Adapt.location._lastVisitedType="page";Adapt.location._lastVisitedPage=id}this.setDocumentTitle();this.setGlobalClasses();Adapt.trigger("router:location",Adapt.location);_context3.next=13;return Adapt.wait.queue();case 13:case"end":return _context3.stop();}},_callee3,this)}));function updateLocation(_x5,_x6,_x7,_x8){return _updateLocation.apply(this,arguments)}return updateLocation}()},{key:"setGlobalClasses",value:function setGlobalClasses(){var currentModel=Adapt.location._currentModel;var htmlClasses=(currentModel===null||currentModel===void 0?void 0:currentModel.get("_htmlClasses"))||"";var classes=Adapt.location._currentId?"location-".concat(Adapt.location._contentType," location-id-").concat(Adapt.location._currentId):"location-".concat(Adapt.location._currentLocation);var currentClasses="".concat(classes," ").concat(htmlClasses);this.$html.removeClass(Adapt.location._previousClasses).addClass(currentClasses).attr("data-location",Adapt.location._currentLocation);this.$wrapper.removeClass().addClass(classes).attr("data-location",Adapt.location._currentLocation);Adapt.location._previousClasses=currentClasses}},{key:"handleNavigationFocus",value:function handleNavigationFocus(){if(!this.model.get("_shouldNavigateFocus"))return;Adapt.a11y.focus("body")}},{key:"navigateBack",value:function navigateBack(){this._isBackward=true;Backbone.history.history.back()}},{key:"navigateToCurrentRoute",value:function navigateToCurrentRoute(force){if(!this.model.get("_canNavigate")&&!force){return}if(!Adapt.location._currentId){return}var currentId=Adapt.location._currentModel.get("_id");var isRoot=Adapt.location._currentModel===this.rootModel;var route=isRoot?"#/":"#/id/"+currentId;this.navigate(route,{trigger:true,replace:true})}},{key:"navigateToPreviousRoute",value:function navigateToPreviousRoute(force){if(!this.model.get("_canNavigate")&&!force){return}var currentModel=Adapt.location._currentModel;var previousModel=Adapt.location._previousModel;if(!currentModel){return this.navigateBack()}if(Adapt.location._currentModel instanceof MenuModel$1){return this.navigateToParent()}if(previousModel){return this.navigateBack()}this.navigateToParent()}},{key:"navigateToParent",value:function navigateToParent(force){if(!this.model.get("_canNavigate")&&!force){return}var parentId=Adapt.location._currentModel.get("_parentId");var parentModel=Adapt.findById(parentId);var isRoot=parentModel===this.rootModel;var route=isRoot?"#/":"#/id/"+parentId;this.navigate(route,{trigger:true})}},{key:"navigateToHomeRoute",value:function navigateToHomeRoute(force){if(!this.model.get("_canNavigate")&&!force){return}this.navigate("#/",{trigger:true})}},{key:"navigateToElement",value:function(){var _navigateToElement=_asyncToGenerator(_regeneratorRuntime().mark(function _callee4(selector){var _this2=this;var settings,currentModelId,currentModel,shouldReplace,contentObject,contentObjectId,isNotInCurrentContentObject,location,disableScrollToAnimation,offsetTop,_args4=arguments;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:settings=_args4.length>1&&_args4[1]!==undefined?_args4[1]:{};currentModelId=selector.replace(/\./g,"").split(" ")[0];currentModel=Adapt.findById(currentModelId);if(!(currentModel&&(!currentModel.get("_isRendered")||!currentModel.get("_isReady")))){_context4.next=17;break}shouldReplace=settings.replace||false;contentObject=currentModel instanceof ContentObjectModel?currentModel:currentModel.findAncestor("contentobject");contentObjectId=contentObject.get("_id");isNotInCurrentContentObject=contentObjectId!==Adapt.location._currentId;if(!isNotInCurrentContentObject){_context4.next=15;break}this.isScrolling=true;this.navigate("#/id/".concat(currentModelId),{trigger:true,replace:shouldReplace});this.model.set("_shouldNavigateFocus",false,{pluginName:"adapt"});_context4.next=14;return new Promise(function(resolve){return Adapt.once("contentObjectView:ready",_.debounce(function(){_this2.model.set("_shouldNavigateFocus",true,{pluginName:"adapt"});resolve()},1))});case 14:this.isScrolling=false;case 15:_context4.next=17;return Adapt.parentView.renderTo(currentModelId);case 17:if(currentModel&&selector===currentModel.get("_id")){selector=".".concat(selector)}location=Adapt.location._contentType?Adapt.location._contentType:Adapt.location._currentLocation;Adapt.trigger("".concat(location,":scrollTo"),selector);disableScrollToAnimation=Adapt.config.has("_disableAnimation")?Adapt.config.get("_disableAnimation"):false;if(disableScrollToAnimation){settings.duration=0}else if(!settings.duration){settings.duration=$.scrollTo.defaults.duration}offsetTop=0;if(Adapt.scrolling.isLegacyScrolling){offsetTop=-$(".nav").outerHeight();if($(selector).hasClass("component")){offsetTop-=$(selector).find(".aria-label").height()||0}}if(!settings.offset)settings.offset={top:offsetTop,left:0};if(settings.offset.top===undefined)settings.offset.top=offsetTop;if(settings.offset.left===undefined)settings.offset.left=0;if(settings.offset.left===0)settings.axis="y";if(Adapt.get("_canScroll")!==false){$.scrollTo(selector,settings)}_context4.next=31;return new Promise(function(resolve){_.delay(function(){Adapt.a11y.focusNext(selector);Adapt.trigger("".concat(location,":scrolledTo"),selector);resolve()},settings.duration+300)});case 31:case"end":return _context4.stop();}},_callee4,this)}));function navigateToElement(_x9){return _navigateToElement.apply(this,arguments)}return navigateToElement}()},{key:"get",value:function get(){var _this$model;Adapt.log.deprecated("Adapt.router.get, please use Adapt.router.model.get");return(_this$model=this.model).get.apply(_this$model,arguments)}},{key:"set",value:function set(){var _this$model2;Adapt.log.deprecated("Adapt.router.set, please use Adapt.router.model.set");return(_this$model2=this.model).set.apply(_this$model2,arguments)}}]);return Router}(Backbone.Router);Adapt.router=new Router({model:new RouterModel(null,{reset:true})});Adapt.navigateToElement=Adapt.router.navigateToElement.bind(Adapt.router);__AMD("core/js/router",Adapt.router);var AdaptSubsetCollection=__AMD("core/js/collections/adaptSubsetCollection",function(_AdaptCollection){_inherits(AdaptSubsetCollection,_AdaptCollection);var _super=_createSuper(AdaptSubsetCollection);function AdaptSubsetCollection(){_classCallCheck(this,AdaptSubsetCollection);return _super.apply(this,arguments)}_createClass(AdaptSubsetCollection,[{key:"initialize",value:function initialize(models,options){_get(_getPrototypeOf(AdaptSubsetCollection.prototype),"initialize",this).call(this,models,options);this.parent=options.parent;this.listenTo(this.parent,"reset",this.loadSubset)}},{key:"loadSubset",value:function loadSubset(){var _this=this;this.set(this.parent.filter(function(model){return model instanceof _this.model}));this._byAdaptID=this.groupBy("_id")}}]);return AdaptSubsetCollection}(AdaptCollection));var ArticleModel=function(_AdaptModel){_inherits(ArticleModel,_AdaptModel);var _super=_createSuper(ArticleModel);function ArticleModel(){_classCallCheck(this,ArticleModel);return _super.apply(this,arguments)}_createClass(ArticleModel,[{key:"_parent",get:function(){Adapt.log.deprecated("articleModel._parent, use articleModel.getParent() instead, parent models are defined by the JSON");return"contentObjects"}},{key:"_siblings",get:function(){Adapt.log.deprecated("articleModel._siblings, use articleModel.getSiblings() instead, sibling models are defined by the JSON");return"articles"}},{key:"_children",get:function(){Adapt.log.deprecated("articleModel._children, use articleModel.hasManagedChildren instead, child models are defined by the JSON");return"blocks"}},{key:"getTypeGroup",value:function getTypeGroup(){return"article"}}]);return ArticleModel}(AdaptModel);Adapt.register("article",{model:ArticleModel});var ArticleModel$1=__AMD("core/js/models/articleModel",ArticleModel);var BlockModel=function(_AdaptModel){_inherits(BlockModel,_AdaptModel);var _super=_createSuper(BlockModel);function BlockModel(){_classCallCheck(this,BlockModel);return _super.apply(this,arguments)}_createClass(BlockModel,[{key:"_parent",get:function(){Adapt.log.deprecated("blockModel._parent, use blockModel.getParent() instead, parent models are defined by the JSON");return"articles"}},{key:"_siblings",get:function(){Adapt.log.deprecated("blockModel._siblings, use blockModel.getSiblings() instead, sibling models are defined by the JSON");return"blocks"}},{key:"_children",get:function(){Adapt.log.deprecated("blockModel._children, use blockModel.hasManagedChildren instead, child models are defined by the JSON");return"components"}},{key:"getTypeGroup",value:function getTypeGroup(){return"block"}}]);return BlockModel}(AdaptModel);Adapt.register("block",{model:BlockModel});var BlockModel$1=__AMD("core/js/models/blockModel",BlockModel);var ComponentModel$2=function(_AdaptModel){_inherits(ComponentModel,_AdaptModel);var _super=_createSuper(ComponentModel);function ComponentModel(){_classCallCheck(this,ComponentModel);return _super.apply(this,arguments)}_createClass(ComponentModel,[{key:"_parent",get:function(){Adapt.log.deprecated("componentModel._parent, use componentModel.getParent() instead, parent models are defined by the JSON");return"blocks"}},{key:"_siblings",get:function(){Adapt.log.deprecated("componentModel._siblings, use componentModel.getSiblings() instead, sibling models are defined by the JSON");return"components"}},{key:"getTypeGroup",value:function getTypeGroup(){return"component"}},{key:"defaults",value:function defaults(){return AdaptModel.resultExtend("defaults",{_isA11yComponentDescriptionEnabled:true,_userAnswer:null,_attemptStates:null,_isHybComplete:false})}},{key:"trackable",value:function trackable(){return AdaptModel.resultExtend("trackable",["_userAnswer","_attemptStates","_isHybComplete"])}},{key:"trackableType",value:function trackableType(){return AdaptModel.resultExtend("trackableType",[Array,Array,Boolean])}},{key:"hasManagedChildren",get:function(){return false}},{key:"init",value:function init(){if(Adapt.get("_isStarted")){this.onAdaptInitialize();return}this.listenToOnce(Adapt,"adapt:initialize",this.onAdaptInitialize)}},{key:"onAdaptInitialize",value:function onAdaptInitialize(){this.restoreUserAnswers()}},{key:"restoreUserAnswers",value:function restoreUserAnswers(){}},{key:"storeUserAnswer",value:function storeUserAnswer(){}},{key:"resetUserAnswer",value:function resetUserAnswer(){this.set("_userAnswer",null)}},{key:"reset",value:function reset(type,force){if(!this.get("_canReset")&&!force)return;this.resetUserAnswer();_get(_getPrototypeOf(ComponentModel.prototype),"reset",this).call(this,type,force)}},{key:"getAttemptState",value:function getAttemptState(){var object=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.toJSON();var trackables=this.trackable();var types=this.trackableType();trackables.find(function(name,index){if(name!=="_attemptStates")return;trackables.splice(index,1);types.splice(index,1);return true});var values=trackables.map(function(n){return object[n]});var booleans=values.filter(function(v,i){return types[i]===Boolean}).map(Boolean);var numbers=values.filter(function(v,i){return types[i]===Number}).map(function(v){return Number(v)||0});var arrays=values.filter(function(v,i){return types[i]===Array});return[numbers,booleans,arrays]}},{key:"getAttemptObject",value:function getAttemptObject(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getAttemptState();var trackables=this.trackable();var types=this.trackableType();trackables.find(function(name,index){if(name!=="_attemptStates")return;trackables.splice(index,1);types.splice(index,1);return true});var numbers=(state[0]||[]).slice(0);var booleans=(state[1]||[]).slice(0);var arrays=(state[2]||[]).slice(0);var object={};trackables.forEach(function(n,i){if(n==="_id")return;switch(types[i]){case Number:object[n]=numbers.shift();break;case Boolean:object[n]=booleans.shift();break;case Array:object[n]=arrays.shift();break;}});return object}},{key:"setAttemptObject",value:function setAttemptObject(object){var silent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.set(object,{silent:silent})}},{key:"addAttemptObject",value:function addAttemptObject(){var object=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getAttemptObject();var attemptStates=this.get("_attemptStates")||[];var state=this.getAttemptState(object);attemptStates.push(state);this.set("_attemptStates",attemptStates)}},{key:"getAttemptObjects",value:function getAttemptObjects(){var _this=this;var states=this.get("_attemptStates")||[];return states.map(function(state){return _this.getAttemptObject(state)})}}]);return ComponentModel}(AdaptModel);Adapt.register("component",{model:ComponentModel$2});var ComponentModel$3=__AMD("core/js/models/componentModel",ComponentModel$2);var PageModel=function(_ContentObjectModel){_inherits(PageModel,_ContentObjectModel);var _super=_createSuper(PageModel);function PageModel(){_classCallCheck(this,PageModel);return _super.apply(this,arguments)}_createClass(PageModel,[{key:"_children",get:function(){Adapt.log.deprecated("pageModel._children, use menuModel.hasManagedChildren instead, child models are defined by the JSON");return"articles"}},{key:"getTypeGroup",value:function getTypeGroup(){return"page"}}]);return PageModel}(ContentObjectModel);Adapt.register("page",{model:PageModel});__AMD("core/js/models/pageModel",PageModel);var ContentObjectView=__AMD("core/js/views/contentObjectView",function(_AdaptView){_inherits(ContentObjectView,_AdaptView);var _super=_createSuper(ContentObjectView);function ContentObjectView(){_classCallCheck(this,ContentObjectView);return _super.apply(this,arguments)}_createClass(ContentObjectView,[{key:"attributes",value:function attributes(){return AdaptView$1.resultExtend("attributes",{"role":"main","aria-labelledby":"".concat(this.model.get("_id"),"-heading")},this)}},{key:"className",value:function className(){return[this.constructor.type,"contentobject",this.constructor.className,this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].filter(Boolean).join(" ")}},{key:"preRender",value:function preRender(){$.inview.lock(this.constructor.type+"View");this.disableAnimation=Adapt.config.has("_disableAnimation")?Adapt.config.get("_disableAnimation"):false;this.$el.css("opacity",0);this.listenTo(this.model,"change:_isReady",this.isReady)}},{key:"render",value:function render(){var _this=this;var type=this.constructor.type;Adapt.trigger("".concat(type,"View:preRender contentObjectView:preRender view:preRender"),this);if(this.isReact){this.changed()}else{var data=this.model.toJSON();data.view=this;var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))}Adapt.trigger("".concat(type,"View:render contentObjectView:render view:render"),this);_.defer(function(){if(_this._isRemoved)return;_this.postRender();Adapt.trigger("".concat(type,"View:postRender contentObjectView:postRender view:postRender"),_this)});return this}},{key:"isReady",value:function(){var _isReady=_asyncToGenerator(_regeneratorRuntime().mark(function _callee2(){var _this2=this;var type,performIsReady;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(!(!this.model.get("_isReady")||this._isTriggeredReady)){_context2.next=2;break}return _context2.abrupt("return");case 2:this._isTriggeredReady=true;type=this.constructor.type;performIsReady=function(){var _ref=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(){var styleOptions;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:Adapt.trigger("".concat(type,"View:preReady contentObjectView:preReady view:preReady"),_this2);_context.next=3;return Adapt.wait.queue();case 3:$(".js-loading").hide();if(Adapt.get("_shouldContentObjectScrollTop")!==false){$(window).scrollTop(0)}Adapt.trigger("".concat(type,"View:ready contentObjectView:ready view:ready"),_this2);$.inview.unlock("".concat(type,"View"));styleOptions={opacity:1};if(_this2.disableAnimation){_this2.$el.css(styleOptions);$.inview();_.defer(function(){Adapt.trigger("".concat(type,"View:postReady contentObjectView:postReady view:postReady"),_this2)})}else{_this2.$el.velocity(styleOptions,{duration:"fast",complete:function(){$.inview();Adapt.trigger("".concat(type,"View:postReady contentObjectView:postReady view:postReady"),_this2)}})}$(window).scroll();case 10:case"end":return _context.stop();}},_callee)}));return function performIsReady(){return _ref.apply(this,arguments)}}();_.defer(performIsReady);case 6:case"end":return _context2.stop();}},_callee2,this)}));function isReady(){return _isReady.apply(this,arguments)}return isReady}()},{key:"renderTo",value:function(){var _renderTo=_asyncToGenerator(_regeneratorRuntime().mark(function _callee3(id){var isRenderToSelf,models,index,model,ids,forceUntilId;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:isRenderToSelf=id===this.model.get("_id");if(!isRenderToSelf){_context3.next=3;break}return _context3.abrupt("return");case 3:models=this.model.getAllDescendantModels(true).filter(function(model){return model.get("_isAvailable")});index=models.findIndex(function(model){return model.get("_id")===id});if(!(index===-1)){_context3.next=7;break}throw new Error("Cannot renderTo \"".concat(id,"\" as it isn't a descendant."));case 7:model=models[index];if(!(model.get("_isRendered")&&model.get("_isReady"))){_context3.next=10;break}return _context3.abrupt("return");case 10:models=models.slice(0,index+1);ids=_.indexBy(models,function(model){return model.get("_id")});forceUntilId=function(event){var addingId=event.model.get("_id");if(!ids[addingId])return;event.force();if(addingId!==id)return;Adapt.off("view:addChild",forceUntilId)};Adapt.on("view:addChild",forceUntilId);_context3.next=16;return this.addChildren();case 16:_context3.next=18;return this.whenReady();case 18:if(!(!model.get("_isRendered")||!model.get("_isReady"))){_context3.next=20;break}throw new Error("Cannot renderTo \"".concat(id,"\"."));case 20:case"end":return _context3.stop();}},_callee3,this)}));function renderTo(_x){return _renderTo.apply(this,arguments)}return renderTo}()},{key:"preRemove",value:function preRemove(){var type=this.constructor.type;Adapt.trigger("".concat(type,"View:preRemove contentObjectView:preRemove view:preRemove"),this)}},{key:"remove",value:function remove(){var _this3=this;var type=this.constructor.type;this.preRemove();Adapt.trigger("".concat(type,"View:remove contentObjectView:remove view:remove"),this);this._isRemoved=true;Adapt.wait.for(function(end){if(_this3.isReact){ReactDOM.unmountComponentAtNode(_this3.el)}_this3.$el.off("onscreen.adaptView");_this3.findDescendantViews().reverse().forEach(function(view){view.remove()});_this3.setChildViews(null);_get(_getPrototypeOf(ContentObjectView.prototype),"remove",_this3).call(_this3);_.defer(function(){Adapt.trigger("".concat(type,"View:postRemove contentObjectView:postRemove view:postRemove"),_this3);_this3.trigger("postRemove")});end()});return this}},{key:"destroy",value:function destroy(){this.remove();if(Adapt.parentView===this){Adapt.parentView=null}}}]);return ContentObjectView}(AdaptView$1));var PageView$2=function(_ContentObjectView){_inherits(PageView,_ContentObjectView);var _super=_createSuper(PageView);function PageView(){_classCallCheck(this,PageView);return _super.apply(this,arguments)}_createClass(PageView,[{key:"remove",value:function remove(){if(this.$pageLabel){this.$pageLabel.remove()}_get(_getPrototypeOf(PageView.prototype),"remove",this).call(this)}}]);return PageView}(ContentObjectView);Object.assign(PageView$2,{childContainer:".article__container",type:"page",template:"page"});Adapt.register("page",{view:PageView$2});__AMD("core/js/views/pageView",PageView$2);var ArticleView=function(_AdaptView){_inherits(ArticleView,_AdaptView);var _super=_createSuper(ArticleView);function ArticleView(){_classCallCheck(this,ArticleView);return _super.apply(this,arguments)}_createClass(ArticleView,[{key:"className",value:function className(){return["article",this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}}]);return ArticleView}(AdaptView$1);Object.assign(ArticleView,{childContainer:".block__container",type:"article",template:"article"});Adapt.register("article",{view:ArticleView});var ArticleView$1=__AMD("core/js/views/articleView",ArticleView);var BlockView=function(_AdaptView){_inherits(BlockView,_AdaptView);var _super=_createSuper(BlockView);function BlockView(){_classCallCheck(this,BlockView);return _super.apply(this,arguments)}_createClass(BlockView,[{key:"className",value:function className(){return["block",this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}}]);return BlockView}(AdaptView$1);Object.assign(BlockView,{childContainer:".component__container",type:"block",template:"block"});Adapt.register("block",{view:BlockView});__AMD("core/js/views/blockView",BlockView);var MPABC=function(_Backbone$Controller){_inherits(MPABC,_Backbone$Controller);var _super=_createSuper(MPABC);function MPABC(){_classCallCheck(this,MPABC);return _super.apply(this,arguments)}_createClass(MPABC,[{key:"initialize",value:function initialize(){this.listenTo(Data$1,{loading:this.waitForDataLoaded,loaded:this.onDataLoaded});this.setupSubsetCollections()}},{key:"waitForDataLoaded",value:function waitForDataLoaded(){Adapt.wait.begin()}},{key:"onDataLoaded",value:function onDataLoaded(){Adapt.wait.end()}},{key:"setupSubsetCollections",value:function setupSubsetCollections(){Adapt.contentObjects=new AdaptSubsetCollection(null,{parent:Data$1,model:ContentObjectModel});Adapt.articles=new AdaptSubsetCollection(null,{parent:Data$1,model:ArticleModel$1});Adapt.blocks=new AdaptSubsetCollection(null,{parent:Data$1,model:BlockModel$1});Adapt.components=new AdaptSubsetCollection(null,{parent:Data$1,model:ComponentModel$3})}}]);return MPABC}(Backbone.Controller);__AMD("core/js/mpabc",Adapt.mpabc=new MPABC);var defaultAriaLevels={"_menu":1,"_menuGroup":2,"_menuItem":2,"_page":1,"_article":2,"_block":3,"_component":4,"_componentItem":5,"_notify":1};var helpers$6={lowercase:function(text){return text.toLowerCase()},capitalise:function(text){return text.charAt(0).toUpperCase()+text.slice(1)},inc:function(index){return index+1},dec:function(index){return index-1},odd:function(index){return(index+1)%2===0?"even":"odd"},equals:function(value,text,block){return helpers$6.compare.call(this,value,"==",text,block)},compare:function(value,operator,text,block){switch(operator){case"===":if(value===text)return block.fn(this);break;case"=":case"==":if(value==text)return block.fn(this);break;case">=":if(value>=text)return block.fn(this);break;case"<=":if(value<=text)return block.fn(this);break;case">":if(value>text)return block.fn(this);break;case"<":if(value<text)return block.fn(this);break;}return block.inverse(this)},math:function(lvalue,operator,rvalue,options){lvalue=parseFloat(lvalue);rvalue=parseFloat(rvalue);switch(operator){case"+":return lvalue+rvalue;case"-":return lvalue-rvalue;case"*":return lvalue*rvalue;case"/":return lvalue/rvalue;case"%":return lvalue%rvalue;}},any:function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}var specified=args.slice(0,-1);var block=args.slice(-1)[0];return specified.some(Boolean)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},all:function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}var specified=args.slice(0,-1);var block=args.slice(-1)[0];return specified.every(Boolean)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},none:function(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3]}var specified=args.slice(0,-1);var block=args.slice(-1)[0];return!specified.some(Boolean)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},compile:function(template,context){if(!template){return""}if(template instanceof Object)template=template.toString();var data=this;if(context){var _context$data$root,_context$data;data=(_context$data$root=(_context$data=context.data)===null||_context$data===void 0?void 0:_context$data.root)!==null&&_context$data$root!==void 0?_context$data$root:context}return Handlebars.compile(template)(data)},compile_a11y_text:function(template,context){Adapt.a11y.log.deprecated("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return helpers$6.compile.call(this,template,context)},compile_a11y_normalize:function(template,context){if(!template){return""}if(template instanceof Object)template=template.toString();return Handlebars.helpers.a11y_normalize.call(this,helpers$6.compile.call(this,template,context))},compile_a11y_remove_breaks:function(template,context){if(!template){return""}return Handlebars.helpers.a11y_remove_breaks.call(this,helpers$6.compile.call(this,template,context))},import_globals:function(context){if(context.data.root._globals){return""}context.data.root._globals=Adapt.course.get("_globals");return""},import_adapt:function(context){if(context.data.root.Adapt){return}var adapt=context.data.root.Adapt={};var i,l,name;var directImport=["config","course"];for(i=0,l=directImport.length;i<l;i++){name=directImport[i];adapt[name]=Adapt[name].toJSON()}var indexedImport=["contentObjects","articles","blocks","components"];for(i=0,l=indexedImport.length;i<l;i++){name=indexedImport[i];var importArray=Adapt[name].toJSON();var importIndex={};for(var i1=0,l1=importArray.length;i1<l1;i1++){var item=importArray[i1];importIndex[item._id]=item}adapt[name]=importIndex}return""},component_description:function(override,context){var _this$_globals$_compo;if(!this._isA11yComponentDescriptionEnabled){return}var isNotDefined=!((_this$_globals$_compo=this._globals._components)!==null&&_this$_globals$_compo!==void 0&&_this$_globals$_compo["_"+this._component]);if(isNotDefined){return}var hasOverride=arguments.length>1;var description;if(hasOverride){description=override;description=helpers$6.compile(description,context)}else{description=this._globals._components["_"+this._component].ariaRegion;description=helpers$6.compile(description,override)}if(!description){return}return new Handlebars.SafeString("<div class=\"aria-label\">"+description+"</div>")},a11y_text:function(text){Adapt.a11y.log.deprecated("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return text},a11y_normalize:function(htmls){return Adapt.a11y.normalize.apply(Adapt.a11y,arguments)},a11y_remove_breaks:function(htmls){return Adapt.a11y.removeBreaks.apply(Adapt.a11y,arguments)},a11y_aria_label:function(htmls){var values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label\">"+values.join(" ")+"</div>")},a11y_aria_label_relative:function(htmls){var values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label relative\">"+values.join(" ")+"</div>")},a11y_aria_image:function(texts){var values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label\" role=\"img\" aria-label=\""+values.join(" ")+"\"></div>")},a11y_wrap_focus:function(){var cfg=Adapt.config.get("_accessibility");if(cfg._isPopupWrapFocusEnabled===false)return"";return new Handlebars.SafeString("<a class=\"a11y-focusguard a11y-ignore a11y-ignore-focus\" role=\"presentation\">&nbsp;</a>")},a11y_attrs_heading:function(levelOrType){var cfg=Adapt.config.get("_accessibility");var level=1;if(this._ariaLevel){levelOrType=this._ariaLevel}if(isNaN(levelOrType)===false){level=levelOrType}else if(_.isString(levelOrType)){var _cfg$_ariaLevels;cfg._ariaLevels=cfg._ariaLevels||defaultAriaLevels;if(((_cfg$_ariaLevels=cfg._ariaLevels)===null||_cfg$_ariaLevels===void 0?void 0:_cfg$_ariaLevels["_"+levelOrType])!==undefined){level=cfg._ariaLevels["_"+levelOrType]}}return new Handlebars.SafeString(" role=\"heading\" aria-level=\""+level+"\" ")},a11y_attrs_tabbable:function(){Adapt.a11y.log.deprecated("a11y_attrs_tabbable should not be used. tabbable elements should be natively tabbable.");return new Handlebars.SafeString(" role=\"region\" tabindex=\"0\" ")},a11y_alt_text:function(visible,alternatives){var values=Array.prototype.slice.call(arguments,1,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<span aria-hidden=\"true\">"+visible+"</span><span class=\"aria-label\">"+values.join(" ")+"</span>")}};Object.assign(helpers$6,{if_value_equals:function(){Adapt.a11y.log.deprecated("if_value_equals, use equals instead.");return helpers$6.equals.apply(this,arguments)},numbers:function(){Adapt.a11y.log.deprecated("numbers, use inc instead.");return helpers$6.inc.apply(this,arguments)},lowerCase:function(){Adapt.a11y.log.deprecated("lowerCase, use lowercase instead.");return helpers$6.lowercase.apply(this,arguments)}});for(var name$6 in helpers$6){if(!helpers$6.hasOwnProperty(name$6))continue;Handlebars.registerHelper(name$6,helpers$6[name$6])}__AMD("core/js/helpers",helpers$6);var Scrolling=function(_Backbone$Controller){_inherits(Scrolling,_Backbone$Controller);var _super=_createSuper(Scrolling);function Scrolling(){_classCallCheck(this,Scrolling);return _super.apply(this,arguments)}_createClass(Scrolling,[{key:"initialize",value:function initialize(){this.$html=null;this.$app=null;this.isLegacyScrolling=true;this._checkApp();Adapt.once("configModel:dataLoaded",this._loadConfig.bind(this))}},{key:"_checkApp",value:function _checkApp(){this.$html=$("html");this.$app=$("#app");if(this.$app.length)return;this.$app=$("<div id=\"app\">");$("body").append(this.$app);this.$app.append($("#wrapper"));Adapt.log.warn("UPDATE - Your html file needs to have #app adding. See https://github.com/adaptlearning/adapt_framework/issues/2168")}},{key:"_loadConfig",value:function _loadConfig(){var config=Adapt.config.get("_scrollingContainer");if(!(config!==null&&config!==void 0&&config._isEnabled))return;var limitTo=config._limitToSelector;var isIncluded=!limitTo||this.$html.is(limitTo)||this.$html.hasClass(limitTo);if(!isIncluded)return;this.isLegacyScrolling=false;this._addStyling();this._fixJQuery();this._fixScrollTo();this._fixBrowser()}},{key:"_addStyling",value:function _addStyling(){this.$html.addClass("adapt-scrolling")}},{key:"_fixJQuery",value:function _fixJQuery(){var selectorScrollTop=$.fn.scrollTop;var $app=Adapt.scrolling.$app;$.fn.scrollTop=function(){if(this[0]===window||this[0]===document.body){return selectorScrollTop.apply($app,arguments)}return selectorScrollTop.apply(this,arguments)};var selectorOffset=$.fn.offset;$.fn.offset=function(coordinates){if(coordinates){return selectorOffset.apply(this,arguments)}var $app=Adapt.scrolling.$app;var $element=this;var elementOffset=selectorOffset.call($element);var isCorrectedContainer=$element.is("html, body, #app")||$element.parents().is("#app");if(!isCorrectedContainer){return elementOffset}var scrollTop=parseInt($app.scrollTop());var scrollLeft=parseInt($app.scrollLeft());var appOffset=selectorOffset.call($app);elementOffset.top+=scrollTop-appOffset.top;elementOffset.left+=scrollLeft-appOffset.left;return elementOffset}}},{key:"_fixScrollTo",value:function _fixScrollTo(){var selectorScrollTo=$.fn.scrollTo;var scrollTo=$.scrollTo;var $app=Adapt.scrolling.$app;$.fn.scrollTo=function(target,duration,settings){if(this[0]===window||this[0]===document.body){return selectorScrollTo.apply($app,arguments)}return selectorScrollTo.apply(this,arguments)};$.scrollTo=function(target,duration,settings){return selectorScrollTo.apply($app,arguments)};Object.assign($.scrollTo,scrollTo)}},{key:"_fixBrowser",value:function _fixBrowser(){var app=Adapt.scrolling.$app[0];window.scrollTo=function(x,y){app.scrollTop=y||0;app.scrollLeft=x||0};var $window=$(window);this.$app.on("scroll",function(){$window.scroll()})}},{key:"scrollTo",value:function(){var _scrollTo=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(selector){var settings,_args=arguments;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:settings=_args.length>1&&_args[1]!==undefined?_args[1]:{};Adapt.log.deprecated("Adapt.scrollTo and Adapt.scrolling.scrollTo, use Adapt.navigateToElement instead.");return _context.abrupt("return",Adapt.router.navigateToElement(selector,settings));case 3:case"end":return _context.stop();}},_callee)}));function scrollTo(_x){return _scrollTo.apply(this,arguments)}return scrollTo}()}]);return Scrolling}(Backbone.Controller);Adapt.scrolling=new Scrolling;Adapt.scrollTo=Adapt.scrolling.scrollTo.bind(Adapt.scrolling);__AMD("core/js/scrolling",Adapt.scrolling);var HeadingView=function(_Backbone$View){_inherits(HeadingView,_Backbone$View);var _super=_createSuper(HeadingView);function HeadingView(){_classCallCheck(this,HeadingView);return _super.apply(this,arguments)}_createClass(HeadingView,[{key:"initialize",value:function initialize(){this.listenTo(Adapt.parentView,"postRemove",this.remove);this.listenTo(this.model,"change:_isComplete",this.updateAria);this.render()}},{key:"render",value:function render(){var template=Handlebars.templates[this.constructor.template];var data=this.model.toJSON();var customHeadingType=this.$el.attr("data-a11y-heading-type");if(customHeadingType)data._type=customHeadingType;this.$el.html(template(data));this.checkCompletion()}},{key:"updateAria",value:function updateAria(){var template=Handlebars.templates[this.constructor.template];var data=this.model.toJSON();var $rendered=$("<div>".concat(template(data),"</div>"));this.$(".aria-label").html($rendered.find(".aria-label").html());this.checkCompletion()}},{key:"checkCompletion",value:function checkCompletion(){var isComplete=this.model.get("_isComplete");this.$el.toggleClass("is-complete",isComplete).toggleClass("is-incomplete",!isComplete)}}]);return HeadingView}(Backbone.View);HeadingView.template="heading";var HeadingView$1=__AMD("core/js/views/headingView",HeadingView);var Headings=function(_Backbone$Controller){_inherits(Headings,_Backbone$Controller);var _super=_createSuper(Headings);function Headings(){_classCallCheck(this,Headings);return _super.apply(this,arguments)}_createClass(Headings,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,"view:render",this.onViewRender)}},{key:"onViewRender",value:function onViewRender(view){var $headingSeats=view.$(".js-heading");$headingSeats.each(function(index,el){return new HeadingView$1({el:el,model:view.model})})}}]);return Headings}(Backbone.Controller);__AMD("core/js/headings",new Headings);var NavigationView$2=function(_Backbone$View){_inherits(NavigationView,_Backbone$View);var _super=_createSuper(NavigationView);function NavigationView(){_classCallCheck(this,NavigationView);return _super.apply(this,arguments)}_createClass(NavigationView,[{key:"className",value:function className(){return"nav"}},{key:"events",value:function events(){return{"click [data-event]":"triggerEvent"}}},{key:"attributes",value:function attributes(){return{"role":"navigation"}}},{key:"initialize",value:function initialize(){this.listenToOnce(Adapt,{"courseModel:dataLoading":this.remove});this.listenTo(Adapt,"router:menu router:page",this.hideNavigationButton);this.preRender()}},{key:"preRender",value:function preRender(){Adapt.trigger("navigationView:preRender",this);this.render()}},{key:"render",value:function render(){var _this=this;var template=Handlebars.templates[this.constructor.template];this.$el.html(template({_globals:Adapt.course.get("_globals"),_accessibility:Adapt.config.get("_accessibility")})).insertBefore("#app");_.defer(function(){Adapt.trigger("navigationView:postRender",_this)});return this}},{key:"triggerEvent",value:function triggerEvent(event){event.preventDefault();var currentEvent=$(event.currentTarget).attr("data-event");Adapt.trigger("navigation:"+currentEvent);switch(currentEvent){case"backButton":Adapt.router.navigateToPreviousRoute();break;case"homeButton":Adapt.router.navigateToHomeRoute();break;case"parentButton":Adapt.router.navigateToParent();break;case"skipNavigation":this.skipNavigation();break;case"returnToStart":Adapt.startController.returnToStartLocation();break;}}},{key:"skipNavigation",value:function skipNavigation(){Adapt.a11y.focusFirst("."+Adapt.location._contentType)}},{key:"hideNavigationButton",value:function hideNavigationButton(model){var shouldHide=model.get("_type")==="course";this.$(".nav__back-btn, .nav__home-btn").toggleClass("u-display-none",shouldHide)}},{key:"showNavigationButton",value:function showNavigationButton(){this.$(".nav__back-btn, .nav__home-btn").removeClass("u-display-none")}}]);return NavigationView}(Backbone.View);NavigationView$2.template="nav";var NavigationView$3=__AMD("core/js/views/navigationView",NavigationView$2);var NavigationController=function(_Backbone$Controller){_inherits(NavigationController,_Backbone$Controller);var _super=_createSuper(NavigationController);function NavigationController(){_classCallCheck(this,NavigationController);return _super.apply(this,arguments)}_createClass(NavigationController,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,"adapt:preInitialize",this.addNavigationBar)}},{key:"addNavigationBar",value:function addNavigationBar(){var adaptConfig=Adapt.course.get("_navigation");if(adaptConfig!==null&&adaptConfig!==void 0&&adaptConfig._isDefaultNavigationDisabled){Adapt.trigger("navigation:initialize");return}Adapt.navigation=new NavigationView$3}}]);return NavigationController}(Backbone.Controller);__AMD("core/js/navigation",new NavigationController);var ComponentView=function(_AdaptView){_inherits(ComponentView,_AdaptView);var _super=_createSuper(ComponentView);function ComponentView(){_classCallCheck(this,ComponentView);return _super.apply(this,arguments)}_createClass(ComponentView,[{key:"attributes",value:function attributes(){if(!this.model.get("_isA11yRegionEnabled")){return AdaptView$1.resultExtend("attributes",{},this)}return AdaptView$1.resultExtend("attributes",{"aria-labelledby":this.model.get("_id")+"-heading","role":"region"},this)}},{key:"className",value:function className(){return["component",this.model.get("_component").toLowerCase(),this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),"is-"+this.model.get("_layout"),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}},{key:"renderState",value:function renderState(){Adapt.log.removed("renderState is removed and moved to item title")}},{key:"setupInviewCompletion",value:function setupInviewCompletion(){var inviewElementSelector=arguments.length>0&&arguments[0]!==undefined?arguments[0]:".component__inner";var callback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.setCompletionStatus;this.$inviewElement=this.$(inviewElementSelector);this.inviewCallback=callback;this.$inviewElement.on("inview.componentView",this.onInview.bind(this))}},{key:"removeInviewListener",value:function removeInviewListener(){if(!this.$inviewElement)return;this.$inviewElement.off("inview.componentView");this.$inviewElement=null}},{key:"onInview",value:function onInview(event,visible,visiblePartX,visiblePartY){if(!visible)return;switch(visiblePartY){case"top":this.hasSeenTop=true;break;case"bottom":this.hasSeenBottom=true;break;case"both":this.hasSeenTop=this.hasSeenBottom=true;}if(!this.hasSeenTop||!this.hasSeenBottom)return;this.inviewCallback();if(this.model.get("_isComplete")){this.removeInviewListener()}}},{key:"postRender",value:function postRender(){}},{key:"remove",value:function remove(){this.removeInviewListener();_get(_getPrototypeOf(ComponentView.prototype),"remove",this).call(this)}}]);return ComponentView}(AdaptView$1);ComponentView.type="component";var ComponentView$1=__AMD("core/js/views/componentView",ComponentView);var ActivatorView=function(_ComponentView){_inherits(ActivatorView,_ComponentView);var _super=_createSuper(ActivatorView);function ActivatorView(){_classCallCheck(this,ActivatorView);return _super.apply(this,arguments)}_createClass(ActivatorView,[{key:"events",value:function events(){return{"click .js-activator-click":"onBtnClicked"}}},{key:"initialize",value:function initialize(){ComponentView$1.prototype.initialize.call(this);this.setUpEventListeners()}},{key:"setUpEventListeners",value:function setUpEventListeners(){var _this=this;this.listenTo(this.model,"change:_isActive",this.onActiveChange);if(Adapt.isPDFMode()){this.listenToOnce(this.model,"change:_isReady",function(){_this.model.set("_isActive",true);Adapt.log.info("Activator: PDF mode detected; activating automatically.")})}}},{key:"checkIfResetOnRevisit",value:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}}},{key:"onBtnClicked",value:function onBtnClicked(event){this.model.set("_isActive",!this.model.get("_isActive"));this.setCompletionStatus();if(this.model.get("_toggleEnabled")===false){Adapt.log.warn("activatorView._toggleEnabled === false functionality needs re-implementation.");this.$el.off("click",event.currentTarget);$(event.currentTarget).attr("disabled",true)}}},{key:"onActiveChange",value:function onActiveChange(model,isActive){this.$(".js-activator-click").toggleClass("is-active",isActive).toggleClass("is-disabled",isActive);if(!isActive)return;_.debounce(this.scrollToTargets.bind(this),0)()}},{key:"scrollToTargets",value:function scrollToTargets(){var $targets=$();this.model.get("_targets").each(function(target){$targets=$targets.add($(Adapt.findViewByModelId(target.get("_parent").get("_id")).$el))});try{Adapt.navigateToElement($targets,{duration:400,align:"inview",offset:{top:-100,left:0},priority:-1})}catch(err){Adapt.log.error("An unexpected error prevented adapt-activator from scrolling its targets into view (is \"adapt-scrollfix\" installed?).",err)}}},{key:"preRender",value:function preRender(){}},{key:"postRender",value:function postRender(){if(this.model.get("_targetsReady"))this.setReadyStatus();else this.listenToOnce(this.model,"change:_targetsReady",this.setReadyStatus.bind(this))}}]);return ActivatorView}(ComponentView$1);ActivatorView.template="activator";var ActivatorView$1=__AMD("components/adapt-activator/js/activatorView",ActivatorView);var ActivatorTargetModel=function(_Backbone$Model){_inherits(ActivatorTargetModel,_Backbone$Model);var _super=_createSuper(ActivatorTargetModel);function ActivatorTargetModel(){_classCallCheck(this,ActivatorTargetModel);return _super.apply(this,arguments)}_createClass(ActivatorTargetModel,[{key:"defaults",value:function defaults(){return{_parent:undefined,_activationType:"default",_isReady:false,_isActive:false,_duration:800}}},{key:"initialize",value:function initialize(){var _this=this;this.listenTo(this.get("_parent"),"change:_isReady",function(m,isReady){_this.set("_isReady",isReady)});var component=this.get("_parent");if(!component.setupActivatorTarget);else{component.setupActivatorTarget(this.get("_isActive"))}}},{key:"toggle",value:function toggle(){var _this2=this;return new Promise(function(resolve){_this2.set("_isActive",!_this2.get("_isActive"));var component=_this2.get("_parent");if(!component.toggleActivatorTarget);else{component.toggleActivatorTarget(_this2.get("_isActive"))}_.debounce(resolve,_this2.get("_duration")||0)()})}}]);return ActivatorTargetModel}(Backbone.Model);var ActivatorTargetModel$1=__AMD("components/adapt-activator/js/activatorTargetModel",ActivatorTargetModel);var ActivatorModel=function(_ComponentModel){_inherits(ActivatorModel,_ComponentModel);var _super=_createSuper(ActivatorModel);function ActivatorModel(){_classCallCheck(this,ActivatorModel);return _super.apply(this,arguments)}_createClass(ActivatorModel,[{key:"defaults",value:function defaults(){return ComponentModel$3.resultExtend("defaults",{_isActive:false})}},{key:"initialize",value:function initialize(){ComponentModel$3.prototype.initialize.call(this);this.setUpEventListeners()}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenTo(Adapt,"app:dataReady",this.onDataReady.bind(this));this.listenTo(this,"change:_isActive",this.onActiveChange.bind(this))}},{key:"onDataReady",value:function onDataReady(){this.initTargets();this.listenTo(this.get("_targets"),"change:_isReady",this.onTargetReadyChange)}},{key:"onTargetReadyChange",value:function onTargetReadyChange(targetModel,isReady){var notReadyModel=this.get("_targets").find(function(m){return!m.get("_isReady")});if(notReadyModel)return;this.set("_targetsReady",true)}},{key:"initTargets",value:function initTargets(){var _this=this;var targets=this.get("_targets");var _targets=[];var index=0;_.each(targets,function(target,key){var componentId=target._id;if(componentId===undefined&&typeof key==="string"){componentId=key;Adapt.log.deprecated("Set \"_target\" as an array with property \"_id\" in its elements instead of a dictionary.")}var componentModel=Adapt.findById(componentId);if(!componentModel)throw"activatorModel could not find _target component with _id: "+componentId;var activatorTarget=new ActivatorTargetModel$1({_activatorModel:_this,_parent:componentModel,_activationType:target._activationType?target._activationType:"default",_index:index});componentModel.set("_activatorTarget",activatorTarget);_targets.push(activatorTarget);index++});this.set("_targets",new Backbone.Collection(_targets))}},{key:"onActiveChange",value:function onActiveChange(model,isActive){this.toggleTargets(isActive)}},{key:"toggleTargets",value:function(){var _toggleTargets=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(isActive){var targetModels,i;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:targetModels=this.get("_targets").models;i=0;case 2:if(!(i<targetModels.length)){_context.next=12;break}if(!isActive){_context.next=8;break}_context.next=6;return targetModels[i].toggle();case 6:_context.next=9;break;case 8:targetModels[i].toggle();case 9:i++;_context.next=2;break;case 12:case"end":return _context.stop();}},_callee,this)}));function toggleTargets(_x){return _toggleTargets.apply(this,arguments)}return toggleTargets}()}]);return ActivatorModel}(ComponentModel$3);var ActivatorModel$1=__AMD("components/adapt-activator/js/activatorModel",ActivatorModel);var helpers$5={ac_mark:function(){return"data-activator-transition=\"mark\""},ac_show:function(){return"data-activator-transition=\"show\""}};for(var name$5 in helpers$5){if(!helpers$5.hasOwnProperty(name$5))continue;Handlebars__default["default"].registerHelper(name$5,helpers$5[name$5])}Adapt.on("componentView:preRender",function(componentView){if(componentView.onActivatorToggle)return;var activatorTarget=componentView.model.get("_activatorTarget");if(!activatorTarget)return;componentView.$el.addClass("is-activator-target").attr("data-activator-activation",activatorTarget.get("_activationType"));componentView.listenTo(activatorTarget,"change:_isActive",function(model,isActive){componentView.$el.toggleClass("is-activator-active",isActive)});if(componentView.model.get("_component")=="text"&&activatorTarget.get("_activationType")=="default"){setUpDefaultTargetComponent(componentView)}});function setUpDefaultTargetComponent(componentView){var activatorTarget=componentView.model.get("_activatorTarget");componentView.model.get("_componentRow").set("_hasDivider",false);componentView.$el.hide(0);componentView.getBoundingClientRect=function(){componentView.$el.show(0).css("height","");var bb=componentView.$el[0].getBoundingClientRect();if(!activatorTarget.get("_isActive")){componentView.$el.hide(0)}return bb};componentView.listenTo(activatorTarget,"change:_isActive",function(model,isActive){if(isActive){componentView.$el.slideDown()}else{componentView.$el.slideUp()}})}__AMD("components/adapt-activator/js/adapt-activator",Adapt.register("activator",{model:ActivatorModel$1,view:ActivatorView$1}));var HYBActivatorView=function(_ComponentView){_inherits(HYBActivatorView,_ComponentView);var _super=_createSuper(HYBActivatorView);function HYBActivatorView(){_classCallCheck(this,HYBActivatorView);return _super.apply(this,arguments)}_createClass(HYBActivatorView,[{key:"events",value:function events(){return{"click .js-hyb-activator-main-btn":"onMainBtnClick"}}},{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBActivatorView.prototype),"initialize",this).call(this)}},{key:"onMainBtnClick",value:function onMainBtnClick(event){this.model.set("_isContentActive",true)}},{key:"preRender",value:function preRender(){this.setupModelData();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model,{"change:_isContentActive":this.onContentActiveChange,"change:_isComplete":this.onComplete})}},{key:"onComplete",value:function onComplete(event,isComplete){if(!isComplete)return;this.$(".js-hyb-activator-main-btn").toggleClass("is-complete",isComplete)}},{key:"onContentActiveChange",value:function onContentActiveChange(event,isContentActive){var _this$model$get;if(!isContentActive)return;(_this$model$get=this.model.get("_hybBackground"))===null||_this$model$get===void 0?void 0:_this$model$get.blur();this.$el.toggleClass("is-content-active",isContentActive);this.setCompletionStatus()}},{key:"setupModelData",value:function setupModelData(){var _content=this.model.get("_content");if(_content._theme===undefined){_content._theme="bubble"}}},{key:"postRender",value:function postRender(){var _this=this;this.$el.imageready(function(){_this.setReadyStatus()})}}]);return HYBActivatorView}(ComponentView$1);HYBActivatorView.template="hyb-activator";var HYBActivatorView$1=__AMD("components/adapt-hyb-activator/js/hyb-activatorView",HYBActivatorView);var ComponentModel=function(_AdaptModel){_inherits(ComponentModel,_AdaptModel);var _super=_createSuper(ComponentModel);function ComponentModel(){_classCallCheck(this,ComponentModel);return _super.apply(this,arguments)}_createClass(ComponentModel,[{key:"_parent",get:function(){Adapt.log.deprecated("componentModel._parent, use componentModel.getParent() instead, parent models are defined by the JSON");return"blocks"}},{key:"_siblings",get:function(){Adapt.log.deprecated("componentModel._siblings, use componentModel.getSiblings() instead, sibling models are defined by the JSON");return"components"}},{key:"getTypeGroup",value:function getTypeGroup(){return"component"}},{key:"defaults",value:function defaults(){return AdaptModel.resultExtend("defaults",{_isA11yComponentDescriptionEnabled:true,_userAnswer:null,_attemptStates:null,_isHybComplete:false})}},{key:"trackable",value:function trackable(){return AdaptModel.resultExtend("trackable",["_userAnswer","_attemptStates","_isHybComplete"])}},{key:"trackableType",value:function trackableType(){return AdaptModel.resultExtend("trackableType",[Array,Array,Boolean])}},{key:"hasManagedChildren",get:function(){return false}},{key:"init",value:function init(){if(Adapt.get("_isStarted")){this.onAdaptInitialize();return}this.listenToOnce(Adapt,"adapt:initialize",this.onAdaptInitialize)}},{key:"onAdaptInitialize",value:function onAdaptInitialize(){this.restoreUserAnswers()}},{key:"restoreUserAnswers",value:function restoreUserAnswers(){}},{key:"storeUserAnswer",value:function storeUserAnswer(){}},{key:"resetUserAnswer",value:function resetUserAnswer(){this.set("_userAnswer",null)}},{key:"reset",value:function reset(type,force){if(!this.get("_canReset")&&!force)return;this.resetUserAnswer();_get(_getPrototypeOf(ComponentModel.prototype),"reset",this).call(this,type,force)}},{key:"getAttemptState",value:function getAttemptState(){var object=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.toJSON();var trackables=this.trackable();var types=this.trackableType();trackables.find(function(name,index){if(name!=="_attemptStates")return;trackables.splice(index,1);types.splice(index,1);return true});var values=trackables.map(function(n){return object[n]});var booleans=values.filter(function(v,i){return types[i]===Boolean}).map(Boolean);var numbers=values.filter(function(v,i){return types[i]===Number}).map(function(v){return Number(v)||0});var arrays=values.filter(function(v,i){return types[i]===Array});return[numbers,booleans,arrays]}},{key:"getAttemptObject",value:function getAttemptObject(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getAttemptState();var trackables=this.trackable();var types=this.trackableType();trackables.find(function(name,index){if(name!=="_attemptStates")return;trackables.splice(index,1);types.splice(index,1);return true});var numbers=(state[0]||[]).slice(0);var booleans=(state[1]||[]).slice(0);var arrays=(state[2]||[]).slice(0);var object={};trackables.forEach(function(n,i){if(n==="_id")return;switch(types[i]){case Number:object[n]=numbers.shift();break;case Boolean:object[n]=booleans.shift();break;case Array:object[n]=arrays.shift();break;}});return object}},{key:"setAttemptObject",value:function setAttemptObject(object){var silent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.set(object,{silent:silent})}},{key:"addAttemptObject",value:function addAttemptObject(){var object=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getAttemptObject();var attemptStates=this.get("_attemptStates")||[];var state=this.getAttemptState(object);attemptStates.push(state);this.set("_attemptStates",attemptStates)}},{key:"getAttemptObjects",value:function getAttemptObjects(){var _this=this;var states=this.get("_attemptStates")||[];return states.map(function(state){return _this.getAttemptObject(state)})}}]);return ComponentModel}(AdaptModel);Adapt.register("component",{model:ComponentModel});var ComponentModel$1=__AMD("core/js/models/ComponentModel",ComponentModel);var HYBNarrativeModel$2=function(_ComponentModel){_inherits(HYBNarrativeModel,_ComponentModel);var _super=_createSuper(HYBNarrativeModel);function HYBNarrativeModel(){_classCallCheck(this,HYBNarrativeModel);return _super.apply(this,arguments)}_createClass(HYBNarrativeModel,[{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBNarrativeModel.prototype),"initialize",this).call(this);this.set("_isContentActive",false)}}]);return HYBNarrativeModel}(ComponentModel$1);var HYBActivatorModel=__AMD("components/adapt-hyb-activator/js/hyb-activatorModel",HYBNarrativeModel$2);__AMD("components/adapt-hyb-activator/js/adapt-hyb-activator",Adapt.register("hyb-activator",{model:HYBActivatorModel,view:HYBActivatorView$1}));var HYBBookView=function(_ComponentView){_inherits(HYBBookView,_ComponentView);var _super=_createSuper(HYBBookView);function HYBBookView(){_classCallCheck(this,HYBBookView);return _super.apply(this,arguments)}_createClass(HYBBookView,[{key:"events",value:function events(){return{"click .js-hyb-book-front":"onMainBtnClick","click .js-hyb-book-back":"onBackClick","click .js-hyb-book-main-btn":"onMainBtnClick","click .js-hyb-book-controls-left":"onNavigationClick","click .js-hyb-book-controls-right":"onNavigationClick","click .js-hyb-book-controls-close":"onCloseClick","click .js-hyb-book-progress":"onProgressClick"}}},{key:"initialize",value:function initialize(){this.splitPages=_.debounce(this.splitPages.bind(this),100);this.setupModelData();_get(_getPrototypeOf(HYBBookView.prototype),"initialize",this).call(this)}},{key:"setupModelData",value:function setupModelData(){this.model.set("_itemCount",this.model.getChildren().length);this.model.setActiveItem(0)}},{key:"onMainBtnClick",value:function onMainBtnClick(event){this.model.setActiveItem(1)}},{key:"onBackClick",value:function onBackClick(event){this.model.setActiveItem(this.model.getChildren().length-2)}},{key:"preRender",value:function preRender(){this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model.getChildren(),{"change:_isActive":this.onItemActiveChange,"change:_isVisited":this.onItemVisitedChange,"change:_isComplete":this.onItemCompleteChange});this.listenTo(this.model,"change:_isComplete",this.onComplete)}},{key:"onComplete",value:function onComplete(model,isComplete){if(!isComplete)return;this.$(".js-hyb-book-main-btn").toggleClass("is-complete",isComplete)}},{key:"onItemActiveChange",value:function onItemActiveChange(itemModel,isActive){var $item=this.$(".js-hyb-book-item").filter("[data-index=".concat(itemModel.get("_index"),"]"));$item.toggleClass("is-active",isActive);var activeItem=this.model.getActiveItem();if(activeItem){activeItem.set("_isVisited",true);var $items=this.$(".js-hyb-book-item");var idx=activeItem.get("_index");$items.each(function(i,e){var isOpen=i<idx;$(e).toggleClass("is-open",isOpen).toggleClass("is-closed",!isOpen)});var isCover=idx===0||idx===this.model.getChildren().length-1;this.$(".js-hyb-book-controls-left").toggleClass("is-hidden",idx===0);this.$(".js-hyb-book-controls-right").toggleClass("is-hidden",isCover);this.$(".js-hyb-book-controls-close").toggleClass("is-hidden",idx===0);this.$(".js-hyb-book-indicators").toggleClass("is-hidden",isCover);this.$(".js-hyb-book-progress").removeClass("is-active").filter("[data-index=".concat(idx,"]")).addClass("is-active").addClass("is-complete")}return}},{key:"onItemCompleteChange",value:function onItemCompleteChange(itemModel,isComplete){return}},{key:"onItemVisitedChange",value:function onItemVisitedChange(itemModel,isVisited){return}},{key:"onNavigationClick",value:function onNavigationClick(event){var activeItem=this.model.getActiveItem();if(!activeItem){this.model.setActiveItem(0);return}var stage=activeItem.get("_index");if($(event.currentTarget).hasClass("js-hyb-book-controls-right")){this.model.setActiveItem(++stage)}else if($(event.currentTarget).hasClass("js-hyb-book-controls-left")){this.model.setActiveItem(--stage)}}},{key:"onCloseClick",value:function onCloseClick(){this.model.setActiveItem(0)}},{key:"onProgressClick",value:function onProgressClick(event){var activeItem=this.model.getActiveItem();if(!activeItem||activeItem.get("_isCover"))return;var idx=$(event.currentTarget).attr("data-index");this.model.setActiveItem(parseInt(idx,10))}},{key:"postRender",value:function postRender(){var _this=this;this.model.setActiveItem(0);this.$el.imageready(function(){_this.setReadyStatus();_this.setupDebug()})}},{key:"setupDebug",value:function setupDebug(){var _this2=this;var debugWindow=Adapt.hyb.debug.initDebugWindow(this.model.getParent(),"_items");this.model.getChildren().each(function(itemModel,idx){var _itemModel$get,_itemModel$get2;var lGraphic=(_itemModel$get=itemModel.get("_pageLeft"))===null||_itemModel$get===void 0?void 0:_itemModel$get._graphic;var rGraphic=(_itemModel$get2=itemModel.get("_pageRight"))===null||_itemModel$get2===void 0?void 0:_itemModel$get2._graphic;if(lGraphic)debugWindow.track(itemModel,"_pageLeft._graphic._sizing._width","[".concat(idx,"]._pageLeft._graphic._sizing._width(%)"));if(rGraphic)debugWindow.track(itemModel,"_pageRight._graphic._sizing._width","[".concat(idx,"]._pageRight._graphic._sizing._width(%)"))});this.listenTo(this.model.getChildren(),"change:_pageLeft",function(itemModel,pageLeft){var _pageLeft$_graphic,_pageLeft$_graphic$_s;var $graphic=_this2.$(".js-hyb-book-item-graphic[data-id='left.".concat(itemModel.get("_index"),"']"));var width=pageLeft===null||pageLeft===void 0?void 0:(_pageLeft$_graphic=pageLeft._graphic)===null||_pageLeft$_graphic===void 0?void 0:(_pageLeft$_graphic$_s=_pageLeft$_graphic._sizing)===null||_pageLeft$_graphic$_s===void 0?void 0:_pageLeft$_graphic$_s._width;console.log($graphic,width);if(!$graphic.length||!width)return;$graphic.css("width",width+"%")});this.listenTo(this.model.getChildren(),"change:_pageRight",function(itemModel,pageRight){var _pageRight$_graphic,_pageRight$_graphic$_;var $graphic=_this2.$(".js-hyb-book-item-graphic[data-id='right.".concat(itemModel.get("_index"),"']"));var width=pageRight===null||pageRight===void 0?void 0:(_pageRight$_graphic=pageRight._graphic)===null||_pageRight$_graphic===void 0?void 0:(_pageRight$_graphic$_=_pageRight$_graphic._sizing)===null||_pageRight$_graphic$_===void 0?void 0:_pageRight$_graphic$_._width;if(!$graphic.length||!width)return;$graphic.css("width",width+"%")})}},{key:"splitPages",value:function splitPages(){return}}]);return HYBBookView}(ComponentView$1);HYBBookView.template="hyb-book";var HYBBookView$1=__AMD("components/adapt-hyb-book/js/hyb-bookView",HYBBookView);var ItemModel=__AMD("core/js/models/itemModel",function(_LockingModel){_inherits(ItemModel,_LockingModel);var _super=_createSuper(ItemModel);function ItemModel(){_classCallCheck(this,ItemModel);return _super.apply(this,arguments)}_createClass(ItemModel,[{key:"defaults",value:function defaults(){return{_isActive:false,_isVisited:false}}},{key:"reset",value:function reset(){this.set({_isActive:false,_isVisited:false})}},{key:"toggleActive",value:function toggleActive(){var isActive=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!this.get("_isActive");this.set("_isActive",isActive)}},{key:"toggleVisited",value:function toggleVisited(){var isVisited=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!this.get("_isVisited");this.set("_isVisited",isVisited)}}]);return ItemModel}(LockingModel));var ItemsComponentModel=__AMD("core/js/models/itemsComponentModel",function(_ComponentModel){_inherits(ItemsComponentModel,_ComponentModel);var _super=_createSuper(ItemsComponentModel);function ItemsComponentModel(){_classCallCheck(this,ItemsComponentModel);return _super.apply(this,arguments)}_createClass(ItemsComponentModel,[{key:"toJSON",value:function toJSON(){var json=_get(_getPrototypeOf(ItemsComponentModel.prototype),"toJSON",this).call(this);json._items=this.getChildren().toJSON();return json}},{key:"init",value:function init(){this.setUpItems();this.listenTo(this.getChildren(),{"all":this.onAll,"change:_isVisited":this.checkCompletionStatus});_get(_getPrototypeOf(ItemsComponentModel.prototype),"init",this).call(this)}},{key:"restoreUserAnswers",value:function restoreUserAnswers(){var booleanArray=this.get("_userAnswer");if(!booleanArray)return;this.getChildren().forEach(function(child,index){return child.set("_isVisited",booleanArray[index])})}},{key:"storeUserAnswer",value:function storeUserAnswer(){var booleanArray=this.getChildren().map(function(child){return child.get("_isVisited")});this.set("_userAnswer",booleanArray)}},{key:"setUpItems",value:function setUpItems(){var items=this.get("_items")||[];items.forEach(function(item,index){return item._index=index});this.setChildren(new Backbone.Collection(items,{model:ItemModel}))}},{key:"getItem",value:function getItem(index){return this.getChildren().findWhere({_index:index})}},{key:"getVisitedItems",value:function getVisitedItems(){return this.getChildren().where({_isVisited:true})}},{key:"getActiveItems",value:function getActiveItems(){return this.getChildren().where({_isActive:true})}},{key:"getActiveItem",value:function getActiveItem(){return this.getChildren().findWhere({_isActive:true})}},{key:"areAllItemsCompleted",value:function areAllItemsCompleted(){return this.getVisitedItems().length===this.getChildren().length}},{key:"checkCompletionStatus",value:function checkCompletionStatus(){this.storeUserAnswer();if(!this.areAllItemsCompleted())return;this.setCompletionStatus()}},{key:"reset",value:function reset(type,force){this.getChildren().each(function(item){return item.reset()});_get(_getPrototypeOf(ItemsComponentModel.prototype),"reset",this).call(this,type,force)}},{key:"resetActiveItems",value:function resetActiveItems(){this.getChildren().each(function(item){return item.toggleActive(false)})}},{key:"setActiveItem",value:function setActiveItem(index){var item=this.getItem(index);if(!item)return;var activeItem=this.getActiveItem();if(activeItem)activeItem.toggleActive(false);item.toggleActive(true)}}]);return ItemsComponentModel}(ComponentModel$3));var HYBBookModel=function(_ItemsComponentModel){_inherits(HYBBookModel,_ItemsComponentModel);var _super=_createSuper(HYBBookModel);function HYBBookModel(){_classCallCheck(this,HYBBookModel);return _super.apply(this,arguments)}_createClass(HYBBookModel,[{key:"initialize",value:function initialize(){var _this=this;var bookSettings=this.get("_bookSettings")||{};bookSettings.frontSrc=bookSettings.frontSrc||"assets/adapt-hyb-book/cover-front.jpg";bookSettings.backSrc=bookSettings.backSrc||"assets/adapt-hyb-book/cover-back.jpg";bookSettings.innerSrc=bookSettings.innerSrc||"assets/adapt-hyb-book/cover-back.jpg";this.set("_bookSettings",bookSettings);var outro=this.get("_outro");this.set("_hasOutro",Boolean((outro===null||outro===void 0?void 0:outro.title)||(outro===null||outro===void 0?void 0:outro.body)));var items=this.get("_items");items=[{}].concat(items);items.push({});items.forEach(function(e,i){e._pageNum=i*2-1;e._zIndex=items.length-i;_this.legacyFixItem(e)});items[0]._isFront=true;items[0]._isCover=true;items[0]._isVisited=true;items[1]._isFirst=true;items[items.length-2]._isLast=true;items[items.length-1]._isCover=true;items[items.length-1]._isBack=true;items[items.length-1]._isVisited=!this.get("_hasOutro");this.set("_items",items);_get(_getPrototypeOf(HYBBookModel.prototype),"initialize",this).call(this)}},{key:"legacyFixItem",value:function legacyFixItem(item){var _pageLeft$title,_pageLeft$body,_pageRight$title,_pageRight$body,_pageRight$_graphic,_pageRight$_backgroun;var pageLeft=item._pageLeft||{};var pageRight=item._pageRight||{};(_pageLeft$title=pageLeft.title)!==null&&_pageLeft$title!==void 0?_pageLeft$title:pageLeft.title=item.title;(_pageLeft$body=pageLeft.body)!==null&&_pageLeft$body!==void 0?_pageLeft$body:pageLeft.body=item.body;(_pageRight$title=pageRight.title)!==null&&_pageRight$title!==void 0?_pageRight$title:pageRight.title=item.titleRight;(_pageRight$body=pageRight.body)!==null&&_pageRight$body!==void 0?_pageRight$body:pageRight.body=item.bodyRight;(_pageRight$_graphic=pageRight._graphic)!==null&&_pageRight$_graphic!==void 0?_pageRight$_graphic:pageRight._graphic=item._graphic;(_pageRight$_backgroun=pageRight._background)!==null&&_pageRight$_backgroun!==void 0?_pageRight$_backgroun:pageRight._background=item._background;item._pageLeft=pageLeft;item._pageRight=pageRight}}]);return HYBBookModel}(ItemsComponentModel);var HYBBookModel$1=__AMD("components/adapt-hyb-book/js/hyb-bookModel",HYBBookModel);__AMD("components/adapt-hyb-book/js/adapt-hyb-book",Adapt.register("hyb-book",{model:HYBBookModel$1,view:HYBBookView$1}));var PAGE_HEIGHT_THRESHOLD=2;var HYBChecklistView=function(_ComponentView){_inherits(HYBChecklistView,_ComponentView);var _super=_createSuper(HYBChecklistView);function HYBChecklistView(){_classCallCheck(this,HYBChecklistView);return _super.apply(this,arguments)}_createClass(HYBChecklistView,[{key:"events",value:function events(){return{"click .js-hyb-checklist-item-btn":"onItemBtnClick","click .js-hyb-checklist-controls-left":"onNavigationClick","click .js-hyb-checklist-controls-right":"onNavigationClick","click .js-hyb-checklist-progress":"onProgressClick"}}},{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBChecklistView.prototype),"initialize",this).call(this);this._lastPageViewedCC=this.model.createCompletionCondition()}},{key:"preRender",value:function preRender(){this.setupModelData();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model,{"change:_activePageIdx":this.onActivePageIdxChange,"change:_hasControls":this.onHasControlsChange});this.listenTo(this.model.getChildren(),{"change:_isActive":this.onItemActiveChange,"change:_isComplete":this.onItemCompleteChange,"change:_isVisited":this.onItemVisitedChange})}},{key:"onHasControlsChange",value:function onHasControlsChange(model,hasControls){this.$el.toggleClass("has-controls",hasControls)}},{key:"onActivePageIdxChange",value:function onActivePageIdxChange(model,idx){var $pages=this.$(".js-hyb-checklist-page");$pages.toggleClass("is-active",false);$pages.filter("[data-index=".concat(idx,"]")).toggleClass("is-active",true);this.$(".js-hyb-checklist-controls-left").toggleClass("is-hidden",idx===0);this.$(".js-hyb-checklist-controls-right").toggleClass("is-hidden",idx===this.model.get("_pageCount")-1);this.$(".js-hyb-checklist-progress").toggleClass("is-active",false).filter("[data-index=".concat(idx,"]")).toggleClass("is-active",true).toggleClass("is-complete",this.isPageComplete(idx));if(idx===this.model.get("_pageCount")-1){var _this$_lastPageViewed;(_this$_lastPageViewed=this._lastPageViewedCC)===null||_this$_lastPageViewed===void 0?void 0:_this$_lastPageViewed.call(this)}if(this._lastActivePageIdx===undefined){this._lastActivePageIdx=idx;return}var $clip=this.$(".js-hyb-checklist-clip");$clip.toggleClass("is-active",true).toggleClass("is-next",this._lastActivePageIdx<idx).toggleClass("is-prev",this._lastActivePageIdx>idx).one("animationend webkitAnimationEnd",function(){$clip.removeClass("is-active")});this._lastActivePageIdx=idx}},{key:"onItemBtnClick",value:function onItemBtnClick(event){var itemIdx=$(event.currentTarget).data("adapt-index");this.model.setActiveItem(itemIdx)}},{key:"onItemActiveChange",value:function onItemActiveChange(itemModel,isActive){var $item=this.$getItem(itemModel);$item.toggleClass("is-active",isActive);if(!isActive)return;itemModel.toggleVisited(true);itemModel.set("_isComplete",true);var pageIdx=itemModel.get("_pageIndex");var incompleteSamePage=this.model.getChildren().find(function(itemModel){if(itemModel.get("_pageIndex")!==pageIdx)return false;if(itemModel.get("_isComplete"))return false;return true});if(!incompleteSamePage){this.$(".js-hyb-checklist-progress").filter("[data-index=".concat(pageIdx,"]")).toggleClass("is-complete",true)}}},{key:"onItemVisitedChange",value:function onItemVisitedChange(itemModel,isVisited){var $item=this.$getItem(itemModel);$item.toggleClass("is-visited",isVisited)}},{key:"onItemCompleteChange",value:function onItemCompleteChange(itemModel,isComplete){var $item=this.$getItem(itemModel);$item.toggleClass("is-complete",isComplete).find(".js-hyb-checklist-item-btn").toggleClass("is-locked",isComplete)}},{key:"$getItem",value:function $getItem(itemModel){return this.$(".js-hyb-checklist-item").filter("[data-index=".concat(itemModel.get("_index"),"]"))}},{key:"isPageComplete",value:function isPageComplete(pageIdx){var incomplete=this.model.getChildren().find(function(itemModel){if(itemModel.get("_pageIndex")!==pageIdx)return false;if(itemModel.get("_isComplete"))return false;return true});return!incomplete}},{key:"setupModelData",value:function setupModelData(){}},{key:"postRender",value:function postRender(){var _this=this;this.$el.imageready(function(){_.delay(function(){_this.setupPages();_this.setReadyStatus();_this.imgRenderFallback()},100)})}},{key:"imgRenderFallback",value:function imgRenderFallback(){var $img=this.$(".js-hyb-checklist-image .js-ddimg-img");if($img.width()>5)return;this.$(".js-hyb-checklist-image-container").hide(0).delay(0).show(0)}},{key:"setupPages",value:function setupPages(){this.model.set("_pageCount",0);var $items=this.$(".js-hyb-checklist-item");this.renderPages($items);this.renderProgress();this.model.set("_activePageIdx",0);this.$(".js-hyb-checklist-page").hide(0).show(0)}},{key:"renderPages",value:function renderPages($items){var _this2=this;var $pageContainer=this.$(".js-hyb-checklist-page-container");var template=Handlebars.templates["hyb-checklistPage"];var data={_index:this.model.get("_pageCount")};var $page=$(new Handlebars.SafeString(template(data)).string);$pageContainer.prepend($page);$page.find(".js-hyb-checklist-items").append($items);var removedItems=0;var $removedItems=$();while(Math.abs($page.outerHeight()-$pageContainer.outerHeight())>PAGE_HEIGHT_THRESHOLD){this.model.set("_hasControls",true);$items=$page.find(".js-hyb-checklist-item");$removedItems=$items.last().detach().add($removedItems);removedItems++}$items.each(function(i,e){var $item=$(e);var itemIdx=$item.attr("data-index");if(itemIdx===undefined)return;var itemModel=_this2.model.getChildren().find(function(itemModel){return itemModel.get("_index")==itemIdx});if(!itemModel)Adapt.log.error("hyb-checklist: could not find item with index: ".concat(itemIdx,"."));else itemModel.set("_pageIndex",_this2.model.get("_pageCount"))});this.model.set("_pageCount",this.model.get("_pageCount")+1);if(this.model.get("_pageCount")>100){throw"hyb-checklistView: infinite loop detected in renderPages() for component ".concat(this.model.get("_id"),".")}if(!removedItems)return;this.renderPages($removedItems)}},{key:"renderProgress",value:function renderProgress(){var pageCount=this.model.get("_pageCount");if(pageCount<=1)return;var data={_items:Array(pageCount).fill(true)};var template=Handlebars.templates["hyb-checklistProgress"];var $progress=$(new Handlebars.SafeString(template(data)).string);this.$(".js-hyb-checklist-indicators").append($progress)}},{key:"onNavigationClick",value:function onNavigationClick(event){var activePageIdx=this.model.get("_activePageIdx");if($(event.currentTarget).hasClass("js-hyb-checklist-controls-left")){if(activePageIdx<=0)return;this.model.set("_activePageIdx",activePageIdx-1);return}if($(event.currentTarget).hasClass("js-hyb-checklist-controls-right")){if(!this.isPageComplete(activePageIdx)){var incompleteItem=this.model.getChildren().find(function(item){return!item.get("_isComplete")});if(incompleteItem){this.model.setActiveItem(incompleteItem.get("_index"));return}}if(activePageIdx>=this.model.get("_pageCount")-1)return;this.model.set("_activePageIdx",activePageIdx+1);return}}},{key:"onProgressClick",value:function onProgressClick(event){var idx=parseInt($(event.currentTarget).attr("data-index"),10);if(idx==0||this.isPageComplete(idx-1)){this.model.set("_activePageIdx",idx)}else{var $el=$(event.currentTarget);$el.addClass("is-shake").one("animationend webkitAnimationEnd",function(){$el.removeClass("is-shake")})}}}]);return HYBChecklistView}(ComponentView$1);HYBChecklistView.template="hyb-checklist";var HYBChecklistView$1=__AMD("components/adapt-hyb-checklist/js/hyb-checklistView",HYBChecklistView);var HYBChecklistModel=function(_ItemsComponentModel){_inherits(HYBChecklistModel,_ItemsComponentModel);var _super=_createSuper(HYBChecklistModel);function HYBChecklistModel(){_classCallCheck(this,HYBChecklistModel);return _super.apply(this,arguments)}_createClass(HYBChecklistModel,[{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBChecklistModel.prototype),"initialize",this).call(this);var graphic=this.get("_graphic");if(!graphic)return;graphic._isEnabled==graphic._isEnabled!==false;if(!graphic.src)graphic._isEnabled=false}}]);return HYBChecklistModel}(ItemsComponentModel);var HYBChecklistModel$1=__AMD("components/adapt-hyb-checklist/js/hyb-checklistModel",HYBChecklistModel);__AMD("components/adapt-hyb-checklist/js/adapt-hyb-checklist",Adapt.register("hyb-checklist",{model:HYBChecklistModel$1,view:HYBChecklistView$1}));var HYBClicklistView=function(_ComponentView){_inherits(HYBClicklistView,_ComponentView);var _super=_createSuper(HYBClicklistView);function HYBClicklistView(){_classCallCheck(this,HYBClicklistView);return _super.apply(this,arguments)}_createClass(HYBClicklistView,[{key:"events",value:function events(){return{"click .js-hyb-clicklist-item-btn":"onItemBtnClick"}}},{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBClicklistView.prototype),"initialize",this).call(this)}},{key:"preRender",value:function preRender(){this.setupModelData();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model.getChildren(),{"change:_isActive":this.onItemActiveChange,"change:_isComplete":this.onItemCompleteChange,"change:_isVisited":this.onItemVisitedChange})}},{key:"onItemBtnClick",value:function onItemBtnClick(event){var itemIdx=$(event.currentTarget).data("adapt-index");this.model.setActiveItem(itemIdx)}},{key:"onItemActiveChange",value:function onItemActiveChange(itemModel,isActive){var $item=this.$getItem(itemModel);$item.toggleClass("is-active",isActive);if(isActive){var _this$model$get;itemModel.toggleVisited(true);itemModel.set("_isComplete",true);(_this$model$get=this.model.get("_hybBackground"))===null||_this$model$get===void 0?void 0:_this$model$get.blur()}}},{key:"onItemVisitedChange",value:function onItemVisitedChange(itemModel,isVisited){var $item=this.$getItem(itemModel);$item.toggleClass("is-visited",isVisited)}},{key:"onItemCompleteChange",value:function onItemCompleteChange(itemModel,isComplete){var $item=this.$getItem(itemModel);$item.toggleClass("is-complete",isComplete).find(".js-hyb-clicklist-item-btn").toggleClass("is-locked",isComplete).toggleClass("is-complete",isComplete)}},{key:"$getItem",value:function $getItem(itemModel){return this.$(".js-hyb-clicklist-item").filter("[data-index=".concat(itemModel.get("_index"),"]"))}},{key:"setupModelData",value:function setupModelData(){}},{key:"postRender",value:function postRender(){var _this=this;this.$el.imageready(function(){_this.setReadyStatus()})}}]);return HYBClicklistView}(ComponentView$1);HYBClicklistView.template="hyb-clicklist";var HYBClicklistView$1=__AMD("components/adapt-hyb-clicklist/js/hyb-clicklistView",HYBClicklistView);var HYBClicklistModel=function(_ItemsComponentModel){_inherits(HYBClicklistModel,_ItemsComponentModel);var _super=_createSuper(HYBClicklistModel);function HYBClicklistModel(){_classCallCheck(this,HYBClicklistModel);return _super.apply(this,arguments)}_createClass(HYBClicklistModel,[{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBClicklistModel.prototype),"initialize",this).call(this)}}]);return HYBClicklistModel}(ItemsComponentModel);var HYBClicklistModel$1=__AMD("components/adapt-hyb-clicklist/js/hyb-clicklistModel",HYBClicklistModel);__AMD("components/adapt-hyb-clicklist/js/adapt-hyb-clicklist",Adapt.register("hyb-clicklist",{model:HYBClicklistModel$1,view:HYBClicklistView$1}));var BUTTON_STATE=ENUM(["SUBMIT","CORRECT","INCORRECT","SHOW_CORRECT_ANSWER","HIDE_CORRECT_ANSWER","SHOW_FEEDBACK","RESET"]);var BUTTON_STATE$1=__AMD("core/js/enums/buttonStateEnum",BUTTON_STATE);var textPropertyName={"SUBMIT":"submit","CORRECT":"correct","INCORRECT":"incorrect","SHOW_CORRECT_ANSWER":"showCorrectAnswer","HIDE_CORRECT_ANSWER":"hideCorrectAnswer","SHOW_FEEDBACK":"showFeedback","RESET":"reset"};var ButtonsView=__AMD("core/js/views/buttonsView",function(_Backbone$View){_inherits(ButtonsView,_Backbone$View);var _super=_createSuper(ButtonsView);function ButtonsView(){_classCallCheck(this,ButtonsView);return _super.apply(this,arguments)}_createClass(ButtonsView,[{key:"initialize",value:function initialize(options){this.parent=options.parent;this.listenTo(Adapt.parentView,"postRemove",this.remove);this.listenTo(this.model,{"change:_buttonState":this.onButtonStateChanged,"change:feedbackMessage":this.onFeedbackMessageChanged,"change:_attemptsLeft":this.onAttemptsChanged,"change:_canSubmit":this.onCanSubmitChange});this.render()}},{key:"events",value:function events(){return{"click .js-btn-action":"onActionClicked","click .js-btn-feedback":"onFeedbackClicked"}}},{key:"render",value:function render(){var _this=this;var data=this.model.toJSON();var template=Handlebars.templates.buttons;_.defer(function(){_this.postRender();Adapt.trigger("buttonsView:postRender",_this)});this.$el.html(template(data))}},{key:"postRender",value:function postRender(){this.refresh()}},{key:"checkResetSubmittedState",value:function checkResetSubmittedState(){var isSubmitted=this.model.get("_isSubmitted");if(isSubmitted){this.$el.addClass("is-submitted");return}this.$(".js-btn-marking").removeClass("is-incorrect is-correct").addClass("u-display-none");this.$el.removeClass("is-submitted");this.model.set("feedbackMessage",undefined);Adapt.a11y.toggleEnabled(this.$(".js-btn-feedback"),false)}},{key:"onActionClicked",value:function onActionClicked(){var buttonState=BUTTON_STATE$1(this.model.get("_buttonState"));this.trigger("buttons:stateUpdate",buttonState);this.checkResetSubmittedState();if(buttonState===BUTTON_STATE$1.SHOW_CORRECT_ANSWER){var _this$model$getCorrec,_this$model;var correctAnswer=(_this$model$getCorrec=(_this$model=this.model).getCorrectAnswerAsText)===null||_this$model$getCorrec===void 0?void 0:_this$model$getCorrec.call(_this$model);this.updateAnswerLiveRegion(correctAnswer)}if(buttonState===BUTTON_STATE$1.HIDE_CORRECT_ANSWER){var _this$model$getUserAn,_this$model2;var userAnswer=(_this$model$getUserAn=(_this$model2=this.model).getUserAnswerAsText)===null||_this$model$getUserAn===void 0?void 0:_this$model$getUserAn.call(_this$model2);this.updateAnswerLiveRegion(userAnswer)}}},{key:"onFeedbackClicked",value:function onFeedbackClicked(){this.trigger("buttons:stateUpdate",BUTTON_STATE$1.SHOW_FEEDBACK)}},{key:"onFeedbackMessageChanged",value:function onFeedbackMessageChanged(model,changedAttribute){if(changedAttribute&&this.model.get("_canShowFeedback")){Adapt.a11y.toggleEnabled(this.$(".js-btn-feedback"),true);return}Adapt.a11y.toggleEnabled(this.$(".js-btn-feedback"),false)}},{key:"onCanSubmitChange",value:function onCanSubmitChange(){this.onButtonStateChanged(this.model,this.model.get("_buttonState"))}},{key:"onButtonStateChanged",value:function onButtonStateChanged(model,changedAttribute){this.updateAttemptsCount();var $buttonsAction=this.$(".js-btn-action");var buttonState=BUTTON_STATE$1(changedAttribute);if(changedAttribute===BUTTON_STATE$1.CORRECT||changedAttribute===BUTTON_STATE$1.INCORRECT){Adapt.a11y.toggleEnabled($buttonsAction,false);return}var propertyName=textPropertyName[buttonState.asString];var ariaLabel=this.model.get("_buttons")["_"+propertyName].ariaLabel;var buttonText=this.model.get("_buttons")["_"+propertyName].buttonText;Adapt.a11y.toggleEnabled($buttonsAction,this.model.get("_canSubmit"));$buttonsAction.html(buttonText).attr("aria-label",ariaLabel)}},{key:"checkFeedbackState",value:function checkFeedbackState(){var canShowFeedback=this.model.get("_canShowFeedback");this.$(".js-btn-action").toggleClass("is-full-width",!canShowFeedback);this.$(".js-btn-feedback").toggleClass("u-display-none",!canShowFeedback);this.$(".js-btn-marking").toggleClass("is-full-width u-display-none",!canShowFeedback)}},{key:"updateAttemptsCount",value:function updateAttemptsCount(){var isInteractionComplete=this.model.get("_isInteractionComplete");var attemptsLeft=this.model.get("_attemptsLeft")?this.model.get("_attemptsLeft"):this.model.get("_attempts");var shouldDisplayAttempts=this.model.get("_shouldDisplayAttempts");var attemptsString;this.checkResetSubmittedState();if(!isInteractionComplete&&attemptsLeft!==0){attemptsString=attemptsLeft+" ";attemptsString+=attemptsLeft===1?this.model.get("_buttons").remainingAttemptText:this.model.get("_buttons").remainingAttemptsText}else{this.$(".js-display-attempts").addClass("u-visibility-hidden");this.showMarking()}if(shouldDisplayAttempts){this.$(".js-insert-attempts-string").html(attemptsString)}}},{key:"updateAnswerLiveRegion",value:function updateAnswerLiveRegion(answer){if(!answer)return;this.$(".js-answer-live-region").html(answer)}},{key:"showMarking",value:function showMarking(){if(!this.model.shouldShowMarking)return;var isCorrect=this.model.get("_isCorrect");var ariaLabels=Adapt.course.get("_globals")._accessibility._ariaLabels;this.$(".js-btn-marking").removeClass("u-display-none").addClass(isCorrect?"is-correct":"is-incorrect").attr("aria-label",isCorrect?ariaLabels.answeredCorrectly:ariaLabels.answeredIncorrectly)}},{key:"refresh",value:function refresh(){this.updateAttemptsCount();this.checkResetSubmittedState();this.checkFeedbackState();this.onButtonStateChanged(null,this.model.get("_buttonState"));this.onFeedbackMessageChanged(null,this.model.get("feedbackMessage"))}}]);return ButtonsView}(Backbone.View));var QuestionModel=function(_ComponentModel){_inherits(QuestionModel,_ComponentModel);var _super=_createSuper(QuestionModel);function QuestionModel(){_classCallCheck(this,QuestionModel);return _super.apply(this,arguments)}_createClass(QuestionModel,[{key:"defaults",value:function defaults(){return ComponentModel$3.resultExtend("defaults",{_isQuestionType:true,_shouldDisplayAttempts:false,_canShowModelAnswer:true,_canShowFeedback:true,_canShowMarking:true,_canSubmit:true,_isSubmitted:false,_questionWeight:Adapt.config.get("_questionWeight"),_items:[]})}},{key:"trackable",value:function trackable(){return ComponentModel$3.resultExtend("trackable",["_isSubmitted","_score","_isCorrect","_attemptsLeft"])}},{key:"trackableType",value:function trackableType(){return ComponentModel$3.resultExtend("trackableType",[Boolean,Number,Boolean,Number])}},{key:"getTypeGroup",value:function getTypeGroup(){return"question"}},{key:"init",value:function init(){this.setupDefaultSettings();this.setLocking("_canSubmit",true);_get(_getPrototypeOf(QuestionModel.prototype),"init",this).call(this)}},{key:"setupDefaultSettings",value:function setupDefaultSettings(){this.setupWeightSettings();this.setupButtonSettings()}},{key:"setupButtonSettings",value:function setupButtonSettings(){var globalButtons=Adapt.course.get("_buttons");if(!this.has("_buttons")){this.set("_buttons",globalButtons)}else{var componentButtons=this.get("_buttons");for(var key in componentButtons){if(_typeof(componentButtons[key])==="object"){if(!componentButtons[key].buttonText&&globalButtons[key].buttonText){componentButtons[key].buttonText=globalButtons[key].buttonText}if(!componentButtons[key].ariaLabel&&globalButtons[key].ariaLabel){componentButtons[key].ariaLabel=globalButtons[key].ariaLabel}}if(!componentButtons[key]&&globalButtons[key]){componentButtons[key]=globalButtons[key]}}}}},{key:"setupWeightSettings",value:function setupWeightSettings(){}},{key:"canSubmit",value:function canSubmit(){}},{key:"checkCanSubmit",value:function checkCanSubmit(){this.set("_canSubmit",this.canSubmit(),{pluginName:"adapt"})}},{key:"updateAttempts",value:function updateAttempts(){if(!this.get("_attemptsLeft")){this.set("_attemptsLeft",this.get("_attempts"))}this.set("_attemptsLeft",this.get("_attemptsLeft")-1)}},{key:"setQuestionAsSubmitted",value:function setQuestionAsSubmitted(){this.set({_isEnabled:false,_isSubmitted:true})}},{key:"markQuestion",value:function markQuestion(){if(this.isCorrect()){this.set("_isCorrect",true)}else{this.set("_isCorrect",false)}}},{key:"isCorrect",value:function isCorrect(){}},{key:"setScore",value:function setScore(){}},{key:"checkQuestionCompletion",value:function checkQuestionCompletion(){var isComplete=this.get("_isCorrect")||this.get("_attemptsLeft")===0;if(isComplete){this.setCompletionStatus()}return isComplete}},{key:"updateButtons",value:function updateButtons(){var isInteractionComplete=this.get("_isInteractionComplete");var isCorrect=this.get("_isCorrect");var isEnabled=this.get("_isEnabled");var buttonState=this.get("_buttonState");var canShowModelAnswer=this.get("_canShowModelAnswer");if(isInteractionComplete){if(isCorrect||!canShowModelAnswer){this.set("_buttonState",BUTTON_STATE$1.CORRECT)}else{switch(buttonState){case BUTTON_STATE$1.SUBMIT:case BUTTON_STATE$1.HIDE_CORRECT_ANSWER:this.set("_buttonState",BUTTON_STATE$1.SHOW_CORRECT_ANSWER);break;default:this.set("_buttonState",BUTTON_STATE$1.HIDE_CORRECT_ANSWER);}}}else{if(isEnabled){this.set("_buttonState",BUTTON_STATE$1.SUBMIT)}else{this.set("_buttonState",BUTTON_STATE$1.RESET)}}}},{key:"setupFeedback",value:function setupFeedback(){if(!this.has("_feedback"))return;if(this.get("_isCorrect")){this.setupCorrectFeedback()}else if(this.isPartlyCorrect()){this.setupPartlyCorrectFeedback()}else{this.setupIncorrectFeedback()}}},{key:"isPartlyCorrect",value:function isPartlyCorrect(){}},{key:"setupCorrectFeedback",value:function setupCorrectFeedback(){this.set({feedbackTitle:this.getFeedbackTitle(),feedbackMessage:this.get("_feedback").correct})}},{key:"setupPartlyCorrectFeedback",value:function setupPartlyCorrectFeedback(){var feedback=this.get("_feedback")._partlyCorrect;if(feedback!==null&&feedback!==void 0&&feedback.final){this.setAttemptSpecificFeedback(feedback)}else{this.setupIncorrectFeedback()}}},{key:"setupIncorrectFeedback",value:function setupIncorrectFeedback(){this.setAttemptSpecificFeedback(this.get("_feedback")._incorrect)}},{key:"setAttemptSpecificFeedback",value:function setAttemptSpecificFeedback(feedback){var body=this.get("_attemptsLeft")&&feedback.notFinal||feedback.final;this.set({feedbackTitle:this.getFeedbackTitle(),feedbackMessage:body})}},{key:"getFeedbackTitle",value:function getFeedbackTitle(){return this.get("_feedback").title||this.get("displayTitle")||this.get("title")||""}},{key:"isInteractive",value:function isInteractive(){return!this.get("_isComplete")||this.get("_isEnabled")&&!this.get("_isSubmitted")}},{key:"reset",value:function reset(type,force){if(!this.get("_canReset")&&!force)return;type=type||true;_get(_getPrototypeOf(QuestionModel.prototype),"reset",this).call(this,type,force);var attempts=this.get("_attempts");this.set({_attemptsLeft:attempts,_isCorrect:undefined,_isSubmitted:false,_buttonState:BUTTON_STATE$1.SUBMIT})}},{key:"setQuestionAsReset",value:function setQuestionAsReset(){this.set({_isEnabled:true,_isSubmitted:false})}},{key:"refresh",value:function refresh(){this.trigger("question:refresh")}},{key:"getButtonState",value:function getButtonState(){if(this.get("_isCorrect")){return BUTTON_STATE$1.CORRECT}if(this.get("_attemptsLeft")===0){return this.get("_canShowModelAnswer")?BUTTON_STATE$1.SHOW_CORRECT_ANSWER:BUTTON_STATE$1.INCORRECT}return this.get("_isSubmitted")?BUTTON_STATE$1.RESET:BUTTON_STATE$1.SUBMIT}},{key:"getInteractionObject",value:function getInteractionObject(){return{}}},{key:"getResponse",value:function getResponse(){}},{key:"getResponseType",value:function getResponseType(){}},{key:"onSubmitted",value:function onSubmitted(){this.addAttemptObject()}},{key:"shouldShowMarking",get:function(){if(!this.get("_canShowMarking")){return false}return this.get("_isInteractionComplete")}}]);return QuestionModel}(ComponentModel$3);Adapt.register("question",{model:QuestionModel});var QuestionModel$1=__AMD("core/js/models/questionModel",QuestionModel);var QuestionView=function(_ComponentView){_inherits(QuestionView,_ComponentView);var _super=_createSuper(QuestionView);function QuestionView(){_classCallCheck(this,QuestionView);return _super.apply(this,arguments)}_createClass(QuestionView,[{key:"className",value:function className(){return["component","is-question",this.model.get("_component").toLowerCase(),this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),"is-"+this.model.get("_layout"),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":"",this.model.get("_canShowModelAnswer")?"can-show-model-answer":"",this.model.get("_canShowFeedback")?"can-show-feedback":"",this.model.get("_canShowMarking")?"can-show-marking":""].join(" ")}},{key:"initialize",value:function initialize(){var _get2;this.isInteractive=this.isInteractive.bind(this);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}(_get2=_get(_getPrototypeOf(QuestionView.prototype),"initialize",this)).call.apply(_get2,[this].concat(args))}},{key:"isInteractive",value:function isInteractive(){return this.model.isInteractive()}},{key:"preRender",value:function preRender(){this.listenTo(this.model,"change:_isEnabled",this.onEnabledChanged);this.listenTo(this.model,"question:refresh",this.refresh);this.checkIfResetOnRevisit();this._runModelCompatibleFunction("setupDefaultSettings");this.setupQuestion()}},{key:"onEnabledChanged",value:function onEnabledChanged(model,changedAttribute){if(!changedAttribute){this.$(".component__widget").addClass("is-disabled");this.disableQuestion()}else{this.$(".component__widget").removeClass("is-disabled");this.enableQuestion()}}},{key:"disableQuestion",value:function disableQuestion(){}},{key:"enableQuestion",value:function enableQuestion(){}},{key:"checkIfResetOnRevisit",value:function checkIfResetOnRevisit(){var _this=this;var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit,true);_.defer(function(){_this.resetQuestionOnRevisit(isResetOnRevisit)});return}var isInteractionComplete=this.model.get("_isInteractionComplete");if(isInteractionComplete){this.model.set("_buttonState",BUTTON_STATE$1.HIDE_CORRECT_ANSWER);_.defer(function(){_this.onHideCorrectAnswerClicked()});return}this.model.set("_buttonState",BUTTON_STATE$1.SUBMIT);_.defer(function(){_this.onResetClicked()})}},{key:"resetQuestionOnRevisit",value:function resetQuestionOnRevisit(type){}},{key:"setupQuestion",value:function setupQuestion(){}},{key:"postRender",value:function postRender(){this.addButtonsView();this.onQuestionRendered()}},{key:"addButtonsView",value:function addButtonsView(){this.buttonsView=new ButtonsView({model:this.model,el:this.$(".btn__container")});this.listenTo(this.buttonsView,"buttons:stateUpdate",this.onButtonStateUpdate)}},{key:"onButtonStateUpdate",value:function onButtonStateUpdate(buttonState){switch(buttonState){case BUTTON_STATE$1.SUBMIT:this.onSubmitClicked();break;case BUTTON_STATE$1.RESET:this.onResetClicked();break;case BUTTON_STATE$1.SHOW_CORRECT_ANSWER:this.onShowCorrectAnswerClicked();break;case BUTTON_STATE$1.HIDE_CORRECT_ANSWER:this.onHideCorrectAnswerClicked();break;case BUTTON_STATE$1.SHOW_FEEDBACK:this.showFeedback();break;}}},{key:"onQuestionRendered",value:function onQuestionRendered(){}},{key:"onSubmitClicked",value:function onSubmitClicked(){var canSubmit=this._runModelCompatibleFunction("canSubmit");if(!canSubmit){this.showInstructionError();this.onCannotSubmit();return}this._runModelCompatibleFunction("updateAttempts");this._runModelCompatibleFunction("setQuestionAsSubmitted");this.removeInstructionError();this._runModelCompatibleFunction("storeUserAnswer");this._runModelCompatibleFunction("markQuestion","isCorrect");this._runModelCompatibleFunction("setScore");this._runModelCompatibleFunction("checkQuestionCompletion");if(this.model.shouldShowMarking){this.showMarking()}this.recordInteraction();this._runModelCompatibleFunction("setupFeedback");this.showFeedback();$(window).resize();this._runModelCompatibleFunction("updateButtons");this.model.onSubmitted();this.onSubmitted()}},{key:"showInstructionError",value:function showInstructionError(){Adapt.trigger("questionView:showInstructionError",this)}},{key:"onCannotSubmit",value:function onCannotSubmit(){}},{key:"onSubmitted",value:function onSubmitted(){}},{key:"setQuestionAsSubmitted",value:function setQuestionAsSubmitted(){this.model.setQuestionAsSubmitted();this.$(".component__widget").addClass("is-submitted")}},{key:"removeInstructionError",value:function removeInstructionError(){this.$(".component__instruction-inner").removeClass("validation-error")}},{key:"showMarking",value:function showMarking(){}},{key:"checkQuestionCompletion",value:function checkQuestionCompletion(){var isComplete=this.model.checkQuestionCompletion();if(isComplete){this.$(".component__widget").addClass("is-complete show-user-answer")}}},{key:"recordInteraction",value:function recordInteraction(){if(this.model.get("_recordInteraction")===true||!this.model.has("_recordInteraction")){Adapt.trigger("questionView:recordInteraction",this)}}},{key:"showFeedback",value:function showFeedback(){if(this.model.get("_canShowFeedback")){Adapt.trigger("questionView:showFeedback",this)}else{Adapt.trigger("questionView:disabledFeedback",this)}}},{key:"onResetClicked",value:function onResetClicked(){this.setQuestionAsReset();this._runModelCompatibleFunction("resetUserAnswer");this.resetQuestion();this.model.checkCanSubmit();this._runModelCompatibleFunction("updateButtons");if(!this.model.get("_isReady"))return;var currentModel=Adapt.findById(Adapt.location._currentId);if(!(currentModel!==null&&currentModel!==void 0&&currentModel.get("_isReady")))return;Adapt.a11y.focusNext(this.$el)}},{key:"setQuestionAsReset",value:function setQuestionAsReset(){this.model.setQuestionAsReset();this.$(".component__widget").removeClass("is-submitted")}},{key:"resetQuestion",value:function resetQuestion(){}},{key:"refresh",value:function refresh(){this.model.set("_buttonState",this.model.getButtonState());if(this.model.shouldShowMarking&&this.model.get("_isSubmitted")){this.showMarking()}if(this.buttonsView){_.defer(this.buttonsView.refresh.bind(this.buttonsView))}}},{key:"onShowCorrectAnswerClicked",value:function onShowCorrectAnswerClicked(){this.setQuestionAsShowCorrect();this._runModelCompatibleFunction("updateButtons");this.showCorrectAnswer()}},{key:"setQuestionAsShowCorrect",value:function setQuestionAsShowCorrect(){this.$(".component__widget").addClass("is-submitted show-correct-answer").removeClass("show-user-answer")}},{key:"showCorrectAnswer",value:function showCorrectAnswer(){}},{key:"onHideCorrectAnswerClicked",value:function onHideCorrectAnswerClicked(){this.setQuestionAsHideCorrect();this._runModelCompatibleFunction("updateButtons");this.hideCorrectAnswer()}},{key:"setQuestionAsHideCorrect",value:function setQuestionAsHideCorrect(){this.$(".component__widget").addClass("is-submitted show-user-answer").removeClass("show-correct-answer")}},{key:"hideCorrectAnswer",value:function hideCorrectAnswer(){}},{key:"getLatency",value:function getLatency(){return null}},{key:"_runModelCompatibleFunction",value:function _runModelCompatibleFunction(name,lookForViewOnlyFunction){return this.model[name]()}}]);return QuestionView}(ComponentView$1);QuestionView._isQuestionType=true;var ViewOnlyQuestionViewCompatibilityLayer=function(_QuestionView){_inherits(ViewOnlyQuestionViewCompatibilityLayer,_QuestionView);var _super2=_createSuper(ViewOnlyQuestionViewCompatibilityLayer);function ViewOnlyQuestionViewCompatibilityLayer(){_classCallCheck(this,ViewOnlyQuestionViewCompatibilityLayer);return _super2.apply(this,arguments)}_createClass(ViewOnlyQuestionViewCompatibilityLayer,[{key:"getInteractionObject",value:function getInteractionObject(){Adapt.log.deprecated("QuestionView.getInteractionObject, please use QuestionModel.getInteractionObject");return this.model.getInteractionObject()}},{key:"getResponse",value:function getResponse(){Adapt.log.deprecated("QuestionView.getInteractionObject, please use QuestionModel.getInteractionObject");return this.model.getResponse()}},{key:"getResponseType",value:function getResponseType(){Adapt.log.deprecated("QuestionView.getResponseType, please use QuestionModel.getResponseType");return this.model.getResponseType()}},{key:"setupDefaultSettings",value:function setupDefaultSettings(){Adapt.log.deprecated("QuestionView.setupDefaultSettings, please use QuestionModel.setupDefaultSettings");return this.model.setupDefaultSettings()}},{key:"setupButtonSettings",value:function setupButtonSettings(){Adapt.log.deprecated("QuestionView.setupButtonSettings, please use QuestionModel.setupButtonSettings");return this.model.setupButtonSettings()}},{key:"setupWeightSettings",value:function setupWeightSettings(){Adapt.log.deprecated("QuestionView.setupWeightSettings, please use QuestionModel.setupWeightSettings");return this.model.setupWeightSettings()}},{key:"canSubmit",value:function canSubmit(){Adapt.log.deprecated("QuestionView.canSubmit, please use QuestionModel.canSubmit");return this.model.canSubmit()}},{key:"updateAttempts",value:function updateAttempts(){Adapt.log.deprecated("QuestionView.updateAttempts, please use QuestionModel.updateAttempts");return this.model.updateAttempts()}},{key:"storeUserAnswer",value:function storeUserAnswer(){Adapt.log.deprecated("QuestionView.storeUserAnswer, please use QuestionModel.storeUserAnswer");return this.model.storeUserAnswer()}},{key:"resetUserAnswer",value:function resetUserAnswer(){Adapt.log.deprecated("QuestionView.resetUserAnswer, please use QuestionModel.resetUserAnswer");return this.model.resetUserAnswer()}},{key:"markQuestion",value:function markQuestion(){if(this._isInViewOnlyCompatibleMode("isCorrect")){if(this.isCorrect()){this.model.set("_isCorrect",true)}else{this.model.set("_isCorrect",false)}}else{return this.model.markQuestion()}}},{key:"isCorrect",value:function isCorrect(){Adapt.log.deprecated("QuestionView.isCorrect, please use QuestionModel.isCorrect");return this.model.isCorrect()}},{key:"setScore",value:function setScore(){Adapt.log.deprecated("QuestionView.setScore, please use QuestionModel.setScore");return this.model.setScore()}},{key:"updateButtons",value:function updateButtons(){Adapt.log.deprecated("QuestionView.updateButtons, please use QuestionModel.updateButtons");return this.model.updateButtons()}},{key:"setupFeedback",value:function setupFeedback(){if(this._isInViewOnlyCompatibleMode("isPartlyCorrect")){if(this.model.get("_isCorrect")){this._runModelCompatibleFunction("setupCorrectFeedback")}else if(this.isPartlyCorrect()){this._runModelCompatibleFunction("setupPartlyCorrectFeedback")}else{this._runModelCompatibleFunction("setupIncorrectFeedback")}}else{this.model.setupFeedback()}}},{key:"isPartlyCorrect",value:function isPartlyCorrect(){Adapt.log.deprecated("QuestionView.isPartlyCorrect, please use QuestionModel.isPartlyCorrect");return this.model.isPartlyCorrect()}},{key:"setupCorrectFeedback",value:function setupCorrectFeedback(){Adapt.log.deprecated("QuestionView.setupCorrectFeedback, please use QuestionModel.setupCorrectFeedback");return this.model.setupCorrectFeedback()}},{key:"setupPartlyCorrectFeedback",value:function setupPartlyCorrectFeedback(){Adapt.log.deprecated("QuestionView.setupPartlyCorrectFeedback, please use QuestionModel.setupPartlyCorrectFeedback");return this.model.setupPartlyCorrectFeedback()}},{key:"setupIncorrectFeedback",value:function setupIncorrectFeedback(){Adapt.log.deprecated("QuestionView.setupIncorrectFeedback, please use QuestionModel.setupIncorrectFeedback");return this.model.setupIncorrectFeedback()}},{key:"_runModelCompatibleFunction",value:function _runModelCompatibleFunction(name,lookForViewOnlyFunction){if(this._isInViewOnlyCompatibleMode(name,lookForViewOnlyFunction)){return this[name]()}else{return this.model[name]()}}},{key:"_isInViewOnlyCompatibleMode",value:function _isInViewOnlyCompatibleMode(name,lookForViewOnlyFunction){var checkForFunction=lookForViewOnlyFunction||name;if(!this.constructor.prototype[checkForFunction])return false;var hasCompatibleVersion=ViewOnlyQuestionViewCompatibilityLayer.prototype.hasOwnProperty(checkForFunction);var usingCompatibleVersion=this.constructor.prototype[checkForFunction]===ViewOnlyQuestionViewCompatibilityLayer.prototype[checkForFunction];if(hasCompatibleVersion&&usingCompatibleVersion){switch(checkForFunction){case"setupFeedback":case"markQuestion":return true;}return false}return true}}]);return ViewOnlyQuestionViewCompatibilityLayer}(QuestionView);var QuestionView$1=__AMD("core/js/views/questionView",ViewOnlyQuestionViewCompatibilityLayer);var HYBConnectView=function(_QuestionView){_inherits(HYBConnectView,_QuestionView);var _super=_createSuper(HYBConnectView);function HYBConnectView(){_classCallCheck(this,HYBConnectView);return _super.apply(this,arguments)}_createClass(HYBConnectView,[{key:"events",value:function events(){return{}}},{key:"preRender",value:function preRender(){_get(_getPrototypeOf(HYBConnectView.prototype),"preRender",this).call(this);this.setupModelData();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model.getChildren(),{"change:_isGrabbed":this.onItemGrabbedChange,"change:_drop":this.onItemDropChange});this.listenTo(this.model,{"change:_itemSizing":this.onItemSizingChange})}},{key:"setupModelData",value:function setupModelData(){}},{key:"onItemSizingChange",value:function onItemSizingChange(model,itemSizing){this.$(".js-hyb-connect-drags").css("width",itemSizing._width+"%");this.$(".js-hyb-connect-drops").css("width",100-itemSizing._width+"%")}},{key:"onItemGrabbedChange",value:function onItemGrabbedChange(itemModel,isGrabbed){var _this=this;this.getItemElement(itemModel).toggleClass("is-grabbed",isGrabbed);if(!isGrabbed){this.$(".js-hyb-connect-option").toggleClass("is-correct",false).toggleClass("is-incorrect",false);return}var optionsVisited=itemModel.get("_optionsVisited");_.each(optionsVisited,function(optionIdx){var isCorrect=itemModel.get("_optionsCorrect").indexOf(optionIdx)>=0;var $drop=_this.$(".js-hyb-connect-option").filter("[data-adapt-index=".concat(optionIdx,"]"));$drop.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect)})}},{key:"onItemDropChange",value:function onItemDropChange(itemModel,dropModel){this.getItemElement(itemModel).toggleClass("is-dropped",Boolean(dropModel));if(!dropModel){this.getItemElement(itemModel).toggleClass("is-correct",false).toggleClass("is-incorrect",false);return}var dropModelIdx=dropModel.get("_index");var optionsVisited=itemModel.get("_optionsVisited");if(optionsVisited.indexOf(dropModelIdx)>=0){var isCorrect=itemModel.get("_optionsCorrect").indexOf(dropModelIdx)>=0;this.getItemElement(itemModel).toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect)}}},{key:"postRender",value:function postRender(){var _this2=this,_this$model$get;_get(_getPrototypeOf(HYBConnectView.prototype),"postRender",this).call(this);Adapt.hyb.dragDrop({_drags:this.model.getChildren(),_drops:this.model.get("_options"),$getDrag:function(itemModel){return _this2.$(".js-hyb-connect-drag").filter("[data-adapt-index=\"".concat(itemModel.get("_index"),"\"]"))},$getDrop:function(optionModel){return _this2.$(".js-hyb-connect-drop").filter("[data-adapt-index=\"".concat(optionModel.get("_index"),"\"]"))},onDrag:this.onDrag.bind(this),onStop:this.onStop.bind(this)});this.$el.imageready(function(){_this2.setReadyStatus()});if((_this$model$get=this.model.get("_itemSizing"))!==null&&_this$model$get!==void 0&&_this$model$get._width){var debugWindow=Adapt.hyb.debug.initDebugWindow(this.model.getParent(),"_itemSizing._width");debugWindow.track(this.model,"_itemSizing._width","_width(%)")}}},{key:"getItemElement",value:function getItemElement(itemModel){return this.$(".js-hyb-connect-item").filter("[data-adapt-index="+itemModel.get("_index")+"]")}},{key:"onDrag",value:function onDrag(itemModel,$drag){this.updateTail(itemModel,$drag)}},{key:"onStop",value:function onStop(itemModel,$drag){this.updateTail(itemModel,$drag)}},{key:"updateTail",value:function updateTail(itemModel,$drag){var $dragTail=$drag.parent().find(".js-hyb-connect-drag-tail");var x=parseFloat($drag[0].style.left,10);var y=parseFloat($drag[0].style.top,10);var length=Math.sqrt(Math.pow(x,2)+Math.pow(y,2));var angle=Math.atan2(y,x)*180/Math.PI;$dragTail.css({width:length+"px"});if(x||y){var transform="rotate("+angle+"deg)";$dragTail.css({transform:transform})}}},{key:"onQuestionRendered",value:function onQuestionRendered(){this.update()}},{key:"onCannotSubmit",value:function onCannotSubmit(){}},{key:"showMarking",value:function showMarking(){this.update();this.updateMarking()}},{key:"resetQuestion",value:function resetQuestion(){}},{key:"showCorrectAnswer",value:function showCorrectAnswer(){this.isCorrectAnswerShown=true;this.update()}},{key:"hideCorrectAnswer",value:function hideCorrectAnswer(){this.isCorrectAnswerShown=false;this.update()}},{key:"update",value:function update(model){}},{key:"updateSelection",value:function updateSelection(){}},{key:"updateMarking",value:function updateMarking(){var _this3=this;this.model.getChildren().each(function(itemModel){var $item=_this3.getItemElement(itemModel);var isCorrect=Boolean(itemModel.get("_isCorrect"));if(!isCorrect){_.delay(function(){itemModel.dragRevert()},0);return}$item.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect);itemModel.dragLock()})}}]);return HYBConnectView}(QuestionView$1);HYBConnectView.template="hyb-connect";var HYBConnectView$1=__AMD("components/adapt-hyb-connect/js/hyb-connectView",HYBConnectView);var HYBConnectModel$1=function(_QuestionModel){_inherits(HYBConnectModel,_QuestionModel);var _super=_createSuper(HYBConnectModel);function HYBConnectModel(){_classCallCheck(this,HYBConnectModel);return _super.apply(this,arguments)}_createClass(HYBConnectModel,[{key:"init",value:function init(){_get(_getPrototypeOf(HYBConnectModel.prototype),"init",this).call(this);this.setupItems.apply(this,arguments);this.setupEventListeners();this.checkCanSubmit()}},{key:"toJSON",value:function toJSON(){var json=_get(_getPrototypeOf(HYBConnectModel.prototype),"toJSON",this).call(this);json._options=json._options.toJSON();return json}},{key:"setupItems",value:function setupItems(){var _this=this;var items=this.get("_items");var options=this.get("_options");var optionsLength=options.length;_.each(items,function(item,index){item._index=index;item._optionsVisited=[];_.each(item._optionsCorrect,function(correctIdx){if(correctIdx>=optionsLength)throw"hyb-connect: In ".concat(_this.get("_id"),", an \"_optionsCorrect\" index is greater than the max index of \"_options\" in the component (you have ").concat(optionsLength," \"_options\", and the index is ").concat(correctIdx,").")})});this.setChildren(new Backbone.Collection(items,{model:Backbone.Model}));_.each(options,function(option,index){option._index=index});this.set("_options",new Backbone.Collection(options,{model:Backbone.Model}));this.setupRandomisation()}},{key:"setupRandomisation",value:function setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;this.set("_items",_.shuffle(this.get("_items")))}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.getChildren(),{"change:_drop":this.checkCanSubmit.bind(this)})}},{key:"isCorrect",value:function isCorrect(){var props={_numberOfIncorrectAnswers:0,_numberOfCorrectAnswers:0,_isAtLeastOneIncorrectSelection:false};this.getChildren().each(function(itemModel){var _itemModel$get;var dropIdx=(_itemModel$get=itemModel.get("_drop"))===null||_itemModel$get===void 0?void 0:_itemModel$get.get("_index");var optionsCorrect=itemModel.get("_optionsCorrect");var isItemCorrect=optionsCorrect.indexOf(dropIdx)!==-1;itemModel.set("_isCorrect",isItemCorrect);itemModel.set("_isIncorrect",!isItemCorrect);itemModel.set("_isDisabled",isItemCorrect);var optionsVisited=itemModel.get("_optionsVisited");optionsVisited.push(dropIdx);itemModel.set("_optionsVisited",_.unique(optionsVisited));if(!isItemCorrect){props._numberOfIncorrectAnswers++;props._isAtLeastOneIncorrectSelection=true;return}props._numberOfCorrectAnswers++});this.set(props);var hasRightNumberOfCorrectAnswers=props._numberOfCorrectAnswers===this.getChildren().length;var hasNoIncorrectAnswers=!props._isAtLeastOneIncorrectSelection;return hasRightNumberOfCorrectAnswers&&hasNoIncorrectAnswers}},{key:"canSubmit",value:function canSubmit(){var incompleteItem=this.getChildren().find(function(itemModel){return!Boolean(itemModel.get("_drop"))});return!Boolean(incompleteItem)}},{key:"storeUserAnswer",value:function storeUserAnswer(){var items=this.getChildren();var userAnswer=new Array(items.length);var tempUserAnswer=new Array(items.length);items.forEach(function(itemModel){var _itemModel$get2;var optionIndex=((_itemModel$get2=itemModel.get("_drop"))===null||_itemModel$get2===void 0?void 0:_itemModel$get2.get("_index"))||0;tempUserAnswer[itemModel.get("_index")]=optionIndex;userAnswer[itemModel.get("_index")]=optionIndex},this);this.set({_userAnswer:userAnswer,_tempUserAnswer:tempUserAnswer})}},{key:"getResponse",value:function getResponse(){var responses=[];this.get("_userAnswer").forEach(function(userAnswer,index){responses.push(index+1+"."+(userAnswer+1))});return responses.join("#")}},{key:"getResponseType",value:function getResponseType(){return"matching"}}]);return HYBConnectModel}(QuestionModel$1);var HYBConnectModel$2=__AMD("components/adapt-hyb-connect/js/hyb-connectModel",HYBConnectModel$1);__AMD("components/adapt-hyb-connect/js/adapt-hyb-connect",Adapt.register("hyb-connect",{model:HYBConnectModel$2,view:HYBConnectView$1}));var HYBDragLabelView=function(_QuestionView){_inherits(HYBDragLabelView,_QuestionView);var _super=_createSuper(HYBDragLabelView);function HYBDragLabelView(){_classCallCheck(this,HYBDragLabelView);return _super.apply(this,arguments)}_createClass(HYBDragLabelView,[{key:"events",value:function events(){return{}}},{key:"preRender",value:function preRender(){_get(_getPrototypeOf(HYBDragLabelView.prototype),"preRender",this).call(this);this.setupModelData();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model.getChildren(),{"change:_isGrabbed":this.onItemGrabbedChange,"change:_drop":this.onItemDropChange});this.listenTo(this.model.get("_options"),{"change:_drags":this.onOptionDragsChange})}},{key:"setupModelData",value:function setupModelData(){}},{key:"onItemGrabbedChange",value:function onItemGrabbedChange(itemModel,isGrabbed){var _this=this;this.getItemElement(itemModel).toggleClass("is-grabbed",isGrabbed);if(!isGrabbed){this.$(".js-hyb-draglabel-option").toggleClass("is-correct",false).toggleClass("is-incorrect",false);return}var optionsVisited=itemModel.get("_optionsVisited");_.each(optionsVisited,function(optionIdx){var isCorrect=itemModel.get("_optionsCorrect").indexOf(optionIdx)>=0;var $drop=_this.$(".js-hyb-draglabel-option").filter("[data-index=".concat(optionIdx,"]"));$drop.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect)})}},{key:"onItemDropChange",value:function onItemDropChange(itemModel,dropModel){this.getItemElement(itemModel).toggleClass("is-dropped",Boolean(dropModel));if(!dropModel){this.getItemElement(itemModel).toggleClass("is-correct",false).toggleClass("is-incorrect",false);return}var dropModelIdx=dropModel.get("_index");var optionsVisited=itemModel.get("_optionsVisited");if(optionsVisited.indexOf(dropModelIdx)>=0){var isCorrect=itemModel.get("_optionsCorrect").indexOf(dropModelIdx)>=0;this.getItemElement(itemModel).toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect)}}},{key:"_isGraphicDrags",value:function _isGraphicDrags(){return Boolean(this.model.getChildren().find(function(itemModel){var _itemModel$get;return(_itemModel$get=itemModel.get("_graphic"))===null||_itemModel$get===void 0?void 0:_itemModel$get.src}))}},{key:"postRender",value:function postRender(){var _this2=this;_get(_getPrototypeOf(HYBDragLabelView.prototype),"postRender",this).call(this);Adapt.hyb.dragDrop({_drags:this.model.getChildren(),_drops:this.model.get("_options"),_isGraphic:this._isGraphicDrags(),$getDrag:function(itemModel){return _this2.getDragElement(itemModel)},$getDrop:function(optionModel){return _this2.getDropElement(optionModel)},onDrag:this.onDrag.bind(this),onStop:this.onStop.bind(this)});this.$el.imageready(function(){_this2.updateDragDropSize();_this2.setupOptionSizing();_this2.setReadyStatus()});if(!Adapt.isDebugEnabled())return;var options=this.model.getOptions();var debugWindow=Adapt.hyb.debug.initDebugWindow(this.model.getParent(),"_item._graphic._sizing._width");debugWindow.trackCollection(options,"_graphic._sizing._width","_item[*]._graphic._sizing._width(%)");this.listenTo(options,{"change:_graphic":function(optionModel){var _optionModel$get,_optionModel$get$_siz;var $option=_this2.getOptionElement(optionModel);var $graphic=$option.find(".js-hyb-draglabel-option-graphic");$graphic.css("width",(((_optionModel$get=optionModel.get("_graphic"))===null||_optionModel$get===void 0?void 0:(_optionModel$get$_siz=_optionModel$get._sizing)===null||_optionModel$get$_siz===void 0?void 0:_optionModel$get$_siz._width)||100)+"%")}})}},{key:"setupOptionSizing",value:function setupOptionSizing(){var _options$_base;var options=this.model.get("_optionSizing");if(!Boolean(options===null||options===void 0?void 0:(_options$_base=options._base)===null||_options$_base===void 0?void 0:_options$_base._width)){return}try{options._parent=this.model;options._itemSizings=[];this.model.get("_options").each(function(optionModel){var _optionModel$get2;return options._itemSizings[optionModel.get("_index")]=(_optionModel$get2=optionModel.get("_graphic"))===null||_optionModel$get2===void 0?void 0:_optionModel$get2._sizing});var sizingGrid=Adapt.hyb.initSizingGrid(this.$(".js-hyb-draglabel-drops"),options);sizingGrid.onReady(function(){}).onUpdate(function(){})}catch(err){Adapt.log.error("hyb-dragLabelView.js: Could not set up sizingGrid for options (try setting '_optionSizing._base._width' to 0).",err)}}},{key:"updateDragDropSize",value:function updateDragDropSize(){var _this3=this;var $drags=this.$(".js-hyb-draglabel-drag");var width=0;var height=0;$drags.each(function(i,e){width=Math.max($(e).outerWidth(),width);height=Math.max($(e).outerHeight(),height)});$drags.outerWidth(width).outerHeight(height);var options=this.model.get("_options");options.each(function(option){var $option=_this3.getOptionElement(option);var $drop=_this3.getDropElement(option);$option.outerWidth(width);$drop.outerWidth(width).outerHeight(height*option.get("_capacity"))});var $optionText=this.$(".js-hyb-draglabel-option-text");if($optionText.length){_.delay(function(){var optionTextHeight=0;$optionText.each(function(i,e){optionTextHeight=Math.max(optionTextHeight,$(e).outerHeight())});$optionText.css({"height":optionTextHeight})},0)}}},{key:"getItemElement",value:function getItemElement(itemModel){return this.$(".js-hyb-draglabel-item").filter("[data-adapt-index="+itemModel.get("_index")+"]")}},{key:"getDragElement",value:function getDragElement(itemModel){return this.$(".js-hyb-draglabel-drag").filter("[data-adapt-index="+itemModel.get("_index")+"]")}},{key:"getOptionElement",value:function getOptionElement(optionModel){return this.$(".js-hyb-draglabel-option").filter("[data-adapt-index="+optionModel.get("_index")+"]")}},{key:"getDropElement",value:function getDropElement(optionModel){return this.$(".js-hyb-draglabel-drop").filter("[data-adapt-index="+optionModel.get("_index")+"]")}},{key:"onDrag",value:function onDrag(itemModel,$drag){}},{key:"onStop",value:function onStop(itemModel,$drag){}},{key:"onOptionDragsChange",value:function onOptionDragsChange(optionModel,drags){var _this4=this;if(optionModel.get("_capacity")<=1)return;var optionTop=this.getDropElement(optionModel).offset().top;_.each(drags,function(drag,idx){var $drag=_this4.getDragElement(drag);var height=$drag.outerHeight();_.delay(function(){if(!drag.get("_drop"))return;$drag.offset({top:optionTop+height*idx})},0)})}},{key:"onQuestionRendered",value:function onQuestionRendered(){this.update()}},{key:"onCannotSubmit",value:function onCannotSubmit(){}},{key:"showMarking",value:function showMarking(){this.update();this.updateMarking()}},{key:"resetQuestion",value:function resetQuestion(){}},{key:"showCorrectAnswer",value:function showCorrectAnswer(){this.isCorrectAnswerShown=true;this.update()}},{key:"hideCorrectAnswer",value:function hideCorrectAnswer(){this.isCorrectAnswerShown=false;this.update()}},{key:"update",value:function update(model){}},{key:"updateSelection",value:function updateSelection(){}},{key:"updateMarking",value:function updateMarking(){var _this5=this;this.model.getChildren().each(function(itemModel){var $item=_this5.getItemElement(itemModel);var isCorrect=Boolean(itemModel.get("_isCorrect"));if(!isCorrect){_.delay(function(){itemModel.dragRevert()},0);return}$item.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect);itemModel.dragLock()})}}]);return HYBDragLabelView}(QuestionView$1);HYBDragLabelView.template="hyb-dragLabel";var HYBDragLabelView$1=__AMD("components/adapt-hyb-dragLabel/js/hyb-dragLabelView",HYBDragLabelView);var HYBDragGraphicView=function(_HYBDragLabelView){_inherits(HYBDragGraphicView,_HYBDragLabelView);var _super=_createSuper(HYBDragGraphicView);function HYBDragGraphicView(){_classCallCheck(this,HYBDragGraphicView);return _super.apply(this,arguments)}_createClass(HYBDragGraphicView,[{key:"setupOptionSizing",value:function setupOptionSizing(){var _this=this;this.model.getOptions().each(function(optionModel){var $option=_this.getOptionElement(optionModel);var sizing=optionModel.get("_sizing");optionModel._prevSizing=_.extend({},sizing);$option.css({left:(sizing===null||sizing===void 0?void 0:sizing._left)+"%",top:(sizing===null||sizing===void 0?void 0:sizing._top)+"%",width:(sizing===null||sizing===void 0?void 0:sizing._width)+"%",height:(sizing===null||sizing===void 0?void 0:sizing._height)+"%"})})}},{key:"onOptionDragsChange",value:function onOptionDragsChange(optionModel,drags){var _this2=this;_.each(drags,function(itemModel,idx){_.delay(function(){if(!itemModel.get("_drop"))return;_this2.moveDragToDrop(itemModel,optionModel)},0)})}},{key:"moveDragToDrop",value:function moveDragToDrop(itemModel,optionModel){var $drag=this.getDragElement(itemModel);var dragSize={width:$drag.width(),height:$drag.height()};var $option=this.getDropElement(optionModel);var optionOffset=$option.offset();var optionSize={width:$option.width(),height:$option.height()};var left=optionOffset.left+(optionSize.width-dragSize.width)/2;var top=optionOffset.top+(optionSize.height-dragSize.height)/2;switch(optionModel.get("_align")){case"left":left=optionOffset.left;break;case"right":left=optionOffset.left+optionSize.width-dragSize.width;break;case"top":top=optionOffset.top;break;case"bottom":top=optionOffset.top+optionSize.height-dragSize.height;break;}$drag.offset({left:left,top:top})}},{key:"updateDragDropSize",value:function updateDragDropSize(){return}},{key:"setupDebug",value:function setupDebug(){var _this3=this;var debugWindow=Adapt.hyb.debug.initDebugWindow(this.model.getParent(),"_options._sizing");debugWindow.trackCollection(this.model.getOptions(),["_sizing._left","_sizing._top","_sizing._width","_sizing._height"],"_item[*]._sizing");debugWindow.setCopyFunc(function(data){var obj=[];for(var i=0;i<data.length;i+=4){obj.push({_align:_this3.model.getOptions().models[i/4].get("_align"),_sizing:{_left:parseFloat(data[i],10)||"",_top:parseFloat(data[i+1],10)||"",_width:parseFloat(data[i+2],10)||"",_height:parseFloat(data[i+3],10)||""}})}return JSON.stringify(obj,"",4)});this.__debugWindow=debugWindow;this.listenTo(this.model.getOptions(),{"change:_sizing":this._updateOptionSizing})}},{key:"_updateOptionSizing",value:function _updateOptionSizing(optionModel,sizing){var _this4=this;var $option=this.getOptionElement(optionModel);var prevSizing=_.extend({},optionModel._prevSizing);optionModel._prevSizing=_.extend({},sizing);var widthDiff=parseFloat(sizing._width||0,10)-parseFloat(prevSizing._width||0,10);var heightDiff=parseFloat(sizing._height||0,10)-parseFloat(prevSizing._height||0,10);if(Math.abs(widthDiff)>0.01||Math.abs(heightDiff)>0.01){var left=parseFloat(sizing._left,10)-(widthDiff?widthDiff/2:0);var top=parseFloat(sizing._top,10)-(heightDiff?heightDiff/2:0);this.__debugWindow.setProp("[".concat(optionModel.get("_index"),"]*._left"),left);this.__debugWindow.setProp("[".concat(optionModel.get("_index"),"]*._top"),top)}$option.css({left:sizing._left+"%",top:sizing._top+"%",width:sizing._width?sizing._width+"%":undefined,height:sizing._height?sizing._height+"%":undefined});_.each(optionModel.get("_drags"),function(itemModel,idx){_this4.moveDragToDrop(itemModel,optionModel);_this4.getDragElement(itemModel).hide(0).show(0)})}},{key:"postRender",value:function postRender(){var _get2;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}(_get2=_get(_getPrototypeOf(HYBDragGraphicView.prototype),"postRender",this)).call.apply(_get2,[this].concat(args));this.setupDebug()}},{key:"getItemElement",value:function getItemElement(itemModel){return this.$(".js-hyb-draggraphic-item").filter("[data-adapt-index="+itemModel.get("_index")+"]")}},{key:"getDragElement",value:function getDragElement(itemModel){return this.$(".js-hyb-draggraphic-drag").filter("[data-adapt-index="+itemModel.get("_index")+"]")}},{key:"getOptionElement",value:function getOptionElement(optionModel){return this.$(".js-hyb-draggraphic-option").filter("[data-adapt-index="+optionModel.get("_index")+"]")}},{key:"getDropElement",value:function getDropElement(optionModel){return this.$(".js-hyb-draggraphic-drop").filter("[data-adapt-index="+optionModel.get("_index")+"]")}}]);return HYBDragGraphicView}(HYBDragLabelView$1);HYBDragGraphicView.template="hyb-dragGraphic";var HYBDragGraphicView$1=__AMD("components/adapt-hyb-dragGraphic/js/hyb-dragGraphicView",HYBDragGraphicView);var HYBConnectModel=function(_QuestionModel){_inherits(HYBConnectModel,_QuestionModel);var _super=_createSuper(HYBConnectModel);function HYBConnectModel(){_classCallCheck(this,HYBConnectModel);return _super.apply(this,arguments)}_createClass(HYBConnectModel,[{key:"init",value:function init(){_get(_getPrototypeOf(HYBConnectModel.prototype),"init",this).call(this);this.setupItems.apply(this,arguments);this.setupEventListeners();this.checkCanSubmit()}},{key:"toJSON",value:function toJSON(){var json=_get(_getPrototypeOf(HYBConnectModel.prototype),"toJSON",this).call(this);json._options=json._options.toJSON();return json}},{key:"setupItems",value:function setupItems(){var items=this.get("_items");var options=this.get("_options");_.each(items,function(item,index){item._index=index;item._optionsVisited=[]});this.setChildren(new Backbone.Collection(items,{model:Backbone.Model}));var dropQty=[];_.each(items,function(item,index){var ocCount=item._optionsCorrect.length;_.each(item._optionsCorrect,function(optionIdx){if(dropQty[optionIdx]===undefined)dropQty[optionIdx]=0;else if(ocCount>1)return;dropQty[optionIdx]++})});dropQty=dropQty.sort();var dropCapacity=dropQty[dropQty.length-1];_.each(options,function(option,index){option._index=index;option._capacity=option._capacity||dropCapacity||1});this.set("_options",new Backbone.Collection(options,{model:Backbone.Model}));this.setupRandomisation()}},{key:"setupRandomisation",value:function setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;this.set("_items",_.shuffle(this.get("_items")))}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.getChildren(),{"change:_drop":this.onDrop.bind(this)})}},{key:"getOptions",value:function getOptions(){return this.get("_options")}},{key:"onDrop",value:function onDrop(itemModel,drop){if(drop)itemModel.set("_isVisited",true);this.checkCanSubmit()}},{key:"isCorrect",value:function isCorrect(){var props={_numberOfIncorrectAnswers:0,_numberOfCorrectAnswers:0,_isAtLeastOneIncorrectSelection:false};this.getChildren().each(function(itemModel){var _itemModel$get;var dropIdx=(_itemModel$get=itemModel.get("_drop"))===null||_itemModel$get===void 0?void 0:_itemModel$get.get("_index");var optionsCorrect=itemModel.get("_optionsCorrect");if(!optionsCorrect.length&&dropIdx===undefined){return}var isItemCorrect=optionsCorrect.indexOf(dropIdx)!==-1;itemModel.set("_isCorrect",isItemCorrect);itemModel.set("_isIncorrect",!isItemCorrect);itemModel.set("_isDisabled",isItemCorrect);var optionsVisited=itemModel.get("_optionsVisited");optionsVisited.push(dropIdx);itemModel.set("_optionsVisited",_.unique(optionsVisited));if(!isItemCorrect){props._numberOfIncorrectAnswers++;props._isAtLeastOneIncorrectSelection=true;return}props._numberOfCorrectAnswers++});this.set(props);var hasRightNumberOfCorrectAnswers=props._numberOfCorrectAnswers===this.getChildren().filter(function(itemModel){return Boolean(itemModel.get("_optionsCorrect").length)}).length;var hasNoIncorrectAnswers=!props._isAtLeastOneIncorrectSelection;return hasRightNumberOfCorrectAnswers&&hasNoIncorrectAnswers}},{key:"canSubmit",value:function canSubmit(){var incompleteItem=this.get("_options").find(function(optionModel){var _optionModel$get;return!Boolean((_optionModel$get=optionModel.get("_drags"))===null||_optionModel$get===void 0?void 0:_optionModel$get.length)});return!Boolean(incompleteItem)}},{key:"storeUserAnswer",value:function storeUserAnswer(){var items=this.getChildren();var userAnswer=new Array(items.length);var tempUserAnswer=new Array(items.length);items.forEach(function(itemModel){var _itemModel$get2;var optionIndex=((_itemModel$get2=itemModel.get("_drop"))===null||_itemModel$get2===void 0?void 0:_itemModel$get2.get("_index"))||0;tempUserAnswer[itemModel.get("_index")]=optionIndex;userAnswer[itemModel.get("_index")]=optionIndex},this);this.set({_userAnswer:userAnswer,_tempUserAnswer:tempUserAnswer})}},{key:"getResponse",value:function getResponse(){var responses=[];this.get("_userAnswer").forEach(function(userAnswer,index){responses.push(index+1+"."+(userAnswer+1))});return responses.join("#")}},{key:"getResponseType",value:function getResponseType(){return"matching"}}]);return HYBConnectModel}(QuestionModel$1);var HYBDragLabelModel=__AMD("components/adapt-hyb-dragLabel/js/hyb-dragLabelModel",HYBConnectModel);var HYBDragGraphicModel=function(_HYBDragLabelModel){_inherits(HYBDragGraphicModel,_HYBDragLabelModel);var _super=_createSuper(HYBDragGraphicModel);function HYBDragGraphicModel(){_classCallCheck(this,HYBDragGraphicModel);return _super.apply(this,arguments)}_createClass(HYBDragGraphicModel,[{key:"canSubmit",value:function canSubmit(){var filledOption=this.getOptions().find(function(optionModel){var _optionModel$get;return Boolean((_optionModel$get=optionModel.get("_drags"))===null||_optionModel$get===void 0?void 0:_optionModel$get.length)});return Boolean(filledOption)}}]);return HYBDragGraphicModel}(HYBDragLabelModel);var HYBDragGraphicModel$1=__AMD("components/adapt-hyb-dragGraphic/js/hyb-dragGraphicModel",HYBDragGraphicModel);__AMD("components/adapt-hyb-dragGraphic/js/adapt-hyb-dragGraphic",Adapt.register("hyb-draggraphic",{model:HYBDragGraphicModel$1,view:HYBDragGraphicView$1}));__AMD("components/adapt-hyb-dragLabel/js/adapt-hyb-dragLabel",Adapt.register("hyb-draglabel",{model:HYBDragLabelModel,view:HYBDragLabelView$1}));var HYBFreeThinkingFeedbackView=function(_Backbone$View){_inherits(HYBFreeThinkingFeedbackView,_Backbone$View);var _super=_createSuper(HYBFreeThinkingFeedbackView);function HYBFreeThinkingFeedbackView(){_classCallCheck(this,HYBFreeThinkingFeedbackView);return _super.apply(this,arguments)}_createClass(HYBFreeThinkingFeedbackView,[{key:"events",value:function events(){return{}}},{key:"className",value:function className(){var classes=["hyb-freethinking-feedback",this.model.get("class")||""];return classes.join(" ")}},{key:"initialize",value:function initialize(){this.render()}},{key:"render",value:function render(){var template=Handlebars.templates["hyb-freeThinkingFeedback"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}}]);return HYBFreeThinkingFeedbackView}(Backbone.View);var HYBFreeThinkingFeedbackView$1=__AMD("components/adapt-hyb-freeThinking/js/hyb-freeThinkingFeedbackView",HYBFreeThinkingFeedbackView);var HYBFreeThinkingView=function(_ComponentView){_inherits(HYBFreeThinkingView,_ComponentView);var _super=_createSuper(HYBFreeThinkingView);function HYBFreeThinkingView(){_classCallCheck(this,HYBFreeThinkingView);return _super.apply(this,arguments)}_createClass(HYBFreeThinkingView,[{key:"events",value:function events(){return{"click .js-hyb-freethinking-controls-left":"onControlsLeftClick","click .js-hyb-freethinking-controls-right":"onControlsRightClick","click .js-hyb-freethinking-controls-submit":"onControlsSubmitClick"}}},{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBFreeThinkingView.prototype),"initialize",this).call(this)}},{key:"preRender",value:function preRender(){this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model.getChildren(),"change:_isActive",this.onItemActiveChange)}},{key:"onItemActiveChange",value:function onItemActiveChange(itemModel,isActive){if(!isActive)return;this.$(".js-hyb-freethinking-logo").toggleClass("is-active",itemModel.get("_index")!==0)}},{key:"onControlsLeftClick",value:function onControlsLeftClick(){var activeItem=this.model.getActiveItem();var stage=activeItem.get("_index");this.model.setActiveItem(--stage)}},{key:"onControlsRightClick",value:function onControlsRightClick(){var activeItem=this.model.getActiveItem();var stage=activeItem.get("_index");this.model.setActiveItem(++stage)}},{key:"onControlsSubmitClick",value:function onControlsSubmitClick(){this.$(".js-hyb-freethinking-controls-submit").html("Feedback");this.feedback.toggle()}},{key:"postRender",value:function postRender(){var _this=this;Adapt.hyb.initSlider(this.$(".js-hyb-slider"),{_parent:this.model,_controls:{_hideNav:true,_hideProgress:true,_hideClose:true}});this.model.setActiveItem(0);this.setupFeedback();this.$el.imageready(function(){_this.setReadyStatus()})}},{key:"setupFeedback",value:function setupFeedback(){var feedbackData=this.model.get("_feedback");var feedbackWidth=feedbackData._width||undefined;var feedbackView=new HYBFreeThinkingFeedbackView$1({model:new Backbone.Model(feedbackData)});this.feedback=Adapt.hyb.drawer({_parent:this.model,_view:feedbackView,_$target:this.$(".js-hyb-freethinking-content"),_width:feedbackWidth,title:feedbackData.title});if(feedbackWidth){var $content=this.$(".js-hyb-freethinking-content");$content.css("width",100-feedbackWidth+"%")}this.listenTo(this.feedback.model,"change:_isActive",this.onFeedbackActiveChange)}},{key:"onFeedbackActiveChange",value:function onFeedbackActiveChange(feedbackModel,isActive){this.$(".js-hyb-freethinking-logo").toggleClass("is-hidden",isActive);this.$(".js-hyb-freethinking-controls-left").toggleClass("is-hidden",isActive);if(isActive)this.setCompletionStatus()}}]);return HYBFreeThinkingView}(ComponentView$1);HYBFreeThinkingView.template="hyb-freeThinking";var HYBFreeThinkingView$1=__AMD("components/adapt-hyb-freeThinking/js/hyb-freeThinkingView",HYBFreeThinkingView);var HYBFreeThinkingModel=function(_ItemsComponentModel){_inherits(HYBFreeThinkingModel,_ItemsComponentModel);var _super=_createSuper(HYBFreeThinkingModel);function HYBFreeThinkingModel(){_classCallCheck(this,HYBFreeThinkingModel);return _super.apply(this,arguments)}_createClass(HYBFreeThinkingModel,[{key:"initialize",value:function initialize(){this.get("_feedback")._parent=this;_get(_getPrototypeOf(HYBFreeThinkingModel.prototype),"initialize",this).call(this);Adapt.on({"app:dataReady":this.onDataReady.bind(this)})}},{key:"onDataReady",value:function onDataReady(){this.initItems();this.setupFeedback();_get(_getPrototypeOf(HYBFreeThinkingModel.prototype),"setUpItems",this).call(this);this.listenTo(this.getChildren(),{"all":_get(_getPrototypeOf(HYBFreeThinkingModel.prototype),"onAll",this),"change:_isVisited":_get(_getPrototypeOf(HYBFreeThinkingModel.prototype),"checkCompletionStatus",this)});this.setActiveItem(0)}},{key:"initItems",value:function initItems(){var _this$get,_this$get2;this.set("_items",[{_background:((_this$get=this.get("_hybBackground"))===null||_this$get===void 0?void 0:_this$get.toJSON())||undefined},{_background:_.extend({},{_isEnabled:true,src:"assets/adapt-hyb-freeThinking/bg.jpg"},this.get("_content")._background||{})}]);this.set("_background",null);(_this$get2=this.get("_hybBackground"))===null||_this$get2===void 0?void 0:_this$get2.set("_hasCustomView",true)}},{key:"setupFeedback",value:function setupFeedback(){var feedback=this.get("_feedback")||{};feedback.title=feedback.title===false?"":feedback.title||"How did you go?";feedback.subTitle=feedback.subTitle===false?"":feedback.subTitle||"Compare your answers to these."}},{key:"hybReset",value:function hybReset(){this.setActiveItem(0)}}]);return HYBFreeThinkingModel}(ItemsComponentModel);var HYBFreeThinkingModel$1=__AMD("components/adapt-hyb-freeThinking/js/hyb-freeThinkingModel",HYBFreeThinkingModel);__AMD("components/adapt-hyb-freeThinking/js/adapt-hyb-freeThinking",Adapt.register("hyb-freethinking",{model:HYBFreeThinkingModel$1,view:HYBFreeThinkingView$1}));var CLOSE_TIMEOUT=500;var HYBHotgraphicPopupView=function(_Backbone$View){_inherits(HYBHotgraphicPopupView,_Backbone$View);var _super=_createSuper(HYBHotgraphicPopupView);function HYBHotgraphicPopupView(){_classCallCheck(this,HYBHotgraphicPopupView);return _super.apply(this,arguments)}_createClass(HYBHotgraphicPopupView,[{key:"className",value:function className(){var classes=["hyb-hotgraphic-popup",this.model.get("_invertColor")?"invert-color":"",this.model.get("_isLegacyPopup")?"is-legacy-popup":""];return classes.join(" ")}},{key:"events",value:function events(){return{"click .js-hyb-hotgraphic-popup-close":"onClickClose","click .hyb-hotgraphic-popup__inner, .hyb-hotgraphic-popup__item-content, .hyb-hotgraphic-popup__item-graphic":"onClickBG","click .js-hotgraphic-controls-click":"onControlClick"}}},{key:"initialize",value:function initialize(){var _this=this;this.initFilter();this._canUserClose=false;var graphic=this.model.get("_graphic");if(graphic){graphic.srcPopup=graphic.srcPopup||graphic.srcVisited||undefined;this._hasAltImg=Boolean(graphic.srcPopup);if(graphic.srcVisited)graphic.src=graphic.srcVisited}else{this._hasAltImg=false}var theme=this.model.get("_theme");if(theme===undefined)theme="bubble";this.model.set("_theme",theme);_.delay(function(){_this._canUserClose=true},CLOSE_TIMEOUT);this.listenToOnce(Adapt,"notify:opened",this.onOpened);this.listenTo(Adapt,"notify:closed",this.onClosed);this.render()}},{key:"initFilter",value:function initFilter(){var graphic=this.model.get("_graphic");var filter=graphic===null||graphic===void 0?void 0:graphic._filter;if(!filter)return;filter=filter.replace(/outline\(([\d.]*\w+)\s*(.*?)\)(\s|$)/g,function(match,$1,$2){var _width=parseFloat($1,10);var isDiag=_width!=Math.floor(_width);var width=Math.floor(_width)+"px";var zero="0px";var color=$2;if(_width===0)return["drop-shadow(0 0 0.5px ".concat(color,")"),"drop-shadow(0 0 0.5px ".concat(color,")"),"drop-shadow(0 0 0.5px ".concat(color,")")].join(" ");return["drop-shadow( ".concat(width,"  ").concat(isDiag?width:zero," 0 ").concat(color,")"),"drop-shadow(-".concat(width," -").concat(isDiag?width:zero," 0 ").concat(color,")"),"drop-shadow( ".concat(isDiag?width:zero," -").concat(width," 0 ").concat(color,")"),"drop-shadow(-".concat(isDiag?width:zero,"  ").concat(width," 0 ").concat(color,")")].join(" ")});graphic._filter=filter}},{key:"onClickClose",value:function onClickClose(event){if(!this._canUserClose)return;this.closePopup()}},{key:"onClickBG",value:function onClickBG(event){event.stopPropagation();if(event.target!=event.currentTarget)return;if(!this._canUserClose)return;this.closePopup()}},{key:"onOpened",value:function onOpened(){this.$el.imageready(_.debounce(this.setupGraphicTransition.bind(this),100))}},{key:"alignGraphicToPin",value:function alignGraphicToPin(){var parentView=Adapt.findViewByModelId(this.model.get("_parent").get("_id"));var itemIdx=this.model.get("_index");var $pin=parentView.$(".js-hyb-hotgraphic-item-transition").filter("[data-adapt-index=".concat(itemIdx,"]")).find("img");var $popupImg=this.$(".js-hyb-hotgraphic-popup-image");var $img=$popupImg.find(".js-ddimg-img");var $tran=this.$(".js-hyb-hotgraphic-popup-image-transition");$tran.css({"transform":""});var pinBB=$pin[0].getBoundingClientRect();var popupImgBB=$popupImg[0].getBoundingClientRect();var imgBB=_.extend({},$img[0].getBoundingClientRect());var fixLeft=(popupImgBB.width-imgBB.width)/2;var fixTop=(popupImgBB.height-imgBB.height)/2;var scale=pinBB.width/imgBB.width;var offset={top:pinBB.top-popupImgBB.top-fixTop*scale,left:pinBB.left-popupImgBB.left-fixLeft*scale};if(this._hasAltImg){var tranBB=$tran[0].getBoundingClientRect();offset.top=pinBB.top-tranBB.top-(imgBB.top-tranBB.top)*scale}$tran.css({"transform":"translate("+offset.left+"px, "+offset.top+"px) scale("+scale+")"});return $tran}},{key:"cropImgToImgMap",value:function cropImgToImgMap($imgWithMap,$imgToCrop){var mapBB=$imgWithMap.attr("data-bb");if(!mapBB){return}mapBB=mapBB.split(",").map(function(e){return parseFloat(e,10)});var width=$imgToCrop.width();var height=$imgToCrop.height();var multi=1/mapBB[2];var left=-mapBB[0]*width*multi;var top=-mapBB[1]*height*multi;var right=-(1-mapBB[0]-mapBB[2])*width*multi;var bottom=-(1-mapBB[1]-mapBB[3])*height*multi;$imgToCrop.css({"width":multi*100+"%","max-width":"none","position":"relative","left":left,"top":top,"right":right,"bottom":bottom});$imgToCrop.closest(".ddimg").css({height:$imgToCrop.height()+top+bottom})}},{key:"setupGraphicTransition",value:function setupGraphicTransition(){var _this2=this;var $tran=this.alignGraphicToPin();_.delay(function(){_this2.setReadyStatus();$tran.removeClass("u-visibility-hidden")},0);_.debounce(function(){$tran.addClass("is-active transition-enabled")},50)()}},{key:"setReadyStatus",value:function setReadyStatus(){this.model.trigger("HYBHotgraphicPopupView:ready");this.$el.addClass("is-ready")}},{key:"onClosed",value:function onClosed(notifyView){if(!notifyView.$el.hasClass("hyb-hotgraphic"))return;var $img=this.$(".js-hyb-hotgraphic-popup-image-transition");$img.removeClass("is-active").find(".hyb-hotgraphic-popup__item-image-transition-inner").removeClass("is-active");this.$el.addClass("is-closed");var $close=this.$el.closest(".notify").find(".js-notify-close-btn");$close.fadeOut()}},{key:"remove",value:function remove(){this.model.trigger("remove")}},{key:"_remove",value:function _remove(){_get(_getPrototypeOf(HYBHotgraphicPopupView.prototype),"remove",this).call(this)}},{key:"render",value:function render(){var data=this.model.toJSON();data.view=this;var template=Handlebars.templates["hyb-hotgraphicPopup"];this.$el.html(template(data))}},{key:"closePopup",value:function closePopup(event){Adapt.trigger("notify:close")}}]);return HYBHotgraphicPopupView}(Backbone.View);var HYBHotgraphicPopupView$1=__AMD("components/adapt-hyb-hotgraphic/js/hyb-hotgraphicPopupView",HYBHotgraphicPopupView);var HYBHotgraphicView=function(_ComponentView){_inherits(HYBHotgraphicView,_ComponentView);var _super=_createSuper(HYBHotgraphicView);function HYBHotgraphicView(){_classCallCheck(this,HYBHotgraphicView);return _super.apply(this,arguments)}_createClass(HYBHotgraphicView,[{key:"events",value:function events(){return{"click .js-hyb-hotgraphic-item-click":"onItemBtnClick"}}},{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBHotgraphicView.prototype),"initialize",this).call(this)}},{key:"preRender",value:function preRender(){var _this$model$get,_this$model$get2;_get(_getPrototypeOf(HYBHotgraphicView.prototype),"preRender",this).call(this);this.setupModelData();this.setupEventListeners();this._hasPins=((_this$model$get=this.model.get("_graphic"))===null||_this$model$get===void 0?void 0:_this$model$get._isEnabled)||((_this$model$get2=this.model.get("_graphic"))===null||_this$model$get2===void 0?void 0:_this$model$get2.src);if(this._hasPins){this.model.getChildren().each(function(itemModel){var graphic=itemModel.get("_graphic");var sizing=_.extend({},{_top:0,_left:0,_width:100},graphic._sizing);graphic._sizing=sizing})}}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model.getChildren(),{"change:_isActive":this.onItemActiveChange,"change:_isComplete":this.onItemCompleteChange,"change:_isVisited":this.onItemVisitedChange,"change:_isVisible":this.onItemVisibleChange})}},{key:"isMasked",value:function isMasked(){var _this$model$get3;return Boolean((_this$model$get3=this.model.get("_graphic"))===null||_this$model$get3===void 0?void 0:_this$model$get3._mask)}},{key:"onItemBtnClick",value:function onItemBtnClick(event){var $item=$(event.currentTarget);var itemIdx=$item.data("adapt-index");if(this.isMasked()){var $img=$item.find("img[data-bb]").first();var _$img$attr$split$map=$img.attr("data-bb").split(",").map(function(e){return parseFloat(e,10)}),_$img$attr$split$map2=_slicedToArray(_$img$attr$split$map,4),x=_$img$attr$split$map2[0],y=_$img$attr$split$map2[1],w=_$img$attr$split$map2[2],h=_$img$attr$split$map2[3];var itemModel=this.model.getChildren().models[itemIdx];var scaleX=1/w*100;var scaleY=scaleX/($img.width()/$img.height());var left=-x*scaleX;var right=(x+w-1)*scaleX;var top=-y*scaleY;var bottom=(y+h-1)*scaleY;itemModel.set("_maskWidth",scaleX+"%");itemModel.set("_maskMargin",[top+"%",right+"%",bottom+"%",left+"%"].join(" "))}this.model.setActiveItem(itemIdx)}},{key:"onItemActiveChange",value:function onItemActiveChange(itemModel,isActive){var $item=this.$getItem(itemModel);$item.toggleClass("is-active",isActive);if(isActive){this.openPopup(itemModel)}}},{key:"openPopup",value:function openPopup(itemModel){if(this._isPopupOpen)return;this._isPopupOpen=true;itemModel.set("_parent",this.model);itemModel.set("_isLegacyPopup",this.model.get("_legacyPopups")!==false);this.popupView=new HYBHotgraphicPopupView$1({model:itemModel});this.listenToOnce(this.popupView.model,"HYBHotgraphicPopupView:ready",function(){itemModel.set("_isVisible",false);itemModel.toggleVisited(true);itemModel.set("_isComplete",true)});Adapt.trigger("notify:popup",{_view:this.popupView,_isCancellable:true,_classes:"hyb-hotgraphic "+this.model.get("_classes")+" "+this.model.get("_id")});this.listenToOnce(this.popupView.model,"remove",this.onPopupRemoved)}},{key:"onPopupRemoved",value:function onPopupRemoved(){var _this$popupView;this.model.getActiveItem().set("_isVisible",true);this.model.getActiveItem().toggleActive();this._isPopupOpen=false;(_this$popupView=this.popupView)===null||_this$popupView===void 0?void 0:_this$popupView._remove()}},{key:"onItemVisitedChange",value:function onItemVisitedChange(itemModel,isVisited){var $item=this.$getItem(itemModel);$item.toggleClass("is-visited",isVisited)}},{key:"onItemVisibleChange",value:function onItemVisibleChange(itemModel,isVisible){var $item=this.$getItem(itemModel);$item.toggleClass("u-visibility-hidden",!isVisible)}},{key:"onItemCompleteChange",value:function onItemCompleteChange(itemModel,isComplete){var $item=this.$getItem(itemModel);$item.toggleClass("is-complete",isComplete).find(".js-hyb-hotgraphic-item-click").toggleClass("is-complete",isComplete)}},{key:"$getItem",value:function $getItem(itemModel){return this.$(".js-hyb-hotgraphic-item").filter("[data-index=".concat(itemModel.get("_index"),"]"))}},{key:"setupModelData",value:function setupModelData(){}},{key:"postRender",value:function postRender(){var _this=this;this.$el.imageready(function(){_this.setupItemSizing();_this.setReadyStatus()})}},{key:"setupItemSizing",value:function setupItemSizing(){if(this._hasPins){if(this.isMasked()){Adapt.ddImg.setupImgMap(this.$(".js-hyb-hotgraphic-container"),{},this.onImgMapReady.bind(this))}return}var options=this.model.get("_itemSizing");options._parent=this.model;options._itemSizings=_.map(this.model.getChildren().models,function(itemModel){return itemModel.get("_graphic")._sizing});var sizingGrid=Adapt.hyb.initSizingGrid(this.$(".js-hyb-hotgraphic-container"),options);sizingGrid.onReady(function(){}).onUpdate(function(){})}},{key:"onImgMapReady",value:function onImgMapReady(){var $items=this.$(".js-hyb-hotgraphic-item");$items.each(function(i,e){var $el=$(e);$el.css("transform-origin",$el.find(".js-ddimg-img").css("transform-origin"))})}}]);return HYBHotgraphicView}(ComponentView$1);HYBHotgraphicView.template="hyb-hotgraphic";var HYBHotgraphicView$1=__AMD("components/adapt-hyb-hotgraphic/js/hyb-hotgraphicView",HYBHotgraphicView);var HYBHotgraphicModel=function(_ItemsComponentModel){_inherits(HYBHotgraphicModel,_ItemsComponentModel);var _super=_createSuper(HYBHotgraphicModel);function HYBHotgraphicModel(){_classCallCheck(this,HYBHotgraphicModel);return _super.apply(this,arguments)}_createClass(HYBHotgraphicModel,[{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBHotgraphicModel.prototype),"initialize",this).call(this)}}]);return HYBHotgraphicModel}(ItemsComponentModel);var HYBHotgraphicModel$1=__AMD("components/adapt-hyb-hotgraphic/js/hyb-hotgraphicModel",HYBHotgraphicModel);__AMD("components/adapt-hyb-hotgraphic/js/adapt-hyb-hotgraphic",Adapt.register("hyb-hotgraphic",{model:HYBHotgraphicModel$1,view:HYBHotgraphicView$1}));var HYBHotgraphicMiniView=function(_ComponentView){_inherits(HYBHotgraphicMiniView,_ComponentView);var _super=_createSuper(HYBHotgraphicMiniView);function HYBHotgraphicMiniView(){_classCallCheck(this,HYBHotgraphicMiniView);return _super.apply(this,arguments)}_createClass(HYBHotgraphicMiniView,[{key:"events",value:function events(){return{"click .js-hyb-hotgraphicmini-item-click":"onItemBtnClick"}}},{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBHotgraphicMiniView.prototype),"initialize",this).call(this)}},{key:"preRender",value:function preRender(){var _this$model$get;this.setupModelData();this.setupEventListeners();this.setupAudio();this.$el.toggleClass("is-xl",Boolean((_this$model$get=this.model.get("_itemSizing"))===null||_this$model$get===void 0?void 0:_this$model$get._xl))}},{key:"setupAudio",value:function setupAudio(){var _this=this;this.model.getChildren().each(function(itemModel){var audio=itemModel.get("_audio");if(!audio||audio._isEnabled===false)return;var audioId="".concat(_this.model.get("_id"),"-").concat(itemModel.get("_index"));var audioModel=Adapt.ddAudio.loadAudio(audioId,[audio.mp3,audio.ogg]);itemModel.set("_audioModel",audioModel);Adapt.ddAudio.setComponentAudioStatus(_this.model)})}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model.getChildren(),{"change:_isActive":this.onItemActiveChange,"change:_isComplete":this.onItemCompleteChange,"change:_isVisited":this.onItemVisitedChange,"change:_cWidth":this.updateCustomWidth})}},{key:"onItemBtnClick",value:function onItemBtnClick(event){var _this$model$get2;var itemIdx=$(event.currentTarget).data("adapt-index");if((_this$model$get2=this.model.get("_itemSizing"))!==null&&_this$model$get2!==void 0&&_this$model$get2._hasToggle){var item=this.model.getChildren().at(itemIdx);if(item.get("_isComplete")){this.$getItem(item).toggleClass("is-complete").find(".js-hyb-hotgraphicmini-item-click").toggleClass("is-locked").toggleClass("is-complete")}}this.model.setActiveItem(itemIdx)}},{key:"onItemActiveChange",value:function onItemActiveChange(itemModel,isActive){var _this$model$get3;var hasToggle=(_this$model$get3=this.model.get("_itemSizing"))===null||_this$model$get3===void 0?void 0:_this$model$get3._hasToggle;var $item=this.$getItem(itemModel);$item.toggleClass("is-active",isActive);if(isActive){itemModel.toggleVisited(true);itemModel.set("_isComplete",true);if(itemModel.get("_audioModel")){if(!hasToggle||$item.hasClass("is-complete")){itemModel.get("_audioModel").play(0)}else{Adapt.ddVideo.pauseAllMedia()}}}}},{key:"onItemVisitedChange",value:function onItemVisitedChange(itemModel,isVisited){var $item=this.$getItem(itemModel);$item.toggleClass("is-visited",isVisited)}},{key:"onItemCompleteChange",value:function onItemCompleteChange(itemModel,isComplete){var $item=this.$getItem(itemModel);$item.toggleClass("is-complete",isComplete).find(".js-hyb-hotgraphicmini-item-click").toggleClass("is-locked",isComplete).toggleClass("is-complete",isComplete)}},{key:"$getItem",value:function $getItem(itemModel){return this.$(".js-hyb-hotgraphicmini-item").filter("[data-index=".concat(itemModel.get("_index"),"]"))}},{key:"setupModelData",value:function setupModelData(){this.model.getChildren().each(function(itemModel){var theme=itemModel.get("_theme");if(theme===undefined)itemModel.set("_theme","bubble")})}},{key:"postRender",value:function postRender(){var _this2=this;this.setupDebug();this.$el.imageready(function(){_this2.setupItemSizing();_this2.setReadyStatus()})}},{key:"setupDebug",value:function setupDebug(){if(!this.model.getChildren().find(function(e){return Boolean(e.get("_cWidth"))}))return;var debugWindow=Adapt.hyb.debug.initDebugWindow(this.model.getParent(),"_items");debugWindow.trackCollection(this.model.getChildren(),"_cWidth","_item[*]._cWidth")}},{key:"setupItemSizing",value:function setupItemSizing(){var _this3=this;var options=this.model.get("_itemSizing");options._parent=this.model;options._itemSizings=_.map(this.model.getChildren().models,function(itemModel){return itemModel.get("_graphic")._sizing});var sizingGrid=Adapt.hyb.initSizingGrid(this.$(".js-hyb-hotgraphicmini-grid"),options);sizingGrid.onReady(function(){_this3.setupContentSizing()}).onUpdate(function(){_this3.setupContentSizing()})}},{key:"updateContentWidth",value:function updateContentWidth(itemModel,contentWidth){var $item=this.$getItem(itemModel);var $content=$item.find(".js-hyb-hotgraphicmini-content");$content.css("width",contentWidth+"%")}},{key:"updateCustomWidth",value:function updateCustomWidth(itemModel,cWidth){var $item=this.$getItem(itemModel);var $content=$item.find(".js-hyb-hotgraphicmini-content");$content.css("min-width",cWidth+"rem")}},{key:"setupContentSizing",value:function setupContentSizing(){var _this4=this;var items=this.model.getChildren();var $container=this.$(".js-hyb-hotgraphicmini-grid");var margin=Infinity;var $items=this.$(".js-hyb-hotgraphicmini-item");$items.each(function(i,e){margin=Math.min(margin,$(e).actual("offset").left-$container.actual("offset").left)});items.each(function(item){if(item.get("_layout")==="hoz")return;var $item=_this4.$getItem(item);var $content=$item.find(".js-hyb-hotgraphicmini-content");var contentWidth=item.get("_contentWidth");var marginMulti=(contentWidth||100)/100;if(contentWidth&&contentWidth!=100)throw"_items[*]._contentWidth should not be used with _itemSizing._layout: \"ver\". Change the layout, or remove the property.";$content.css({"margin-left":-margin*marginMulti,"margin-right":-margin*marginMulti})})}}]);return HYBHotgraphicMiniView}(ComponentView$1);HYBHotgraphicMiniView.template="hyb-hotgraphicMini";var HYBHotgraphicMiniView$1=__AMD("components/adapt-hyb-hotgraphicMini/js/hyb-hotgraphicMiniView",HYBHotgraphicMiniView);var HYBHotgraphicMiniModel=function(_ItemsComponentModel){_inherits(HYBHotgraphicMiniModel,_ItemsComponentModel);var _super=_createSuper(HYBHotgraphicMiniModel);function HYBHotgraphicMiniModel(){_classCallCheck(this,HYBHotgraphicMiniModel);return _super.apply(this,arguments)}_createClass(HYBHotgraphicMiniModel,[{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBHotgraphicMiniModel.prototype),"initialize",this).call(this);this.setupItems()}},{key:"setupItems",value:function setupItems(){var itemSizing=this.get("_itemSizing")||{};this.get("_items").forEach(function(item){if(item._layout)return;item._layout=itemSizing._layout||"ver"});var noToggle=this.get("_items").find(function(e){return Boolean(e.title||e.body)});if(!noToggle&&itemSizing._hasToggle===undefined){itemSizing._hasToggle=true;this.set("_itemSizing",itemSizing)}}}]);return HYBHotgraphicMiniModel}(ItemsComponentModel);var HYBHotgraphicMiniModel$1=__AMD("components/adapt-hyb-hotgraphicMini/js/hyb-hotgraphicMiniModel",HYBHotgraphicMiniModel);__AMD("components/adapt-hyb-hotgraphicMini/js/adapt-hyb-hotgraphicMini",Adapt.register("hyb-hotgraphicmini",{model:HYBHotgraphicMiniModel$1,view:HYBHotgraphicMiniView$1}));var HYBNarrativeView=function(_ComponentView){_inherits(HYBNarrativeView,_ComponentView);var _super=_createSuper(HYBNarrativeView);function HYBNarrativeView(){_classCallCheck(this,HYBNarrativeView);return _super.apply(this,arguments)}_createClass(HYBNarrativeView,[{key:"events",value:function events(){var itemBtnSelector=".js-hyb-item-btn[data-component-id=\"".concat(this.model.get("_id"),"\"]");var events={};events["click .js-hyb-main-btn"]="onMainBtnClick";events["click "+itemBtnSelector]="onItemBtnClick";return events}},{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBNarrativeView.prototype),"initialize",this).call(this)}},{key:"onItemBtnClick",value:function onItemBtnClick(event){var itemIdx=$(event.currentTarget).data("index");this.model.setActiveItem(itemIdx)}},{key:"onMainBtnClick",value:function onMainBtnClick(event){this.model.setActiveItem(0)}},{key:"preRender",value:function preRender(){this.setupModelData();this.setupEventListeners();this.setupAudio()}},{key:"setupAudio",value:function setupAudio(){var _this=this;this.model.getChildren().each(function(itemModel){var audio=itemModel.get("_audio");if(!audio||audio._isEnabled===false)return;var audioId="".concat(_this.model.get("_id"),"-").concat(itemModel.get("_index"));var audioModel=Adapt.ddAudio.loadAudio(audioId,[audio.mp3,audio.ogg]);itemModel.set("_audioModel",audioModel);Adapt.ddAudio.setComponentAudioStatus(_this.model)})}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model.getChildren(),{"change:_isActive":this.onItemActiveChange,"change:_isVisited":this.onItemVisitedChange,"change:_isComplete":this.onItemCompleteChange});this.listenTo(this.model,{"change:_isComplete":this.onComplete})}},{key:"onComplete",value:function onComplete(event,isComplete){if(!isComplete)return;this.$(".js-hyb-main-btn").toggleClass("is-complete",isComplete)}},{key:"setupModelData",value:function setupModelData(){var _this2=this;var items=this.model.getChildren();items.each(function(item){var componentId=item.get("_nestComponent");if(!componentId)return;var itemComponent=Adapt.findById(componentId);if(!itemComponent){throw"hyb-narrativeModel: could not find component with \"_id\": \"".concat(componentId,"\"!")}item.set("_component",itemComponent);item.set("title",itemComponent.get("title"));_this2.listenTo(itemComponent,"change:_isComplete",function(model,isComplete){if(!isComplete)return;if(!item.get("_isActive"))return;item.set("_isComplete",true)});var componentHBG=itemComponent.get("_hybBackground");if(componentHBG){item.set("_background",_.extend({},componentHBG.toJSON(),{_isHybBackground:true}));componentHBG.set("_hasCustomView",true);componentHBG.set("_narrativeItemIndex",item.get("_index"));_this2.listenTo(componentHBG,"change:_isBlurred",_this2.onItemBGBlurred)}})}},{key:"onItemBGBlurred",value:function onItemBGBlurred(componentHBG,isBlurred){var $bg=this.$(".js-hyb-slider-bg-item[data-index='".concat(componentHBG.get("_narrativeItemIndex"),"']")).first();$bg.toggleClass("is-blurred",isBlurred).find(".js-hyb-slider-bg-item-inner").css(componentHBG.getBlurStyles())}},{key:"onItemActiveChange",value:function onItemActiveChange(itemModel,isActive){this.$getItemBtn(itemModel).toggleClass("is-active",isActive);if(!isActive)return;var audioModel=itemModel.get("_audioModel");if(audioModel){_.defer(function(){return audioModel.play(0)})}if(itemModel.get("_isComplete"))return;var childComponent=itemModel.get("_component");if(!childComponent){if(itemModel.get("_media")){var $item=this.$getItemContent(itemModel);var videoModel=Adapt.ddVideo.getVideoModel($item.find(".js-hyb-video"));this.listenToOnce(videoModel,"change:_isPlaying",function(){itemModel.set("_isComplete",true)})}else{itemModel.set("_isComplete",true)}}else if(childComponent.get("_isComplete")){itemModel.set("_isComplete",true);return}}},{key:"onItemCompleteChange",value:function onItemCompleteChange(itemModel,isComplete){var $btn=this.$getItemBtn(itemModel);var hs=itemModel.get("_hiddenSiblings");if(hs){var incompleteHSCount=hs.filter(function(e){return!e.get("_isComplete")}).length;if(incompleteHSCount==0){$btn.toggleClass("is-complete",isComplete)}else{var onHSComplete=function(hsItem,isComplete){if(!isComplete)return;incompleteHSCount--;if(incompleteHSCount<=0)$btn.toggleClass("is-complete",isComplete)};itemModel.listenTo(hs,"change:_isComplete",onHSComplete)}}else{$btn.toggleClass("is-complete",isComplete)}itemModel.toggleVisited(isComplete)}},{key:"onItemVisitedChange",value:function onItemVisitedChange(itemModel,isVisited){var $btn=this.$getItemBtn(itemModel);$btn.toggleClass("is-visited",isVisited)}},{key:"$getItemBtn",value:function $getItemBtn(itemModel){return this.$(".js-hyb-item-btn[data-component-id=\"".concat(this.model.get("_id"),"\"]")).filter("[data-index=".concat(itemModel.get("_index"),"]"))}},{key:"$getItemContent",value:function $getItemContent(itemModel){return this.$(".js-hyb-item-content[data-component-id=\"".concat(this.model.get("_id"),"\"]")).filter("[data-index=".concat(itemModel.get("_index"),"]"))}},{key:"postRender",value:function postRender(){var _this$model$get,_this3=this;var tabsEnabled=Boolean((_this$model$get=this.model.get("_tabs"))===null||_this$model$get===void 0?void 0:_this$model$get._isEnabled);this.$el.toggleClass("has-tabs",tabsEnabled).toggleClass("has-narrative",!tabsEnabled).toggleClass("legacy-tabs",this.model.get("_isLegacyTabs")).addClass(Handlebars.getThemeStr(this.model.get("_theme")));this._slider=Adapt.hyb.initSlider(this.$(".js-hyb-slider"),{_parent:this.model,_controls:{_hideNav:false,_hideClose:false,_hideProgress:false}});this.$el.imageready(function(){_this3.setReadyStatus();_this3.setupTabSizing()})}},{key:"setupTabSizing",value:function setupTabSizing(){var _this$model$get2;if(!((_this$model$get2=this.model.get("_tabs"))!==null&&_this$model$get2!==void 0&&_this$model$get2._hasGraphics))return;var options=this.model.get("_tabs");options._parent=this.model;options._itemSizings=_.map(this.model.getChildren().models,function(itemModel){var _itemModel$get;var obj=((_itemModel$get=itemModel.get("_graphic"))===null||_itemModel$get===void 0?void 0:_itemModel$get._sizing)||{};obj._whRatio="w1";return obj});var sizingGrid=Adapt.hyb.initSizingGrid(this.$(".js-hyb-narrative-tabs"),options);sizingGrid.onReady(function(){}).onUpdate(function(){})}}]);return HYBNarrativeView}(ComponentView$1);HYBNarrativeView.template="hyb-narrative";var HYBNarrativeView$1=__AMD("components/adapt-hyb-narrative/js/hyb-narrativeView",HYBNarrativeView);var HYBNarrativeModel=function(_ItemsComponentModel){_inherits(HYBNarrativeModel,_ItemsComponentModel);var _super=_createSuper(HYBNarrativeModel);function HYBNarrativeModel(){_classCallCheck(this,HYBNarrativeModel);return _super.apply(this,arguments)}_createClass(HYBNarrativeModel,[{key:"initialize",value:function initialize(){this.set("_isLegacyTabs",this.get("_legacyTabs")!==false);this.setupItems();this.setupNestComponent();_get(_getPrototypeOf(HYBNarrativeModel.prototype),"initialize",this).call(this)}},{key:"init",value:function init(){_get(_getPrototypeOf(HYBNarrativeModel.prototype),"init",this).call(this);this.setupItemsTabHidden()}},{key:"getDefaultItemAreas",value:function getDefaultItemAreas(item){var _item$_graphic,_item$_graphic$_sizin,_item$_media,_item$_media$_sizing;var wWidth=((_item$_graphic=item._graphic)===null||_item$_graphic===void 0?void 0:(_item$_graphic$_sizin=_item$_graphic._sizing)===null||_item$_graphic$_sizin===void 0?void 0:_item$_graphic$_sizin._width)||((_item$_media=item._media)===null||_item$_media===void 0?void 0:(_item$_media$_sizing=_item$_media._sizing)===null||_item$_media$_sizing===void 0?void 0:_item$_media$_sizing._width)||(item._media?50:0)||"";if(!wWidth){return[["","",""],["","s",""],["","",""]]}return[["","",""],["s".concat(100-wWidth),"w".concat(wWidth),""],["","",""]]}},{key:"setupItems",value:function setupItems(){var _this=this;this.get("_items").forEach(function(item){if(item._media){item._media._theme=item._media._theme||"border"}if(item._background){item._background._isEnabled=item._background._isEnabled===undefined?true:item._background._isEnabled}var translateX=item._translateX;var translateY=item._translateY;if(translateX||translateY){if(!translateX)translateX=0;if(!translateY)translateY=0;translateX=translateX+(isNaN(translateX)?"":"rem");translateY=translateY+(isNaN(translateY)?"":"rem");item._styleTransform="transform: translate(".concat(translateX,", ").concat(translateY,");")}if(item._grid)return;item._grid={_areas:_this.getDefaultItemAreas(item)}})}},{key:"setupItemsTabHidden",value:function setupItemsTabHidden(){var prevItem=null;this.getChildren().each(function(itemModel){if(!itemModel.get("_tabHidden")){prevItem=itemModel;return}if(!prevItem)throw"hyb-narrativeModel: the first item cannot have \"_tabHidden: true\"!";if(!prevItem.get("_hiddenSiblings"))prevItem.set("_hiddenSiblings",new Backbone.Collection);prevItem.get("_hiddenSiblings").add(itemModel)})}},{key:"setupNestComponent",value:function setupNestComponent(){var _this2=this;_.find(this.get("_items"),function(item){if(!item._nestComponent)return;_this2.set("_nestComponent",{_isParent:true});return true})}},{key:"hybReset",value:function hybReset(){this.resetActiveItems()}}]);return HYBNarrativeModel}(ItemsComponentModel);var HYBNarrativeModel$1=__AMD("components/adapt-hyb-narrative/js/hyb-narrativeModel",HYBNarrativeModel);var HYBNarrative=__AMD("components/adapt-hyb-narrative/js/adapt-hyb-narrative",Adapt.register("hyb-narrative",{model:HYBNarrativeModel$1,view:HYBNarrativeView$1}));var HYBHotgraphicTabsView=function(_HYBNarrative$view){_inherits(HYBHotgraphicTabsView,_HYBNarrative$view);var _super=_createSuper(HYBHotgraphicTabsView);function HYBHotgraphicTabsView(){_classCallCheck(this,HYBHotgraphicTabsView);return _super.apply(this,arguments)}_createClass(HYBHotgraphicTabsView,[{key:"setupEventListeners",value:function setupEventListeners(){_get(_getPrototypeOf(HYBHotgraphicTabsView.prototype),"setupEventListeners",this).call(this);this.listenTo(this.model.getChildren(),{"change:_graphic":this.updateItemPosition,"change:_isActive":this._onItemActiveChange})}},{key:"_onItemActiveChange",value:function _onItemActiveChange(itemModel,isActive){var $item=this.$(".js-hyb-hotgraphictabs-item").filter("[data-index=\"".concat(itemModel.get("_index"),"\"]"));$item.toggleClass("is-active",isActive);if(isActive){this.$(".js-hyb-hotgraphictabs-tabs").toggleClass("is-active",true)}this.$(".js-hyb-hotgraphictabs-tabs").attr("data-active-index",itemModel.get("_index"));if(!this.model.get("_speechBubbleEnabled"))return;var $sbtail=this.$(".js-hyb-hotgraphictabs-speechbubble");var bottom=$item.offset().top>$sbtail.offset().top;var left=$item.offset().left;if(this.isMasked()){try{var origin=$item.find(".ddimg__img[data-bb]")[0].style.transformOrigin;var x=parseFloat(origin.split(" ")[0],10)/100;left+=$item.width()*x}catch(err){}}else{left+=$item.width()/2}$sbtail.offset({left:left}).css({bottom:bottom?"0":""})}},{key:"updateItemPosition",value:function updateItemPosition(itemModel){var _itemModel$get,_itemModel$get$_sizin,_itemModel$get2,_itemModel$get2$_sizi,_itemModel$get3,_itemModel$get3$_sizi;var $item=this.$(".js-hyb-hotgraphictabs-item").filter("[data-index=\"".concat(itemModel.get("_index"),"\"]"));$item.css({"left":((_itemModel$get=itemModel.get("_graphic"))===null||_itemModel$get===void 0?void 0:(_itemModel$get$_sizin=_itemModel$get._sizing)===null||_itemModel$get$_sizin===void 0?void 0:_itemModel$get$_sizin._left)+"%","top":((_itemModel$get2=itemModel.get("_graphic"))===null||_itemModel$get2===void 0?void 0:(_itemModel$get2$_sizi=_itemModel$get2._sizing)===null||_itemModel$get2$_sizi===void 0?void 0:_itemModel$get2$_sizi._top)+"%","width":((_itemModel$get3=itemModel.get("_graphic"))===null||_itemModel$get3===void 0?void 0:(_itemModel$get3$_sizi=_itemModel$get3._sizing)===null||_itemModel$get3$_sizi===void 0?void 0:_itemModel$get3$_sizi._width)+"%"})}},{key:"preRender",value:function preRender(){var _this$model$get,_this$model$get2;_get(_getPrototypeOf(HYBHotgraphicTabsView.prototype),"preRender",this).call(this);this._hasPins=((_this$model$get=this.model.get("_graphic"))===null||_this$model$get===void 0?void 0:_this$model$get._isEnabled)||((_this$model$get2=this.model.get("_graphic"))===null||_this$model$get2===void 0?void 0:_this$model$get2.src);if(this._hasPins){this.model.getChildren().each(function(itemModel){var graphic=itemModel.get("_graphic");var sizing=_.extend({},{_top:0,_left:0,_width:100},graphic._sizing);graphic._sizing=sizing})}}},{key:"postRender",value:function postRender(){var _this=this;this._slider=Adapt.hyb.initSlider(this.$(".js-hyb-slider"),{_parent:this.model,_size:"small",_controls:{_hideNav:true,_hideProgress:true,_hideClose:true,_isExternal:false}});this.$el.imageready(function(){_this.setupItemSizing();_this.setReadyStatus()});if(this._hasPins){var debugWindow=Adapt.hyb.debug.initDebugWindow(this.model.getParent(),"hotgraphictabs");debugWindow.trackCollection(this.model.getChildren(),["_graphic._sizing._left","_graphic._sizing._top","_graphic._sizing._width"],"_item[*]._graphic._sizing")}}},{key:"isMasked",value:function isMasked(){var _this$model$get3;return Boolean((_this$model$get3=this.model.get("_graphic"))===null||_this$model$get3===void 0?void 0:_this$model$get3._mask)}},{key:"setupItemSizing",value:function setupItemSizing(){if(this._hasPins){if(this.isMasked()){Adapt.ddImg.setupImgMap(this.$(".js-hyb-hotgraphictabs-container"),{})}return}var options=this.model.get("_itemSizing");options._parent=this.model;options._itemSizings=_.map(this.model.getChildren().models,function(itemModel){return itemModel.get("_graphic")._sizing});var sizingGrid=Adapt.hyb.initSizingGrid(this.$(".js-hyb-hotgraphictabs-container"),options);sizingGrid.onReady(function(){}).onUpdate(function(){})}}]);return HYBHotgraphicTabsView}(HYBNarrative.view);HYBHotgraphicTabsView.template="hyb-hotgraphicTabs";var HYBHotgraphicTabsView$1=__AMD("components/adapt-hyb-hotgraphicTabs/js/hyb-hotgraphicTabsView",HYBHotgraphicTabsView);var HYBHotgraphicTabsModel=function(_HYBNarrative$model){_inherits(HYBHotgraphicTabsModel,_HYBNarrative$model);var _super=_createSuper(HYBHotgraphicTabsModel);function HYBHotgraphicTabsModel(){_classCallCheck(this,HYBHotgraphicTabsModel);return _super.apply(this,arguments)}_createClass(HYBHotgraphicTabsModel,[{key:"initialize",value:function initialize(){var _this$get;this.set("_speechBubbleEnabled",(((_this$get=this.get("_itemSizing"))===null||_this$get===void 0?void 0:_this$get._theme)||"").toLowerCase().includes("speechbubble"));_get(_getPrototypeOf(HYBHotgraphicTabsModel.prototype),"initialize",this).call(this)}},{key:"getDefaultItemAreas",value:function getDefaultItemAreas(wWidth){return[["","",""],["","s100",""],["","",""]]}}]);return HYBHotgraphicTabsModel}(HYBNarrative.model);var HYBHotgraphicTabsModel$1=__AMD("components/adapt-hyb-hotgraphicTabs/js/hyb-hotgraphicTabsModel",HYBHotgraphicTabsModel);__AMD("components/adapt-hyb-hotgraphicTabs/js/adapt-hyb-hotgraphicTabs",Adapt.register("hyb-hotgraphictabs",{model:HYBHotgraphicTabsModel$1,view:HYBHotgraphicTabsView$1}));var HYBMcqView=function(_QuestionView){_inherits(HYBMcqView,_QuestionView);var _super=_createSuper(HYBMcqView);function HYBMcqView(){_classCallCheck(this,HYBMcqView);return _super.apply(this,arguments)}_createClass(HYBMcqView,[{key:"events",value:function events(){return{"change .js-item-input":"onItemSelect"}}},{key:"preRender",value:function preRender(){_get(_getPrototypeOf(HYBMcqView.prototype),"preRender",this).call(this);this.setupModelData();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model.getChildren(),{"change:_isActive":this.onItemActiveChange});this.listenTo(this.model,"change:_isComplete",this.onComplete)}},{key:"setupQuestion",value:function setupQuestion(){this.model.setupRandomisation()}},{key:"setupModelData",value:function setupModelData(){}},{key:"getItemElement",value:function getItemElement(itemModel){return this.$(".js-hyb-mcq-item").filter("[data-adapt-index="+itemModel.get("_index")+"]")}},{key:"onItemSelect",value:function onItemSelect(event){if(!this.model.isInteractive())return;var index=$(event.currentTarget).data("adapt-index");var itemModel=this.model.getItem(index);var shouldSelect=!itemModel.get("_isActive");if(this.model.isSingleSelect()){shouldSelect=true;this.model.resetActiveItems()}else if(shouldSelect&&this.model.isAtActiveLimit()){this.model.getLastActiveItem().toggleActive(false)}itemModel.toggleActive(shouldSelect)}},{key:"onItemActiveChange",value:function onItemActiveChange(itemModel,isActive){var $item=this.getItemElement(itemModel);$item.toggleClass("is-selected",isActive)}},{key:"updateMarking",value:function updateMarking(model){var _this=this;this.model.getChildren().each(function(itemModel){itemModel.get("_index");var $item=_this.getItemElement(itemModel);itemModel.get("_shouldBeSelected");var isCorrect=Boolean(itemModel.get("_isCorrect"));var isActive=Boolean(itemModel.get("_isActive"));if(isActive)itemModel.set("_isVisited",true);var isVisited=Boolean(itemModel.get("_isVisited"));if(!isVisited){$item.removeClass("is-correct is-incorrect");return}if(!isActive)return;$item.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect);var $itemlabel=$item.find(".js-item-label");$itemlabel.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect)})}},{key:"onComplete",value:function onComplete(){var _this2=this;this.model.getChildren().each(function(itemModel){var $item=_this2.getItemElement(itemModel);$item.toggleClass("is-locked",true);var $itemlabel=$item.find(".js-item-label");$itemlabel.toggleClass("is-locked",true)})}},{key:"onQuestionRendered",value:function onQuestionRendered(){this.setReadyStatus();this.update()}},{key:"onCannotSubmit",value:function onCannotSubmit(){}},{key:"showMarking",value:function showMarking(){this.update();this.updateMarking()}},{key:"resetQuestion",value:function resetQuestion(){}},{key:"showCorrectAnswer",value:function showCorrectAnswer(){this.isCorrectAnswerShown=true;this.update()}},{key:"hideCorrectAnswer",value:function hideCorrectAnswer(){this.isCorrectAnswerShown=false;this.update()}},{key:"updateSelection",value:function updateSelection(){}},{key:"update",value:function update(){}}]);return HYBMcqView}(QuestionView$1);HYBMcqView.template="hyb-mcq";var HYBMCQView=__AMD("components/adapt-hyb-mcq/js/hyb-mcqView",HYBMcqView);var BlendedItemsComponentQuestionModel=function(_QuestionModel){_inherits(BlendedItemsComponentQuestionModel,_QuestionModel);var _super=_createSuper(BlendedItemsComponentQuestionModel);function BlendedItemsComponentQuestionModel(){_classCallCheck(this,BlendedItemsComponentQuestionModel);return _super.apply(this,arguments)}_createClass(BlendedItemsComponentQuestionModel,[{key:"init",value:function init(){ItemsComponentModel.prototype.init.call(this);_get(_getPrototypeOf(BlendedItemsComponentQuestionModel.prototype),"init",this).call(this)}},{key:"reset",value:function reset(type,force){ItemsComponentModel.prototype.reset.call(this,type,force);_get(_getPrototypeOf(BlendedItemsComponentQuestionModel.prototype),"reset",this).call(this,type,force)}}]);return BlendedItemsComponentQuestionModel}(QuestionModel$1);Object.getOwnPropertyNames(ItemsComponentModel.prototype).forEach(function(name){if(name==="constructor"||name==="init"||name==="reset")return;Object.defineProperty(BlendedItemsComponentQuestionModel.prototype,name,{value:ItemsComponentModel.prototype[name]})});var ItemsQuestionModel=__AMD("core/js/models/itemsQuestionModel",function(_BlendedItemsComponen){_inherits(ItemsQuestionModel,_BlendedItemsComponen);var _super2=_createSuper(ItemsQuestionModel);function ItemsQuestionModel(){_classCallCheck(this,ItemsQuestionModel);return _super2.apply(this,arguments)}_createClass(ItemsQuestionModel,[{key:"init",value:function init(){_get(_getPrototypeOf(ItemsQuestionModel.prototype),"init",this).call(this);this.set("_isRadio",this.isSingleSelect());this.listenTo(this.getChildren(),"change:_isActive",this.checkCanSubmit);this.checkCanSubmit()}},{key:"restoreUserAnswers",value:function restoreUserAnswers(){if(!this.get("_isSubmitted"))return;var itemModels=this.getChildren();var userAnswer=this.get("_userAnswer");itemModels.each(function(item){item.toggleActive(userAnswer[item.get("_index")])});this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()}},{key:"setupRandomisation",value:function setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;var children=this.getChildren();children.set(children.shuffle())}},{key:"canSubmit",value:function canSubmit(){var activeItems=this.getActiveItems();return activeItems.length>0}},{key:"storeUserAnswer",value:function storeUserAnswer(){var items=this.getChildren().slice(0);items.sort(function(a,b){return a.get("_index")-b.get("_index")});var userAnswer=items.map(function(itemModel){return itemModel.get("_isActive")});this.set("_userAnswer",userAnswer)}},{key:"isCorrect",value:function isCorrect(){var allChildren=this.getChildren();var activeChildren=allChildren.filter(function(itemModel){return itemModel.get("_isActive")});var isItemCorrect=function(itemModel){return itemModel.get("_shouldBeSelected")&&!itemModel.get("_isPartlyCorrect")};var isItemPartlyCorrect=function(itemModel){return itemModel.get("_isPartlyCorrect")};var isItemIncorrect=function(itemModel){return!itemModel.get("_shouldBeSelected")&&!itemModel.get("_isPartlyCorrect")};var sum=function(list,predicate){return list.reduce(function(sum,item){return sum+(predicate(item)?1:0)},0)};var props={_numberOfRequiredAnswers:sum(allChildren,isItemCorrect),_numberOfCorrectAnswers:sum(activeChildren,isItemCorrect),_numberOfPartlyCorrectAnswers:sum(activeChildren,isItemPartlyCorrect),_numberOfIncorrectAnswers:sum(activeChildren,isItemIncorrect)};activeChildren.forEach(function(itemModel){return itemModel.set("_isCorrect",itemModel.get("_shouldBeSelected"))});props._isAtLeastOneCorrectSelection=props._numberOfCorrectAnswers||props._numberOfPartlyCorrectAnswers;var numberOfSelectableAnswers=this.get("_selectable");var hasSelectableCorrectAnswers=props._numberOfCorrectAnswers===numberOfSelectableAnswers;var hasAllCorrectAnswers=props._numberOfCorrectAnswers===props._numberOfRequiredAnswers;var hasCorrectAnswers=hasSelectableCorrectAnswers||hasAllCorrectAnswers;var hasIncorrectAnswers=props._numberOfIncorrectAnswers;var hasPartlyCorrectAnswers=props._numberOfPartlyCorrectAnswers;this.set(props);return hasCorrectAnswers&&!hasIncorrectAnswers&&!hasPartlyCorrectAnswers}},{key:"setScore",value:function setScore(){var questionWeight=this.get("_questionWeight");var answeredCorrectly=this.get("_isCorrect");var score=answeredCorrectly?questionWeight:0;this.set("_score",score)}},{key:"setupFeedback",value:function setupFeedback(){if(!this.has("_feedback"))return;if(this.get("_isCorrect")){this.setupCorrectFeedback();return}if(this.isPartlyCorrect()){this.setupPartlyCorrectFeedback();return}var activeItem=this.getActiveItem();if(this.isSingleSelect()&&activeItem.get("feedback")){this.setupIndividualFeedback(activeItem);return}this.setupIncorrectFeedback()}},{key:"setupIndividualFeedback",value:function setupIndividualFeedback(selectedItem){this.set({feedbackTitle:this.getFeedbackTitle(this.get("_feedback")),feedbackMessage:selectedItem.get("feedback")})}},{key:"isPartlyCorrect",value:function isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")}},{key:"resetUserAnswer",value:function resetUserAnswer(){this.set("_userAnswer",[])}},{key:"isAtActiveLimit",value:function isAtActiveLimit(){var selectedItems=this.getActiveItems();return selectedItems.length===this.get("_selectable")}},{key:"isSingleSelect",value:function isSingleSelect(){return this.get("_selectable")===1}},{key:"getLastActiveItem",value:function getLastActiveItem(){var selectedItems=this.getActiveItems();return selectedItems[selectedItems.length-1]}},{key:"resetItems",value:function resetItems(){this.resetActiveItems();this.set("_isAtLeastOneCorrectSelection",false)}},{key:"getInteractionObject",value:function getInteractionObject(){var interactions={correctResponsesPattern:[],choices:[]};interactions.choices=this.getChildren().map(function(itemModel){return{id:(itemModel.get("_index")+1).toString(),description:itemModel.get("text")}});var correctItems=this.getChildren().filter(function(itemModel){return itemModel.get("_shouldBeSelected")});interactions.correctResponsesPattern=[correctItems.map(function(itemModel){return String(itemModel.get("_index")+1)}).join("[,]")];return interactions}},{key:"getResponse",value:function getResponse(){var activeItems=this.getActiveItems();var activeIndexes=activeItems.map(function(itemModel){return itemModel.get("_index")+1});return activeIndexes.join(",")}},{key:"getResponseType",value:function getResponseType(){return"choice"}},{key:"getCorrectAnswerAsText",value:function getCorrectAnswerAsText(){var globals=Adapt.course.get("_globals")._components["_"+this.get("_component")];var ariaAnswer;var correctAnswer;if(this.isSingleSelect()){ariaAnswer=globals.ariaCorrectAnswer;var correctOption=this.getChildren().findWhere({_shouldBeSelected:true});correctAnswer=correctOption.get("text")}else{ariaAnswer=globals.ariaCorrectAnswers;var correctOptions=this.getChildren().where({_shouldBeSelected:true});correctAnswer=correctOptions.map(function(correctOption){return correctOption.get("text")}).join("<br/>")}return Handlebars.compile(ariaAnswer)({correctAnswer:correctAnswer})}},{key:"getUserAnswerAsText",value:function getUserAnswerAsText(){var globals=Adapt.course.get("_globals")._components["_"+this.get("_component")];var ariaAnswer;var userAnswer;var selectedItems=this.getActiveItems();if(selectedItems.length===1){ariaAnswer=globals.ariaUserAnswer;userAnswer=selectedItems[0].get("text")}else{ariaAnswer=globals.ariaUserAnswers;userAnswer=selectedItems.map(function(selectedItem){return selectedItem.get("text")}).join("<br/>")}return Handlebars.compile(ariaAnswer)({userAnswer:userAnswer})}}]);return ItemsQuestionModel}(BlendedItemsComponentQuestionModel));var HYBMcqModel=function(_ItemsQuestionModel){_inherits(HYBMcqModel,_ItemsQuestionModel);var _super=_createSuper(HYBMcqModel);function HYBMcqModel(){_classCallCheck(this,HYBMcqModel);return _super.apply(this,arguments)}_createClass(HYBMcqModel,[{key:"initialize",value:function initialize(){var _this=this;this.set("_selectable",this.get("_isRadio")?1:this.get("_items").length);if(this.isSingleSelect()){_.each(this.get("_items"),function(item){if(item._feedback){if(!item._feedback.title)delete item._feedback.title;if(!item._feedback.body)delete item._feedback.body;if(!item._feedback.instruction)delete item._feedback.instruction}if(item._shouldBeSelected){item._feedback=_.extend({},_this.get("_feedback")._correct,item._feedback)}else{item._feedback=_.extend({},_this.get("_feedback")._incorrect,item._feedback)}item.feedback=item._feedback});var itemCorrectFeedback=_.find(this.get("_items"),function(item){return item._shouldBeSelected})._feedback;var globalCorrectFeedback=this.get("_feedback")._correct;this.get("_feedback")._correct={title:(itemCorrectFeedback===null||itemCorrectFeedback===void 0?void 0:itemCorrectFeedback.title)||(globalCorrectFeedback===null||globalCorrectFeedback===void 0?void 0:globalCorrectFeedback.title),body:(itemCorrectFeedback===null||itemCorrectFeedback===void 0?void 0:itemCorrectFeedback.body)||(globalCorrectFeedback===null||globalCorrectFeedback===void 0?void 0:globalCorrectFeedback.body)}}ItemsQuestionModel.prototype.initialize.apply(this,arguments)}},{key:"setupIndividualFeedback",value:function setupIndividualFeedback(selectedItem){var _selectedItem$get;if(this.get("_isCorrect"))return;if(!this.isSingleSelect())return;var itemFeedback=selectedItem.get("_feedback");this.get("_feedback")._incorrect=_.extend({},this.get("_feedback")._incorrect,itemFeedback);Adapt.questionPlus.setUpFeedback(this);this.set({feedbackTitle:((_selectedItem$get=selectedItem.get("_feedback"))===null||_selectedItem$get===void 0?void 0:_selectedItem$get.title)||this.getFeedbackTitle(this.get("_feedback")),feedbackMessage:this.get("_feedback")._incorrect.final})}}]);return HYBMcqModel}(ItemsQuestionModel);var HYBMCQModel=__AMD("components/adapt-hyb-mcq/js/hyb-mcqModel",HYBMcqModel);__AMD("components/adapt-hyb-mcq/js/adapt-hyb-mcq",Adapt.register("hyb-mcq",{model:HYBMCQModel,view:HYBMCQView}));var HYBMediaView=function(_ComponentView){_inherits(HYBMediaView,_ComponentView);var _super=_createSuper(HYBMediaView);function HYBMediaView(){_classCallCheck(this,HYBMediaView);return _super.apply(this,arguments)}_createClass(HYBMediaView,[{key:"events",value:function events(){return{}}},{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBMediaView.prototype),"initialize",this).call(this)}},{key:"preRender",value:function preRender(){this.setupModelData();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){}},{key:"setupModelData",value:function setupModelData(){}},{key:"postRender",value:function postRender(){var _this=this;this.$el.imageready(function(){_this.setReadyStatus();_this.setupVideoListeners()})}},{key:"setupVideoListeners",value:function setupVideoListeners(){var videoModel=Adapt.ddVideo.getVideoModel(this.$(".js-media-video"));if(!videoModel)throw"hyb-mediaView.js: could not find videoModel in view!";this.listenToOnce(videoModel,{"change:_isPlaying":this.onVideoPlayingChange})}},{key:"onVideoPlayingChange",value:function onVideoPlayingChange(model,isPlaying){this.setCompletionStatus()}}]);return HYBMediaView}(ComponentView$1);HYBMediaView.template="hyb-media";var HYBMediaView$1=__AMD("components/adapt-hyb-media/js/hyb-mediaView",HYBMediaView);var HYBMediaModel=function(_ComponentModel){_inherits(HYBMediaModel,_ComponentModel);var _super=_createSuper(HYBMediaModel);function HYBMediaModel(){_classCallCheck(this,HYBMediaModel);return _super.apply(this,arguments)}_createClass(HYBMediaModel,[{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBMediaModel.prototype),"initialize",this).call(this)}}]);return HYBMediaModel}(ComponentModel$1);var HYBMediaModel$1=__AMD("components/adapt-hyb-media/js/hyb-mediaModel",HYBMediaModel);__AMD("components/adapt-hyb-media/js/adapt-hyb-media",Adapt.register("hyb-media",{model:HYBMediaModel$1,view:HYBMediaView$1}));var HYBPresentationView=function(_ComponentView){_inherits(HYBPresentationView,_ComponentView);var _super=_createSuper(HYBPresentationView);function HYBPresentationView(){_classCallCheck(this,HYBPresentationView);return _super.apply(this,arguments)}_createClass(HYBPresentationView,[{key:"events",value:function events(){return{"click .js-hyb-presentation-splash-btn":"onSplashBtnClick"}}},{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBPresentationView.prototype),"initialize",this).call(this)}},{key:"preRender",value:function preRender(){this.setupModelData();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){}},{key:"setupModelData",value:function setupModelData(){}},{key:"onSplashBtnClick",value:function onSplashBtnClick(){this.getVideoModel().play(0)}},{key:"hideSplash",value:function hideSplash(){var $splash=this.$(".js-hyb-presentation-splash");$splash.fadeOut();this.$el.removeClass("is-splash-active")}},{key:"postRender",value:function postRender(){var _this=this;this.$el.addClass("is-splash-active");this.$el.imageready(function(){_this.setReadyStatus();_this.setupVideoListeners()})}},{key:"getVideoModel",value:function getVideoModel(){var videoModel=Adapt.ddVideo.getVideoModel(this.$(".js-presentation-video"));if(!videoModel)throw"hyb-presentationView.js: could not find videoModel in view!";return videoModel}},{key:"setupVideoListeners",value:function setupVideoListeners(){var videoModel=this.getVideoModel();this.listenTo(videoModel,{"change:_isEnded":this.onVideoEndedChange});this.listenToOnce(videoModel,{"change:_isPlaying":this.onVideoPlayingChange})}},{key:"onVideoEndedChange",value:function onVideoEndedChange(model,isEnded){this.$(".js-hyb-presentation-video-container").toggleClass("is-ended",isEnded);this.setCompletionStatus()}},{key:"onVideoPlayingChange",value:function onVideoPlayingChange(model,isPlaying){this.hideSplash();this.$(".js-hyb-presentation-sectionbanner").fadeOut()}}]);return HYBPresentationView}(ComponentView$1);HYBPresentationView.template="hyb-presentation";var HYBPresentationView$1=__AMD("components/adapt-hyb-presentation/js/hyb-presentationView",HYBPresentationView);var HYBPresentationModel=function(_ComponentModel){_inherits(HYBPresentationModel,_ComponentModel);var _super=_createSuper(HYBPresentationModel);function HYBPresentationModel(){_classCallCheck(this,HYBPresentationModel);return _super.apply(this,arguments)}_createClass(HYBPresentationModel,[{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBPresentationModel.prototype),"initialize",this).call(this);if(this.get("_content")===undefined){var content={title:this.get("title"),body:this.get("body"),_items:this.get("_items"),_invertColor:this.get("_invertColor"),_columns:this.get("_columns")};this.set("_content",content);this.set("_items","");this.set("_columns","");this.set("title","");this.set("body","")}if(!this.get("title")){this.set("title","Overview")}if(!this.get("_content").title){this.get("_content").title="Let's look at what you will learn on completion of this unit."}}}]);return HYBPresentationModel}(ComponentModel$1);var HYBPresentationModel$1=__AMD("components/adapt-hyb-presentation/js/hyb-presentationModel",HYBPresentationModel);__AMD("components/adapt-hyb-presentation/js/adapt-hyb-presentation",Adapt.register("hyb-presentation",{model:HYBPresentationModel$1,view:HYBPresentationView$1}));var HYBRecipePlusModel=function(_ComponentModel){_inherits(HYBRecipePlusModel,_ComponentModel);var _super=_createSuper(HYBRecipePlusModel);function HYBRecipePlusModel(){_classCallCheck(this,HYBRecipePlusModel);return _super.apply(this,arguments)}_createClass(HYBRecipePlusModel,[{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBRecipePlusModel.prototype),"initialize",this).call(this);Adapt.on("router:page",this.setupData.bind(this))}},{key:"setupData",value:function setupData(){var recipeId=this.get("_recipeId");var pageModel=Adapt.findById(Adapt.location._currentId);var recipes=pageModel.get("_menuData")._recipes;var recipeData=_.find(recipes._items,function(g){return g._id==recipeId});if(!recipeData){Adapt.log.error("adapt-hyb-recipePlus: Could not find recipe in contentObjects.json with \"_id\": \"".concat(recipeId,"\""));return}var data=_.extend({_graphic:{src:"course/en/images/recipes/".concat(recipeId,".jpg")}},recipeData,{num:"#"+recipeData._id});this.set("_content",data)}}]);return HYBRecipePlusModel}(ComponentModel$3);var HYBRecipePlusView=function(_ComponentView){_inherits(HYBRecipePlusView,_ComponentView);var _super2=_createSuper(HYBRecipePlusView);function HYBRecipePlusView(){_classCallCheck(this,HYBRecipePlusView);return _super2.apply(this,arguments)}_createClass(HYBRecipePlusView,[{key:"preRender",value:function preRender(){}},{key:"postRender",value:function postRender(){var _this=this;this.$el.imageready(function(){_this.setReadyStatus();_this.setCompletionStatus()});if(!Adapt.isDebugEnabled())return;var heading=this.model.get("_content").heading;if(heading){var $block=this.$el.closest(".block");$block.before("<div class=\"debug hyb-recipeplus__debug-heading\">".concat(this.model.get("_content").heading,"</div>"))}}}]);return HYBRecipePlusView}(ComponentView$1);HYBRecipePlusView.template="hyb-recipePlus";__AMD("components/adapt-hyb-recipePlus/js/adapt-hyb-recipeplus",Adapt.register("hyb-recipeplus",{model:HYBRecipePlusModel,view:HYBRecipePlusView}));var JITTER_THRESHOLD=1;var VIEWPORT_SCROLL_THRESHOLD=0.175;var VIEWPORT_SCROLL_SPEED=10;var ReorderView=function(_QuestionView){_inherits(ReorderView,_QuestionView);var _super=_createSuper(ReorderView);function ReorderView(){_classCallCheck(this,ReorderView);return _super.apply(this,arguments)}_createClass(ReorderView,[{key:"events",value:function events(){return{"mousedown .js-reorder-item":"onItemMousedown","touchstart .js-reorder-item":"onItemMousedown","mouseup .js-reorder-item":"onItemMouseup","touchend .js-reorder-item":"onItemMouseup"}}},{key:"initialize",value:function initialize(){this.itemCount=this.model.getChildren().length;this.itemElementTopCache=new Array(this.itemCount);QuestionView$1.prototype.initialize.apply(this,arguments);this.update=_.debounce(this.update.bind(this),1);this.updateLabels=_.debounce(this.updateLabels,0);this.listenTo(this.model,{"change:_isEnabled change:_isComplete change:_isSubmitted":this.update})}},{key:"resetQuestionOnRevisit",value:function resetQuestionOnRevisit(){this.resetQuestion()}},{key:"setupQuestion",value:function setupQuestion(){this.model.setupRandomisation()}},{key:"postRender",value:function postRender(){QuestionView$1.prototype.postRender.apply(this,arguments);this.renderItems();this.updateMarking();this.setUpEventListeners();this.updateLabels();this.setReadyStatus()}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenTo(this.model.getChildren(),{"change:_isGrabbed":this.onItemGrabbedChange,"change:_userIndex":this.onItemUserIndexChange,"change:_isVisited":this.onItemVisitedChange,"change:_isCorrect":this.onItemCorrectChange,"change:_isLocked":this.onItemLockedChange,"change:_positionTop":this.onItemPositionTopChange})}},{key:"onItemMousedown",value:function onItemMousedown(event){var itemModel=this.getItemModel($(event.currentTarget));if(itemModel.get("_isLocked"))return;$(event.currentTarget).addClass("is-grabbed")}},{key:"onItemMouseup",value:function onItemMouseup(event){var itemModel=this.getItemModel($(event.currentTarget));if(itemModel.get("_isLocked")||itemModel.get("_isGrabbed"))return;$(event.currentTarget).removeClass("is-grabbed")}},{key:"getItemModel",value:function getItemModel($itemElement){var index=$itemElement.attr("data-adapt-index");return this.model.getChildren().find(function(itemModel){return itemModel.get("_index")==index})}},{key:"getItemElement",value:function getItemElement(itemModel){return this.$(".js-reorder-item").filter("[data-adapt-index="+itemModel.get("_index")+"]")}},{key:"onItemGrabbedChange",value:function onItemGrabbedChange(itemModel,isGrabbed){var $item=this.getItemElement(itemModel);$item.toggleClass("is-grabbed",isGrabbed)}},{key:"onItemVisitedChange",value:function onItemVisitedChange(itemModel,isVisited){var $item=this.getItemElement(itemModel);$item.toggleClass("is-visited",isVisited)}},{key:"onItemLockedChange",value:function onItemLockedChange(itemModel,isLocked){var $item=this.getItemElement(itemModel);$item.toggleClass("is-disabled",isLocked);this.getItemElement(itemModel).draggable("option","disabled",isLocked)}},{key:"onItemCorrectChange",value:function onItemCorrectChange(itemModel,isCorrect){var $item=this.getItemElement(itemModel);$item.toggleClass("is-correct",isCorrect===true).toggleClass("is-incorrect",isCorrect===false)}},{key:"onItemUserIndexChange",value:function onItemUserIndexChange(itemModel,userIndex){var _this$model$get;var $item=this.getItemElement(itemModel);$item.attr("data-adapt-user-index",userIndex);if(!((_this$model$get=this.model.get("_labels"))!==null&&_this$model$get!==void 0&&_this$model$get._isNumbered))return;this.updateLabels()}},{key:"updateLabels",value:function updateLabels(){var _this$model$get2;if(!((_this$model$get2=this.model.get("_labels"))!==null&&_this$model$get2!==void 0&&_this$model$get2._isNumbered))return;var $labelsContainer=this.$(".js-reoder-labels-container");var $items=this.$(".js-reorder-item");var heights=[];$items.each(function(i,e){var $el=$(e);var idx=$el.attr("data-adapt-user-index");heights[idx]=$(e).outerHeight()+"px"});$labelsContainer.css({"grid-template-rows":heights.join(" ")})}},{key:"onItemPositionTopChange",value:function onItemPositionTopChange(itemModel,positionTop){if(itemModel.get("_isGrabbed"))return;var $item=this.getItemElement(itemModel);_.debounce(function(){var translate=positionTop-$item.position().top;translate=Math.abs(translate)<JITTER_THRESHOLD?0:translate;if(translate){$item.find(".js-reorder-item-transform").css("transform","translateY("+translate+"px)")}else{$item.find(".js-reorder-item-transform").css("transform","")}},0)()}},{key:"renderItems",value:function renderItems(){var _this=this;this.model.getChildren().each(function(itemModel){_this.setUpItem(itemModel);_this.getItemElement(itemModel).draggable("option","disabled",itemModel.get("_isLocked"))})}},{key:"refreshItemElementTopCache",value:function refreshItemElementTopCache(){var _this2=this;var top=0;this.model.getChildren().each(function(itemModel,index){_this2.itemElementTopCache[index]=top;top+=_this2.getItemElement(itemModel).outerHeight()})}},{key:"getItemElementTop",value:function getItemElementTop(itemModel){return this.itemElementTopCache[itemModel.get("_userIndex")]}},{key:"_getFirstEmptyIdx",value:function _getFirstEmptyIdx(arr){var idx=0;while(arr[idx]){idx++;if(idx>=arr.length)throw"Unexpected error has occured: idx out of range of arr (there are no falsy elements)"}return idx}},{key:"setUpItem",value:function setUpItem(itemModel){var _this3=this;var $item=this.getItemElement(itemModel);var curTop;var lastTop;var children;var offsetY=0;$item.draggable({containment:this.$(".js-reorder-containment"),scroll:false,start:function(event,ui){itemModel.set("_isGrabbed",true);_this3.$(".js-reorder-item");offsetY=0;var top=$item.position().top;curTop=top;lastTop=top;children=_this3.model.getChildren();children.sort()},drag:_.throttle(function(event,ui){_this3.refreshItemElementTopCache();itemModel.set("_isGrabbed",true);var bb=$item[0].getBoundingClientRect();offsetY+=_this3.scrollPage($item,dir,bb.top,bb.bottom);ui.position.top+=offsetY;$item.css("top",ui.position.top);curTop=$item.position().top;var movement=curTop-lastTop;var dir=movement==0?0:movement<0?-1:1;lastTop=curTop;if(dir==0)return;var newItemOrder=new Array(_this3.itemCount);var itemsAbove=[];var itemsBelow=[];children.each(function(item){if(!item.get("_isLocked"))return;newItemOrder[item.get("_index")]=item});var curMiddle=curTop+$item.outerHeight()/2;if(dir>0){children.each(function(eModel){if(eModel==itemModel)return;if(eModel.get("_isLocked"))return;var eTop=_this3.getItemElementTop(eModel);if(eTop<curMiddle)itemsAbove.push(eModel);else itemsBelow.push(eModel)})}else{children.each(function(eModel){if(eModel==itemModel)return;if(eModel.get("_isLocked"))return;var eBottom=_this3.getItemElementTop(eModel)+_this3.getItemElement(eModel).outerHeight();if(eBottom>curMiddle)itemsBelow.push(eModel);else itemsAbove.push(eModel)})}_.each(itemsAbove,function(item){newItemOrder[_this3._getFirstEmptyIdx(newItemOrder)]=item});newItemOrder[_this3._getFirstEmptyIdx(newItemOrder)]=itemModel;_.each(itemsBelow,function(item){newItemOrder[_this3._getFirstEmptyIdx(newItemOrder)]=item});_.each(newItemOrder,function(item,index){item.set("_userIndex",index)});_this3.model.getChildren().sort();_.each(newItemOrder,function(item,index){item.set("_positionTop",_this3.getItemElementTop(item))})},1),stop:function(){var $container=_this3.$(".js-reorder-items-container");var itemGrabbedTop=$item.offset().top;_this3.model.getChildren().each(function(item){var $item=_this3.getItemElement(item);$item.find(".js-reorder-item-transform").css("transform","");$item.css("top","");$container.append($item)});var itemGrabbedOffset=itemGrabbedTop-$item.offset().top;$item.addClass("is-grabbed").find(".js-reorder-item-transform").css("top",itemGrabbedOffset+"px").hide(0).show(0);_.debounce(function(){$item.find(".js-reorder-item-transform").css("top","0");itemModel.set("_isGrabbed",false)},0)()},axis:"y"})}},{key:"scrollPage",value:function scrollPage($item,dragDir,draggableTop,draggableBottom){var bb=this.$(".js-reorder-containment")[0].getBoundingClientRect();if(draggableTop<bb.top){return bb.top-draggableTop}if(draggableBottom>bb.bottom){return bb.bottom-draggableBottom}var pageY=draggableTop+(draggableBottom-draggableTop)/2;var screenHeight=Adapt.device.screenHeight;var dir=0;if(pageY<screenHeight*VIEWPORT_SCROLL_THRESHOLD)dir=-1;else if(pageY>screenHeight-screenHeight*VIEWPORT_SCROLL_THRESHOLD)dir=1;if(dir==0)return 0;$.scrollTo(dir>0?"+="+VIEWPORT_SCROLL_SPEED+"px":"-="+VIEWPORT_SCROLL_SPEED+"px",{});return dir*VIEWPORT_SCROLL_SPEED}},{key:"onQuestionRendered",value:function onQuestionRendered(){this.update()}},{key:"onCannotSubmit",value:function onCannotSubmit(){}},{key:"showMarking",value:function showMarking(){this.update();this.updateMarking()}},{key:"resetQuestion",value:function resetQuestion(){return}},{key:"showCorrectAnswer",value:function showCorrectAnswer(){this.isCorrectAnswerShown=true;this.update()}},{key:"hideCorrectAnswer",value:function hideCorrectAnswer(){this.isCorrectAnswerShown=false;this.update()}},{key:"update",value:function update(model){}},{key:"updateSelection",value:function updateSelection(){}},{key:"updateMarking",value:function updateMarking(){}}]);return ReorderView}(QuestionView$1);var ReorderView$1=__AMD("components/adapt-reorder/js/reorderView",ReorderView);var ReorderItemModel=function(_Backbone$Model){_inherits(ReorderItemModel,_Backbone$Model);var _super=_createSuper(ReorderItemModel);function ReorderItemModel(){_classCallCheck(this,ReorderItemModel);return _super.apply(this,arguments)}_createClass(ReorderItemModel,[{key:"defaults",value:function defaults(){return{_index:-1,_userIndex:-1,_isCorrect:false,_isLocked:false,_isVisited:false,_visitedIndexes:[],_isGrabbed:false,_positionTop:0}}},{key:"initialize",value:function initialize(){this.setUpEventListeners()}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenTo(this,"change:_userIndex",this.onUserIndexChange)}},{key:"onUserIndexChange",value:function onUserIndexChange(model,userIndex){var isVisited=_.includes(this.get("_visitedIndexes"),userIndex);this.set("_isVisited",isVisited);if(!isVisited){this.set("_isCorrect",undefined);return}this.set("_isCorrect",this.get("_index")==this.get("_userIndex"))}},{key:"setVisited",value:function setVisited(){var visitedIndexes=this.get("_visitedIndexes");var userIndex=this.get("_userIndex");if(_.includes(visitedIndexes,userIndex))return;visitedIndexes.push(userIndex)}}]);return ReorderItemModel}(Backbone.Model);var ReorderItemModel$1=__AMD("components/adapt-reorder/js/reorderItemModel",ReorderItemModel);var ReorderItemCollection=function(_Backbone$Collection){_inherits(ReorderItemCollection,_Backbone$Collection);var _super=_createSuper(ReorderItemCollection);function ReorderItemCollection(){_classCallCheck(this,ReorderItemCollection);return _super.apply(this,arguments)}_createClass(ReorderItemCollection,[{key:"comparator",value:function comparator(item){return item.get("_userIndex")}}]);return ReorderItemCollection}(Backbone.Collection);var ReorderItemCollection$1=__AMD("components/adapt-reorder/js/reorderItemCollection",ReorderItemCollection);var ReorderModel=function(_QuestionModel){_inherits(ReorderModel,_QuestionModel);var _super=_createSuper(ReorderModel);function ReorderModel(){_classCallCheck(this,ReorderModel);return _super.apply(this,arguments)}_createClass(ReorderModel,[{key:"toJSON",value:function toJSON(){var json=_get(_getPrototypeOf(ReorderModel.prototype),"toJSON",this).call(this);json._items=this.getChildren().toJSON();return json}},{key:"init",value:function init(){QuestionModel$1.prototype.init.call(this);this.setUpLabels();this.setUpItems();this.checkCanSubmit()}},{key:"setUpLabels",value:function setUpLabels(){var legacyHeader=this.get("header");var legacyFooter=this.get("footer");if(legacyHeader||legacyFooter){Adapt.log.deprecated("reorderModel.js: \"header\" and \"footer\" properties are now defined in the \"_labels\" object.")}var labels=this.get("_labels")||{};labels=_.extend({},{header:legacyHeader,footer:legacyFooter},labels);if(labels._isNumbered!==undefined&&labels._isNumbered!==false){var count=labels._isNumbered===true?1:labels._isNumbered;var items=this.get("_items");var labelItems=[];items.forEach(function(item,index){labelItems.push({text:count+"."});count++});if(labels._items===undefined){labels._items=labelItems}}this.set("_labels",labels)}},{key:"setUpItems",value:function setUpItems(){var items=this.get("_items")||[];items.forEach(function(item,index){item._index=index});this.setChildren(new ReorderItemCollection$1(items,{model:ReorderItemModel$1}))}},{key:"setupRandomisation",value:function setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;var children=this.getChildren();children.reset(children.shuffle(),{silent:true});var temp=new Array(children.length);children.each(function(item,index){if(!item.get("_isLocked"))return;temp[item.get("_index")]=item});children.each(function(item,index){if(item.get("_isLocked"))return;temp[_.indexOf(temp,undefined)]=item});_.each(temp,function(item,index){item.set("_userIndex",index)});children.sort()}},{key:"canSubmit",value:function canSubmit(){return true}},{key:"isCorrect",value:function isCorrect(){var props={_numberOfIncorrectAnswers:0,_numberOfCorrectAnswers:0,_isAtLeastOneCorrectAnswer:false};this.getChildren().each(function(item){var isCorrect=Boolean(item.get("_index")==item.get("_userIndex"));item.set("_isCorrect",isCorrect);item.set("_isLocked",isCorrect);item.setVisited();if(isCorrect){props._numberOfCorrectAnswers++;props._isAtLeastOneCorrectAnswer=true}else{props._numberOfIncorrectAnswers++}});this.set(props);return props._numberOfIncorrectAnswers===0}},{key:"setScore",value:function setScore(){var questionWeight=this.get("_questionWeight");if(this.get("_isCorrect")){this.set("_score",questionWeight);return}var numberOfCorrectAnswers=this.get("_numberOfCorrectAnswers");var itemLength=this.getChildren().length;var score=questionWeight*numberOfCorrectAnswers/itemLength;this.set("_score",score)}},{key:"isPartlyCorrect",value:function isPartlyCorrect(){return this.get("_isAtLeastOneCorrectAnswer")}},{key:"resetUserAnswer",value:function resetUserAnswer(){this.set("_userAnswer",[])}},{key:"restoreUserAnswers",value:function restoreUserAnswers(){if(!this.get("_isSubmitted"))return;var userAnswer=this.get("_userAnswer");this.set("_items",_.sortBy(this.get("_items"),function(item,index){item.set("_userAnswer",userAnswer[index]);return userAnswer[index]}));this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()}},{key:"storeUserAnswer",value:function storeUserAnswer(){var userAnswer=new Array(this.getChildren().length);var tempUserAnswer=new Array(this.getChildren().length);this.getChildren().each(function(item,index){tempUserAnswer[item._index]=item.get("_userAnswer");userAnswer[item._index]=item.get("_userAnswer")},this);this.set({"_userAnswer":userAnswer,"_tempUserAnswer":tempUserAnswer})}},{key:"getResponse",value:function getResponse(){var responses=[];_.each(this.get("_userAnswer"),function(userAnswer,index){responses.push(userAnswer+1)});return responses.join("#")}},{key:"getResponseType",value:function getResponseType(){return"sequencing"}}]);return ReorderModel}(QuestionModel$1);var ReorderModel$1=__AMD("components/adapt-reorder/js/reorderModel",ReorderModel);var Reorder=__AMD("components/adapt-reorder/js/adapt-reorder",Adapt.register("reorder",{view:ReorderView$1,model:ReorderModel$1}));var HYBReorderView=function(_Reorder$view){_inherits(HYBReorderView,_Reorder$view);var _super=_createSuper(HYBReorderView);function HYBReorderView(){_classCallCheck(this,HYBReorderView);return _super.apply(this,arguments)}_createClass(HYBReorderView,[{key:"scrollPage",value:function scrollPage(){return 0}}]);return HYBReorderView}(Reorder.view);HYBReorderView.template="hyb-reorder";var HYBReorderView$1=__AMD("components/adapt-hyb-reorder/js/hyb-reorderView",HYBReorderView);var HYBReorderModel=function(_Reorder$model){_inherits(HYBReorderModel,_Reorder$model);var _super=_createSuper(HYBReorderModel);function HYBReorderModel(){_classCallCheck(this,HYBReorderModel);return _super.apply(this,arguments)}_createClass(HYBReorderModel,[{key:"isPartlyCorrect",value:function isPartlyCorrect(){this.set("_isPartlyCorrect",false);this.set("_isAtLeastOneCorrectSelection",false);return false}}]);return HYBReorderModel}(Reorder.model);var HYBReorderModel$1=__AMD("components/adapt-hyb-reorder/js/hyb-reorderModel",HYBReorderModel);__AMD("components/adapt-hyb-reorder/js/adapt-hyb-reorder",Adapt.register("hyb-reorder",{model:HYBReorderModel$1,view:HYBReorderView$1}));var HYBStaticView=function(_ComponentView){_inherits(HYBStaticView,_ComponentView);var _super=_createSuper(HYBStaticView);function HYBStaticView(){_classCallCheck(this,HYBStaticView);return _super.apply(this,arguments)}_createClass(HYBStaticView,[{key:"preRender",value:function preRender(){}},{key:"postRender",value:function postRender(){var _this=this;this.$el.imageready(function(){_this.setReadyStatus();_this.model.setCompletionStatus()})}}]);return HYBStaticView}(ComponentView$1);HYBStaticView.template="hyb-static";var HYBStaticView$1=__AMD("components/adapt-hyb-static/js/hyb-staticView",HYBStaticView);var HYBStaticModel=function(_ItemsComponentModel){_inherits(HYBStaticModel,_ItemsComponentModel);var _super=_createSuper(HYBStaticModel);function HYBStaticModel(){_classCallCheck(this,HYBStaticModel);return _super.apply(this,arguments)}return _createClass(HYBStaticModel)}(ItemsComponentModel);var HYBStaticModel$1=__AMD("components/adapt-hyb-static/js/hyb-staticModel",HYBStaticModel);var HYBStatic=__AMD("components/adapt-hyb-static/js/adapt-hyb-static",Adapt.register("hyb-static",{model:HYBStaticModel$1,view:HYBStaticView$1}));var HYBStaticIntroView=ComponentView$1.extend({preRender:function(){},postRender:function(){var _this=this;this.$el.imageready(function(){_this.setReadyStatus();_this.setCompletionStatus();_this.$el.addClass("is-ready").toggleClass("has-sectionbanner",Boolean(_this.model.get("sectionBanner")))})}});HYBStaticIntroView.template="hyb-staticIntro";__AMD("components/adapt-hyb-staticIntro/js/adapt-hyb-staticIntro",Adapt.register("hyb-staticintro",{model:ComponentModel$3.extend({}),view:HYBStaticIntroView}));var HYBStaticLabelsView=function(_ComponentView){_inherits(HYBStaticLabelsView,_ComponentView);var _super=_createSuper(HYBStaticLabelsView);function HYBStaticLabelsView(){_classCallCheck(this,HYBStaticLabelsView);return _super.apply(this,arguments)}_createClass(HYBStaticLabelsView,[{key:"preRender",value:function preRender(){}},{key:"postRender",value:function postRender(){var _this=this;this.$el.imageready(function(){_this.setupItemSizing();_this.setReadyStatus();_this.setCompletionStatus()})}},{key:"setupItemSizing",value:function setupItemSizing(){var _this2=this;var options=this.model.get("_itemSizing");options._parent=this.model;options._itemSizings=_.map(this.model.getChildren().models,function(itemModel){return itemModel.get("_graphic")._sizing});var sizingGrid=Adapt.hyb.initSizingGrid(this.$(".js-hyb-staticlabels-grid"),options);sizingGrid.onReady(function(){_this2.setupContentSizing()}).onUpdate(function(){_this2.setupContentSizing()})}},{key:"setupContentSizing",value:function setupContentSizing(){var $container=this.$(".js-hyb-staticlabels-grid");var $items=this.$(".js-hyb-staticlabels-item");var margin=Infinity;$items.each(function(i,e){margin=Math.min(margin,$(e).actual("offset").left-$container.actual("offset").left)});var $content=this.$(".js-hyb-staticlabels-content");$content.css({"margin-left":-margin,"margin-right":-margin});var contentHeight=0;$content.each(function(i,e){contentHeight=Math.max($(e).outerHeight(),contentHeight)});$content.css({height:contentHeight})}}]);return HYBStaticLabelsView}(ComponentView$1);HYBStaticLabelsView.template="hyb-staticLabels";__AMD("components/adapt-hyb-staticLabels/js/adapt-hyb-staticLabels",Adapt.register("hyb-staticlabels",{model:ItemsComponentModel.extend({}),view:HYBStaticLabelsView}));var HYBTabsView=function(_HYBNarrative$view){_inherits(HYBTabsView,_HYBNarrative$view);var _super=_createSuper(HYBTabsView);function HYBTabsView(){_classCallCheck(this,HYBTabsView);return _super.apply(this,arguments)}_createClass(HYBTabsView,[{key:"initialize",value:function initialize(itemModel,isActive){var _this=this;_get(_getPrototypeOf(HYBTabsView.prototype),"initialize",this).call(this);this.listenToOnce(this.model.getChildren(),{"change:_isActive":function(){var _this$model$get;(_this$model$get=_this.model.get("_hybBackground"))===null||_this$model$get===void 0?void 0:_this$model$get.blur()}})}},{key:"postRender",value:function postRender(){var _this$model$get2,_this2=this;var tabsEnabled=Boolean((_this$model$get2=this.model.get("_tabs"))===null||_this$model$get2===void 0?void 0:_this$model$get2._isEnabled);this.$el.toggleClass("has-tabs",tabsEnabled).toggleClass("has-narrative",!tabsEnabled).addClass(Handlebars.getThemeStr(this.model.get("_theme")));this._slider=Adapt.hyb.initSlider(this.$(".js-hyb-slider"),{_parent:this.model,_size:"small",_controls:{_hideNav:tabsEnabled,_hideProgress:tabsEnabled,_hideClose:true,_isExternal:!tabsEnabled}});this.$el.imageready(function(){_this2.setReadyStatus()})}}]);return HYBTabsView}(HYBNarrative.view);HYBTabsView.template="hyb-tabs";var HYBTabsView$1=__AMD("components/adapt-hyb-tabs/js/hyb-tabsView",HYBTabsView);var HYBTabsModel=function(_HYBNarrative$model){_inherits(HYBTabsModel,_HYBNarrative$model);var _super=_createSuper(HYBTabsModel);function HYBTabsModel(){_classCallCheck(this,HYBTabsModel);return _super.apply(this,arguments)}return _createClass(HYBTabsModel)}(HYBNarrative.model);var HYBTabsModel$1=__AMD("components/adapt-hyb-tabs/js/hyb-tabsModel",HYBTabsModel);var HYBTabs=__AMD("components/adapt-hyb-tabs/js/adapt-hyb-tabs",Adapt.register("hyb-tabs",{model:HYBTabsModel$1,view:HYBTabsView$1}));var HYBTabsFullView=function(_HYBTabs$view){_inherits(HYBTabsFullView,_HYBTabs$view);var _super=_createSuper(HYBTabsFullView);function HYBTabsFullView(){_classCallCheck(this,HYBTabsFullView);return _super.apply(this,arguments)}_createClass(HYBTabsFullView,[{key:"initialize",value:function initialize(itemModel,isActive){_get(_getPrototypeOf(HYBTabsFullView.prototype),"initialize",this).call(this)}},{key:"postRender",value:function postRender(){_get(_getPrototypeOf(HYBTabsFullView.prototype),"postRender",this).call(this);this.model.setActiveItem(0);this.checkStickyElements();if(!Adapt.isDebugEnabled())return;var $w=this.$(".hyb-tabsfull__w").first();$w.children(".js-hyb-figure-item-inner").attr("data-debug-width",$w.width()).attr("data-debug-height",$w.height())}},{key:"checkStickyElements",value:function checkStickyElements(){var _this=this;var stickyElement=this.model.get("_stickyElement");if(!stickyElement||stickyElement._isEnabled===false)return;var $items=this.$(".js-hyb-item-content");$items.each(function(i,e){var $item=$(e);var $se=$item.find(".stickyelement");if(!$se.length)return;if($se.attr("data-item-index")!==$item.attr("data-index")){throw"hyb-tabsFullView.js (".concat(_this.model.get("_id"),"):\nOne or more {{#stickyElement}} helper \"itemIdx\" values are incorrect.\nInside of a \"").concat(_this.model.get("_component"),"\" component, the \"itemIdx\" value needs to have +1 added.\n(Because the standup is converted to _items[0])\n\nThe same applies for {{#se_mark}} and other {{#se_**}} helper 'idx' values.\n\nFor example, the first '_items' {{#stickyElement}} should have \"itemIdx=1\" instead of 0.")}})}}]);return HYBTabsFullView}(HYBTabs.view);HYBTabsFullView.template="hyb-tabsFull";var HYBTabsFullView$1=__AMD("components/adapt-hyb-tabsFull/js/hyb-tabsFullView",HYBTabsFullView);var HYBTabsFullModel=function(_HYBTabs$model){_inherits(HYBTabsFullModel,_HYBTabs$model);var _super=_createSuper(HYBTabsFullModel);function HYBTabsFullModel(){_classCallCheck(this,HYBTabsFullModel);return _super.apply(this,arguments)}_createClass(HYBTabsFullModel,[{key:"initialize",value:function initialize(){_get(_getPrototypeOf(HYBTabsFullModel.prototype),"initialize",this).call(this)}},{key:"setupItems",value:function setupItems(){var items=this.get("_items");var item={title:this.get("title"),body:this.get("body"),instruction:this.get("instruction"),_invertColor:this.get("_invertColor"),_background:{_isEnabled:this.get("_tabs._isEnabled"),src:this.get("_tabs")._background.src,color:"#ffffff"},_grid:{_areas:this.get("_grid")._areas,_customs:this.get("_grid")._customs},_theme:"",_classes:this.get("_classes")};items.unshift(item);var grid=this.get("_grid");grid._areas=[["x"+this.get("_tabs")._width,"w",""],["","",""],["","",""]];grid._customs=[];items.forEach(function(e){if(e._background===undefined){e._background={_isEnabled:true,_classes:"hyb-tabsfull-bg-default"}}var translateX=e._translateX;var translateY=e._translateY;if(translateX||translateY){if(!translateX)translateX=0;if(!translateY)translateY=0;translateX=translateX+(isNaN(translateX)?"":"rem");translateY=translateY+(isNaN(translateY)?"":"rem");e._styleTransform="transform: translate(".concat(translateX,", ").concat(translateY,");")}});_get(_getPrototypeOf(HYBTabsFullModel.prototype),"setupItems",this).call(this)}},{key:"hybReset",value:function hybReset(){this.setActiveItem(0)}}]);return HYBTabsFullModel}(HYBTabs.model);var HYBTabsFullModel$1=__AMD("components/adapt-hyb-tabsFull/js/hyb-tabsFullModel",HYBTabsFullModel);__AMD("components/adapt-hyb-tabsFull/js/adapt-hyb-tabsFull",Adapt.register("hyb-tabsfull",{model:HYBTabsFullModel$1,view:HYBTabsFullView$1}));var HYBQuestionView=function(_QuestionView){_inherits(HYBQuestionView,_QuestionView);var _super=_createSuper(HYBQuestionView);function HYBQuestionView(){_classCallCheck(this,HYBQuestionView);return _super.apply(this,arguments)}_createClass(HYBQuestionView,[{key:"postRender",value:function postRender(){var isYourTurn=Boolean(this.model.get("_hybYourTurnParent"));if(!isYourTurn)this.renderSubmitButton();_get(_getPrototypeOf(HYBQuestionView.prototype),"postRender",this).call(this)}},{key:"renderSubmitButton",value:function renderSubmitButton(){this.$el.addClass("is-activity has-activity-controls");var template=Handlebars.templates["hyb-questionControls"];var $parent=this.$el;$parent.append(new Handlebars.SafeString(template(this.model.toJSON())).string);var $btn=$parent.find(".js-hyb-question-controls-submit");$btn.on("click",this.onHybSubmitClicked.bind(this))}},{key:"onHybSubmitClicked",value:function onHybSubmitClicked(){this.onSubmitClicked();if(!this.model.canSubmit()){var $instruction=this.$(".js-component-instruction");$instruction.addClass("is-alert").one("animationend webkitAnimationEnd",function(){$instruction.removeClass("is-alert")})}if(this.model.get("_isCorrect")){this.$(".js-hyb-question-controls-submit").fadeOut()}}}]);return HYBQuestionView}(QuestionView$1);var HYBQuestionView$1=__AMD("extensions/adapt-dd-questionPlus/js/hyb-questionView",HYBQuestionView);var HYBTextInputView=function(_HYBQuestionView){_inherits(HYBTextInputView,_HYBQuestionView);var _super=_createSuper(HYBTextInputView);function HYBTextInputView(){_classCallCheck(this,HYBTextInputView);return _super.apply(this,arguments)}_createClass(HYBTextInputView,[{key:"events",value:function events(){return{"focus .js-hyb-textinput-input":"clearValidationError","change .js-hyb-textinput-input":"onInputChanged","keyup .js-hyb-textinput-input":"onInputChanged","click .js-hyb-textinput-incorrect-icon":"onIncorrectIconClick"}}},{key:"postRender",value:function postRender(){_get(_getPrototypeOf(HYBTextInputView.prototype),"postRender",this).call(this);this.setUpInputFields();this.attemptsBeforeHint=3}},{key:"setUpInputFields",value:function setUpInputFields(){var items=[];var $inputFields=this.$(".inputfield");$inputFields.each(function(i,e){var view=Adapt.inputField.findViewByEl($(e));var model=view.model;view.$(".js-inputfield-input").addClass("js-hyb-textinput-input").attr("data-adapt-index",i);items.push({_answers:model.getAnswers(),_inputFieldModel:model});model.disableHint();model.enableRequireSubmit()});this.model.set("_items",items);this.model.setupQuestionItemIndexes();this.model.checkCanSubmit();return true}},{key:"resetQuestionOnRevisit",value:function resetQuestionOnRevisit(){this.setAllItemsEnabled(false);this.resetQuestion()}},{key:"setupQuestion",value:function setupQuestion(){this.model.setupRandomisation()}},{key:"disableQuestion",value:function disableQuestion(){this.setAllItemsEnabled(false)}},{key:"enableQuestion",value:function enableQuestion(){this.setAllItemsEnabled(true)}},{key:"setAllItemsEnabled",value:function setAllItemsEnabled(isEnabled){this.model.get("_items").forEach(function(item,index){var $itemInput=this.$(".js-hyb-textinput-input").eq(index);$itemInput.prop("disabled",!isEnabled)},this)}},{key:"onQuestionRendered",value:function onQuestionRendered(){this.setReadyStatus()}},{key:"clearValidationError",value:function clearValidationError(){}},{key:"onCannotSubmit",value:function onCannotSubmit(){this.showValidationError()}},{key:"showValidationError",value:function showValidationError(){}},{key:"showMarking",value:function showMarking(){}},{key:"updateMarking",value:function updateMarking(){var _this=this;if(!this.model.get("_canShowMarking"))return;this.model.get("_items").forEach(function(item,i){var _item$_inputFieldMode;var $item=this.$(".js-hyb-textinput-item").eq(i);$item.toggleClass("is-correct",item._isCorrect);$item.toggleClass("is-incorrect",!item._isCorrect);if((_item$_inputFieldMode=item._inputFieldModel)!==null&&_item$_inputFieldMode!==void 0&&_item$_inputFieldMode.isCorrect()){item._inputFieldModel.lock()}},this);this.attemptsBeforeHint--;if(this.attemptsBeforeHint==0){this.listenToOnce(Adapt,"notify:closed",function(){_.debounce(function(){_.each(_this.model.get("_items"),function(item){if(item._inputFieldModel){item._inputFieldModel.enableHint()}})},600)()})}}},{key:"resetQuestion",value:function resetQuestion(){this.$(".js-hyb-textinput-input").prop("disabled",!this.model.get("_isEnabled")).val("");this.attemptsBeforeHint=3;this.model.set({_isAtLeastOneCorrectSelection:false,_isCorrect:undefined})}},{key:"showCorrectAnswer",value:function showCorrectAnswer(){if(this.model.get("_answers")){var correctAnswers=this.model.get("_answers");this.model.get("_items").forEach(function(item,index){this.$(".js-hyb-textinput-input").eq(index).val(correctAnswers[index][0])},this)}else{this.model.get("_items").forEach(function(item,index){this.$(".js-hyb-textinput-input").eq(index).val(item._answers[0])},this)}}},{key:"hideCorrectAnswer",value:function hideCorrectAnswer(){this.model.get("_items").forEach(function(item,index){this.$(".js-hyb-textinput-input").eq(index).val(item.userAnswer)},this)}},{key:"onInputChanged",value:function onInputChanged(e){var $input=$(e.target);this.model.setItemUserAnswer($input.attr("data-adapt-index"),$input.val())}},{key:"clearItemState",value:function clearItemState(index){var $input=this.$(".js-hyb-textinput-input");var $item=this.$(".js-hyb-textinput-item");if(index!==undefined){$item=$item.filter("[data-adapt-index="+index+"]");$input=$input.filter("[data-adapt-index="+index+"]")}$input.prop("disabled",!this.model.get("_isEnabled")).val("").parent().removeClass("is-incorrect is-correct");this.model.setItemUserAnswer(index,"");$item.removeClass("is-correct is-incorrect")}},{key:"onIncorrectIconClick",value:function onIncorrectIconClick(event){var index=$(event.currentTarget).attr("data-adapt-index");this.clearItemState(index)}}]);return HYBTextInputView}(HYBQuestionView$1);HYBTextInputView.template="hyb-textInput";var HYBTextInputView$1=__AMD("components/adapt-hyb-textInput/js/hyb-textInputView",HYBTextInputView);var TextInputPlusView=function(_QuestionView){_inherits(TextInputPlusView,_QuestionView);var _super=_createSuper(TextInputPlusView);function TextInputPlusView(){_classCallCheck(this,TextInputPlusView);return _super.apply(this,arguments)}_createClass(TextInputPlusView,[{key:"events",value:function events(){return{"focus .js-textinputplus-textbox":"clearValidationError","change .js-textinputplus-textbox":"onInputChanged","keyup .js-textinputplus-textbox":"onInputChanged","click .js-textinputplus-incorrect-icon":"onIncorrectIconClick"}}},{key:"postRender",value:function postRender(){_get(_getPrototypeOf(TextInputPlusView.prototype),"postRender",this).call(this);this.setUpInputFields();this.attemptsBeforeHint=3}},{key:"setUpInputFields",value:function setUpInputFields(){var items=[];var $inputFields=this.$(".inputfield");$inputFields.each(function(i,e){var view=Adapt.inputField.findViewByEl($(e));var model=view.model;view.$(".js-inputfield-input").addClass("js-textinputplus-textbox").attr("data-adapt-index",i);items.push({_answers:model.getAnswers(),_inputFieldModel:model});model.disableHint();model.enableRequireSubmit()});this.model.set("_items",items);this.model.setupQuestionItemIndexes();this.model.checkCanSubmit();return true}},{key:"resetQuestionOnRevisit",value:function resetQuestionOnRevisit(){this.setAllItemsEnabled(false);this.resetQuestion()}},{key:"setupQuestion",value:function setupQuestion(){this.model.setupRandomisation()}},{key:"disableQuestion",value:function disableQuestion(){this.setAllItemsEnabled(false)}},{key:"enableQuestion",value:function enableQuestion(){this.setAllItemsEnabled(true)}},{key:"setAllItemsEnabled",value:function setAllItemsEnabled(isEnabled){this.model.get("_items").forEach(function(item,index){var $itemInput=this.$(".js-textinputplus-textbox").eq(index);$itemInput.prop("disabled",!isEnabled)},this)}},{key:"onQuestionRendered",value:function onQuestionRendered(){this.setReadyStatus()}},{key:"clearValidationError",value:function clearValidationError(){}},{key:"onCannotSubmit",value:function onCannotSubmit(){this.showValidationError()}},{key:"showValidationError",value:function showValidationError(){}},{key:"showMarking",value:function showMarking(){}},{key:"updateMarking",value:function updateMarking(){var _this=this;if(!this.model.get("_canShowMarking"))return;this.model.get("_items").forEach(function(item,i){var _item$_inputFieldMode;var $item=this.$(".js-textinputplus-item").eq(i);$item.toggleClass("is-correct",item._isCorrect);$item.toggleClass("is-incorrect",!item._isCorrect);if((_item$_inputFieldMode=item._inputFieldModel)!==null&&_item$_inputFieldMode!==void 0&&_item$_inputFieldMode.isCorrect()){item._inputFieldModel.lock()}},this);this.attemptsBeforeHint--;if(this.attemptsBeforeHint==0){this.listenToOnce(Adapt,"notify:closed",function(){_.debounce(function(){_.each(_this.model.get("_items"),function(item){if(item._inputFieldModel){item._inputFieldModel.enableHint()}})},600)()})}}},{key:"resetQuestion",value:function resetQuestion(){this.$(".js-textinputplus-textbox").prop("disabled",!this.model.get("_isEnabled")).val("");this.attemptsBeforeHint=3;this.model.set({_isAtLeastOneCorrectSelection:false,_isCorrect:undefined})}},{key:"showCorrectAnswer",value:function showCorrectAnswer(){if(this.model.get("_answers")){var correctAnswers=this.model.get("_answers");this.model.get("_items").forEach(function(item,index){this.$(".js-textinputplus-textbox").eq(index).val(correctAnswers[index][0])},this)}else{this.model.get("_items").forEach(function(item,index){this.$(".js-textinputplus-textbox").eq(index).val(item._answers[0])},this)}}},{key:"hideCorrectAnswer",value:function hideCorrectAnswer(){this.model.get("_items").forEach(function(item,index){this.$(".js-textinputplus-textbox").eq(index).val(item.userAnswer)},this)}},{key:"onInputChanged",value:function onInputChanged(e){var $input=$(e.target);this.model.setItemUserAnswer($input.attr("data-adapt-index"),$input.val())}},{key:"clearItemState",value:function clearItemState(index){var $input=this.$(".js-textinputplus-textbox");var $item=this.$(".js-textinputplus-item");if(index!==undefined){$item=$item.filter("[data-adapt-index="+index+"]");$input=$input.filter("[data-adapt-index="+index+"]")}$input.prop("disabled",!this.model.get("_isEnabled")).val("").parent().removeClass("is-incorrect is-correct");this.model.setItemUserAnswer(index,"");$item.removeClass("is-correct is-incorrect")}},{key:"onIncorrectIconClick",value:function onIncorrectIconClick(event){var index=$(event.currentTarget).attr("data-adapt-index");this.clearItemState(index)}}]);return TextInputPlusView}(QuestionView$1);var TextInputPlusView$1=__AMD("components/adapt-textInputPlus/js/textInputPlusView",TextInputPlusView);var TextInputPlusModel=QuestionModel$1.extend({init:function(){QuestionModel$1.prototype.init.call(this);this.set("_genericAnswerIndexOffset",TextInputPlusModel.genericAnswerIndexOffset);this.setupQuestionItemIndexes();this.setUpQuestionItemInputWidths();this.checkCanSubmit()},setUpQuestionItemInputWidths:function(){var maxAnswerLength=0;var inputWidthExtra=this.get("_inputWidthExtra")||2;_.each(this.get("_items"),function(item){_.each(item._answers,function(answer){var answerLength=String(answer).length;if(answerLength>maxAnswerLength){maxAnswerLength=answerLength}})});maxAnswerLength+=inputWidthExtra;_.each(this.get("_items"),function(item){item._inputWidth=maxAnswerLength})},setupQuestionItemIndexes:function(){var _this=this;this.get("_items").forEach(function(item,index){if(item._index===undefined)item._index=index;if(item._answerIndex===undefined)item._answerIndex=-1;if(!item._inputType)item._inputType=_this.get("_inputType")||"text"})},restoreUserAnswers:function(){if(!this.get("_isSubmitted"))return;var userAnswer=this.get("_userAnswer");var genericAnswers=this.get("_answers");this.get("_items").forEach(function(item){var answerIndex=userAnswer[item._index];if(answerIndex>=TextInputPlusModel.genericAnswerIndexOffset){item.userAnswer=genericAnswers[answerIndex-TextInputPlusModel.genericAnswerIndexOffset];item._answerIndex=answerIndex}else if(answerIndex>-1){item.userAnswer=item._answers[answerIndex];item._answerIndex=answerIndex}else{if(item.userAnswer===undefined)item.userAnswer="******";item._answerIndex=-1}if(item.userAnswer instanceof Array)item.userAnswer=item.userAnswer[0]});this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()},setupRandomisation:function(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;this.set("_items",_.shuffle(this.get("_items")))},canSubmit:function(){return this.get("_items").every(function(_ref){var userAnswer=_ref.userAnswer;return userAnswer})},setItemUserAnswer:function(itemIndex,userAnswer){var item=this.get("_items")[itemIndex];item.userAnswer=userAnswer;this.checkCanSubmit()},storeUserAnswer:function(){var items=this.get("_items");this.isCorrect();var userAnswer=new Array(items.length);items.forEach(function(item,index){userAnswer[item._index]=item._answerIndex});this.set("_userAnswer",userAnswer)},isCorrect:function(){this.get("_items").forEach(function(item){if(item._inputFieldModel){item._inputFieldModel.submit()}});if(this.get("_answers")){this.markGenericAnswers()}else{this.markSpecificAnswers()}return!_.contains(_.pluck(this.get("_items"),"_isCorrect"),false)},isPartlyCorrect:function(){return this.get("_isAtLeastOneCorrectSelection")},markGenericAnswers:function(){var numberOfCorrectAnswers=0;var correctAnswers=this.get("_answers").slice();var usedAnswerIndexes=[];this.get("_items").forEach(function(item){correctAnswers.forEach(function(answerGroup,answerIndex){if(_.indexOf(usedAnswerIndexes,answerIndex)>-1)return;if(this.checkAnswerIsCorrect(answerGroup,item.userAnswer)==false)return;usedAnswerIndexes.push(answerIndex);item._isCorrect=true;item._answerIndex=answerIndex+TextInputPlusModel.genericAnswerIndexOffset;this.set({_numberOfCorrectAnswers:++numberOfCorrectAnswers,_isAtLeastOneCorrectSelection:true})},this);if(!item._isCorrect)item._isCorrect=false},this)},markSpecificAnswers:function(){var numberOfCorrectAnswers=0;this.get("_items").forEach(function(item){if(item._inputFieldModel){var isCorrect=item._inputFieldModel.isCorrect();if(isCorrect){item._isCorrect=true;item._answerIndex=item._inputFieldModel.getAnswerIndex();this.set({_numberOfCorrectAnswers:++numberOfCorrectAnswers,_isAtLeastOneCorrectSelection:true})}else{item._isCorrect=false;item._answerIndex=-1}return}if(!item._answers)return;var userAnswer=item.userAnswer||"";if(this.checkAnswerIsCorrect(item._answers,userAnswer)){item._isCorrect=true;item._answerIndex=_.indexOf(item._answers,this.cleanupUserAnswer(userAnswer));this.set({_numberOfCorrectAnswers:++numberOfCorrectAnswers,_isAtLeastOneCorrectSelection:true})}else{item._isCorrect=false;item._answerIndex=-1}},this)},checkAnswerIsCorrect:function(possibleAnswers,userAnswer){var uAnswer=this.cleanupUserAnswer(userAnswer);var matched=possibleAnswers.filter(function(cAnswer){return this.cleanupUserAnswer(cAnswer)==uAnswer},this);var answerIsCorrect=matched&&matched.length>0;if(answerIsCorrect)this.set("_hasAtLeastOneCorrectSelection",true);return answerIsCorrect},cleanupUserAnswer:function(userAnswer){if(this.get("_allowsAnyCase")){userAnswer=userAnswer.toLowerCase()}if(this.get("_allowsPunctuation")){userAnswer=userAnswer.replace(/[\.,-\/#!$£%\^&\*;:{}=\-_`~()]/g,"");userAnswer=userAnswer.replace(/(  +)+/g," ")}return $.trim(userAnswer)},setScore:function(){var numberOfCorrectAnswers=this.get("_numberOfCorrectAnswers");var questionWeight=this.get("_questionWeight");var itemLength=this.get("_items").length;var score=questionWeight*numberOfCorrectAnswers/itemLength;this.set("_score",score)},resetUserAnswer:function(){this.get("_items").forEach(function(item){item._isCorrect=false;item.userAnswer=""})},getResponse:function(){return _.pluck(this.get("_items"),"userAnswer").join("[,]")},getResponseType:function(){return"fill-in"}},{genericAnswerIndexOffset:65536});var TextInputPlusModel$1=__AMD("components/adapt-textInputPlus/js/textInputPlusModel",TextInputPlusModel);var TextInputPlus=__AMD("components/adapt-textInputPlus/js/adapt-textInputPlus",Adapt.register("textinputplus",{view:TextInputPlusView$1,model:TextInputPlusModel$1}));var HYBTextInputModel=function(_TextInputPlus$model){_inherits(HYBTextInputModel,_TextInputPlus$model);var _super=_createSuper(HYBTextInputModel);function HYBTextInputModel(){_classCallCheck(this,HYBTextInputModel);return _super.apply(this,arguments)}_createClass(HYBTextInputModel,[{key:"isCorrect",value:function isCorrect(){if(this.get("_isActivity"))return true;return _get(_getPrototypeOf(HYBTextInputModel.prototype),"isCorrect",this).call(this)}},{key:"isPartlyCorrect",value:function isPartlyCorrect(){this.set("_isPartlyCorrect",false);this.set("_isAtLeastOneCorrectSelection",false);return false}}]);return HYBTextInputModel}(TextInputPlus.model);var HYBTextInputModel$1=__AMD("components/adapt-hyb-textInput/js/hyb-textInputModel",HYBTextInputModel);__AMD("components/adapt-hyb-textInput/js/adapt-hyb-textInput",Adapt.register("hyb-textinput",{model:HYBTextInputModel$1,view:HYBTextInputView$1}));var HYBTFView=function(_QuestionView){_inherits(HYBTFView,_QuestionView);var _super=_createSuper(HYBTFView);function HYBTFView(){_classCallCheck(this,HYBTFView);return _super.apply(this,arguments)}_createClass(HYBTFView,[{key:"events",value:function events(){return{"change .js-item-input":"onItemSelect"}}},{key:"preRender",value:function preRender(){this.setupModelData();_get(_getPrototypeOf(HYBTFView.prototype),"preRender",this).call(this);this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model.getChildren(),{"_change:_optionsSelected":this.onItemSelectedChange})}},{key:"setupQuestion",value:function setupQuestion(){this.model.setupRandomisation()}},{key:"setupModelData",value:function setupModelData(){this.calculateWidths()}},{key:"getItemElement",value:function getItemElement(itemModel){return this.$(".js-hyb-tf-item").filter("[data-adapt-index="+itemModel.get("_index")+"]")}},{key:"onItemSelect",value:function onItemSelect(event){var index=$(event.currentTarget).data("adapt-index");var inputIndex=$(event.currentTarget).data("adapt-option-index");var itemModel=this.model.getChildren().find(function(itemModel){return itemModel.get("_index")===index});itemModel.set("_optionsSelected",[inputIndex]);itemModel.trigger("_change:_optionsSelected",itemModel,[inputIndex])}},{key:"onItemSelectedChange",value:function onItemSelectedChange(itemModel,optionsSelected){var markerIdx=optionsSelected[0];var optionsCount=this.model.get("_options").length;var $marker=this.$(".js-hyb-tf-item-marker").filter("[data-adapt-index=".concat(itemModel.get("_index"),"]"));var $markerContent=$marker.find(".js-hyb-tf-item-marker-content");$marker.css({"transform":"translateX(".concat(100*markerIdx,"%)")});$markerContent.css({"transform":"translateX(".concat(-100/optionsCount*markerIdx,"%)")})}},{key:"onItemActiveChange",value:function onItemActiveChange(itemModel,isActive){var $item=this.getItemElement(itemModel);$item.toggleClass("is-selected",isActive)}},{key:"updateMarking",value:function updateMarking(model){var _this=this;this.model.getChildren().each(function(itemModel){var $item=_this.getItemElement(itemModel);var isCorrect=Boolean(itemModel.get("_isCorrect"));var isLocked=isCorrect;$item.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect).toggleClass("is-locked",isLocked);$item.find(".js-item-input").prop("disabled",isLocked);$item.find(".js-item-label").toggleClass("is-locked",isLocked)})}},{key:"calculateWidths",value:function calculateWidths(){var optionCount=this.model.get("_options").length;this.model.set({"_markerWidth":100/optionCount,"_markerInnerWidth":100*optionCount})}},{key:"onQuestionRendered",value:function onQuestionRendered(){var _this2=this;this.$el.imageready(function(){_this2.setupItemSizing();_this2.setReadyStatus();_this2.update()})}},{key:"setupOptionSizing",value:function setupOptionSizing(){if(!this.model.get("_hasUniqueOptions"))return;var $btns=this.$(".js-hyb-tf-item-btn");var maxWidth=0;$btns.each(function(i,e){maxWidth=Math.max(maxWidth,$(e).width())});maxWidth=Math.ceil(maxWidth/2)*2;$btns.width(maxWidth)}},{key:"setupItemSizing",value:function setupItemSizing(){var _options$_base;var options=this.model.get("_itemSizing");this.setupOptionSizing();if(!Boolean(options===null||options===void 0?void 0:(_options$_base=options._base)===null||_options$_base===void 0?void 0:_options$_base._width)){return}try{options._parent=this.model;options._itemSizings=[];this.model.getChildren().each(function(itemModel){var _itemModel$get;return options._itemSizings[itemModel.get("_index")]=(_itemModel$get=itemModel.get("_graphic"))===null||_itemModel$get===void 0?void 0:_itemModel$get._sizing});var sizingGrid=Adapt.hyb.initSizingGrid(this.$(".js-hyb-tf-widget"),options);sizingGrid.onReady(function(){}).onUpdate(function(){})}catch(err){Adapt.log.error("hyb-tfView.js: Could not set up sizingGrid for items (try setting '_itemSizing._base._width' to 0).",err)}}},{key:"onCannotSubmit",value:function onCannotSubmit(){}},{key:"showMarking",value:function showMarking(){this.update();this.updateMarking()}},{key:"resetQuestion",value:function resetQuestion(){}},{key:"showCorrectAnswer",value:function showCorrectAnswer(){this.isCorrectAnswerShown=true;this.update()}},{key:"hideCorrectAnswer",value:function hideCorrectAnswer(){this.isCorrectAnswerShown=false;this.update()}},{key:"updateSelection",value:function updateSelection(){}},{key:"update",value:function update(){}}]);return HYBTFView}(QuestionView$1);HYBTFView.template="hyb-tf";var HYBTFView$1=__AMD("components/adapt-hyb-tf/js/hyb-tfView",HYBTFView);var HYBTFModel=function(_QuestionModel){_inherits(HYBTFModel,_QuestionModel);var _super=_createSuper(HYBTFModel);function HYBTFModel(){_classCallCheck(this,HYBTFModel);return _super.apply(this,arguments)}_createClass(HYBTFModel,[{key:"init",value:function init(){_get(_getPrototypeOf(HYBTFModel.prototype),"init",this).call(this);this.setUpItems.apply(this,arguments);this.checkCanSubmit();this.setUpEventListeners()}},{key:"toJSON",value:function toJSON(){var json=_get(_getPrototypeOf(HYBTFModel.prototype),"toJSON",this).call(this);json._items=this.getChildren().toJSON();return json}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenTo(this.getChildren(),{"change:_optionsSelected":this.onItemOptionsSelectedChange})}},{key:"setupRandomisation",value:function setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled")){Adapt.log.error("matchingPlusModel: '_isRandom: false' setting is not fully implemented yet. Using it is not recommended.");return}var children=this.getChildren();children.reset(children.shuffle(),{silent:true})}},{key:"onItemOptionsSelectedChange",value:function onItemOptionsSelectedChange(){this.checkCanSubmit()}},{key:"canSubmit",value:function canSubmit(){var incompleteItem=this.getChildren().find(function(itemModel){return itemModel.get("_optionsSelected").length===0});return!Boolean(incompleteItem)}},{key:"setUpItems",value:function setUpItems(){var _this=this;var items=this.get("_items");var globalOptions=this.get("_options");var hasUniqueOptions=false;_.each(items,function(item,index){item._index=index;item._optionsSelected=[];if(item._optionsCorrect){if(item._optionsCorrect.length!==1){throw"(".concat(_this.get("_id"),") adapt-matchingPlus: only 1 correct option per item is supported (you had: \" + ").concat(item._optionsCorrect.length," + \").")}if(item._options===undefined){item._options=[];_.each(globalOptions,function(go,goIndex){item._options.push({text:go,_index:goIndex})})}else{hasUniqueOptions=true;_.each(item._options,function(o,oIndex){item._options[oIndex]={text:o,_index:oIndex}})}}});this.setChildren(new Backbone.Collection(items,{model:Backbone.Model}));this.set("_hasUniqueOptions",hasUniqueOptions)}},{key:"isCorrect",value:function isCorrect(){var props={_numberOfIncorrectAnswers:0,_numberOfCorrectAnswers:0,_isAtLeastOneIncorrectSelection:false};this.getChildren().each(function(itemModel){var options=itemModel.get("_options");var optionsSelected=itemModel.get("_optionsSelected");var optionsCorrect=itemModel.get("_optionsCorrect");var isItemCorrect=true;_.each(optionsSelected,function(selectedIdx){var isCorrect=_.includes(optionsCorrect,selectedIdx);var option=_.find(options,function(o){return o._index==selectedIdx});option._isCorrect=isCorrect;option._isIncorrect=!isCorrect;option._isVisited=true;if(!isCorrect)isItemCorrect=false});itemModel.set("_isCorrect",isItemCorrect);itemModel.set("_isIncorrect",!isItemCorrect);itemModel.set("_isDisabled",isItemCorrect);if(!isItemCorrect){props._numberOfIncorrectAnswers++;props._isAtLeastOneIncorrectSelection=true;return}props._numberOfCorrectAnswers++});this.set(props);var hasRightNumberOfCorrectAnswers=props._numberOfCorrectAnswers===this.getChildren().length;var hasNoIncorrectAnswers=!props._isAtLeastOneIncorrectSelection;return hasRightNumberOfCorrectAnswers&&hasNoIncorrectAnswers}},{key:"storeUserAnswer",value:function storeUserAnswer(){var items=this.getChildren();var userAnswer=new Array(items.length);var tempUserAnswer=new Array(items.length);items.forEach(function(itemModel){var optionIndex=itemModel.get("_optionsSelected")[0];tempUserAnswer[itemModel.get("_index")]=optionIndex;userAnswer[itemModel.get("_index")]=optionIndex},this);this.set({_userAnswer:userAnswer,_tempUserAnswer:tempUserAnswer})}},{key:"setScore",value:function setScore(){var questionWeight=this.get("_questionWeight");if(this.get("_isCorrect")){this.set("_score",questionWeight);return}var numberOfCorrectAnswers=this.get("_numberOfCorrectAnswers");var itemLength=this.getChildren().length;var score=questionWeight*numberOfCorrectAnswers/itemLength;this.set("_score",score)}},{key:"isPartlyCorrect",value:function isPartlyCorrect(){return this.get("_numberOfCorrectAnswers")>0}},{key:"resetUserAnswer",value:function resetUserAnswer(){this.set("_userAnswer",[])}},{key:"getResponse",value:function getResponse(){var responses=[];this.get("_userAnswer").forEach(function(userAnswer,index){responses.push(index+1+"."+(userAnswer+1))});return responses.join("#")}},{key:"getResponseType",value:function getResponseType(){return"matching"}}]);return HYBTFModel}(QuestionModel$1);var HYBTFModel$1=__AMD("components/adapt-hyb-tf/js/hyb-tfModel",HYBTFModel);__AMD("components/adapt-hyb-tf/js/adapt-hyb-tf",Adapt.register("hyb-tf",{model:HYBTFModel$1,view:HYBTFView$1}));var HYBYourTurnView=function(_ComponentView){_inherits(HYBYourTurnView,_ComponentView);var _super=_createSuper(HYBYourTurnView);function HYBYourTurnView(){_classCallCheck(this,HYBYourTurnView);return _super.apply(this,arguments)}_createClass(HYBYourTurnView,[{key:"events",value:function events(){return{"click .js-hyb-yourturn-controls-left":"onControlsLeftClick","click .js-hyb-yourturn-controls-right":"onControlsRightClick","click .js-hyb-yourturn-controls-submit":"onControlsSubmitClick","click .js-hyb-yourturn-animation-container":"onAnimationContainerClick"}}},{key:"initialize",value:function initialize(){Adapt.ddAudio.loadAudio("yourTurn-intro",["assets/adapt-hyb-yourTurn/intro/audio.mp3","assets/adapt-hyb-yourTurn/intro/audio.ogg"]);Adapt.ddAudio.loadAudio("yourTurn-trophy",["assets/adapt-hyb-yourTurn/trophy/audio.mp3","assets/adapt-hyb-yourTurn/trophy/audio.ogg"]);this.setupModelData();_get(_getPrototypeOf(HYBYourTurnView.prototype),"initialize",this).call(this)}},{key:"setupModelData",value:function setupModelData(){}},{key:"preRender",value:function preRender(){this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){var _this=this;this.listenTo(this.model.getParent(),"change:_isHybActive",this.onParentHybActiveChange);this.listenTo(this.model.getChildren(),{"change:_isComplete":this.onItemCompleteChange,"change:_isActive":this.onItemActiveChange});this.listenTo(Adapt,"notify:opened",this.onFeedbackOpened);this.listenTo(Adapt,"notify:closed",this.onFeedbackClosed);this.model.getChildren().each(function(itemModel,idx){var name=idx==0?"_background (standup)":"_items[".concat(idx-1,"]._background");var debugWindow=Adapt.hyb.debug.initDebugWindow(_this.model.getParent(),name);debugWindow.track(itemModel,"_background.opacity","Opacity");debugWindow.track(itemModel,"_background._offset","Offset(%)")})}},{key:"onAnimationContainerClick",value:function onAnimationContainerClick(){this.hideIntroAnimation();Adapt.ddAudio.pauseAllAudio()}},{key:"hideIntroAnimation",value:function hideIntroAnimation(){var $animContainer=this.$(".js-hyb-yourturn-animation-container");$animContainer.fadeOut(500,function(){$animContainer.remove()})}},{key:"playIntroAnimation",value:function playIntroAnimation(){var _this2=this;var lottieModel=Adapt.lottie.getLottieModel(this.$(".js-hyb-yourturn-animation"));if(!lottieModel)return;lottieModel.play(0);if(Adapt.hyb._isDecorativeAudioEnabled){_.delay(function(){Adapt.ddAudio.play("yourTurn-intro",0)},10)}this.listenToOnce(lottieModel,"change:_isComplete",function(){_this2.hideIntroAnimation()})}},{key:"onParentHybActiveChange",value:function onParentHybActiveChange(blockModel,isHybActive){if(!isHybActive)return;this.playIntroAnimation()}},{key:"onFeedbackOpened",value:function onFeedbackOpened(notifyView){var componentModel;try{componentModel=notifyView.model.get("_parentView").model;if(componentModel.getParent()!==this.model.getParent())return}catch(err){return}var isLast=this.model.getChildren().last().get("_questionModel")==componentModel;var isComplete=componentModel.get("_isComplete");var isBlockComplete=this.model.getParent().get("_isComplete");var $notifyAnimation=notifyView.$(".js-notify-animation");var showCompleteTrophy=isBlockComplete||isLast&&isComplete;$notifyAnimation.append(this.createTrophyEl(showCompleteTrophy));if(showCompleteTrophy){notifyView.$(".js-notify-controls-container").hide();$notifyAnimation.css("width","8rem");var lottieView=Adapt.lottie.createLottieView(this.model,{src:"assets/adapt-hyb-yourTurn/trophy/anim.json",autoplay:false,loops:1});$notifyAnimation.html("").append(lottieView.$el);_.delay(function(){lottieView.model.play(0);if(Adapt.hyb._isDecorativeAudioEnabled){Adapt.ddAudio.play("yourTurn-trophy",0)}},500)}}},{key:"createTrophyEl",value:function createTrophyEl(isComplete){var template=Handlebars.templates["hyb-yourTurnTrophy"];return $(new Handlebars.SafeString(template({_isComplete:isComplete})).string)}},{key:"onFeedbackClosed",value:function onFeedbackClosed(notifyView){var _this3=this;try{var componentModel=notifyView.model.get("_parentView").model;if(componentModel.getParent()!==this.model.getParent())return}catch(err){return}var activeItem=this.model.getChildren().find(function(item){return item.get("_isActive")});if(!activeItem.get("_isComplete"))return;if(activeItem.get("_hasFeedbackMoved"))return;if(!this.model.getParent().isHybActive())return;activeItem.set("_hasFeedbackMoved",true);_.delay(function(){_this3.onControlsRightClick()},500)}},{key:"onItemCompleteChange",value:function onItemCompleteChange(itemModel,isComplete){if(!isComplete)return;var $item=this.$(".js-hyb-yourturn-item").filter("[data-adapt-index=\"".concat(itemModel.get("_index"),"\"]"));$item.toggleClass("is-complete",isComplete);$item.find(".js-hyb-yourturn-controls-submit").toggleClass("is-moved",isComplete).fadeOut();$item.find(".js-hyb-yourturn-controls-right").toggleClass("is-hidden",!isComplete);$item.find(".js-hyb-yourturn-controls-container").toggleClass("is-complete",isComplete)}},{key:"onItemActiveChange",value:function onItemActiveChange(itemModel,isActive){if(!isActive)return;this.updateLogoState(itemModel)}},{key:"updateLogoState",value:function updateLogoState(itemModel){var $logo=this.$(".js-hyb-yourturn-logo");var isActive=itemModel.get("_index")!==0;$logo.toggleClass("is-active",isActive).removeClass("is-hidden");if(!isActive)return;var $item=this.$(".js-hyb-yourturn-item").filter("[data-adapt-index=\"".concat(itemModel.get("_index"),"\"]"));var $sliderItem=$item.closest(".js-hyb-slider-item");var logoBB=$logo[0].getBoundingClientRect();var sliderItemBB=$sliderItem[0].getBoundingClientRect();var isHidden=false;$sliderItem.find(".js-hyb-figure-item").each(function(i,e){var BB=_.extend({},$(e)[0].getBoundingClientRect());BB.left-=sliderItemBB.left;BB.top-=sliderItemBB.top;if(BB.left>logoBB.left+logoBB.width)return true;if(BB.top>logoBB.top+logoBB.height)return true;if(BB.left+logoBB.width<logoBB.left)return true;if(BB.top+logoBB.height<logoBB.height)return true;isHidden=true;return false});$logo.toggleClass("is-hidden",isHidden)}},{key:"onControlsLeftClick",value:function onControlsLeftClick(){var activeItem=this.model.getActiveItem();var stage=activeItem.get("_index");this.model.setActiveItem(--stage)}},{key:"onControlsRightClick",value:function onControlsRightClick(){var activeItem=this.model.getActiveItem();var stage=activeItem.get("_index");this.model.setActiveItem(++stage)}},{key:"onControlsSubmitClick",value:function onControlsSubmitClick(){var id=this.model.getActiveItem().get("_questionModel").get("_id");var questionView=Adapt.findViewByModelId(id);if(!questionView)throw"hyb-yourTurnView.js: could not find QuestionView with '_id': ".concat(id);questionView.onSubmitClicked();if(!questionView.model.canSubmit()){var $instruction=questionView.$(".js-component-instruction");$instruction.addClass("is-alert").one("animationend webkitAnimationEnd",function(){$instruction.removeClass("is-alert")})}}},{key:"postRender",value:function postRender(){var _this4=this;this.slider=Adapt.hyb.initSlider(this.$(".js-hyb-slider"),{_parent:this.model,_hasBackground:true,_hasBackgroundOffsets:true,_forceCompletion:true,_controls:{_hideNav:true,_hideClose:true,_hideProgress:false}});this.model.setActiveItem(0);this.$el.imageready(function(){_this4.setReadyStatus()});if(this.model.getParent().isHybActive()){var playAnimationDelayed=_.debounce(this.playIntroAnimation.bind(this),50);if(Adapt.ddLoading){if(Adapt.ddLoading.isActive&&Adapt.ddLoading.isActive())this.listenToOnce(Adapt,"loading:end",playAnimationDelayed);else playAnimationDelayed()}else{playAnimationDelayed()}}}}]);return HYBYourTurnView}(ComponentView$1);HYBYourTurnView.template="hyb-yourTurn";var HYBYourTurnView$1=__AMD("components/adapt-hyb-yourTurn/js/hyb-yourTurnView",HYBYourTurnView);var HYBYourTurnModel=function(_ItemsComponentModel){_inherits(HYBYourTurnModel,_ItemsComponentModel);var _super=_createSuper(HYBYourTurnModel);function HYBYourTurnModel(){_classCallCheck(this,HYBYourTurnModel);return _super.apply(this,arguments)}_createClass(HYBYourTurnModel,[{key:"initialize",value:function initialize(){this.setupNestComponent();_get(_getPrototypeOf(HYBYourTurnModel.prototype),"initialize",this).call(this);Adapt.on({"app:dataReady":this.onDataReady.bind(this)})}},{key:"onDataReady",value:function onDataReady(){this.initItems();_get(_getPrototypeOf(HYBYourTurnModel.prototype),"setUpItems",this).call(this);this.listenTo(this.getChildren(),{"all":_get(_getPrototypeOf(HYBYourTurnModel.prototype),"onAll",this),"change:_isVisited":_get(_getPrototypeOf(HYBYourTurnModel.prototype),"checkCompletionStatus",this)});this.getChildren().each(function(itemModel,i){itemModel.listenTo(itemModel.get("_questionModel"),"change:_isComplete",function(model,isComplete){itemModel.set("_isComplete",isComplete)})});this.setActiveItem(0);this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.getChildren(),"change:_isComplete",this.onItemComplete)}},{key:"onItemComplete",value:function onItemComplete(itemModel,isComplete){var incompleteItem=this.getChildren().find(function(itemModel){return!itemModel.get("_isComplete")});if(!incompleteItem)this.setCompletionStatus()}},{key:"initItems",value:function initItems(){var _this=this,_this$get,_this$get2;var components=this.getParent().getChildren();var qComponents=components.filter(function(componentModel){return componentModel!==_this&&(componentModel instanceof QuestionModel$1||componentModel instanceof ItemsQuestionModel||componentModel instanceof HYBStatic.model)});if(!qComponents.length){Adapt.log.error("hyb-youturn with _id: \"".concat(this.get("_id"),"\" could not find any child components in its block!"))}var items=[{_background:((_this$get=this.get("_hybBackground"))===null||_this$get===void 0?void 0:_this$get.toJSON())||undefined,_questionModel:this,_isComplete:true,_isVisited:true}];this.set("_background",null);(_this$get2=this.get("_hybBackground"))===null||_this$get2===void 0?void 0:_this$get2.set("_hasCustomView",true);_.each(qComponents,function(componentModel){var _componentModel$get,_componentModel$get2;items.push({_nestComponent:componentModel.get("_id"),_questionModel:componentModel,_background:((_componentModel$get=componentModel.get("_hybBackground"))===null||_componentModel$get===void 0?void 0:_componentModel$get.toJSON())||undefined});(_componentModel$get2=componentModel.get("_hybBackground"))===null||_componentModel$get2===void 0?void 0:_componentModel$get2.set("_hasCustomView",true);componentModel.set("_hybYourTurnParent",_this)});this.set("_items",items)}},{key:"setupNestComponent",value:function setupNestComponent(){this.set("_nestComponent",{_isParent:true})}},{key:"hybReset",value:function hybReset(){this.setActiveItem(0)}}]);return HYBYourTurnModel}(ItemsComponentModel);var HYBYourTurnModel$1=__AMD("components/adapt-hyb-yourTurn/js/hyb-yourTurnModel",HYBYourTurnModel);__AMD("components/adapt-hyb-yourTurn/js/adapt-hyb-yourTurn",Adapt.register("hyb-yourturn",{model:HYBYourTurnModel$1,view:HYBYourTurnView$1}));var AnnotationView=function(_Backbone$View){_inherits(AnnotationView,_Backbone$View);var _super=_createSuper(AnnotationView);function AnnotationView(){_classCallCheck(this,AnnotationView);return _super.apply(this,arguments)}_createClass(AnnotationView,[{key:"className",value:function className(){var classNames=["annotation","js-annotation-click",this.model.get("_isBtn")?"btn-text":"",this.model.get("_hasIcon")?"has-icon":"",this.model.get("_tooltip")?"has-tooltip":""];return classNames.join(" ")}},{key:"tagName",value:function tagName(){return this.model.get("_isBtn")?"button":"span"}},{key:"events",value:function events(){return{"click":"onClick"}}},{key:"attributes",value:function attributes(){var attributes={"data-annotation-num":this.model.get("_number")};return attributes}},{key:"initialize",value:function initialize(){this.setupEventListeners();_.debounce(this.initTargets.bind(this))();this.render()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model,"change:_isActive",this.onActiveChange);this.listenTo(this.model,"change:_isVisited",this.onVisitedChange);this.listenTo(this.model,"change:_isComplete",this.onCompleteChange);Adapt.on("annotation:toggle",this.onAdaptAnnotationToggle.bind(this))}},{key:"initTargets",value:function initTargets(){var $targets=this.$getForTargets();$targets.addClass("is-annotation-target").attr("data-annotation-num",this.model.get("_number"));if(Adapt.isPDFMode()){$targets.addClass("is-active")}}},{key:"render",value:function render(){var template=Handlebars.templates["annotation"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);if(Adapt.isPDFMode())this.renderTooltipFallback()}},{key:"renderTooltipFallback",value:function(){var _renderTooltipFallback=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(){var _this=this;var tooltip;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:tooltip=this.model.get("_tooltip");if(tooltip){_context.next=3;break}return _context.abrupt("return");case 3:_.debounce(function(){var componentView=Adapt.findViewByModelId(_this.model.get("_parent").get("_id"));var $tooltipFallback=componentView.$(".tooltip-fallback");if(!$tooltipFallback.length){throw"AnnotationView: Could not find a {{{tooltipFallback}}} element in component \""+_this.model.get("_parent").get("_id")+"\" (required for PDF mode)."}$tooltipFallback.append("<div class='tooltip-fallback__item' data-annotation-num='"+_this.model.get("_number")+"'>"+tooltip+"</div>")},0)();case 4:case"end":return _context.stop();}},_callee,this)}));function renderTooltipFallback(){return _renderTooltipFallback.apply(this,arguments)}return renderTooltipFallback}()},{key:"onClick",value:function onClick(){var _this2=this;this.toggle();if(!this.model.get("_isActive"))return;var tooltip=this.model.get("_tooltip");if(tooltip){var $target=this.model.get("_tooltipTarget")=="mark"?this.$getForTargets().first():this.$el;var tooltipPopupView=Adapt.createTooltip($target,{content:tooltip,_classes:this.model.get("_tooltipClass"),_type:"annotation"});this.tooltipPopupView=tooltipPopupView;this.listenToOnce(tooltipPopupView.model,"change:_isActive",function(){_this2.model.set("_isActive",false)})}}},{key:"toggle",value:function toggle(){this.model.set("_isActive",!this.model.get("_isActive"));Adapt.trigger("annotation:toggle",this.model)}},{key:"onAdaptAnnotationToggle",value:function onAdaptAnnotationToggle(model){if(model==this.model)return;this.model.set("_isActive",false)}},{key:"onVisitedChange",value:function onVisitedChange(model,isVisited){if(!isVisited)return;this.$el.addClass("is-visited")}},{key:"onCompleteChange",value:function onCompleteChange(model,isComplete){var _this$model$get;this.$el.toggleClass("is-complete",isComplete);(_this$model$get=this.model.get("_completionCondition"))===null||_this$model$get===void 0?void 0:_this$model$get()}},{key:"$getForTargets",value:function $getForTargets(){var _this3=this;var _for=this.model.get("_for");var $for=$();if(_for){var $container=this.$el.closest(".block, .notify");if(!$container.length){Adapt.log.error("adapt-annotation: could not find closest .block / .notify element.","Content: "+this.model.get("content"));return $for}_.each(_for,function(forName){var $f=$for.add($container.find("[name='"+forName+"']"));if(!$f.length){Adapt.log.warnOnce("adapt-annotation: Could not find element with name=\""+forName+"\" inside its componentView ("+_this3.model.get("_parent").get("_id")+").")}$for=$for.add($f)})}return $for}},{key:"onActiveChange",value:function onActiveChange(model,isActive){var _this4=this;this.$el.toggleClass("is-active",isActive);if(isActive){this.model.set("_isVisited",true);this.model.set("_isComplete",true)}var $forTargets=this.$getForTargets();if(!$forTargets.length)return;$forTargets.addClass("is-annotation-target").each(function(i,e){if(!isActive){$(e).toggleClass("is-active",false)}else{_.debounce(function(){$(e).toggleClass("is-active",true)})()}});if(!isActive){if(this.tooltipPopupView)this.tooltipPopupView.remove();$(document).off("click touch",this.onClickAnywhereEvent);return}Adapt.navigateToElement($forTargets,{align:"inview",scrollNested:true});_.debounce(function(){_this4.onClickAnywhereEvent=_this4.onClickAnywhere.bind(_this4);$(document).one("click touch",_this4.onClickAnywhereEvent)})()}},{key:"onClickAnywhere",value:function onClickAnywhere(event){var $target=$(event.target);if($target.closest(".is-annotation-target.is-active").length)return;this.model.set("_isActive",false)}}]);return AnnotationView}(Backbone.View);var AnnotationView$1=__AMD("extensions/adapt-annotation/js/annotationView",AnnotationView);Adapt.on("router:page",function(){var annotationNum=1;Handlebars__default["default"].registerHelperEl("annotation",function(){var context=arguments[arguments.length-1];var hash=context.hash;var componentModel=Handlebars__default["default"].getComponentModelFromContext(context);if(!hash.for){if(!hash.tooltip){throw"Annotation must have the \"for\" and/or \"tooltip\" parameter defined."}if(hash.hasIcon===undefined){hash.hasIcon=true}}else{if(hash.hasIcon===undefined){hash.hasIcon=true}}if(hash.isBtn){hash.hasIcon=false;hash.isBtn=true;hash._completionCondition=componentModel.createCompletionCondition()}var modelJSON={content:context!==null&&context!==void 0&&context.fn?context.fn(this):"",_for:hash.for?hash.for.split(","):undefined,_tooltip:hash.tooltip,_tooltipTarget:hash.tooltipTarget||false,_tooltipClass:hash.tooltipClass||has.tooltipClasses||"",_hasIcon:hash.hasIcon!==false,_isBtn:hash.isBtn===true,_completionCondition:hash._completionCondition,_number:annotationNum,_parent:componentModel};annotationNum++;return new AnnotationView$1({model:new Backbone.Model(modelJSON)}).$el})});var helpers$4={mark:function(){var _context$fn;var context=arguments[arguments.length-1];var data=context.hash||{};if(data.absolute){var vals=data.absolute.split(",");if(vals.length<2){throw"{{#mark}} helper: the \"absolute\" property must have a string value formatted as follows: \"LEFT,TOP,WIDTH,HEIGHT\".\n\nFor example: absolute=\"10,10,20,20\".\n\nYou entered: absolute=\""+absolute+"\""}data.absolute={left:vals[0].trim()+"%",top:vals[1].trim()+"%"};if(vals.length>=3)data.absolute.width=vals[2].trim()+"%";if(vals.length>=4)data.absolute.height=vals[3].trim()+"%"}data._tag="mark";data=_.extend({},{content:(_context$fn=context.fn)===null||_context$fn===void 0?void 0:_context$fn.apply(this)},data);var template=Handlebars__default["default"].templates["mark"];return new Handlebars__default["default"].SafeString(template(data)).string},markBlock:function(){var context=arguments[arguments.length-1];var data=_.extend({content:context.fn(this)},context.hash||{},{_tag:"div"});var template=Handlebars__default["default"].templates["mark"];return new Handlebars__default["default"].SafeString(template(data)).string},fade:function(){var context=arguments[arguments.length-1];var data=_.extend({content:context.fn(this)},context.hash||{},{_tag:"span"});var template=Handlebars__default["default"].templates["fade"];return new Handlebars__default["default"].SafeString(template(data)).string},fadeBlock:function(){var context=arguments[arguments.length-1];var data=_.extend({content:context.fn(this)},context.hash||{},{_tag:"div"});var template=Handlebars__default["default"].templates["fade"];return new Handlebars__default["default"].SafeString(template(data)).string},tooltipFallback:function(){var template=Handlebars__default["default"].templates["tooltipFallback"];return new Handlebars__default["default"].SafeString(template({})).string}};for(var name$4 in helpers$4){if(helpers$4.hasOwnProperty(name$4)){Handlebars__default["default"].registerHelper(name$4,helpers$4[name$4])}}var AssessmentView={postRender:function(){ArticleView$1.prototype.postRender.call(this);if(this.model.isAssessmentEnabled()){this._setupEventListeners();var config=this.model.getConfig();if(config&&config._questions&&config._questions._canShowMarking===false){this.$el.addClass("has-no-marking")}}this.$el.addClass("is-assessment")},_setupEventListeners:function(){this.listenTo(Adapt,{"assessments:complete":this._onAssessmentComplete,"assessments:reset":this._onAssessmentReset,remove:this._onRemove})},_removeEventListeners:function(){this.stopListening(Adapt,{"assessments:complete":this._onAssessmentComplete,"assessments:reset":this._onAssessmentReset})},_onAssessmentComplete:function(state,model){if(state.id!=this.model.get("_assessment")._id)return;console.log("assessment complete",state,model)},_onAssessmentReset:function(state,model){if(state.id!=this.model.get("_assessment")._id)return;console.log("assessment reset",state,model)},_onRemove:function(){this._removeEventListeners()}};var AdaptAssessmentArticleView=__AMD("extensions/adapt-contrib-assessment/js/adapt-assessmentArticleView",AssessmentView);var QuestionBank=function(quizBankid,articleId,numQuestionBlocks,uniqueQuestions){this._id=quizBankid;this._articleId=articleId;this._numQuestionBlocks=numQuestionBlocks;this._uniqueQuestions=uniqueQuestions;this.questionBlocks=[];this.unUsedQuestionBlocks=undefined;this.usedQuestionBlocks=[]};QuestionBank.prototype={getID:function(){return this._id},addBlock:function(block){this.questionBlocks.push(block)},getRandomQuestionBlocks:function(){this.checkResetUnunsedBlocks();var questionBlocks=[];var usedQuestionBlocks=this.usedQuestionBlocks.slice(0);for(var i=0;i<this._numQuestionBlocks;i++){var question=this.getRandomQuestion();if(question!==undefined){questionBlocks.push(question)}else{if(usedQuestionBlocks.length===0)break;var index=Math.floor(Math.random()*(usedQuestionBlocks.length-1));question=usedQuestionBlocks.splice(index,1)[0];questionBlocks.push(question)}}return questionBlocks},checkResetUnunsedBlocks:function(){if(this.unUsedQuestionBlocks!==undefined&&this._uniqueQuestions)return;this.unUsedQuestionBlocks=this.questionBlocks.slice(0)},getRandomQuestion:function(){if(this.unUsedQuestionBlocks!==undefined&&this.unUsedQuestionBlocks.length<1){console.warn("assessment:"+this._articleId+" No more unique questions for _assessment._quizBankID "+this._id);return undefined}var index=Math.round(Math.random()*(this.unUsedQuestionBlocks.length-1));var questionBlock=this.unUsedQuestionBlocks[index];this.usedQuestionBlocks.push(questionBlock);this.unUsedQuestionBlocks.splice(index,1);return questionBlock}};var QuestionBank$1=__AMD("extensions/adapt-contrib-assessment/js/adapt-assessmentQuestionBank",QuestionBank);var givenIdCount=0;var assessmentConfigDefaults={_isEnabled:true,_questions:{_resetType:"soft",_canShowFeedback:false,_canShowMarking:false,_canShowModelAnswer:false},_suppressMarking:false,_isPercentageBased:true,_scoreToPass:100,_includeInTotalScore:true,_assessmentWeight:1,_isResetOnRevisit:true,_reloadPageOnReset:true,_attempts:"infinite",_allowResetIfPassed:false};var AssessmentModel={_postInitialize:function(){if(!this.isAssessmentEnabled())return;var assessmentConfig=this.getConfig();_.extend(this,{_currentQuestionComponents:null,_originalChildModels:null,_questionBanks:null,_forceResetOnRevisit:false});var attemptsLeft;switch(assessmentConfig._attempts){case"infinite":case 0:case undefined:case-1:case null:attemptsLeft="infinite";break;default:attemptsLeft=assessmentConfig._attempts;break;}this.set({_currentQuestionComponentIds:[],_assessmentCompleteInSession:false,_attemptInProgress:false,_isAssessmentComplete:false,_numberOfQuestionsAnswered:0,_lastAttemptScoreAsPercent:0,_attempts:attemptsLeft,_attemptsLeft:attemptsLeft,_attemptsSpent:0});this.listenToOnce(Adapt,"app:dataReady",this._onDataReady);this.listenTo(Adapt,"remove",this._onRemove)},init:function(){this._originalChildModels=this.getChildren().models;this._currentQuestionComponents=this.findDescendantModels("components",{where:{_isQuestionType:true}});this.set("_currentQuestionComponentIds",this._currentQuestionComponents.map(function(comp){return comp.get("_id")}));this._setAssessmentOwnershipOnChildrenModels()},_setAssessmentOwnershipOnChildrenModels:function(){var assessmentConfig=this.get("_assessment");var childConfig={_isPartOfAssessment:true,_assessmentId:assessmentConfig._id};for(var i=0,l=this._originalChildModels.length;i<l;i++){var blockModel=this._originalChildModels[i];blockModel.set(childConfig);blockModel.setOnChildren(childConfig)}},_onDataReady:function(){Adapt.assessment.register(this)},_setupAssessmentData:function(force,callback){var assessmentConfig=this.getConfig();var state=this.getState();var shouldResetAssessment=!this.get("_attemptInProgress")&&!state.isPass||force===true;var shouldResetQuestions=assessmentConfig._isResetOnRevisit&&(state.allowResetIfPassed||!state.isPass)||force===true;if(shouldResetAssessment||shouldResetQuestions){Adapt.trigger("assessments:preReset",this.getState(),this)}var quizModels;if(shouldResetAssessment){this.set({_numberOfQuestionsAnswered:0,_isAssessmentComplete:false,_assessmentCompleteInSession:false,_score:0});this.getChildren().models=this._originalChildModels;if(assessmentConfig._banks&&assessmentConfig._banks._isEnabled&&assessmentConfig._banks._split.length>1){quizModels=this._setupBankedAssessment()}else if(assessmentConfig._randomisation&&assessmentConfig._randomisation._isEnabled){quizModels=this._setupRandomisedAssessment()}}if(!quizModels){quizModels=this.getChildren().models}else if(quizModels.length===0){quizModels=this.getChildren().models;console.warn("assessment: Not enough unique questions to create a fresh assessment, using last selection")}this.getChildren().models=quizModels;this._currentQuestionComponents=this.findDescendantModels("components",{where:{_isQuestionType:true}});this.set("_currentQuestionComponentIds",this._currentQuestionComponents.map(function(comp){return comp.get("_id")}));if(shouldResetAssessment||shouldResetQuestions){this._resetQuestions(function(){this.set("_attemptInProgress",true);Adapt.trigger("assessments:reset",this.getState(),this);finalise.apply(this)}.bind(this))}else{finalise.apply(this)}function finalise(){if(!state.isComplete){this.set("_attemptInProgress",true)}this._overrideQuestionComponentSettings();this._setupQuestionListeners();this._checkNumberOfQuestionsAnswered();this._updateQuestionsState();Adapt.assessment.saveState();if(typeof callback=="function")callback.apply(this);if(shouldResetAssessment||shouldResetQuestions){Adapt.trigger("assessments:postReset",this.getState(),this)}}},_setupBankedAssessment:function(){var assessmentConfig=this.getConfig();this._setupBanks();var questionModels=[];for(var bankId in this._questionBanks){if(this._questionBanks.hasOwnProperty(bankId)){var questionBank=this._questionBanks[bankId];var questions=questionBank.getRandomQuestionBlocks();questionModels=questionModels.concat(questions)}}if(assessmentConfig._banks._randomisation){questionModels=_.shuffle(questionModels)}return questionModels},_setupBanks:function(){var assessmentConfig=this.getConfig();var banks=assessmentConfig._banks._split.split(",");var bankId;this._questionBanks=[];for(var i=0,l=banks.length;i<l;i++){var bank=banks[i];bankId=i+1;var questionBank=new QuestionBank$1(bankId,this.get("_id"),bank,true);this._questionBanks[bankId]=questionBank}var children=this.getChildren().models;for(var j=0,count=children.length;j<count;j++){var blockModel=children[j];var blockAssessmentConfig=blockModel.get("_assessment");if(!blockAssessmentConfig)continue;bankId=blockAssessmentConfig._quizBankID;this._questionBanks[bankId].addBlock(blockModel)}},_setupRandomisedAssessment:function(){var assessmentConfig=this.getConfig();var randomisationModel=assessmentConfig._randomisation;var blockModels=this.getChildren().models;var questionModels=_.shuffle(blockModels);if(randomisationModel._blockCount>0){questionModels=questionModels.slice(0,randomisationModel._blockCount)}return questionModels},_overrideQuestionComponentSettings:function(){var newSettings=this._getMarkingSettings();var questionConfig=this.getConfig()._questions;if(questionConfig.hasOwnProperty("_canShowFeedback")){newSettings._canShowFeedback=questionConfig._canShowFeedback}if(!_.isEmpty(newSettings)){for(var i=0,l=this._currentQuestionComponents.length;i<l;i++){this._currentQuestionComponents[i].set(newSettings,{pluginName:"_assessment"})}}},_setupQuestionListeners:function(){var questionComponents=this._currentQuestionComponents;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];if(question.get("_isInteractionComplete"))continue;this.listenTo(question,"change:_isInteractionComplete",this._onQuestionCompleted)}},_checkNumberOfQuestionsAnswered:function(){var questionComponents=this._currentQuestionComponents;var numberOfQuestionsAnswered=0;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];if(question.get("_isInteractionComplete")){numberOfQuestionsAnswered++}}this.set("_numberOfQuestionsAnswered",numberOfQuestionsAnswered)},_removeQuestionListeners:function(){var questionComponents=this._currentQuestionComponents;if(!questionComponents)return;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];this.stopListening(question,"change:_isInteractionComplete",this._onQuestionCompleted)}},_onQuestionCompleted:function(questionModel,value){if(value===false)return;if(!questionModel.get("_isInteractionComplete"))return;var numberOfQuestionsAnswered=this.get("_numberOfQuestionsAnswered");numberOfQuestionsAnswered++;this.set("_numberOfQuestionsAnswered",numberOfQuestionsAnswered);this._updateQuestionsState();Adapt.assessment.saveState();this._checkAssessmentComplete()},_checkAssessmentComplete:function(){var numberOfQuestionsAnswered=this.get("_numberOfQuestionsAnswered");var allQuestionsAnswered=numberOfQuestionsAnswered>=this._currentQuestionComponents.length;if(!allQuestionsAnswered)return;this._onAssessmentComplete()},_onAssessmentComplete:function(){this.getConfig();this.set("_attemptInProgress",false);this._spendAttempt();var scoreAsPercent=this._getScoreAsPercent();var score=this._getScore();var maxScore=this._getMaxScore();this.set({_scoreAsPercent:scoreAsPercent,_score:score,_maxScore:maxScore,_lastAttemptScoreAsPercent:scoreAsPercent,_assessmentCompleteInSession:true,_isAssessmentComplete:true});this._updateQuestionsState();this._checkIsPass();this._removeQuestionListeners();if(this._isMarkingSuppressionEnabled()&&!this._isAttemptsLeft()){_.defer(function(){this._overrideMarkingSettings();this._refreshQuestions()}.bind(this))}Adapt.trigger("assessments:complete",this.getState(),this)},_updateQuestionsState:function(){var questions=[];var questionComponents=this._currentQuestionComponents;for(var i=0,l=questionComponents.length;i<l;i++){var questionComponent=questionComponents[i];var questionModel={_id:questionComponent.get("_id"),_isCorrect:questionComponent.get("_isCorrect")===undefined?null:questionComponent.get("_isCorrect")};questions.push(questionModel)}this.set("_questions",questions)},_checkIsPass:function(){var assessmentConfig=this.getConfig();var isPercentageBased=assessmentConfig._isPercentageBased;var scoreToPass=assessmentConfig._scoreToPass;var scoreAsPercent=this.get("_scoreAsPercent");var score=this.get("_score");var isPass=isPercentageBased?scoreAsPercent>=scoreToPass:score>=scoreToPass;this.set("_isPass",isPass)},_getMarkingSettings:function(){var markingSettings={};if(this._shouldSuppressMarking()){markingSettings={_canShowMarking:false,_canShowModelAnswer:false}}else{var questionConfig=this.getConfig()._questions;if(questionConfig.hasOwnProperty("_canShowModelAnswer")){markingSettings._canShowModelAnswer=questionConfig._canShowModelAnswer}if(questionConfig.hasOwnProperty("_canShowMarking")){markingSettings._canShowMarking=questionConfig._canShowMarking}}return markingSettings},_overrideMarkingSettings:function(){var newMarkingSettings=this._getMarkingSettings();for(var i=0,l=this._currentQuestionComponents.length;i<l;i++){this._currentQuestionComponents[i].set(newMarkingSettings,{pluginName:"_assessment"})}},_refreshQuestions:function(){for(var a=0,b=this._currentQuestionComponents.length;a<b;a++){var question=this._currentQuestionComponents[a];question.refresh()}},_shouldSuppressMarking:function(){return this._isMarkingSuppressionEnabled()&&this._isAttemptsLeft()},_isMarkingSuppressionEnabled:function(){var assessmentConfig=this.getConfig();return assessmentConfig._suppressMarking},_isAttemptsLeft:function(){if(this.get("_isAssessmentComplete")&&this.get("_isPass"))return false;if(this.get("_attemptsLeft")===0)return false;return true},_spendAttempt:function(){if(!this._isAttemptsLeft())return false;var attemptsSpent=this.get("_attemptsSpent");this.set("_attemptsSpent",++attemptsSpent);if(this.get("_attempts")=="infinite")return true;var attemptsLeft=this.get("_attemptsLeft");this.set("_attemptsLeft",--attemptsLeft);return true},_getScore:function(){var score=0;var questionComponents=this._currentQuestionComponents;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];if(question.get("_isCorrect")&&question.get("_questionWeight")){score+=question.get("_questionWeight")}}return score},_getMaxScore:function(){var maxScore=0;var questionComponents=this._currentQuestionComponents;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];if(question.get("_questionWeight")){maxScore+=question.get("_questionWeight")}}return maxScore},_getScoreAsPercent:function(){if(this._getMaxScore()===0)return 0;return Math.round(this._getScore()/this._getMaxScore()*100)},_getLastAttemptScoreAsPercent:function(){return this.get("_lastAttemptScoreAsPercent")},_checkReloadPage:function(){if(!this.canResetInPage())return false;var parentId=this.getParent().get("_id");var currentLocation=Adapt.location._currentId;if(currentLocation!=parentId)return false;if(!this.get("_isReady"))return false;return true},_reloadPage:function(callback){this._forceResetOnRevisit=true;this.listenToOnce(Adapt,"pageView:ready",callback);_.delay(function(){Backbone.history.navigate("#/id/"+Adapt.location._currentId,{replace:true,trigger:true})},250)},_resetQuestions:function(callback){var assessmentConfig=this.getConfig();var syncIterations=1;var i=0,qs=this._currentQuestionComponents,len=qs.length;function step(){for(var j=0,count=Math.min(syncIterations,len-i);j<count;i++,j++){var question=qs[i];question.reset(assessmentConfig._questions._resetType,true)}i==len?callback():setTimeout(step)}step()},_onRemove:function(){this._removeQuestionListeners()},_setCompletionStatus:function(){this.set({_isComplete:true,_isInteractionComplete:true})},_checkIfQuestionsWereRestored:function(){if(this.get("_assessmentCompleteInSession"))return;if(!this.get("_isAssessmentComplete"))return;var wereQuestionsRestored=true;var questions=this.get("_questions");for(var i=0,l=questions.length;i<l;i++){var question=questions[i];var questionModel=Adapt.findById(question._id);if(!questionModel.get("_isSubmitted")){wereQuestionsRestored=false;break}}if(!wereQuestionsRestored){this.set("_assessmentCompleteInSession",true);return true}return false},isAssessmentEnabled:function(){if(this.get("_assessment")&&this.get("_assessment")._isEnabled)return true;return false},canResetInPage:function(){var assessmentConfig=this.getConfig();if(assessmentConfig._reloadPageOnReset===false)return false;return true},reset:function(force,callback){if(this._isResetInProgress){this.once("reset",function(){this._isResetInProgress=false;if(typeof callback=="function"){callback(true)}});return}var assessmentConfig=this.getConfig();force=this._forceResetOnRevisit||force===true;this._forceResetOnRevisit=false;var isPageReload=this._checkReloadPage();if(this.get("_assessmentCompleteInSession")&&!assessmentConfig._isResetOnRevisit&&!isPageReload&&!force){if(typeof callback=="function"){callback(false)}return false}var wereQuestionsRestored=this._checkIfQuestionsWereRestored();force=force||wereQuestionsRestored;if(force&&!this._isAttemptsLeft()){this.set({_attemptsLeft:this.get("_attempts"),_attemptsSpent:0})}var allowResetIfPassed=this.get("_assessment")._allowResetIfPassed;if(!this._isAttemptsLeft()&&!force&&!allowResetIfPassed){if(typeof callback=="function")callback(false);return false}if(!isPageReload){this.once("reset",function(){this._isResetInProgress=false;if(typeof callback=="function"){callback(true)}});this._isResetInProgress=true;this._setupAssessmentData(force,function(){this.trigger("reset")})}else{this._reloadPage(function(){if(typeof callback=="function"){callback(true)}})}return true},getSaveState:function(){var state=this.getState();var blocks;var cfg=this.getConfig();var banksActive=cfg._banks&&cfg._banks._isEnabled&&cfg._banks._split.length>1;var randomisationActive=cfg._randomisation&&cfg._randomisation._isEnabled;if(!banksActive&&!randomisationActive){blocks=this.findDescendantModels("block")}else{blocks=state.questions.map(function(question){return Adapt.findById(question._id).getParent()})}blocks=blocks.filter(function(block){var trackingId=block.get("_trackingId");return Number.isInteger(trackingId)&&trackingId>=0});var blockTrackingIds=blocks.map(function(block){return block.get("_trackingId")});var blockCompletion=blocks.map(function(block){var questions=block.findDescendantModels("question");return questions.map(function(question){return question.get("_isCorrect")||false})});var blockData=[blockTrackingIds,blockCompletion];var saveState=[state.isComplete?1:0,state.attemptsSpent,state.maxScore||0,state.score,state.attemptInProgress?1:0];var dataPackage=[saveState,blockData];return dataPackage},setRestoreState:function(dataPackage){var restoreState=dataPackage[0];var blockData=dataPackage[1];var isComplete=restoreState[0]==1?true:false;var attempts=this.get("_attempts");var attemptsSpent=restoreState[1];var maxScore=restoreState[2];var score=restoreState[3];var attemptInProgress=restoreState[4]==1?true:false;var scoreAsPercent;var blocks=blockData[0].map(function(trackingId){return Adapt.data.findWhere({_trackingId:trackingId})});if(blocks.length){this.getChildren().models=blocks}this.set({_isAssessmentComplete:isComplete,_assessmentCompleteInSession:false,_attemptsSpent:attemptsSpent,_attemptInProgress:attemptInProgress,_attemptsLeft:attempts==="infinite"?attempts:attempts-attemptsSpent,_maxScore:maxScore||this._getMaxScore(),_score:score||0});if(score){scoreAsPercent=Math.round(score/maxScore*100)}else{scoreAsPercent=0}this.set({_scoreAsPercent:scoreAsPercent,_lastAttemptScoreAsPercent:scoreAsPercent});var questions=[];blocks.forEach(function(block,blockIndex){var blockQuestions=block.findDescendantModels("question");blockQuestions.forEach(function(question,questionIndex){questions.push({_id:question.get("_id"),_isCorrect:blockData[1][blockIndex][questionIndex]})})});this.set("_questions",questions);if(isComplete)this._checkIsPass();Adapt.trigger("assessments:restored",this.getState(),this)},getState:function(){var assessmentConfig=this.getConfig();var state={id:assessmentConfig._id,type:"article-assessment",pageId:this.getParent().get("_id"),articleId:this.get("_id"),isEnabled:assessmentConfig._isEnabled,isComplete:this.get("_isAssessmentComplete"),isPercentageBased:assessmentConfig._isPercentageBased,scoreToPass:assessmentConfig._scoreToPass,score:this.get("_score"),scoreAsPercent:this.get("_scoreAsPercent"),maxScore:this.get("_maxScore"),isPass:this.get("_isPass"),includeInTotalScore:assessmentConfig._includeInTotalScore,assessmentWeight:assessmentConfig._assessmentWeight,attempts:this.get("_attempts"),attemptsSpent:this.get("_attemptsSpent"),attemptsLeft:this.get("_attemptsLeft"),attemptInProgress:this.get("_attemptInProgress"),lastAttemptScoreAsPercent:this.get("_lastAttemptScoreAsPercent"),questions:this.get("_questions"),resetType:assessmentConfig._questions._resetType,allowResetIfPassed:assessmentConfig._allowResetIfPassed,questionModels:new Backbone.Collection(this._currentQuestionComponents)};return state},getConfig:function(){var assessmentConfig=this.get("_assessment");if(!assessmentConfig){assessmentConfig=$.extend(true,{},assessmentConfigDefaults)}else{assessmentConfig=$.extend(true,{},assessmentConfigDefaults,assessmentConfig)}if(assessmentConfig._id===undefined){assessmentConfig._id="givenId"+givenIdCount++}this.set("_assessment",assessmentConfig);return assessmentConfig}};var AdaptAssessmentArticleModel=__AMD("extensions/adapt-contrib-assessment/js/adapt-assessmentArticleModel",AssessmentModel);var assessmentsConfigDefaults={_isPercentageBased:true,_scoreToPass:100,_isDefaultsLoaded:true};Adapt.assessment=_.extend({_assessments:_.extend([],{_byPageId:{},_byAssessmentId:{}}),initialize:function(){this.listenTo(Adapt,{"assessments:complete":this._onAssessmentsComplete,"router:location":this._checkResetAssessmentsOnRevisit,"router:plugin":this._handleRoute,"app:dataReady":this._onDataReady})},_onAssessmentsComplete:function(state){var assessmentId=state.id;state.isComplete=true;if(assessmentId===undefined)return;if(!this._getStateByAssessmentId(assessmentId)){Adapt.log.warn("assessments: state was not registered when assessment was created")}this.saveState();this._setPageProgress();this._checkAssessmentsComplete()},_restoreModelState:function(assessmentModel){if(!this._saveStateModel){this._saveStateModel=Adapt.offlineStorage.get("a")}if(this._saveStateModel){var state=assessmentModel.getState();if(this._saveStateModel[state.id]){assessmentModel.setRestoreState(Adapt.offlineStorage.deserialize(this._saveStateModel[state.id]))}}},_handleRoute:function(plugin,id){if(plugin!=="assessment"&&plugin!=="article-assessment"||id===undefined){return}if(!Adapt.findById(id)){var assessment=Adapt.assessment._assessments._byAssessmentId[id];if(assessment){id=assessment.get("_id")}else{Adapt.log.warn("Assessment not found with _id: "+id);return}}_.defer(function(){Backbone.history.navigate("#/id/"+id,{trigger:true,replace:true})})},_checkResetAssessmentsOnRevisit:function(toObject){if(toObject._contentType!=="page")return;var pageAssessmentModels=this._getAssessmentByPageId(toObject._currentId);if(pageAssessmentModels===undefined)return;Adapt.wait.for(function resetAllAssessments(allAssessmentHaveReset){var numberOfAssessments=pageAssessmentModels.length;var numberOfResetAssessments=0;var forceAssessmentReset=false;pageAssessmentModels.forEach(function(model){model.reset(forceAssessmentReset,function(){numberOfResetAssessments++;var haveAllModelsReset=numberOfResetAssessments===numberOfAssessments;if(!haveAllModelsReset){return}allAssessmentHaveReset()})})});this._setPageProgress()},_onDataReady:function(){this._assessments=_.extend([],{_byPageId:{},_byAssessmentId:{}});this._restoredCount=0},_checkAssessmentsComplete:function(){var allAssessmentsComplete=true;var assessmentToPostBack=0;var states=this._getStatesByAssessmentId();var assessmentStates=[];for(var id in states){var state=states[id];if(!state.includeInTotalScore)continue;if(!state.isComplete){allAssessmentsComplete=false;break}assessmentToPostBack++;assessmentStates.push(state)}if(!allAssessmentsComplete||assessmentToPostBack===0)return false;if(assessmentToPostBack===1){this._setupSingleAssessmentConfiguration(assessmentStates[0])}_.defer(function(){Adapt.trigger("assessment:complete",this.getState())}.bind(this));return true},_setupSingleAssessmentConfiguration:function(assessmentState){var assessmentsConfig=Adapt.course.get("_assessment");$.extend(true,assessmentsConfig,{_isPercentageBased:assessmentState.isPercentageBased,_scoreToPass:assessmentState.scoreToPass});Adapt.course.set("_assessment",assessmentsConfig)},_getAssessmentByPageId:function(pageId){return this._assessments._byPageId[pageId]},_getStateByAssessmentId:function(assessmentId){if(assessmentId===undefined){return null}return this._assessments._byAssessmentId[assessmentId].getState()},_getStatesByAssessmentId:function(){var states={};for(var i=0,l=this._assessments.length;i<l;i++){var assessmentModel=this._assessments[i];if(!assessmentModel.get("_isAvailable"))continue;var state=assessmentModel.getState();states[state.id]=state}return states},_setPageProgress:function(){for(var k in this._assessments._byPageId){var assessments=this._assessments._byPageId[k];var assessmentsTotal=assessments.length;var assessmentsPassed=0;for(var i=0,l=assessments.length;i<l;i++){var assessmentState=assessments[i].getState();if(assessmentState.includeInTotalScore&&!assessmentState.isPass)continue;if(assessmentState.isComplete){assessmentsPassed++}}try{var pageModel=Adapt.findById(k);pageModel.set({_subProgressTotal:assessmentsTotal,_subProgressComplete:assessmentsPassed})}catch(e){}}},_addToAssessmentIdMap:function(id,model){if(id===undefined){Adapt.log.warn("An assessment has been registered with an undefined value for \"_id\"");return}if(id===""){Adapt.log.warn("An assessment has been registered with an empty value for \"_id\"")}if(!this._assessments._byAssessmentId[id]){this._assessments._byAssessmentId[id]=model}else{Adapt.log.warn("An assessment with an _id of \""+id+"\" already exists!")}},_setupQuestionNumbering:function(){var getRelatedQuestions=function(data){var currentAssessmentId=data._assessmentId;var currentAssessment=Adapt.assessment.get(currentAssessmentId);return currentAssessment.getState().questions};Handlebars.registerHelper("questionNumber",function getQuestionNumber(){var data=this.view?this.view.model.toJSON():this;if(!data._isPartOfAssessment)return;var related=_.pluck(getRelatedQuestions(data),"_id");return related.indexOf(data._id)+1});Handlebars.registerHelper("questionCount",function getTotalQuestions(){var data=this.view?this.view.model.toJSON():this;if(!data._isPartOfAssessment)return;return getRelatedQuestions(data).length})},register:function(assessmentModel){var state=assessmentModel.getState();var assessmentId=state.id;var pageId=state.pageId;if(this._assessments._byPageId[pageId]===undefined){this._assessments._byPageId[pageId]=[]}this._assessments._byPageId[pageId].push(assessmentModel);this._addToAssessmentIdMap(assessmentId,assessmentModel);this._assessments.push(assessmentModel);this._restoreModelState(assessmentModel);this._restoredCount++;Adapt.trigger("assessments:register",state,assessmentModel);this._setPageProgress();this._setupQuestionNumbering();if(this._restoredCount===this._assessments.length){Adapt.trigger("assessment:restored",this.getState())}},get:function(id){if(id===undefined){return this._assessments.slice(0)}else{return this._assessments._byAssessmentId[id]}},saveState:function(){this._saveStateModel={};for(var i=0,assessmentModel;assessmentModel=this._assessments[i++];){var state=assessmentModel.getState();this._saveStateModel[state.id]=Adapt.offlineStorage.serialize(assessmentModel.getSaveState())}Adapt.offlineStorage.set("a",this._saveStateModel)},getConfig:function(){var assessmentsConfig=Adapt.course.get("_assessment");if(assessmentsConfig&&assessmentsConfig._isDefaultsLoaded){return assessmentsConfig}if(assessmentsConfig===undefined){assessmentsConfig=$.extend(true,{},assessmentsConfigDefaults)}else{assessmentsConfig=$.extend(true,{},assessmentsConfigDefaults,assessmentsConfig)}Adapt.course.set("_assessment",assessmentsConfig);return assessmentsConfig},getState:function(){var assessmentsConfig=this.getConfig();var score=0;var maxScore=0;var isPass=false;var totalAssessments=0;var states=this._getStatesByAssessmentId();var assessmentsComplete=0;for(var id in states){var state=states[id];if(!state.includeInTotalScore)continue;if(state.isComplete)assessmentsComplete++;totalAssessments++;maxScore+=state.maxScore/state.assessmentWeight;score+=state.score/state.assessmentWeight}var isComplete=assessmentsComplete==totalAssessments;var scoreAsPercent=Math.round(score/maxScore*100);if((assessmentsConfig._scoreToPass||100)&&isComplete){if(assessmentsConfig._isPercentageBased!==false){if(scoreAsPercent>=assessmentsConfig._scoreToPass)isPass=true}else{if(score>=assessmentsConfig._scoreToPass)isPass=true}}return{isComplete:isComplete,isPercentageBased:assessmentsConfig._isPercentageBased,isPass:isPass,scoreAsPercent:scoreAsPercent,maxScore:maxScore,score:score,scoreToPass:assessmentsConfig._scoreToPass,assessmentsComplete:assessmentsComplete,assessments:totalAssessments}}},Backbone.Events);Adapt.assessment.initialize();var ArticleViewInitialize=ArticleView$1.prototype.initialize;ArticleView$1.prototype.initialize=function(options){if(this.model.get("_assessment")&&this.model.get("_assessment")._isEnabled===true){_.extend(this,AdaptAssessmentArticleView)}return ArticleViewInitialize.apply(this,arguments)};var ArticleModelInitialize=ArticleModel$1.prototype.initialize;ArticleModel$1.prototype.initialize=function(options){if(this.get("_assessment")&&this.get("_assessment")._isEnabled===true){_.extend(this,AdaptAssessmentArticleModel);var returnValue=ArticleModelInitialize.apply(this,arguments);this._postInitialize();return returnValue}return ArticleModelInitialize.apply(this,arguments)};var Bookmarking=Backbone.Controller.extend({bookmarkLevel:null,watchViewIds:null,watchViews:[],restoredLocationID:null,currentLocationID:null,initialize:function(){this.listenToOnce(Adapt,"router:location",this.onAdaptInitialize)},onAdaptInitialize:function(){if(!this.checkIsEnabled())return;this.setupEventListeners();this.checkRestoreLocation()},checkIsEnabled:function(){Adapt.course.set("_bookmarking",{_isEnabled:true,_level:"block",title:"Resume",body:"Would you like to resume the course from where you previously left off?",_buttons:{"yes":"Yes","no":"No"}});var courseBookmarkModel=Adapt.course.get("_bookmarking");if(!courseBookmarkModel||!courseBookmarkModel._isEnabled)return false;if(!Adapt.offlineStorage)return false;return true},setupEventListeners:function(){this._onScroll=_.debounce(this.checkLocation.bind(this),1000);this.listenTo(Adapt,{"menuView:ready":this.setupMenu,"pageView:preRender":this.setupPage})},checkRestoreLocation:function(){this.restoredLocationID=Adapt.offlineStorage.get("location");if(!this.restoredLocationID||this.restoredLocationID==="undefined")return;console.log("%cBookmark:    ".concat(this.restoredLocationID),"color: green;");this.listenToOnce(Adapt,"pageView:ready menuView:ready",this.restoreLocation)},restoreLocation:function(){_.defer(function(){this.stopListening(Adapt,"pageView:ready menuView:ready",this.restoreLocation);if(this.restoredLocationID===Adapt.location._currentId||!Adapt.findById(this.restoredLocationID)){return}var locationOnscreen=$("."+this.restoredLocationID).onscreen();var isLocationOnscreen=locationOnscreen&&locationOnscreen.percentInview>0;var isLocationFullyInview=locationOnscreen&&locationOnscreen.percentInview===100;if(isLocationOnscreen&&isLocationFullyInview){return}if(Adapt.course.get("_bookmarking")._showPrompt===false){this.navigateToPrevious();return}this.showPrompt()}.bind(this))},showPrompt:function(){var courseBookmarkModel=Adapt.course.get("_bookmarking");var buttons=courseBookmarkModel._buttons||{yes:"Yes",no:"No"};this.listenToOnce(Adapt,{"bookmarking:continue":this.navigateToPrevious,"bookmarking:cancel":this.navigateCancel});var promptObject={title:courseBookmarkModel.title,body:courseBookmarkModel.body,_classes:"bookmarking",_prompts:[{promptText:buttons.yes||"Yes",_callbackEvent:"bookmarking:continue"},{promptText:buttons.no||"No",_callbackEvent:"bookmarking:cancel"}],_showIcon:true};var accessibility=Adapt.config.get("_accessibility");if(!accessibility||!accessibility._isActive){Adapt.notify.prompt(promptObject);return}$(".js-loading").show();$("#a11y-focuser").focus();$("body").attr("aria-hidden",true);_.delay(function(){$(".js-loading").hide();$("body").removeAttr("aria-hidden");Adapt.notify.prompt(promptObject)},3000)},navigateToPrevious:function(){_.defer(function(){Adapt.contentObjects.models.length==1;try{Adapt.hybMenu.navToBlockId(this.restoredLocationID)}catch(err){Adapt.log.error("adapt-contrib-bookmarking: could not change current block (adapt-hyb-menu extension not included in build).")}}.bind(this));this.stopListening(Adapt,"bookmarking:cancel")},navigateCancel:function(){this.stopListening(Adapt,"bookmarking:continue")},resetLocationID:function(){this.setLocationID("")},setupMenu:function(menuView){var menuModel=menuView.model;if(!menuModel.get("_parentId")){this.resetLocationID();return}this.setLocationID(menuModel.get("_id"))},getBookmarkLevel:function(pageModel){var defaultLevel=Adapt.course.get("_bookmarking")._level||"component";var bookmarkModel=pageModel.get("_bookmarking");var isInherit=!bookmarkModel||!bookmarkModel._level||bookmarkModel._level==="inherit";return isInherit?defaultLevel:bookmarkModel._level},setupPage:function(pageView){var pageBookmarkModel=pageView.model.get("_bookmarking");if(pageBookmarkModel&&pageBookmarkModel._isEnabled===false){this.resetLocationID();return}this.setLocationID(pageView.model.get("_id"));this.bookmarkLevel=this.getBookmarkLevel(pageView.model);if(this.bookmarkLevel==="page"){return}this.watchViewIds=pageView.model.findDescendantModels(this.bookmarkLevel).map(function(desc){return desc.get("_id")});this.listenTo(Adapt,this.bookmarkLevel+"View:postRender",this.captureViews);this.listenToOnce(Adapt,"remove",this.releaseViews);$(window).on("scroll",this._onScroll)},captureViews:function(view){this.watchViews.push(view)},setLocationID:function(id){if(!Adapt.offlineStorage)return;if(this.currentLocationID==id)return;Adapt.offlineStorage.set("location",id);this.currentLocationID=id},releaseViews:function(){this.watchViews.length=0;this.watchViewIds.length=0;this.stopListening(Adapt,"remove",this.releaseViews);this.stopListening(Adapt,this.bookmarkLevel+"View:postRender",this.captureViews);$(window).off("scroll",this._onScroll)},checkLocation:function(){var highestOnscreen=0;var highestOnscreenLocation="";for(var i=0,l=this.watchViews.length;i<l;i++){var view=this.watchViews[i];var isViewAPageChild=this.watchViewIds.indexOf(view.model.get("_id"))>-1;if(!isViewAPageChild)continue;var element=$("."+view.model.get("_id"));var measurements=element.onscreen();if(!measurements.onscreen)continue;if(measurements.percentInview>highestOnscreen){highestOnscreen=measurements.percentInview;highestOnscreenLocation=view.model.get("_id")}}if(highestOnscreenLocation)this.setLocationID(highestOnscreenLocation)}});__AMD("extensions/adapt-contrib-bookmarking/js/adapt-contrib-bookmarking",new Bookmarking);var NavigationView=Backbone.View.extend({className:"nav",attributes:{role:"navigation"},initialize:function(){this.template="languagePickerNavigation";this.setupHelpers();this.preRender()},preRender:function(){Adapt.trigger("navigationView:preRender",this);this.render()},render:function(){var template=Handlebars.templates[this.template];this.$el.html(template({_config:this.model.get("_accessibility"),_accessibility:Adapt.config.get("_accessibility")})).insertBefore("#app");_.defer(function(){Adapt.trigger("navigationView:postRender",this)}.bind(this));return this},setupHelpers:function(){Handlebars.registerHelper("a11y_aria_label",function(text){return"<div class=\"aria-label\">"+text+"</div>"})}});var NavigationView$1=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerNavigationView",NavigationView);var LanguagePickerView=Backbone.View.extend({events:{"click .js-languagepicker-btn-click":"onLanguageClick"},className:"languagepicker",initialize:function(){this.initializeNavigation();$("html").addClass("in-languagepicker");this.listenTo(Adapt,"remove",this.remove);this.render()},render:function(){var data=this.model.toJSON();var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data));this.$el.addClass(data._classes);document.title=this.model.get("title")||"";_.defer(this.postRender.bind(this))},postRender:function(){$(".js-loading").hide()},onLanguageClick:function(event){this.destroyNavigation();this.model.setLanguage($(event.target).val())},initializeNavigation:function(){this.navigationView=new NavigationView$1({model:this.model})},destroyNavigation:function(){this.navigationView.remove()},remove:function(){$("html").removeClass("in-languagepicker");Backbone.View.prototype.remove.apply(this,arguments)}},{template:"languagePickerView"});var LanguagePickerView$1=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerView",LanguagePickerView);var LanguagePickerDrawerView=Backbone.View.extend({events:{"click .js-languagepicker-item-btn":"onButtonClick"},initialize:function(){this.listenTo(Adapt,{remove:this.remove,"languagepicker:changelanguage:yes":this.onDoChangeLanguage,"languagepicker:changelanguage:no":this.onDontChangeLanguage});this.render()},render:function(){var data=this.model.toJSON();var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))},onButtonClick:function(event){var newLanguage=$(event.currentTarget).attr("data-language");this.model.set("newLanguage",newLanguage);var data=this.model.getLanguageDetails(newLanguage);var promptObject={_attributes:{lang:newLanguage},_classes:"is-lang-".concat(newLanguage," ").concat(data._direction==="rtl"?"is-rtl":"is-ltr"),title:data.warningTitle,body:data.warningMessage,_prompts:[{promptText:data._buttons.yes,_callbackEvent:"languagepicker:changelanguage:yes"},{promptText:data._buttons.no,_callbackEvent:"languagepicker:changelanguage:no"}],_showIcon:true};if($.a11y){this.$finishFocus=$.a11y.state.focusStack.pop();$.a11y.state.focusStack.push($("#focuser"))}else{this.$finishFocus=Adapt.a11y._popup._focusStack.pop();Adapt.a11y._popup._focusStack.push($("#a11y-focuser"))}Adapt.once("drawer:closed",function(){_.delay(function(){Adapt.once("popup:opened",function(){if($.a11y){$.a11y.state.focusStack.pop();$.a11y.state.focusStack.push($("#focuser"));return}Adapt.a11y._popup._focusStack.pop();Adapt.a11y._popup._focusStack.push($("#a11y-focuser"))});Adapt.notify.prompt(promptObject)},250)});Adapt.trigger("drawer:closeDrawer")},onDoChangeLanguage:function(){var newLanguage=this.model.get("newLanguage");this.model.setTrackedData();this.model.setLanguage(newLanguage);this.remove()},onDontChangeLanguage:function(){this.remove();_.delay(function(){this.$finishFocus.a11y_focus()}.bind(this),500)}},{template:"languagePickerDrawerView"});var LanguagePickerDrawerView$1=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerDrawerView",LanguagePickerDrawerView);var LanguagePickerNavView=Backbone.View.extend({tagName:"button",className:function(){var classNames="btn-icon nav__btn nav__languagepicker-btn js-languagepicker-nav-btn icon";var customClass=this.model.get("_languagePickerIconClass")||"icon-language-2";return classNames+" "+customClass},events:{"click":"onClick"},initialize:function(){this.listenTo(Adapt,"remove",this.remove)},onClick:function(event){Adapt.drawer.triggerCustomView(new LanguagePickerDrawerView$1({model:this.model}).$el,false)}});var LanguagePickerNavView$1=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerNavView",LanguagePickerNavView);var LanguagePickerModel=Backbone.Model.extend({defaults:{_isEnabled:false,displayTitle:"",body:"",_languages:[]},trackedData:{components:[],blocks:[]},locationId:null,initialize:function(){this.listenTo(Adapt.config,"change:_activeLanguage",this.markLanguageAsSelected);this.listenTo(Adapt,"app:dataLoaded",this.onDataLoaded)},getLanguageDetails:function(language){var _languages=this.get("_languages");return _.find(_languages,function(item){return item._language===language})},setLanguage:function(language){Adapt.config.set({"_activeLanguage":language,"_defaultDirection":this.getLanguageDetails(language)._direction})},markLanguageAsSelected:function(model,language){this.get("_languages").forEach(function(item){item._isSelected=item._language===language})},onDataLoaded:function(){if(!this.get("_restoreStateOnLanguageChange")){return}_.defer(function(){this.locationId=Adapt.offlineStorage.get("location")||null;this.restoreState()}.bind(this))},restoreLocation:function(){if(!Adapt.mapById(this.locationId))return;_.defer(function(){Adapt.navigateToElement("."+this.locationId)}.bind(this))},restoreState:function(){if(this.isTrackedDataEmpty())return;if(this.trackedData.components){this.trackedData.components.forEach(this.setTrackableState)}if(this.trackedData.blocks){this.trackedData.blocks.forEach(this.setTrackableState)}},isTrackedDataEmpty:function(){return _.isEqual(this.trackedData,{components:[],blocks:[]})},getTrackableState:function(){var components=this.getState(Adapt.components.models);var blocks=this.getState(Adapt.blocks.models);return{components:_.compact(components),blocks:_.compact(blocks)}},getState:function(models){return models.map(function(model){if(model.get("_isComplete")){return model.getTrackableState()}})},setTrackedData:function(){if(this.get("_restoreStateOnLanguageChange")){this.listenToOnce(Adapt,"menuView:ready",this.restoreLocation);this.trackedData=this.getTrackableState()}},setTrackableState:function(stateObject){var restoreModel=Adapt.findById(stateObject._id);if(restoreModel){restoreModel.setTrackableState(stateObject)}else{Adapt.log.warn("LanguagePicker unable to restore state for: "+stateObject._id)}}});var LanguagePickerModel$1=__AMD("extensions/adapt-contrib-languagePicker/js/languagePickerModel",LanguagePickerModel);var languagePickerModel;Adapt.once("configModel:dataLoaded",onConfigLoaded);function onConfigLoaded(){if(!Adapt.config.has("_languagePicker"))return;if(!Adapt.config.get("_languagePicker")._isEnabled)return;Adapt.config.set("_canLoadData",false);languagePickerModel=new LanguagePickerModel$1(Adapt.config.get("_languagePicker"));Adapt.on("router:menu router:page",setupNavigationView);if(Adapt.offlineStorage.ready){onOfflineStorageReady()}else{Adapt.once("offlineStorage:ready",onOfflineStorageReady)}}function onOfflineStorageReady(){var storedLanguage=Adapt.offlineStorage.get("lang");if(storedLanguage){languagePickerModel.setLanguage(storedLanguage)}else if(languagePickerModel.get("_showOnCourseLoad")===false){languagePickerModel.setLanguage(Adapt.config.get("_defaultLanguage"))}else{showLanguagePickerView()}}function showLanguagePickerView(){var languagePickerView=new LanguagePickerView$1({model:languagePickerModel});languagePickerView.$el.appendTo("#wrapper")}function setupNavigationView(){var courseGlobals=Adapt.course.get("_globals")._extensions;var navigationBarLabel="";if(courseGlobals._languagePicker){navigationBarLabel=courseGlobals._languagePicker.navigationBarLabel}var languagePickerNavView=new LanguagePickerNavView$1({model:languagePickerModel,attributes:{"aria-label":navigationBarLabel}});languagePickerNavView.$el.appendTo(".nav__inner")}var Completion=Backbone.Controller.extend({subProgressCompleted:0,subProgressTotal:0,nonAssessmentCompleted:0,nonAssessmentTotal:0,assessmentCompleted:0,assessmentTotal:0});function calculateCompletion(contentObjectModel){var completion=new Completion;var viewType=contentObjectModel.get("_type");var isComplete=contentObjectModel.get("_isComplete")?1:0;var children;switch(viewType){case"page":children=contentObjectModel.getAllDescendantModels().filter(function(model){return model.get("_isAvailable")&&!model.get("_isOptional")});var availableChildren=filterAvailableChildren(children);var components=getPageLevelProgressEnabledModels(availableChildren);var nonAssessmentComponents=getNonAssessmentComponents(components);completion.nonAssessmentTotal=nonAssessmentComponents.length;completion.nonAssessmentCompleted=getComponentsCompleted(nonAssessmentComponents).length;var assessmentComponents=getAssessmentComponents(components);completion.assessmentTotal=assessmentComponents.length;completion.assessmentCompleted=getComponentsInteractionCompleted(assessmentComponents).length;if(contentObjectModel.get("_pageLevelProgress")._excludeAssessments!==true){completion.subProgressCompleted=contentObjectModel.get("_subProgressComplete")||0;completion.subProgressTotal=contentObjectModel.get("_subProgressTotal")||0}var showPageCompletionCourse=Adapt.course.get("_pageLevelProgress")&&Adapt.course.get("_pageLevelProgress")._showPageCompletion!==false;var showPageCompletionPage=contentObjectModel.get("_pageLevelProgress")&&contentObjectModel.get("_pageLevelProgress")._showPageCompletion!==false;if(showPageCompletionCourse&&showPageCompletionPage){completion.nonAssessmentCompleted+=isComplete;completion.nonAssessmentTotal+=1}break;case"menu":case"course":children=contentObjectModel.get("_children").models;children.forEach(function(contentObject){var completionObject=calculateCompletion(contentObject);completion.subProgressCompleted+=completionObject.subProgressCompleted||0;completion.subProgressTotal+=completionObject.subProgressTotal||0;completion.nonAssessmentTotal+=completionObject.nonAssessmentTotal;completion.nonAssessmentCompleted+=completionObject.nonAssessmentCompleted;completion.assessmentTotal+=completionObject.assessmentTotal;completion.assessmentCompleted+=completionObject.assessmentCompleted});break;}return completion}function getNonAssessmentComponents(models){return models.filter(function(model){return!model.get("_isPartOfAssessment")})}function getAssessmentComponents(models){return models.filter(function(model){return model.get("_isPartOfAssessment")})}function getComponentsCompleted(models){return models.filter(function(item){return item.get("_isComplete")})}function getComponentsInteractionCompleted(models){return models.filter(function(item){return item.get("_isComplete")})}function getPageLevelProgressEnabledModels(models){return models.filter(function(model){var config=model.get("_pageLevelProgress");return config&&config._isEnabled})}function unavailableInHierarchy(parents){if(!parents)return;return parents.some(function(parent){return!parent.get("_isAvailable")})}function filterAvailableChildren(children){var availableChildren=[];for(var i=0,count=children.length;i<count;i++){var parents=children[i].getAncestorModels();if(unavailableInHierarchy(parents))continue;availableChildren.push(children[i])}return availableChildren}function calculatePercentageComplete(model){var completionObject=calculateCompletion(model);var completed=completionObject.nonAssessmentCompleted+completionObject.assessmentCompleted+completionObject.subProgressCompleted;var total=completionObject.nonAssessmentTotal+completionObject.assessmentTotal+completionObject.subProgressTotal;var percentageComplete=Math.floor(completed/total*100);return percentageComplete}var completionCalculations=__AMD("extensions/adapt-contrib-pageLevelProgress/js/completionCalculations",{calculateCompletion:calculateCompletion,calculatePercentageComplete:calculatePercentageComplete,getPageLevelProgressEnabledModels:getPageLevelProgressEnabledModels,filterAvailableChildren:filterAvailableChildren});var PageLevelProgressIndicatorView=Backbone.View.extend({initialize:function(options){options=options||{};this.parent=options.parent;this.calculatePercentage=options.calculatePercentage||this.calculatePercentage;this.ariaLabel=options.ariaLabel||"";this.type=options.type||this.model.get("_type");this.addClasses();this.setUpEventListeners();this.setPercentageComplete();this.render();this.refresh()},addClasses:function(){this.$el.addClass(["pagelevelprogress__indicator","is-"+this.type].join(" "))},checkAria:function(){if(!this.ariaLabel){this.$el.attr("aria-hidden",true);return}var data=this.getRenderData();this.$(".js-indicator-aria-label").html(Handlebars.compile(this.ariaLabel)(data))},setUpEventListeners:function(){if(this.parent){this.listenToOnce(this.parent,"postRemove",this.remove)}else{this.listenTo(Adapt,"remove",this.remove)}this.listenTo(this.model,"change:_isComplete",this.refresh);if(!this.collection)return;this.listenTo(this.collection,"change:_isComplete",this.refresh)},setPercentageComplete:function(){var percentage=this.calculatePercentage();this.model.set("percentageComplete",percentage);return percentage},calculatePercentage:function(){return this.model.get("_isComplete")?100:0},render:function(){var data=this.getRenderData();var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))},getRenderData:function(){var data=this.model.toJSON();data.ariaLabel=this.ariaLabel;data.type=this.type;return data},refresh:function(){this.checkCompletion();this.checkAria();this.$(".js-indicator-bar").css({width:this.calculatePercentage()+"%"})},checkCompletion:function(){var percentage=this.setPercentageComplete();this.$el.toggleClass("is-complete",percentage===100).toggleClass("is-incomplete",percentage!==100)}},{template:"pageLevelProgressIndicator"});var PageLevelProgressIndicatorView$1=__AMD("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressIndicatorView",PageLevelProgressIndicatorView);var PageLevelProgressItemView=Backbone.View.extend({className:function(){return["pagelevelprogress__item drawer__item",this.model.get("_type")+"__indicator"].join(" ")},attributes:{"role":"listitem"},initialize:function(){this.listenTo(Adapt,"remove",this.remove);this.render();this.addIndicator()},render:function(){var data=this.model.toJSON();var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))},addIndicator:function(){if(this.model.get("_isOptional"))return;var item=new PageLevelProgressIndicatorView$1({model:this.model});this.$(".js-indicator").append(item.$el)}},{template:"pageLevelProgressItem"});var PageLevelProgressItemView$1=__AMD("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressItemView",PageLevelProgressItemView);var PageLevelProgressView=Backbone.View.extend({className:"pagelevelprogress",events:{"click .js-pagelevelprogress-item-click":"scrollToPageElement"},initialize:function(){this.listenTo(Adapt,"remove",this.remove);this.render();this.addChildren()},scrollToPageElement:function(){var _ref=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(event){var $target,id,model,currentComponentSelector;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(event&&event.preventDefault)event.preventDefault();$target=$(event.currentTarget);if(!$target.is(".is-disabled")){_context.next=4;break}return _context.abrupt("return");case 4:id=$target.attr("data-pagelevelprogress-id");model=Adapt.findById(id);if(model.get("_isRendered")){_context.next=15;break}_context.prev=7;_context.next=10;return Adapt.parentView.renderTo(id);case 10:_context.next=15;break;case 12:_context.prev=12;_context.t0=_context["catch"](7);return _context.abrupt("return");case 15:currentComponentSelector="."+id;Adapt.once("drawer:closed",function(){Adapt.scrollTo(currentComponentSelector,{duration:400})}).trigger("drawer:closeDrawer",$(currentComponentSelector));case 17:case"end":return _context.stop();}},_callee,null,[[7,12]])}));return function scrollToPageElement(_x){return _ref.apply(this,arguments)}}(),render:function(){var template=Handlebars.templates["pageLevelProgress"];this.$el.html(template({}))},addChildren:function(){var $children=this.$(".js-children");this.collection.each(function(model){$children.append(new PageLevelProgressItemView$1({model:model}).$el)}.bind(this))}});var PageLevelProgressView$1=__AMD("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressView",PageLevelProgressView);var PageLevelProgressNavigationView=Backbone.View.extend({tagName:"button",className:"btn-icon nav__btn nav__pagelevelprogress-btn pagelevelprogress__nav-btn",events:{"click":"onProgressClicked"},initialize:function(){_.bindAll(this,"updateProgressBar");this.setUpEventListeners();this.render();this.addIndicator();this.deferredUpdate()},setUpEventListeners:function(){this.listenTo(Adapt,{"remove":this.remove,"router:location":this.updateProgressBar,"view:childAdded pageLevelProgress:update":this.refreshProgressBar})},render:function(){var template=Handlebars.templates["pageLevelProgressNavigation"];this.$el.html(template({}))},addIndicator:function(){this.indicatorView=new PageLevelProgressIndicatorView$1({model:this.model,collection:this.collection,calculatePercentage:this._getPageCompletionPercentage,ariaLabel:Adapt.course.get("_globals")._extensions._pageLevelProgress.pageLevelProgressIndicatorBar});this.$el.prepend(this.indicatorView.$el)},_getPageCompletionPercentage:function(){return completionCalculations.calculatePercentageComplete(this.model)},deferredUpdate:function(){_.defer(this.updateProgressBar)},updateProgressBar:function(){this.indicatorView.refresh()},refreshProgressBar:function(){this.collection.repopulate();this.updateProgressBar()},onProgressClicked:function(event){if(event&&event.preventDefault)event.preventDefault();Adapt.drawer.triggerCustomView(new PageLevelProgressView$1({collection:this.collection}).$el,false)},remove:function(){Backbone.View.prototype.remove.call(this);this.collection.reset()}});var PageLevelProgressNavigationView$1=__AMD("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressNavigationView",PageLevelProgressNavigationView);var PageLevelProgressCollection=Backbone.Collection.extend({initialize:function(models,options){this.listenTo(Adapt,"remove",this.reset);if(!options||!options.pageModel)return;this._pageModel=options.pageModel;this.repopulate()},repopulate:function(){this.reset();if(!this._pageModel)return;var allDescendants=this._pageModel.getAllDescendantModels(true);var currentPageItems=allDescendants.filter(function(item){return item.get("_isAvailable")===true});var availableItems=completionCalculations.filterAvailableChildren(currentPageItems);var enabledProgressItems=completionCalculations.getPageLevelProgressEnabledModels(availableItems);this.add(enabledProgressItems)}});var PageLevelProgressCollection$1=__AMD("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressCollection",PageLevelProgressCollection);var PageLevelProgress=Backbone.Controller.extend({initialize:function(){Adapt.on({"app:dataReady":this.onDataReady.bind(this),"app:languageChanged":function(){this.stopListening()}.bind(this)})},getCourseConfig:function(){return Adapt.course.get("_pageLevelProgress")},onDataReady:function(){var coursePLPConfig=this.getCourseConfig();if(!coursePLPConfig||!coursePLPConfig._isEnabled){return}this.setUpEventListeners()},setUpEventListeners:function(){var headerIndicatorTypes=["menu","menuItem","page","article","block","component"];var headerIndicatorEventNames=headerIndicatorTypes.concat([""]).join("View:render ");this.listenTo(Adapt,headerIndicatorEventNames,this.renderHeaderIndicatorView);this.listenTo(Adapt,{"menuItemView:postRender":this.renderMenuItemIndicatorView,"router:page":this.renderNavigationView});this.listenTo(Adapt.course,"bubble:change:_isComplete",this.onCompletionChange)},onCompletionChange:function(event){if(!Adapt.location._currentId)return;var currentModel=Adapt.findById(Adapt.location._currentId);var completionState={currentLocation:completionCalculations.calculatePercentageComplete(currentModel),course:completionCalculations.calculatePercentageComplete(Adapt.course)};var hasChanged=!_.isMatch(this._previousCompletionState,completionState);if(!hasChanged)return;this._previousCompletionState=completionState;Adapt.trigger("pageLevelProgress:percentageCompleteChange",completionState)},renderHeaderIndicatorView:function(view){var model=view.model;var config=model.get("_pageLevelProgress");if(!config||!config._isEnabled||!config._isCompletionIndicatorEnabled){return}var pageModel=model.findAncestor("contentObjects");var pageConfig=pageModel&&pageModel.get("_pageLevelProgress");if(pageConfig&&!pageConfig._isEnabled){return}var $headings=view.$(".js-heading");$headings.each(function(index,el){var $el=$(el);var indicatorView=new PageLevelProgressIndicatorView$1({parent:view,model:model});indicatorView.$el.insertAfter($el)})},renderMenuItemIndicatorView:function(view){if(view.model.get("_id")===Adapt.location._currentId){return}var viewType=view.model.get("_type");if(viewType==="course"){return}var pageLevelProgress=view.model.get("_pageLevelProgress");if(!pageLevelProgress||!pageLevelProgress._isEnabled){return}view.$el.find(".js-menu-item-progress").append(new PageLevelProgressIndicatorView$1({parent:view,model:view.model,type:"menu-item",calculatePercentage:this._getMenuItemCompletionPercentage.bind(view),ariaLabel:Adapt.course.get("_globals")._extensions._pageLevelProgress.pageLevelProgressMenuBar}).$el)},_getMenuItemCompletionPercentage:function(){return completionCalculations.calculatePercentageComplete(this.model)},renderNavigationView:function(pageModel){var coursePLPConfig=this.getCourseConfig();if(coursePLPConfig&&coursePLPConfig._isShownInNavigationBar===false){return}var pagePLPConfig=pageModel.get("_pageLevelProgress");if(!pagePLPConfig||!pagePLPConfig._isEnabled){return}var collection=new PageLevelProgressCollection$1(null,{pageModel:pageModel});if(collection.length===0){return}$(".nav__drawer-btn").after(new PageLevelProgressNavigationView$1({model:pageModel,collection:collection}).$el)}});Adapt.pageLevelProgress=new PageLevelProgress;var ResourcesView=Backbone.View.extend({className:"resources",initialize:function(){this.listenTo(Adapt,"remove",this.remove);this.render()},events:{"click .js-resources-filter-btn-click":"onFilterClicked"},render:function(){this.$el.html(Handlebars.templates.resources({model:this.model.toJSON(),resources:this.collection.toJSON()}));_.defer(function(){this.listenTo(Adapt,"drawer:triggerCustomView",this.remove)}.bind(this));return this},onFilterClicked:function(e){if(e&&e.preventDefault)e.preventDefault();this.$(".js-resources-filter-btn-click").removeClass("is-selected");var items;var filter=$(e.currentTarget).addClass("is-selected").attr("data-filter");if(filter==="all"){items=this.$(".js-resources-item").removeClass("u-display-none")}else{this.$(".js-resources-item").removeClass("u-display-none").not(".is-"+filter).addClass("u-display-none");items=this.$(".js-resources-item.is-"+filter)}if(items.length>0)$(items[0]).a11y_focus()}});var ResourcesView$1=__AMD("extensions/adapt-contrib-resources/js/adapt-contrib-resourcesView",ResourcesView);var helpers$3={resources_has_type:function(resources,type,block){var hasType=_.some(resources,_.matcher({_type:type}));return hasType?block.fn(this):block.inverse(this)},resources_has_multiple_types:function(resources,block){if(resources.length===1)return block.inverse(this);var allSameType=_.every(resources,_.matcher({_type:resources[0]._type}));return allSameType?block.inverse(this):block.fn(this)},resources_get_column_count:function(resources){return _.uniq(_.pluck(resources,"_type")).length+1},resources_force_download:function(resource,block){if(Adapt.device.browser==="internet explorer"||Adapt.device.OS==="ios"){return block.inverse(this)}return resource._forceDownload||resource.filename?block.fn(this):block.inverse(this)}};for(var name$3 in helpers$3){if(helpers$3.hasOwnProperty(name$3)){Handlebars__default["default"].registerHelper(name$3,helpers$3[name$3])}}function setupResources(resourcesData){var resourcesModel=new Backbone.Model(resourcesData);var resourcesCollection=new Backbone.Collection(resourcesModel.get("_resourcesItems"));Adapt.on("resources:showResources",function(){Adapt.drawer.triggerCustomView(new ResourcesView$1({model:resourcesModel,collection:resourcesCollection}).$el)})}function initResources(){var courseResources=Adapt.course.get("_resources");if(!courseResources||courseResources._isEnabled===false)return;var drawerObject={title:courseResources.title,description:courseResources.description,className:"is-resources",drawerOrder:courseResources._drawerOrder||0};Adapt.drawer.addItem(drawerObject,"resources:showResources");setupResources(courseResources)}Adapt.on("adapt:start",initResources);var Logger=function(){function Logger(){_classCallCheck(this,Logger);this.logArr=[];this.registeredViews=[]}_createClass(Logger,[{key:"getEntries",value:function getEntries(){return this.logArr}},{key:"getLastEntry",value:function getLastEntry(){return this.logArr[this.logArr.length-1]}},{key:"info",value:function info(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_INFO,time:Date.now()};this.updateViews()}},{key:"warn",value:function warn(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_WARN,time:Date.now()};this.updateViews()}},{key:"error",value:function error(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_ERROR,time:Date.now()};this.updateViews()}},{key:"debug",value:function debug(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_DEBUG,time:Date.now()};this.updateViews()}},{key:"registerView",value:function registerView(_view){this.registeredViews[this.registeredViews.length]=_view}},{key:"unregisterView",value:function unregisterView(_view){for(var i=0,l=this.registeredViews.length;i<l;i++){if(this.registeredViews[i]!==_view)continue;this.registeredViews.splice(i,1);i--}}},{key:"updateViews",value:function updateViews(){for(var i=0,l=this.registeredViews.length;i<l;i++){if(!this.registeredViews[i])continue;this.registeredViews[i].update(this)}}}],[{key:"getInstance",value:function getInstance(){if(Logger.instance===null){Logger.instance=new Logger}return Logger.instance}}]);return Logger}();Logger.instance=null;Logger.LOG_TYPE_INFO=0;Logger.LOG_TYPE_WARN=1;Logger.LOG_TYPE_ERROR=2;Logger.LOG_TYPE_DEBUG=3;var Logger$1=__AMD("extensions/adapt-contrib-spoor/js/scorm/logger",Logger);var ScormWrapper=function(){function ScormWrapper(){_classCallCheck(this,ScormWrapper);this.setCompletedWhenFailed=true;this.commitOnStatusChange=true;this.commitOnAnyChange=false;this.timedCommitFrequency=10;this.maxCommitRetries=5;this.commitRetryDelay=1000;this.commitRetryPending=false;this.commitRetries=0;this.lastCommitSuccessTime=null;this.exitStateIfIncomplete="auto";this.exitStateIfComplete="auto";this.timedCommitIntervalID=null;this.retryCommitTimeoutID=null;this.logOutputWin=null;this.startTime=null;this.endTime=null;this.lmsConnected=false;this.finishCalled=false;this.logger=Logger$1.getInstance();this.scorm=pipwerks__default["default"].SCORM;this.scorm.handleExitMode=false;this.suppressErrors=false;this.debouncedCommit=_.debounce(this.commit.bind(this),100);if(window.__debug){this.showDebugWindow()}if(window.API&&window.API.__offlineAPIWrapper||window.API_1484_11&&window.API_1484_11.__offlineAPIWrapper){this.logger.error("Offline SCORM API is being used. No data will be reported to the LMS!")}}_createClass(ScormWrapper,[{key:"getVersion",value:function getVersion(){return this.scorm.version}},{key:"setVersion",value:function setVersion(value){this.logger.debug("ScormWrapper::setVersion: ".concat(value));this.scorm.version=value}},{key:"initialize",value:function initialize(){this.logger.debug("ScormWrapper::initialize");this.lmsConnected=this.scorm.init();if(this.lmsConnected){this.startTime=new Date;this.initTimedCommit()}else{this.handleError("Course could not connect to the LMS")}return this.lmsConnected}},{key:"isFirstSession",value:function isFirstSession(){return this.getValue(this.isSCORM2004()?"cmi.entry":"cmi.core.entry")==="ab-initio"}},{key:"setIncomplete",value:function setIncomplete(){this.setValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status","incomplete");if(this.commitOnStatusChange&&!this.commitOnAnyChange)this.commit()}},{key:"setCompleted",value:function setCompleted(){this.setValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status","completed");if(this.commitOnStatusChange&&!this.commitOnAnyChange)this.commit()}},{key:"setPassed",value:function setPassed(){if(this.isSCORM2004()){this.setValue("cmi.completion_status","completed");this.setValue("cmi.success_status","passed")}else{this.setValue("cmi.core.lesson_status","passed")}if(this.commitOnStatusChange&&!this.commitOnAnyChange)this.commit()}},{key:"setFailed",value:function setFailed(){if(this.isSCORM2004()){this.setValue("cmi.success_status","failed");if(this.setCompletedWhenFailed){this.setValue("cmi.completion_status","completed")}}else{this.setValue("cmi.core.lesson_status","failed")}if(this.commitOnStatusChange&&!this.commitOnAnyChange)this.commit()}},{key:"getStatus",value:function getStatus(){var status=this.getValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status");switch(status.toLowerCase()){case"passed":case"completed":case"incomplete":case"failed":case"browsed":case"not attempted":case"not_attempted":case"unknown":return status;default:this.handleError("ScormWrapper::getStatus: invalid lesson status '".concat(status,"' received from LMS"));return null;}}},{key:"setStatus",value:function setStatus(status){switch(status.toLowerCase()){case"incomplete":this.setIncomplete();break;case"completed":this.setCompleted();break;case"passed":this.setPassed();break;case"failed":this.setFailed();break;default:this.handleError("ScormWrapper::setStatus: the status '".concat(status,"' is not supported."));}}},{key:"getScore",value:function getScore(){return this.getValue(this.isSCORM2004()?"cmi.score.raw":"cmi.core.score.raw")}},{key:"setScore",value:function setScore(_score,_minScore,_maxScore){if(this.isSCORM2004()){this.setValue("cmi.score.raw",_score);this.setValue("cmi.score.min",_minScore);this.setValue("cmi.score.max",_maxScore);var range=_maxScore-_minScore;var scaledScore=((_score-_minScore)/range).toFixed(7);this.setValue("cmi.score.scaled",scaledScore);return}this.setValue("cmi.core.score.raw",_score);if(this.isSupported("cmi.core.score.min"))this.setValue("cmi.core.score.min",_minScore);if(this.isSupported("cmi.core.score.max"))this.setValue("cmi.core.score.max",_maxScore)}},{key:"getLessonLocation",value:function getLessonLocation(){return this.getValue(this.isSCORM2004()?"cmi.location":"cmi.core.lesson_location")}},{key:"setLessonLocation",value:function setLessonLocation(_location){this.setValue(this.isSCORM2004()?"cmi.location":"cmi.core.lesson_location",_location)}},{key:"getSuspendData",value:function getSuspendData(){return this.getValue("cmi.suspend_data")}},{key:"setSuspendData",value:function setSuspendData(_data){this.setValue("cmi.suspend_data",_data)}},{key:"getStudentName",value:function getStudentName(){return this.getValue(this.isSCORM2004()?"cmi.learner_name":"cmi.core.student_name")}},{key:"getStudentId",value:function getStudentId(){return this.getValue(this.isSCORM2004()?"cmi.learner_id":"cmi.core.student_id")}},{key:"setLanguage",value:function setLanguage(_lang){if(this.isSCORM2004()){this.setValue("cmi.learner_preference.language",_lang);return}if(this.isSupported("cmi.student_preference.language")){this.setValue("cmi.student_preference.language",_lang)}}},{key:"commit",value:function commit(){this.logger.debug("ScormWrapper::commit");if(!this.lmsConnected){this.handleError("Course is not connected to the LMS");return}if(this.commitRetryPending){this.logger.debug("ScormWrapper::commit: skipping this commit call as one is already pending.")}else{if(this.scorm.save()){this.commitRetries=0;this.lastCommitSuccessTime=new Date}else{if(this.commitRetries<this.maxCommitRetries&&!this.finishCalled){this.commitRetries++;this.initRetryCommit()}else{var _errorCode=this.scorm.debug.getCode();var _errorMsg="Course could not commit data to the LMS";_errorMsg+="\nError ".concat(_errorCode,": ").concat(this.scorm.debug.getInfo(_errorCode));_errorMsg+="\nLMS Error Info: ".concat(this.scorm.debug.getDiagnosticInfo(_errorCode));this.handleError(_errorMsg)}}}}},{key:"finish",value:function finish(){this.logger.debug("ScormWrapper::finish");if(!this.lmsConnected||this.finishCalled){this.handleError("Course is not connected to the LMS");return}this.finishCalled=true;if(this.timedCommitIntervalID!==null){window.clearInterval(this.timedCommitIntervalID)}if(this.commitRetryPending){window.clearTimeout(this.retryCommitTimeoutID);this.commitRetryPending=false}if(this.logOutputWin&&!this.logOutputWin.closed){this.logOutputWin.close()}this.endTime=new Date;if(this.isSCORM2004()){this.scorm.set("cmi.session_time",this.convertToSCORM2004Time(this.endTime.getTime()-this.startTime.getTime()));this.scorm.set("cmi.exit",this.getExitState())}else{this.scorm.set("cmi.core.session_time",this.convertToSCORM12Time(this.endTime.getTime()-this.startTime.getTime()));this.scorm.set("cmi.core.exit",this.getExitState())}this.lmsConnected=false;if(!this.scorm.quit()){this.handleError("Course could not finish")}}},{key:"recordInteraction",value:function recordInteraction(id,response,correct,latency,type){if(!this.isSupported("cmi.interactions._count")){this.logger.info("ScormWrapper::recordInteraction: cmi.interactions are not supported by this LMS...");return}switch(type){case"choice":this.recordInteractionMultipleChoice.apply(this,arguments);break;case"matching":this.recordInteractionMatching.apply(this,arguments);break;case"numeric":this.isSCORM2004()?this.recordInteractionScorm2004.apply(this,arguments):this.recordInteractionScorm12.apply(this,arguments);break;case"fill-in":this.recordInteractionFillIn.apply(this,arguments);break;case"sequencing":this.recordInteractionSequencing.apply(this,arguments);break;default:console.error("ScormWrapper.recordInteraction: unknown interaction type of '".concat(type,"' encountered..."));}}},{key:"getValue",value:function getValue(_property){this.logger.debug("ScormWrapper::getValue: _property=".concat(_property));if(this.finishCalled){this.logger.debug("ScormWrapper::getValue: ignoring request as 'finish' has been called");return}if(!this.lmsConnected){this.handleError("Course is not connected to the LMS");return}var _value=this.scorm.get(_property);var _errorCode=this.scorm.debug.getCode();var _errorMsg="";if(_errorCode!==0){if(_errorCode===403){this.logger.warn("ScormWrapper::getValue: data model element not initialized")}else{_errorMsg+="Course could not get ".concat(_property);_errorMsg+="\nError Info: ".concat(this.scorm.debug.getInfo(_errorCode));_errorMsg+="\nLMS Error Info: ".concat(this.scorm.debug.getDiagnosticInfo(_errorCode));this.handleError(_errorMsg)}}this.logger.debug("ScormWrapper::getValue: returning ".concat(_value));return _value+""}},{key:"setValue",value:function setValue(_property,_value){this.logger.debug("ScormWrapper::setValue: _property=".concat(_property," _value=").concat(_value));if(this.finishCalled){this.logger.debug("ScormWrapper::setValue: ignoring request as 'finish' has been called");return}if(!this.lmsConnected){this.handleError("Course is not connected to the LMS");return}var _success=this.scorm.set(_property,_value);var _errorCode=this.scorm.debug.getCode();var _errorMsg="";if(!_success){if(_errorCode!==0){_errorMsg+="Course could not set ".concat(_property," to ").concat(_value);_errorMsg+="\nError Info: ".concat(this.scorm.debug.getInfo(_errorCode));_errorMsg+="\nLMS Error Info: ".concat(this.scorm.debug.getDiagnosticInfo(_errorCode));this.handleError(_errorMsg)}else{this.logger.warn("ScormWrapper::setValue: LMS reported that the 'set' call failed but then said there was no error!")}}if(this.commitOnAnyChange)this.debouncedCommit();return _success}},{key:"isSupported",value:function isSupported(_property){this.logger.debug("ScormWrapper::isSupported: _property=".concat(_property));if(this.finishCalled){this.logger.debug("ScormWrapper::isSupported: ignoring request as 'finish' has been called");return}if(!this.lmsConnected){this.handleError("Course is not connected to the LMS");return false}this.scorm.get(_property);return this.scorm.debug.getCode()===401}},{key:"initTimedCommit",value:function initTimedCommit(){this.logger.debug("ScormWrapper::initTimedCommit");if(!this.commitOnAnyChange&&this.timedCommitFrequency>0){var delay=this.timedCommitFrequency*(60*1000);this.timedCommitIntervalID=window.setInterval(this.commit.bind(this),delay)}}},{key:"initRetryCommit",value:function initRetryCommit(){this.logger.debug("ScormWrapper::initRetryCommit ".concat(this.commitRetries," out of ").concat(this.maxCommitRetries));this.commitRetryPending=true;this.retryCommitTimeoutID=window.setTimeout(this.doRetryCommit.bind(this),this.commitRetryDelay)}},{key:"doRetryCommit",value:function doRetryCommit(){this.logger.debug("ScormWrapper::doRetryCommit");this.commitRetryPending=false;this.commit()}},{key:"handleError",value:function handleError(_msg){this.logger.error(_msg);if(!this.suppressErrors&&(!this.logOutputWin||this.logOutputWin.closed)&&confirm("An error has occured:\n\n".concat(_msg,"\n\nPress 'OK' to view debug information to send to technical support."))){this.showDebugWindow()}}},{key:"getInteractionCount",value:function getInteractionCount(){var count=this.getValue("cmi.interactions._count");return count===""?0:count}},{key:"recordInteractionScorm12",value:function recordInteractionScorm12(id,response,correct,latency,type){id=this.trim(id);var cmiPrefix="cmi.interactions.".concat(this.getInteractionCount());this.setValue("".concat(cmiPrefix,".id"),id);this.setValue("".concat(cmiPrefix,".type"),type);this.setValue("".concat(cmiPrefix,".student_response"),response);this.setValue("".concat(cmiPrefix,".result"),correct?"correct":"wrong");if(latency!==null&&latency!==undefined)this.setValue("".concat(cmiPrefix,".latency"),this.convertToSCORM12Time(latency));this.setValue("".concat(cmiPrefix,".time"),this.getCMITime())}},{key:"recordInteractionScorm2004",value:function recordInteractionScorm2004(id,response,correct,latency,type){id=this.trim(id);var cmiPrefix="cmi.interactions.".concat(this.getInteractionCount());this.setValue("".concat(cmiPrefix,".id"),id);this.setValue("".concat(cmiPrefix,".type"),type);this.setValue("".concat(cmiPrefix,".learner_response"),response);this.setValue("".concat(cmiPrefix,".result"),correct?"correct":"incorrect");if(latency!==null&&latency!==undefined)this.setValue("".concat(cmiPrefix,".latency"),this.convertToSCORM2004Time(latency));this.setValue("".concat(cmiPrefix,".timestamp"),this.getISO8601Timestamp())}},{key:"recordInteractionMultipleChoice",value:function recordInteractionMultipleChoice(id,response,correct,latency,type){if(this.isSCORM2004()){response=response.replace(/,|#/g,"[,]")}else{response=response.replace(/#/g,",")}var scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)}},{key:"recordInteractionSequencing",value:function recordInteractionSequencing(id,response,correct,latency,type){if(this.isSCORM2004()){response=response.replace(/,|#/g,"[,]")}else{response=response.replace(/#/g,",")}var scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)}},{key:"recordInteractionMatching",value:function recordInteractionMatching(id,response,correct,latency,type){response=response.replace(/#/g,",");if(this.isSCORM2004()){response=response.replace(/,/g,"[,]");response=response.replace(/\./g,"[.]")}else{response=this.checkResponse(response,"matching")}var scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)}},{key:"recordInteractionFillIn",value:function recordInteractionFillIn(id,response,correct,latency,type){var maxLength=this.isSCORM2004()?250:255;if(response.length>maxLength){response=response.substr(0,maxLength);this.logger.warn("ScormWrapper::recordInteractionFillIn: response data for ".concat(id," is longer than the maximum allowed length of ").concat(maxLength," characters; data will be truncated to avoid an error."))}var scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)}},{key:"showDebugWindow",value:function showDebugWindow(){if(this.logOutputWin&&!this.logOutputWin.closed){this.logOutputWin.close()}this.logOutputWin=window.open("log_output.html","Log","width=600,height=300,status=no,scrollbars=yes,resizable=yes,menubar=yes,toolbar=yes,location=yes,top=0,left=0");if(this.logOutputWin){this.logOutputWin.focus()}}},{key:"convertToSCORM12Time",value:function convertToSCORM12Time(msConvert){var msPerSec=1000;var msPerMin=msPerSec*60;var msPerHour=msPerMin*60;var ms=msConvert%msPerSec;msConvert=msConvert-ms;var secs=msConvert%msPerMin;msConvert=msConvert-secs;secs=secs/msPerSec;var mins=msConvert%msPerHour;msConvert=msConvert-mins;mins=mins/msPerMin;var hrs=msConvert/msPerHour;if(hrs>9999){return"9999:99:99.99"}var str=[this.padWithZeroes(hrs,4),this.padWithZeroes(mins,2),this.padWithZeroes(secs,2)].join(":");return"".concat(str,".").concat(Math.floor(ms/10))}},{key:"convertToSCORM2004Time",value:function convertToSCORM2004Time(msConvert){var csConvert=Math.floor(msConvert/10);var csPerSec=100;var csPerMin=csPerSec*60;var csPerHour=csPerMin*60;var csPerDay=csPerHour*24;var days=Math.floor(csConvert/csPerDay);csConvert-=days*csPerDay;days=days?days+"D":"";var hours=Math.floor(csConvert/csPerHour);csConvert-=hours*csPerHour;hours=hours?hours+"H":"";var mins=Math.floor(csConvert/csPerMin);csConvert-=mins*csPerMin;mins=mins?mins+"M":"";var secs=Math.floor(csConvert/csPerSec);csConvert-=secs*csPerSec;secs=secs||"0";var cs=csConvert;cs=cs?"."+cs:"";var seconds=secs+cs+"S";var hms=[hours,mins,seconds].join("");return"P"+days+"T"+hms}},{key:"getCMITime",value:function getCMITime(){var date=new Date;var hours=this.padWithZeroes(date.getHours(),2);var min=this.padWithZeroes(date.getMinutes(),2);var sec=this.padWithZeroes(date.getSeconds(),2);return[hours,min,sec].join(":")}},{key:"getISO8601Timestamp",value:function getISO8601Timestamp(){var date=new Date().toISOString();return date.replace(/.\d\d\dZ/,"")}},{key:"padWithZeroes",value:function padWithZeroes(numToPad,padBy){var len=padBy;while(--len){numToPad="0"+numToPad}return numToPad.slice(-padBy)}},{key:"trim",value:function trim(str){return str.replace(/^\s*|\s*$/g,"")}},{key:"isSCORM2004",value:function isSCORM2004(){return this.scorm.version==="2004"}},{key:"checkResponse",value:function checkResponse(response,responseType){if(!response)return response;if(responseType!=="choice"&&responseType!=="matching")return response;response=response.split(/,|#/);var self=this;if(responseType==="choice"){response=response.map(checkIdentifier)}else{response=response.map(function(r){var identifiers=r.split(".");return checkIdentifier(identifiers[0])+"."+checkIdentifier(identifiers[1])})}function checkIdentifier(r){var i;if(r.length===1&&r>="0"&&r<="9")return r;if(r.length===1&&r>="a"&&r<="z")return r;i=parseInt(r);if(isNaN(i)||i<10||i>35){self.handleError("Numeric choice/matching response elements must use a value from 0 to 35 in SCORM 1.2")}return Number(i).toString(36)}return response.join(",")}},{key:"getExitState",value:function getExitState(){var completionStatus=this.scorm.data.completionStatus;var isIncomplete=completionStatus==="incomplete"||completionStatus==="not attempted";var exitState=isIncomplete?this.exitStateIfIncomplete:this.exitStateIfComplete;if(exitState!=="auto")return exitState;if(this.isSCORM2004())return isIncomplete?"suspend":"normal";return""}}],[{key:"getInstance",value:function getInstance(){if(ScormWrapper.instance===null){ScormWrapper.instance=new ScormWrapper}return ScormWrapper.instance}}]);return ScormWrapper}();ScormWrapper.instance=null;var ScormWrapper$1=__AMD("extensions/adapt-contrib-spoor/js/scorm/wrapper",ScormWrapper);var ZeroString={};function makeZeroString(length){ZeroString[length]=ZeroString[length]||new Array(length+1).join("0");return ZeroString[length]}for(var i=1,l=64;i<=l;i++){makeZeroString(i)}function zeroPadRightToLength(string,length){var padLength=length-string.length;if(padLength>0){string+=makeZeroString(padLength)}return string}function zeroPadLeftToLength(string,length){var padLength=length-string.length;if(padLength>0){string=makeZeroString(padLength)+string}return string}function zeroPadRightToMultiple(string,multiple){var padLength=multiple-string.length%multiple;if(padLength!==multiple){string+=makeZeroString(padLength)}return string}function binaryToUnsignedInteger(binary,binaryLength){if(binaryLength===0){return 0}binary=zeroPadLeftToLength(binary,binaryLength);var integer=parseInt(binary.slice(0,binaryLength),2);return integer}function shiftUnsignedIntegerFromBinary(binary,binaryLength){if(binaryLength===0){return[0,binary]}binary=zeroPadLeftToLength(binary,binaryLength);var integer=parseInt(binary.slice(0,binaryLength),2);binary=binary.slice(binaryLength);return[integer,binary]}function shiftBinary(binary,binaryLength){if(binaryLength===0){return["",binary]}binary=zeroPadLeftToLength(binary,binaryLength);var shifted=binary.slice(0,binaryLength);binary=binary.slice(binaryLength);return[shifted,binary]}function unsignedIntegerToBinary(integer,binaryLength){if(binaryLength===0){return""}var binary=Math.abs(integer).toString(2);if(typeof binaryLength==="undefined"){return binary}var length=binary.length;if(length>binaryLength){throw new Error("Integer too big for specified binary length. integer: ".concat(integer," binarylen: ").concat(binaryLength))}binary=zeroPadLeftToLength(binary,binaryLength);return binary}function byteArrayToString(array){var arrayLength=array.length;var string=new Array(arrayLength);for(var _i=0,_l=arrayLength;_i<_l;_i++){string[_i]=String.fromCharCode(array[_i])}string=string.join("");return string}function stringToByteArray(string){var stringLength=string.length;var array=new Array(stringLength);for(var _i2=0,_l2=stringLength;_i2<_l2;_i2++){array[_i2]=string.charCodeAt(_i2)}return array}var BYTE_BIT_LENGTH=8;function binaryToBase64(binary){binary=___default["default"].flatten(binary).join("");binary=zeroPadRightToMultiple(binary,BYTE_BIT_LENGTH);var bytesCount=binary.length/BYTE_BIT_LENGTH;var charCodes=new Array(bytesCount);for(var _i3=0,_l3=bytesCount;_i3<_l3;_i3++){var _shiftUnsignedInteger=shiftUnsignedIntegerFromBinary(binary,BYTE_BIT_LENGTH);var _shiftUnsignedInteger2=_slicedToArray(_shiftUnsignedInteger,2);charCodes[_i3]=_shiftUnsignedInteger2[0];binary=_shiftUnsignedInteger2[1]}var base64=btoa(byteArrayToString(charCodes));base64=base64.replace(/=/g,"");base64=base64.replace(/\+/g,"-");return base64}function base64ToBinary(base64){base64=base64.replace(/-/g,"+");var charCodes=stringToByteArray(atob(base64));var bytesCount=charCodes.length;var binary=new Array(bytesCount);for(var _i4=0,_l4=bytesCount;_i4<_l4;_i4++){binary[_i4]=unsignedIntegerToBinary(charCodes[_i4],BYTE_BIT_LENGTH)}binary=binary.join("");return binary}var logs={usedTypes:{},typeLengths:{},binarySamples:{}};var AbstractValueType=function(){function AbstractValueType(options){_classCallCheck(this,AbstractValueType);Object.assign(this,options);this.binaryTypeLength=this.binaryType.length}_createClass(AbstractValueType,[{key:"log",value:function log(binary){var name=this.name;logs.usedTypes[name]=logs.usedTypes[name]||0;logs.usedTypes[name]++;logs.binarySamples[name]=logs.binarySamples[name]||[];logs.binarySamples[name].push(binary)}}]);return AbstractValueType}();var FixedIntegerType=function(_AbstractValueType){_inherits(FixedIntegerType,_AbstractValueType);var _super=_createSuper(FixedIntegerType);function FixedIntegerType(options){var _this;_classCallCheck(this,FixedIntegerType);_this=_super.call(this,options);_this.esType="number";if(!_this.valueBinaryLength){return _possibleConstructorReturn(_this)}_this.minValue=options.minValue||0;_this.maxValue=options.maxValue||Math.pow(2,_this.valueBinaryLength)-1;return _this}_createClass(FixedIntegerType,[{key:"valueToBinary",value:function valueToBinary(integer){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var binary=unsignedIntegerToBinary(integer,this.valueBinaryLength);if(logStats){this.log(binary)}binary=[binary];return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var integer;var _shiftUnsignedInteger3=shiftUnsignedIntegerFromBinary(binary,this.valueBinaryLength);var _shiftUnsignedInteger4=_slicedToArray(_shiftUnsignedInteger3,2);integer=_shiftUnsignedInteger4[0];binary=_shiftUnsignedInteger4[1];return[integer,binary]}}]);return FixedIntegerType}(AbstractValueType);var FixedBooleanType=function(_FixedIntegerType){_inherits(FixedBooleanType,_FixedIntegerType);var _super2=_createSuper(FixedBooleanType);function FixedBooleanType(options){var _this2;_classCallCheck(this,FixedBooleanType);options.valueBinaryLength=1;_this2=_super2.call(this,options);_this2.esType="boolean";return _this2}_createClass(FixedBooleanType,[{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var bool=binary[0]==="1";binary=binary.slice(1);return[bool,binary]}}]);return FixedBooleanType}(FixedIntegerType);var LengthAndValueBinary=function(){function LengthAndValueBinary(parent,name,bitSizes){_classCallCheck(this,LengthAndValueBinary);this.parent=parent;this.name=name;this.bitSizes=bitSizes;this.maxValues=___default["default"].flatten(this.bitSizes).map(function(value){return Math.pow(2,value)-1});this.maxValue=this.maxValues[this.maxValues.length-1];this.sizeBinaryLength=unsignedIntegerToBinary(this.bitSizes.length-1).length}_createClass(LengthAndValueBinary,[{key:"valueToBinary",value:function valueToBinary(integer){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var parentName=this.parent.name;var sizeIndex=this.maxValues.findIndex(function(maxValue){return integer<=maxValue});if(sizeIndex===-1){throw new Error("Value is too large for type: ".concat(parentName," value: ").concat(integer," max: ").concat(this.maxValue))}var sizeBinary=unsignedIntegerToBinary(sizeIndex,this.sizeBinaryLength);var valueLength=this.bitSizes[sizeIndex];var name=this.name;if(logStats){logs.typeLengths[parentName]=logs.typeLengths[parentName]||{};logs.typeLengths[parentName][name]=logs.typeLengths[parentName][name]||{};logs.typeLengths[parentName][name][valueLength]=logs.typeLengths[parentName][name][valueLength]||0;logs.typeLengths[parentName][name][valueLength]++}var integerBinary=unsignedIntegerToBinary(integer,valueLength);var binary=[sizeBinary,integerBinary];return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var sizeBinary;var _shiftBinary=shiftBinary(binary,this.sizeBinaryLength);var _shiftBinary2=_slicedToArray(_shiftBinary,2);sizeBinary=_shiftBinary2[0];binary=_shiftBinary2[1];var sizeIndex=binaryToUnsignedInteger(sizeBinary);var valueLength=this.bitSizes[sizeIndex];var integer;var _shiftUnsignedInteger5=shiftUnsignedIntegerFromBinary(binary,valueLength);var _shiftUnsignedInteger6=_slicedToArray(_shiftUnsignedInteger5,2);integer=_shiftUnsignedInteger6[0];binary=_shiftUnsignedInteger6[1];return[integer,binary]}}]);return LengthAndValueBinary}();var VariableIntegerType=function(_FixedIntegerType2){_inherits(VariableIntegerType,_FixedIntegerType2);var _super3=_createSuper(VariableIntegerType);function VariableIntegerType(options){var _this3;_classCallCheck(this,VariableIntegerType);_this3=_super3.call(this,options);_this3.isNegative=_this3.minValue<0&&_this3.maxValue===0;_this3.integer=new LengthAndValueBinary(_assertThisInitialized(_this3),"integer",options.integerBitSizes);return _this3}_createClass(VariableIntegerType,[{key:"valueToBinary",value:function valueToBinary(integer){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;integer=integer.toFixed(0);var binary=this.integer.valueToBinary(Math.abs(integer),logStats);if(logStats){this.log(binary)}return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var integer;var _this$integer$shiftVa=this.integer.shiftValueFromBinary(binary);var _this$integer$shiftVa2=_slicedToArray(_this$integer$shiftVa,2);integer=_this$integer$shiftVa2[0];binary=_this$integer$shiftVa2[1];if(this.isNegative){integer=-integer}return[integer,binary]}}]);return VariableIntegerType}(FixedIntegerType);var VariableArrayType=function(_VariableIntegerType){_inherits(VariableArrayType,_VariableIntegerType);var _super4=_createSuper(VariableArrayType);function VariableArrayType(options){var _this4;_classCallCheck(this,VariableArrayType);_this4=_super4.call(this,options);_this4.esType="array";return _this4}_createClass(VariableArrayType,[{key:"valueToBinary",value:function valueToBinary(array){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var arrayLength=array.length;var binary=_get(_getPrototypeOf(VariableArrayType.prototype),"valueToBinary",this).call(this,arrayLength);if(arrayLength){var valueType=findValueTypeFromValues(array);binary.push(valueType.binaryType);binary.type=valueType.name;binary.push(array.map(function(value){return valueType.valueToBinary(value,logStats)}))}if(logStats){this.log(binary)}return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var arrayLength;var _get$call=_get(_getPrototypeOf(VariableArrayType.prototype),"shiftValueFromBinary",this).call(this,binary);var _get$call2=_slicedToArray(_get$call,2);arrayLength=_get$call2[0];binary=_get$call2[1];var value=new Array(arrayLength);if(arrayLength){var valueType;var _shiftValueTypeFromBi=shiftValueTypeFromBinary(binary);var _shiftValueTypeFromBi2=_slicedToArray(_shiftValueTypeFromBi,2);valueType=_shiftValueTypeFromBi2[0];binary=_shiftValueTypeFromBi2[1];for(var _i5=0,_l5=arrayLength;_i5<_l5;_i5++){var _valueType$shiftValue=valueType.shiftValueFromBinary(binary);var _valueType$shiftValue2=_slicedToArray(_valueType$shiftValue,2);value[_i5]=_valueType$shiftValue2[0];binary=_valueType$shiftValue2[1]}}return[value,binary]}}]);return VariableArrayType}(VariableIntegerType);var VariableSignedIntegerType=function(_VariableIntegerType2){_inherits(VariableSignedIntegerType,_VariableIntegerType2);var _super5=_createSuper(VariableSignedIntegerType);function VariableSignedIntegerType(){_classCallCheck(this,VariableSignedIntegerType);return _super5.apply(this,arguments)}_createClass(VariableSignedIntegerType,[{key:"valueToBinary",value:function valueToBinary(integer){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;integer=integer.toFixed(0);var isNegative=integer<0;var signBinary=isNegative?"1":"0";var integerBinary=this.integer.valueToBinary(Math.abs(integer),logStats);var binary=[signBinary,integerBinary];if(logStats){this.log(binary)}return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var isNegative;var _shiftUnsignedInteger7=shiftUnsignedIntegerFromBinary(binary,1);var _shiftUnsignedInteger8=_slicedToArray(_shiftUnsignedInteger7,2);isNegative=_shiftUnsignedInteger8[0];binary=_shiftUnsignedInteger8[1];var integer;var _this$integer$shiftVa3=this.integer.shiftValueFromBinary(binary);var _this$integer$shiftVa4=_slicedToArray(_this$integer$shiftVa3,2);integer=_this$integer$shiftVa4[0];binary=_this$integer$shiftVa4[1];if(isNegative){integer=-integer}return[integer,binary]}}]);return VariableSignedIntegerType}(VariableIntegerType);var VariableDecimalType=function(_VariableIntegerType3){_inherits(VariableDecimalType,_VariableIntegerType3);var _super6=_createSuper(VariableDecimalType);function VariableDecimalType(options){var _this5;_classCallCheck(this,VariableDecimalType);_this5=_super6.call(this,options);_this5.isFloat=true;_this5.decimal=new LengthAndValueBinary(_assertThisInitialized(_this5),"decimal",options.decimalBitSizes);return _this5}_createClass(VariableDecimalType,[{key:"valueToBinary",value:function valueToBinary(float){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;float=float.toFixed(2);var isNegative=float<0;float=Math.abs(float);var parts=String(float).split(".");var higherInteger=parseInt(parts[0]);var lowerInteger=parseInt(zeroPadRightToLength(parts[1]||0,2));var signBinary=isNegative?"1":"0";var integerValueBinary=this.integer.valueToBinary(higherInteger,logStats);var decimalValueBinary=this.decimal.valueToBinary(lowerInteger,logStats);var binary=[signBinary,integerValueBinary,decimalValueBinary];if(logStats){this.log(binary)}return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var isNegative;var _shiftUnsignedInteger9=shiftUnsignedIntegerFromBinary(binary,1);var _shiftUnsignedInteger10=_slicedToArray(_shiftUnsignedInteger9,2);isNegative=_shiftUnsignedInteger10[0];binary=_shiftUnsignedInteger10[1];var higherInteger;var _this$integer$shiftVa5=this.integer.shiftValueFromBinary(binary);var _this$integer$shiftVa6=_slicedToArray(_this$integer$shiftVa5,2);higherInteger=_this$integer$shiftVa6[0];binary=_this$integer$shiftVa6[1];var lowerInteger;var _this$decimal$shiftVa=this.decimal.shiftValueFromBinary(binary);var _this$decimal$shiftVa2=_slicedToArray(_this$decimal$shiftVa,2);lowerInteger=_this$decimal$shiftVa2[0];binary=_this$decimal$shiftVa2[1];lowerInteger=zeroPadLeftToLength(String(lowerInteger),2);var float=parseFloat(higherInteger+"."+lowerInteger);if(isNegative){float=-float}return[float,binary]}}]);return VariableDecimalType}(VariableIntegerType);var arrayType=new VariableArrayType({name:"array",binaryType:"10",integerBitSizes:[4,16]});var booleanType=new FixedBooleanType({name:"boolean",binaryType:"0"});var integerTypes=[new FixedIntegerType({name:"uint3",binaryType:"1110",valueBinaryLength:3}),new VariableIntegerType({name:"vint8+",binaryType:"110",minValue:0,maxValue:255,integerBitSizes:[2,8]}),new VariableIntegerType({name:"vint8-",binaryType:"111100",minValue:-255,maxValue:0,integerBitSizes:[2,8]}),new VariableSignedIntegerType({name:"sint32",binaryType:"111110",minValue:-4294967295,maxValue:4294967295,integerBitSizes:[2,4,16,32]})];var decimalTypes=[new VariableDecimalType({name:"sdec15",binaryType:"111101",minValue:-255.99,maxValue:255.99,integerBitSizes:[2,8],decimalBitSizes:[0,7]}),new VariableDecimalType({name:"sdec39",binaryType:"111111",minValue:-4294967295.99,maxValue:4294967295.99,integerBitSizes:[2,4,16,32],decimalBitSizes:[0,7]})];var ValueTypes=[booleanType,arrayType].concat(integerTypes).concat(decimalTypes);ValueTypes.nameIndex={};ValueTypes.forEach(function(valueType){return ValueTypes.nameIndex[valueType.name]=valueType});function esTypeOf(value){if(Array.isArray(value)){return"array"}if(value===null){return"null"}return _typeof(value)}function findValueTypeFromName(name){return ValueTypes.nameIndex[name.toLowerCase()]}function findValueTypeFromValue(value){var esType=esTypeOf(value);switch(esType){case"array":return arrayType;case"boolean":return booleanType;}value=value.toFixed(2);var isFloat=!Number.isInteger(value);var isValueInValueTypeRange=function(valueType){return value>=valueType.minValue&&value<=valueType.maxValue};var valueType=isFloat?decimalTypes.find(isValueInValueTypeRange):integerTypes.find(isValueInValueTypeRange);if(!valueType){throw new Error("Cannot find type from value: ".concat(value))}return valueType}function findValueTypeFromValues(values){if(!values.length){return}var minValue=0;var maxValue=0;var isFloat=false;var esTypes=values.map(function(value){var valueType=findValueTypeFromValue(value);if(valueType.esType==="number"){minValue=___default["default"].min([value,minValue]);maxValue=___default["default"].max([value,maxValue]);isFloat=isFloat||!Number.isInteger(value)}return valueType.esType});var uniqESTypes=___default["default"].uniq(esTypes);if(uniqESTypes.length>1){throw new Error("Cannot resolve array to one type: ".concat(uniqESTypes.join()))}var esType=uniqESTypes[0];switch(esType){case"array":return arrayType;case"boolean":return booleanType;}var isRangeInValueTypeRange=function(valueType){return minValue>=valueType.minValue&&maxValue<=valueType.maxValue};var valueType=isFloat?decimalTypes.find(isRangeInValueTypeRange):integerTypes.find(isRangeInValueTypeRange);if(!valueType){throw new Error("Cannot find type from value. min: ".concat(minValue," max: ").concat(maxValue," isfloat: ").concat(isFloat))}return valueType}function shiftValueTypeFromBinary(binary){var valueType=ValueTypes.find(function(valueType){var binaryType=binary.slice(0,valueType.binaryTypeLength);return binaryType===valueType.binaryType});if(!valueType){throw new Error("Cannot find type from binary: ".concat(binary.slice(0,6),"..."))}binary=binary.slice(valueType.binaryTypeLength);return[valueType,binary]}function convertValuesToNumbers(value){var esType=esTypeOf(value);switch(esType){case"array":return value.map(convertValuesToNumbers);case"undefined":case"null":return value?1:0;case"boolean":case"number":return value;}throw new Error("Cannot convert ".concat(esType," to number"))}var Converter=function(){function Converter(){_classCallCheck(this,Converter)}_createClass(Converter,[{key:"getInvalidTypeError",value:function getInvalidTypeError(value){try{value=convertValuesToNumbers(value);esTypeOf(value)==="array"?findValueTypeFromValues(value):findValueTypeFromValue(value);return}catch(err){return err}}},{key:"valueToBinary",value:function valueToBinary(value){var typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var logStats=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;this.clearLog();var hasInitialType=typeof typeName==="string";value=convertValuesToNumbers(value);var valueType=hasInitialType?findValueTypeFromName(typeName):findValueTypeFromValue(value);if(!valueType){throw new Error("Could not find value type from ".concat(hasInitialType?"name ".concat(typeName):"value ".concat(value)," accepts: ").concat(Object.keys(ValueTypes.nameIndex),". Leave typeName empty for auto-detect."))}var binary=valueType.valueToBinary(value,logStats);if(!hasInitialType){binary.unshift(valueType.binaryType)}if(logStats){this.printLog()}return binary}},{key:"valueFromBinary",value:function valueFromBinary(binary){var typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;binary=___default["default"].flatten(binary).join("");var hasInitialType=typeof typeName==="string";var valueType;if(hasInitialType){valueType=findValueTypeFromName(typeName)}else{var _shiftValueTypeFromBi3=shiftValueTypeFromBinary(binary);var _shiftValueTypeFromBi4=_slicedToArray(_shiftValueTypeFromBi3,2);valueType=_shiftValueTypeFromBi4[0];binary=_shiftValueTypeFromBi4[1]}if(!valueType||!(valueType instanceof AbstractValueType)){throw new Error("Could not find value type from ".concat(hasInitialType?"name \"".concat(typeName,"\""):"binary \"".concat(binary.slice(0,8),"\"...")," accepts: ").concat(Object.keys(ValueTypes.nameIndex),". Leave typeName empty for auto-detect."))}var _valueType$shiftValue3=valueType.shiftValueFromBinary(binary),_valueType$shiftValue4=_slicedToArray(_valueType$shiftValue3,1),value=_valueType$shiftValue4[0];return value}},{key:"clearLog",value:function clearLog(){logs.usedTypes={};logs.typeLengths={};logs.binarySamples={}}},{key:"printLog",value:function printLog(){console.log("Types used count:",logs.usedTypes);console.log("Type lengths used count:",logs.typeLengths);console.log("Type binary samples:",logs.binarySamples)}},{key:"serialize",value:function serialize(value){var typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var logStats=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var binary=this.valueToBinary(value,typeName,logStats);var base64=binaryToBase64(binary);return base64}},{key:"deserialize",value:function deserialize(base64){var typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var binary=base64ToBinary(base64);var value=this.valueFromBinary(binary,typeName);return value}}]);return Converter}();var SCORMSuspendData=__AMD("extensions/adapt-contrib-spoor/js/serializers/SCORMSuspendData",window.SCORMSuspendData=new Converter);var ComponentSerializer=function(_Backbone$Controller){_inherits(ComponentSerializer,_Backbone$Controller);var _super=_createSuper(ComponentSerializer);function ComponentSerializer(){_classCallCheck(this,ComponentSerializer);return _super.apply(this,arguments)}_createClass(ComponentSerializer,[{key:"initialize",value:function initialize(trackingIdType){this.trackingIdType=trackingIdType}},{key:"serialize",value:function serialize(){var _this=this;var states=[];Adapt.data.each(function(model){if(model.get("_type")!==_this.trackingIdType){return}var trackingId=model.get("_trackingId");if(typeof trackingId==="undefined"){return}var isContainer=model.hasManagedChildren;var components=isContainer?model.findDescendantModels("component"):[model];components.forEach(function(component,index){var modelState=null;if(!component.getAttemptState){modelState=component.get("_isQuestionType")?[[component.get("_score")||0,component.get("_attemptsLeft")||0],[component.get("_isComplete")||false,component.get("_isInteractionComplete")||false,component.get("_isSubmitted")||false,component.get("_isCorrect")||false],[component.get("_userAnswer")]]:[[],[component.get("_isComplete")||false,component.get("_isInteractionComplete")||false],[component.get("_userAnswer")]]}else{modelState=component.getAttemptState()}var userAnswer=modelState[2][0];var hasUserAnswer=typeof userAnswer!=="undefined"&&userAnswer!==null;var isUserAnswerArray=Array.isArray(userAnswer);if(!hasUserAnswer){modelState[2][0]=[]}else if(!isUserAnswerArray){modelState[2][0]=[modelState[2][0]]}var attemptStates=modelState[2][0];var hasAttemptStates=!Array.isArray(attemptStates);if(!hasAttemptStates){modelState[2][1]=[]}var state=[[trackingId,index],[hasUserAnswer,isUserAnswerArray,hasAttemptStates],modelState];states.push(state)})});return SCORMSuspendData.serialize(states)}},{key:"deserialize",value:function deserialize(binary){var trackingIdMap=Adapt.data.toArray().reduce(function(trackingIdMap,model){var trackingId=model.get("_trackingId");if(typeof trackingId==="undefined")return trackingIdMap;trackingIdMap[trackingId]=model;return trackingIdMap},{});var states=SCORMSuspendData.deserialize(binary);states.forEach(function(state){var _state$=_slicedToArray(state[0],2),trackingId=_state$[0],index=_state$[1];var _state$2=_slicedToArray(state[1],3),hasUserAnswer=_state$2[0],isUserAnswerArray=_state$2[1],hasAttemptStates=_state$2[2];var modelState=state[2];if(!hasUserAnswer){modelState[2][0]=null}else if(!isUserAnswerArray){modelState[2][0]=modelState[2][0][0]}if(!hasAttemptStates){modelState[2][1]=null}var model=trackingIdMap[trackingId];if(!model){return}var isContainer=model.hasManagedChildren;var components=isContainer?model.findDescendantModels("component"):[model];var component=components[index];if(!component){Adapt.log.warn("SPOOR could not restore tracking id: ".concat(trackingId,", index: ").concat(index));return}if(component.setAttemptObject){var attemptObject=component.getAttemptObject(modelState);component.setAttemptObject(attemptObject,false);return}component.get("_isQuestionType")?component.set({_score:modelState[0][0],_attemptsLeft:modelState[0][1],_isComplete:modelState[1][0],_isInteractionComplete:modelState[1][1],_isSubmitted:modelState[1][2],_isCorrect:modelState[1][3],_userAnswer:modelState[2][0]}):component.set({_isComplete:modelState[1][0],_isInteractionComplete:modelState[1][1],_userAnswer:modelState[2][0]})})}}]);return ComponentSerializer}(Backbone.Controller);var ComponentSerializer$1=__AMD("extensions/adapt-contrib-spoor/js/serializers/ComponentSerializer",ComponentSerializer);var StatefulSession=function(_Backbone$Controller){_inherits(StatefulSession,_Backbone$Controller);var _super=_createSuper(StatefulSession);function StatefulSession(){_classCallCheck(this,StatefulSession);return _super.apply(this,arguments)}_createClass(StatefulSession,[{key:"initialize",value:function initialize(){_.bindAll(this,"beginSession","onVisibilityChange","endSession");this.scorm=ScormWrapper$1.getInstance();this._trackingIdType="block";this._componentSerializer=null;this._shouldStoreResponses=true;this._shouldRecordInteractions=true;this.beginSession()}},{key:"beginSession",value:function beginSession(){this.listenTo(Adapt,"app:dataReady",this.restoreSession);this._trackingIdType=Adapt.build.get("trackingIdType")||"block";this._componentSerializer=new ComponentSerializer$1(this._trackingIdType);if(window.location.search.indexOf("nolmserrors")!==-1){this.scorm.suppressErrors=true}var config=Adapt.spoor.config;if(!config)return;var tracking=config._tracking;this._shouldStoreResponses=tracking&&tracking._shouldStoreResponses;if(tracking&&tracking._shouldRecordInteractions===false){this._shouldRecordInteractions=false}var settings=config._advancedSettings;if(!settings){this.scorm.setVersion("1.2");this.scorm.initialize();return}if(settings._showDebugWindow){this.scorm.showDebugWindow()}this.scorm.setVersion(settings._scormVersion||"1.2");if(settings._suppressErrors){this.scorm.suppressErrors=settings._suppressErrors}if(settings._commitOnStatusChange){this.scorm.commitOnStatusChange=settings._commitOnStatusChange}if(settings._commitOnAnyChange){this.scorm.commitOnAnyChange=settings._commitOnAnyChange}if(_.isFinite(settings._timedCommitFrequency)){this.scorm.timedCommitFrequency=settings._timedCommitFrequency}if(_.isFinite(settings._maxCommitRetries)){this.scorm.maxCommitRetries=settings._maxCommitRetries}if(_.isFinite(settings._commitRetryDelay)){this.scorm.commitRetryDelay=settings._commitRetryDelay}if("_exitStateIfIncomplete"in settings){this.scorm.exitStateIfIncomplete=settings._exitStateIfIncomplete}if("_exitStateIfComplete"in settings){this.scorm.exitStateIfComplete=settings._exitStateIfComplete}this.scorm.initialize()}},{key:"restoreSession",value:function restoreSession(){this.setupLearnerInfo();this.restoreSessionState();_.defer(this.setupEventListeners.bind(this))}},{key:"setupLearnerInfo",value:function setupLearnerInfo(){var globals=Adapt.course.get("_globals");if(!globals._learnerInfo){globals._learnerInfo={}}Object.assign(globals._learnerInfo,Adapt.offlineStorage.get("learnerinfo"))}},{key:"restoreSessionState",value:function restoreSessionState(){var sessionPairs=Adapt.offlineStorage.get();var hasNoPairs=!Object.keys(sessionPairs).length;if(hasNoPairs)return;if(sessionPairs.c){var _SCORMSuspendData$des=SCORMSuspendData.deserialize(sessionPairs.c),_SCORMSuspendData$des2=_slicedToArray(_SCORMSuspendData$des,2),_isComplete=_SCORMSuspendData$des2[0],_isAssessmentPassed=_SCORMSuspendData$des2[1];Adapt.course.set({_isComplete:_isComplete,_isAssessmentPassed:_isAssessmentPassed})}if(sessionPairs.q&&this._shouldStoreResponses){this._componentSerializer.deserialize(sessionPairs.q)}}},{key:"setupEventListeners",value:function setupEventListeners(){var debouncedSaveSession=_.debounce(this.saveSessionState.bind(this),1);this.listenTo(Adapt.data,"change:_isComplete",debouncedSaveSession);if(this._shouldStoreResponses){this.listenTo(Adapt.data,"change:_isSubmitted change:_userAnswer",debouncedSaveSession)}this.listenTo(Adapt,{"app:languageChanged":this.onLanguageChanged,"questionView:recordInteraction":this.onQuestionRecordInteraction,"assessment:complete":this.onAssessmentComplete,"tracking:complete":this.onTrackingComplete});var config=Adapt.spoor.config;var advancedSettings=config._advancedSettings;var shouldCommitOnVisibilityChange=!advancedSettings||advancedSettings._commitOnVisibilityChangeHidden!==false;if(shouldCommitOnVisibilityChange){document.addEventListener("visibilitychange",this.onVisibilityChange)}$(window).on("beforeunload unload",this.endSession)}},{key:"saveSessionState",value:function saveSessionState(){var courseState=SCORMSuspendData.serialize([Boolean(Adapt.course.get("_isComplete")),Boolean(Adapt.course.get("_isAssessmentPassed"))]);var componentStates=this._shouldStoreResponses===true?this._componentSerializer.serialize():"";var sessionPairs={"c":courseState,"q":componentStates};this.printCompletionInformation();Adapt.offlineStorage.set(sessionPairs)}},{key:"printCompletionInformation",value:function printCompletionInformation(){var _this=this;var courseComplete=Boolean(Adapt.course.get("_isComplete"));var assessmentPassed=Boolean(Adapt.course.get("_isAssessmentPassed"));var trackingIdModels=Adapt.data.filter(function(model){return model.get("_type")===_this._trackingIdType&&model.has("_trackingId")});var trackingIds=trackingIdModels.map(function(model){return model.get("_trackingId")});if(!trackingIds.length){Adapt.log.info("course._isComplete: ".concat(courseComplete,", course._isAssessmentPassed: ").concat(assessmentPassed,", ").concat(this._trackingIdType," completion: no tracking ids found"));return}var max=Math.max.apply(Math,_toConsumableArray(trackingIds));var completion=trackingIdModels.reduce(function(completion,model){var trackingId=model.get("_trackingId");completion[trackingId]=model.get("_isComplete")?"1":"0";return completion},new Array(max+1).join("-").split("")).join("");Adapt.log.info("course._isComplete: ".concat(courseComplete,", course._isAssessmentPassed: ").concat(assessmentPassed,", ").concat(this._trackingIdType," completion: ").concat(completion))}},{key:"onLanguageChanged",value:function onLanguageChanged(){var config=Adapt.spoor.config;this.removeEventListeners();this.setupEventListeners();this.saveSessionState();if(config&&config._reporting&&config._reporting._resetStatusOnLanguageChange===true){Adapt.offlineStorage.set("status","incomplete")}}},{key:"onVisibilityChange",value:function onVisibilityChange(){if(document.visibilityState==="hidden")this.scorm.commit()}},{key:"onQuestionRecordInteraction",value:function onQuestionRecordInteraction(questionView){if(!this._shouldRecordInteractions)return;var responseType=questionView.getResponseType();if(_.isEmpty(responseType))return;var id=questionView.model.get("_id");var response=questionView.getResponse();var result=questionView.isCorrect();var latency=questionView.getLatency();Adapt.offlineStorage.set("interaction",id,response,result,latency,responseType)}},{key:"onAssessmentComplete",value:function onAssessmentComplete(stateModel){var _Adapt$offlineStorage;var config=Adapt.spoor.config;Adapt.course.set("_isAssessmentPassed",stateModel.isPass);this.saveSessionState();var shouldSubmitScore=config&&config._tracking&&config._tracking._shouldSubmitScore;if(!shouldSubmitScore)return;var scoreArgs=stateModel.isPercentageBased?[stateModel.scoreAsPercent,0,100]:[stateModel.score,0,stateModel.maxScore];(_Adapt$offlineStorage=Adapt.offlineStorage).set.apply(_Adapt$offlineStorage,["score"].concat(scoreArgs))}},{key:"onTrackingComplete",value:function onTrackingComplete(completionData){var config=Adapt.spoor.config;this.saveSessionState();var completionStatus=completionData.status.asLowerCase;switch(completionData.status){case COMPLETION_STATE$1.COMPLETED:case COMPLETION_STATE$1.PASSED:{if(!config||!config._reporting||!config._reporting._onTrackingCriteriaMet){Adapt.log.warn("No value defined for '_onTrackingCriteriaMet', so defaulting to '".concat(completionStatus,"'"))}else{completionStatus=config._reporting._onTrackingCriteriaMet}break}case COMPLETION_STATE$1.FAILED:{if(!config||!config._reporting||!config._reporting._onAssessmentFailure){Adapt.log.warn("No value defined for '_onAssessmentFailure', so defaulting to '".concat(completionStatus,"'"))}else{completionStatus=config._reporting._onAssessmentFailure}}}Adapt.offlineStorage.set("status",completionStatus)}},{key:"endSession",value:function endSession(){if(!this.scorm.finishCalled){this.scorm.finish()}this.removeEventListeners()}},{key:"removeEventListeners",value:function removeEventListeners(){$(window).off("beforeunload unload",this.endSession);document.removeEventListener("visibilitychange",this.onVisibilityChange);this.stopListening()}}]);return StatefulSession}(Backbone.Controller);var StatefulSession$1=__AMD("extensions/adapt-contrib-spoor/js/adapt-stateful-session",StatefulSession);var OfflineStorage=function(_Backbone$Controller){_inherits(OfflineStorage,_Backbone$Controller);var _super=_createSuper(OfflineStorage);function OfflineStorage(){_classCallCheck(this,OfflineStorage);return _super.apply(this,arguments)}_createClass(OfflineStorage,[{key:"initialize",value:function initialize(statefulSession){this.scorm=ScormWrapper$1.getInstance();this.statefulSession=statefulSession;this.temporaryStore={};this.suspendDataStore={};this.suspendDataRestored=false;Adapt.offlineStorage.initialize(this)}},{key:"save",value:function save(){this.statefulSession.saveSessionState()}},{key:"serialize",value:function serialize(){var _SCORMSuspendData;return(_SCORMSuspendData=SCORMSuspendData).serialize.apply(_SCORMSuspendData,arguments)}},{key:"deserialize",value:function deserialize(){var _SCORMSuspendData2;return(_SCORMSuspendData2=SCORMSuspendData).deserialize.apply(_SCORMSuspendData2,arguments)}},{key:"get",value:function get(name){if(name===undefined){if(this.useTemporaryStore())return this.temporaryStore;this.suspendDataStore=this.getCustomStates();var _data=Object.assign(_.clone(this.suspendDataStore),{location:this.scorm.getLessonLocation(),score:this.scorm.getScore(),status:this.scorm.getStatus(),student:this.scorm.getStudentName(),learnerInfo:this.getLearnerInfo()});this.suspendDataRestored=true;return _data}if(this.useTemporaryStore())return this.temporaryStore[name];var courseState;switch(name.toLowerCase()){case"location":return this.scorm.getLessonLocation();case"score":return this.scorm.getScore();case"status":return this.scorm.getStatus();case"student":return this.scorm.getStudentName();case"learnerinfo":return this.getLearnerInfo();case"coursestate":courseState=this.getCustomState("c");var stateArray=courseState&&SCORMSuspendData.deserialize(courseState)||[];return{_isCourseComplete:Boolean(stateArray.slice(0,1).map(Number)[0]),_isAssessmentPassed:Boolean(stateArray.slice(1,2).map(Number)[0]),completion:stateArray.slice(2).map(Number).map(String).join("")||""};case"completion":courseState=this.getCustomState("c");return courseState&&SCORMSuspendData.deserialize(courseState).slice(2).map(Number).map(String).join("")||"";case"_iscoursecomplete":courseState=this.getCustomState("c");return Boolean(courseState&&SCORMSuspendData.deserialize(courseState).slice(0,1).map(Number)[0]);case"_isassessmentpassed":courseState=this.getCustomState("c");return Boolean(courseState&&SCORMSuspendData.deserialize(courseState).slice(1,2).map(Number)[0]);case"questions":var questionsState=this.getCustomState("q");return questionsState||"";default:return this.getCustomState(name);}}},{key:"set",value:function set(name,value){var _this$scorm,_this$scorm2,_this$scorm3,_this$scorm4;var args=Array.prototype.slice.call(arguments).slice(1);var isObject=_typeof(name)==="object";if(isObject){value=name;name="suspendData"}if(this.useTemporaryStore()){if(isObject){Object.assign(this.temporaryStore,value)}else{this.temporaryStore[name]=value}return true}switch(name.toLowerCase()){case"interaction":return(_this$scorm=this.scorm).recordInteraction.apply(_this$scorm,_toConsumableArray(args));case"location":return(_this$scorm2=this.scorm).setLessonLocation.apply(_this$scorm2,_toConsumableArray(args));case"score":return(_this$scorm3=this.scorm).setScore.apply(_this$scorm3,_toConsumableArray(args));case"status":return(_this$scorm4=this.scorm).setStatus.apply(_this$scorm4,_toConsumableArray(args));case"student":case"learnerinfo":return false;case"lang":this.scorm.setLanguage(value);break;}if(isObject){Object.assign(this.suspendDataStore,value)}else{this.suspendDataStore[name]=value}var dataAsString=JSON.stringify(this.suspendDataStore);return this.suspendDataRestored?this.scorm.setSuspendData(dataAsString):false}},{key:"getCustomStates",value:function getCustomStates(){var isSuspendDataStoreEmpty=_.isEmpty(this.suspendDataStore);if(!isSuspendDataStoreEmpty&&this.suspendDataRestored){return _.clone(this.suspendDataStore)}var dataAsString=this.scorm.getSuspendData();if(dataAsString===""||dataAsString===" "||dataAsString===undefined){return{}}console.log(dataAsString);var dataAsJSON;try{dataAsJSON=JSON.parse(dataAsString)}catch(err){dataAsJSON=JSON.parse(dataAsString.replace(/'/g,"\""))}if(!isSuspendDataStoreEmpty&&!this.suspendDataRestored){Object.assign(dataAsJSON,this.suspendDataStore)}return dataAsJSON}},{key:"getCustomState",value:function getCustomState(name){var dataAsJSON=this.getCustomStates();return dataAsJSON[name]}},{key:"useTemporaryStore",value:function useTemporaryStore(){var cfg=Adapt.config.get("_spoor");if(!this.scorm.lmsConnected||cfg&&cfg._isEnabled===false)return true;return false}},{key:"getLearnerInfo",value:function getLearnerInfo(){var id=this.scorm.getStudentId();var name=this.scorm.getStudentName();var firstname="";var lastname="";var hasName=name&&name!=="undefined";var isNameCommaSeparated=hasName&&name.includes(",");var isNameSpaceSeparated=hasName&&name.includes(" ");hasName=hasName&&(isNameCommaSeparated||isNameSpaceSeparated);if(!hasName){console.log("SPOOR: LMS learner_name not in 'lastname, firstname' or 'firstname lastname' format");return{id:id,name:name,firstname:firstname,lastname:lastname}}var separator=isNameCommaSeparated?",":" ";var nameParts=name.split(separator);if(isNameCommaSeparated){nameParts.reverse()}var _nameParts$map=nameParts.map(function(part){return part.trim()});var _nameParts$map2=_slicedToArray(_nameParts$map,2);firstname=_nameParts$map2[0];lastname=_nameParts$map2[1];name="".concat(firstname," ").concat(lastname);return{id:id,name:name,firstname:firstname,lastname:lastname}}}]);return OfflineStorage}(Backbone.Controller);var OfflineStorage$1=__AMD("extensions/adapt-contrib-spoor/js/adapt-offlineStorage-scorm",OfflineStorage);var Spoor=function(_Backbone$Controller){_inherits(Spoor,_Backbone$Controller);var _super=_createSuper(Spoor);function Spoor(){_classCallCheck(this,Spoor);return _super.apply(this,arguments)}_createClass(Spoor,[{key:"initialize",value:function initialize(){this.config=null;this.scorm=ScormWrapper$1.getInstance();this.listenToOnce(Adapt,"offlineStorage:prepare",this._prepare)}},{key:"_prepare",value:function _prepare(){this.config=Adapt.config.get("_spoor");if(!this.isEnabled){Adapt.offlineStorage.setReadyStatus();return}this.statefulSession=new StatefulSession$1;this.offlineStorage=new OfflineStorage$1(this.statefulSession);Adapt.offlineStorage.get();Adapt.offlineStorage.setReadyStatus();require(["libraries/jquery.keycombo"],function(){$.onKeyCombo([68,69,86],function(){Adapt.spoor.scorm.showDebugWindow()})})}},{key:"isEnabled",get:function(){return this.config&&this.config._isEnabled}}]);return Spoor}(Backbone.Controller);Adapt.spoor=new Spoor;__AMD("extensions/adapt-contrib-spoor/js/adapt-contrib-spoor",Spoor);var TrickleView=Backbone.View.extend({isSteplocked:false,completionAttribute:null,initialize:function(options){this.setupEventListeners()},setupEventListeners:function(){var AdaptEvents={"trickle:kill":this.onKill,"remove":this.onRemove};this.onPreRender(this);AdaptEvents[this.model.get("_type")+"View:postRender"]=this.onPostRender;this.listenTo(Adapt,AdaptEvents);this.on("steplock",this.onStepLock);this.on("stepunlock",this.onStepUnlock)},onPreRender:function(view){this.completionAttribute=Adapt.trickle.getCompletionAttribute();if(!this.isElementEnabled())return;Adapt.trigger("trickle:preRender",this)},onPostRender:function(view){if(view.model.get("_id")!==this.model.get("_id"))return;if(!this.isElementEnabled())return;Adapt.trigger("trickle:postRender",this)},isElementEnabled:function(){var trickle=Adapt.trickle.getModelConfig(this.model);if(!trickle)return false;if(this.model.get(this.completionAttribute))return false;var isArticleWithOnChildren=this.model.get("_type")==="article"&&trickle._onChildren;if(isArticleWithOnChildren){return false}if(trickle._isEnabled===true)return true;return false},onStepLock:function(){if(!this.isElementEnabled()){this.continueToNext();return}var trickle=Adapt.trickle.getModelConfig(this.model);var isSteplocking=trickle._stepLocking&&trickle._stepLocking._isEnabled;if(!isSteplocking){this.continueToNext();return}Adapt.trigger("trickle:steplock",this);this.isSteplocked=true},continueToNext:function(){Adapt.trigger("trickle:continue",this)},onStepUnlock:function(){if(!this.isSteplocked)return;this.isSteplocked=false;Adapt.trigger("trickle:stepunlock",this)},onKill:function(){this.detachFromElement()},onRemove:function(){this.detachFromElement()},detachFromElement:function(){this.undelegateEvents();this.stopListening();this.model=null;this.articleModel=null;this.$el=null;this.el=null}});var TrickleView$1=__AMD("extensions/adapt-contrib-trickle/js/trickleView",TrickleView);var PageView=Backbone.View.extend({currentDescendantIndex:0,currentLocksOnDescendant:0,currentDescendant:null,initialize:function(options){if(!this.isPageEnabled()){return this.detachFromPage()}this.setupDescendants();if(!this.haveDescendantsGotTrickle()){return this.detachFromPage()}this.addClassToHtml();this.setupEventListeners()},isPageEnabled:function(){var trickleConfig=Adapt.trickle.getModelConfig(this.model);if(trickleConfig&&trickleConfig._isEnabled===false)return false;return true},setupDescendants:function(){this.currentDescendant=null;this.descendantViews={};this.getDescendants();Adapt.trigger("trickle:descendants",this)},descendantsChildFirst:null,descendantsParentFirst:null,descendantViews:null,getDescendants:function(){this.descendantsChildFirst=this.model.getAllDescendantModels();this.descendantsParentFirst=this.model.getAllDescendantModels(true);this.setDescendantsTrickleDefaults();this.descendantsChildFirst=this.filterComponents(this.descendantsChildFirst);this.descendantsParentFirst=this.filterComponents(this.descendantsParentFirst)},filterComponents:function(descendants){return descendants.filter(function(descendant){if(descendant.get("_type")==="component")return false;if(!descendant.get("_isAvailable"))return false;return true})},setDescendantsTrickleDefaults:function(){this.descendantsParentFirst.forEach(function(descendant){var trickle=Adapt.trickle.getModelConfig(descendant);if(!trickle){return}trickle._stepLocking=_.extend({"_isEnabled":true,"_isCompletionRequired":true,"_isLockedOnRevisit":false},trickle._stepLocking);trickle=_.extend({"_isEnabled":true,"_autoScroll":true,"_scrollDuration":500,"_onChildren":true,"_scrollTo":"@block +1"},trickle);Adapt.trickle.setModelConfig(descendant,trickle);if(trickle._onChildren&&descendant.get("_type")==="article"){this.setupArticleOnChildren(descendant,trickle)}descendant.set("_isTrickleConfigured",true)}.bind(this))},setupArticleOnChildren:function(articleModel,articleTrickleConfig){var articleBlocks=articleModel.getChildren();articleBlocks.each(function(blockModel,index){var blockTrickleConfig=Adapt.trickle.getModelConfig(blockModel);for(var k in blockTrickleConfig){if(_typeof(blockTrickleConfig[k])==="object"){blockTrickleConfig[k]=_.extend({},articleTrickleConfig[k],blockTrickleConfig[k])}}blockTrickleConfig=_.extend({},articleTrickleConfig,blockTrickleConfig);if(articleBlocks.length===index+1){blockTrickleConfig._isFinal=true}if(index===0){blockTrickleConfig._isStart=true}Adapt.trickle.setModelConfig(blockModel,blockTrickleConfig)})},haveDescendantsGotTrickle:function(){return this.descendantsChildFirst.some(function(descendant){var trickle=Adapt.trickle.getModelConfig(descendant);return trickle&&trickle._isEnabled===true})},addClassToHtml:function(){$("html").addClass("trickle")},setupEventListeners:function(){this.listenTo(Adapt,{"remove":this.onRemove,"articleView:preRender":this.onDescendantPreRender,"blockView:preRender":this.onDescendantPreRender,"trickle:unwait":this.onUnwait,"trickle:wait":this.onWait,"trickle:continue":this.onContinue,"trickle:skip":this.onSkip,"trickle:kill":this.onKill});this.listenToOnce(this.model,"change:_isReady",this.onPageReady)},onDescendantPreRender:function(view){if(view.model.get("_type")==="component")return;var descendantView=new TrickleView$1({model:view.model,el:view.el});this.descendantViews[view.model.get("_id")]=descendantView},onPageReady:function(model,value){if(!value)return;this.currentDescendant=null;Adapt.trigger("trickle:started");this.gotoNextDescendant()},gotoNextDescendant:function(){this.getDescendants();if(this.currentDescendant){this.currentDescendant.trigger("stepunlock");this.currentDescendant=null}for(var index=this.currentDescendantIndex||0,l=this.descendantsChildFirst.length;index<l;index++){var descendant=this.descendantsChildFirst[index];switch(descendant.get("_type")){case"block":case"article":this.currentLocksOnDescendant=0;this.currentDescendantIndex=index;var currentId=descendant.get("_id");this.currentDescendant=this.descendantViews[currentId];this.currentDescendant.trigger("steplock");return;}}this.finished()},onContinue:function(view){if(!this.currentDescendant)return;if(view.model.get("_id")!==this.currentDescendant.model.get("_id"))return;this.onSkip()},onWait:function(){this.currentLocksOnDescendant++},onUnwait:function(){this.currentLocksOnDescendant--;if(this.currentLocksOnDescendant>0)return;var lastDescendant=this.currentDescendant.model;this.currentDescendantIndex++;this.gotoNextDescendant();Adapt.trickle.scroll(lastDescendant)},onSkip:function(){this.currentDescendantIndex++;this.gotoNextDescendant()},onKill:function(){this.finished();this.detachFromPage()},finished:function(){Adapt.trigger("trickle:finished");this.detachFromPage()},onRemove:function(){this.finished()},detachFromPage:function(){$("html").removeClass("trickle");this.undelegateEvents();this.stopListening();this.model=null;this.$el=null;this.el=null;this.currentDescendant=null;this.descendantViews=null;this.descendantsChildFirst=null;this.descendantsParentFirst=null;Adapt.trickle.pageView=null}});var PageView$1=__AMD("extensions/adapt-contrib-trickle/js/pageView",PageView);var completionAttribute$1="_isComplete";var TrickleButtonView=Backbone.View.extend({isStepLocking:false,hasStepLocked:false,isStepLocked:false,isStepLockFinished:false,hasStepPreCompleted:false,isWaitingForClick:false,allowVisible:false,allowEnabled:true,overlayShownCount:0,el:function(){this.setupPreRender();return Handlebars.templates["trickle-button"](this.model.toJSON())},setupPreRender:function(){this.setupButtonVisible();this.setupButtonEnabled()},setupButtonVisible:function(){var trickle=Adapt.trickle.getModelConfig(this.model);this.allowVisible=false;trickle._button._isVisible=false;if(trickle._button._styleBeforeCompletion==="visible"){this.allowVisible=true;if(trickle._button._autoHide&&trickle._button._isFullWidth){trickle._button._isVisible=false}else{trickle._button._isVisible=true}}},setupButtonEnabled:function(){var trickle=Adapt.trickle.getModelConfig(this.model);if(trickle._stepLocking._isCompletionRequired===false){this.allowEnabled=true;trickle._button._isDisabled=false}else if(trickle._button._styleBeforeCompletion==="visible"){this.allowEnabled=false;trickle._button._isDisabled=true}else{trickle._button._isDisabled=false;this.allowEnabled=true}},events:{"click .js-trickle-btn":"onButtonClick"},initialize:function(options){this.getCompletionAttribute();this.debounceCheckAutoHide();this.setupStepLocking();this.setupEventListeners()},getCompletionAttribute:function(){var trickle=Adapt.trickle.getModelConfig(Adapt.config);if(!trickle)return;if(!trickle._completionAttribute)return;completionAttribute$1=trickle._completionAttribute},setupStepLocking:function(){var trickle=Adapt.trickle.getModelConfig(this.model);this.isStepLocked=Boolean(trickle._stepLocking._isEnabled)},setupEventListeners:function(){this.listenTo(Adapt,{"trickle:overlay":this.onOverlay,"trickle:unoverlay":this.onUnoverlay,"trickle:steplock":this.onStepLock,"trickle:stepunlock":this.onStepUnlock,"trickle:skip":this.onSkip,"trickle:kill":this.onKill,"trickle:update":this.onUpdate,"remove":this.onRemove});this.listenTo(this.model,"change:"+completionAttribute$1,this.onCompletion)},debounceCheckAutoHide:function(){this.checkButtonAutoHideSync=this.checkButtonAutoHide.bind(this);this.checkButtonAutoHide=_.debounce(this.checkButtonAutoHideSync,100)},checkButtonAutoHide:function(){if(!this.allowVisible){this.setButtonVisible(false);return}var trickle=Adapt.trickle.getModelConfig(this.model);if(!trickle._button._autoHide){this.setButtonVisible(true);return}else if(this.overlayShownCount>0){this.setButtonVisible(false);return}var measurements=this.$el.onscreen();var isJustOffscreen=measurements.bottom>-100;if(measurements.onscreen||isJustOffscreen){this.setButtonVisible(true)}else{this.setButtonVisible(false)}},setButtonVisible:function(isVisible){var trickle=Adapt.trickle.getModelConfig(this.model);trickle._button._isVisible=Boolean(isVisible);this.$(".js-trickle-btn-container").toggleClass("u-display-none",!trickle._button._isVisible)},checkButtonEnabled:function(){this.setButtonEnabled(this.allowEnabled)},setButtonEnabled:function(isEnabled){var trickle=Adapt.trickle.getModelConfig(this.model);var $button=this.$(".js-trickle-btn");if(isEnabled){$button.removeClass("is-disabled").removeAttr("disabled");trickle._button._isDisabled=true;if(document.activeElement&&document.activeElement.isSameNode(this.$(".aria-label")[0])){this.$(".aria-label").focusNext()}this.$(".aria-label").a11y_cntrl(false)}else{$button.addClass("is-disabled").attr("disabled","disabled");trickle._button._isDisabled=false}},onStepLock:function(view){if(!this.isViewMatch(view))return;this.hasStepLocked=true;this.isStepLocking=true;this.overlayShownCount=0;var trickle=Adapt.trickle.getModelConfig(this.model);if(!this.isButtonEnabled())return;var isCompleteAndShouldRelock=trickle._stepLocking._isLockedOnRevisit&&this.model.get(completionAttribute$1);if(isCompleteAndShouldRelock){this.isStepLocked=true;this.model.set("_isTrickleAutoScrollComplete",false);Adapt.trigger("trickle:wait");this.allowVisible=true;this.checkButtonAutoHide()}else if(this.hasStepPreCompleted){this.isStepLocked=true;this.model.set("_isTrickleAutoScrollComplete",false);this.allowVisible=true;this.stepCompleted()}this.setupOnScreenListener()},onOverlay:function(){this.overlayShownCount++},onUnoverlay:function(){this.overlayShownCount--;this.checkButtonAutoHide()},setupOnScreenListener:function(){var trickle=Adapt.trickle.getModelConfig(this.model);if(!trickle._button._autoHide)return;this.$el.on("onscreen",this.checkButtonAutoHideSync)},isViewMatch:function(view){return view.model.get("_id")===this.model.get("_id")},isButtonEnabled:function(){var trickle=Adapt.trickle.getModelConfig(this.model);if(!trickle._isEnabled||!trickle._button._isEnabled)return false;return true},onCompletion:function(model,value){if(value===false)return;this.hasStepPreCompleted=true;if(!this.hasStepLocked)return;this.stepCompleted()},stepCompleted:function(){if(this.isStepLockFinished)return;this.isStepLocked=false;this.allowVisible=false;this.allowEnabled=false;if(this.isButtonEnabled()){if(this.isStepLocking){this.isStepLocked=true;this.isWaitingForClick=true;Adapt.trigger("trickle:wait")}else{this.isStepLockFinished=true}this.allowVisible=true;this.allowEnabled=true}this.model.set("_isTrickleAutoScrollComplete",false);this.checkButtonAutoHideSync();this.checkButtonEnabled()},onButtonClick:function(){if(this.isStepLocked){Adapt.trigger("trickle:unwait");this.isStepLocked=false;this.isStepLockFinished=true}else{this.model.set("_isTrickleAutoScrollComplete",false);Adapt.trickle.scroll(this.model)}var trickle=this.model.get("_trickle");switch(trickle._button._styleAfterClick){case"hidden":this.allowVisible=false;this.checkButtonAutoHideSync();break;case"disabled":this.allowEnabled=false;this.checkButtonAutoHideSync();}},onUpdate:function(){var trickle=Adapt.trickle.getModelConfig(this.model);if(trickle._button._autoHide&&this.isStepLocking){this.$el.off("onscreen",this.checkButtonAutoHideSync)}var $original=this.$el;var $newEl=$(Handlebars.templates["trickle-button"](this.model.toJSON()));$original.replaceWith($newEl);this.setElement($newEl);if(trickle._button._autoHide&&this.isStepLocking){this.$el.on("onscreen",this.checkButtonAutoHideSync)}},onStepUnlock:function(view){if(!this.isViewMatch(view))return;this.$el.off("onscreen",this.checkButtonAutoHideSync);this.isStepLocking=false;this.overlayShownCount=0;if(document.activeElement&&document.activeElement.isSameNode(this.$(".aria-label")[0])){this.$(".aria-label").focusNext()}this.$(".aria-label").a11y_cntrl(false)},onSkip:function(){if(!this.isStepLocking)return;this.onKill()},onKill:function(){this.$el.off("onscreen",this.checkButtonAutoHideSync);if(this.isWaitingForClick){this.model.set("_isTrickleAutoScrollComplete",true)}this.isWaitingForClick=false;this.isStepLocked=false;this.isStepLocking=false;this.allowVisible=false;this.allowEnabled=false;this.isStepLockFinished=true;this.model.set("_isTrickleAutoScrollComplete",false);this.checkButtonAutoHide();this.checkButtonEnabled()},onRemove:function(){if(this.isWaitingForClick){this.model.set("_isTrickleAutoScrollComplete",true)}this.isWaitingForClick=false;this.$el.off("onscreen",this.checkButtonAutoHideSync);this.isStepLocking=true;this.remove()}});var ButtonView=__AMD("extensions/adapt-contrib-trickle/js/handlers/buttonView",TrickleButtonView);var TrickleButtonHandler=Backbone.Controller.extend({buttonViews:null,initialize:function(){this.listenToOnce(Adapt,{"app:dataReady":this.onAppDataReady,remove:this.onRemove})},onAppDataReady:function(){this.buttonViews={};this.setupEventListeners()},setupEventListeners:function(){this.listenTo(Adapt,{"trickle:preRender":this.onPreRender,"trickle:postRender":this.onPostRender})},onPreRender:function(view){if(!this.isTrickleEnabled(view.model))return;this.setupConfigDefaults(view.model);this.buttonViews[view.model.get("_id")]=new ButtonView({model:view.model})},onPostRender:function(view){if(!this.isTrickleEnabled(view.model))return;view.$el.append(this.buttonViews[view.model.get("_id")].$el)},isTrickleEnabled:function(model){var trickle=Adapt.trickle.getModelConfig(model);if(!trickle||!trickle._isEnabled)return false;if(trickle._onChildren&&model.get("_type")==="article")return false;return true},setupConfigDefaults:function(model){if(model.get("_isTrickleButtonConfigured"))return;var defaults={_isEnabled:true,_styleBeforeCompletion:"hidden",_styleAfterClick:"hidden",_isFullWidth:true,_autoHide:false,_className:"",_hasIcon:false,text:"Continue",startText:"Begin",finalText:"Finish",_component:"trickle-button",_isLocking:true,_isVisible:false,_isDisabled:false};var trickle=Adapt.trickle.getModelConfig(model);trickle._button=_.extend(defaults,trickle._button);if(trickle._button._isFullWidth){trickle._stepLocking._isEnabled=true;trickle._button._styleAfterClick="hidden"}else{trickle._button._autoHide=false}Adapt.trickle.setModelConfig(model,trickle);model.set("_isTrickleButtonConfigured",true)},onRemove:function(){this.buttonViews={}}});__AMD("extensions/adapt-contrib-trickle/js/handlers/button",new TrickleButtonHandler);var completionAttribute="_isComplete";var TrickleCompletionHandler=Backbone.Controller.extend({isStepLocking:false,isCompleted:false,stepModel:null,initialize:function(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function(){this.getCompletionAttribute();this.setupEventListeners()},getCompletionAttribute:function(){var trickle=Adapt.trickle.getModelConfig(Adapt.config);if(!trickle)return;if(!trickle._completionAttribute)return;completionAttribute=trickle._completionAttribute},setupEventListeners:function(){this.listenTo(Adapt,{"trickle:descendants":this.onDescendants,"trickle:steplock":this.onStepLock,"trickle:stepunlock":this.onStepUnlock,"trickle:kill":this.onKill,"remove":this.onRemove})},onDescendants:function(view){view.descendantsParentFirst.forEach(function(descendant){var trickle=Adapt.trickle.getModelConfig(descendant);if(!trickle)return;trickle._wasCompletedPreRender=descendant.get(completionAttribute)})},onStepLock:function(view){var isModelComplete=view.model.get(completionAttribute);var trickle=Adapt.trickle.getModelConfig(view.model);if(!trickle._stepLocking._isCompletionRequired&&!trickle._stepLocking._isLockedOnRevisit){if(!isModelComplete)return;Adapt.trigger("trickle:continue",view);return}if(trickle._stepLocking._isCompletionRequired&&isModelComplete&&trickle._wasCompletedPreRender){Adapt.trigger("trickle:continue",view);return}Adapt.trigger("trickle:wait");if(isModelComplete){Adapt.trigger("trickle:unwait");return}view.model.set("_isTrickleAutoScrollComplete",false);this.isCompleted=false;this.isStepLocking=true;this.stepModel=view.model;this.listenTo(this.stepModel,"change:"+completionAttribute,this.onCompletion)},onCompletion:function(model,value){if(value===false)return;this.stepCompleted()},stepCompleted:function(){if(!this.isStepLocking)return;if(this.isCompleted)return;this.isCompleted=true;this.stopListening(this.stepModel,"change:"+completionAttribute,this.onCompletion);Adapt.trigger("trickle:unwait")},onKill:function(){this.onStepUnlock()},onRemove:function(){this.onStepUnlock()},onStepUnlock:function(){this.stopListening(this.stepModel,"change:"+completionAttribute,this.onCompletion);this.isStepLocking=false;this.stepModel=null;this.isCompleted=false}});__AMD("extensions/adapt-contrib-trickle/js/handlers/completion",new TrickleCompletionHandler);var TrickleNotifyHandler=Backbone.Controller.extend({isStepLocking:false,isNotifyOpen:false,initialize:function(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function(){this.setupEventListeners()},setupEventListeners:function(){this.listenTo(Adapt,{"trickle:steplock":this.onStepLock,"notify:opened":this.onNotifyOpened,"notify:closed":this.onNotifyClosed,"trickle:stepunlock":this.onStepUnlock,"remove":this.onRemove})},onStepLock:function(view){this.isStepLocking=true},onNotifyOpened:function(){if(!this.isStepLocking)return;this.isNotifyOpen=true;Adapt.trigger("trickle:overlay");Adapt.trigger("trickle:wait")},onNotifyClosed:function(){if(!this.isStepLocking)return;if(!this.isNotifyOpen)return;this.isNotifyOpen=false;Adapt.trigger("trickle:unoverlay");Adapt.trigger("trickle:unwait")},onStepUnlock:function(){this.isStepLocking=false},onRemove:function(){this.onStepUnlock()}});__AMD("extensions/adapt-contrib-trickle/js/handlers/notify",new TrickleNotifyHandler);var TrickleBodyResizeHandler=Backbone.Controller.extend({isStepLocking:false,stepView:null,initialize:function(){this.listenToOnce(Adapt,{"app:dataReady":this.onAppDataReady,"adapt:initialize":this.onAdaptInitialized})},onAppDataReady:function(){this.onResize=this.onResize.bind(this);this.preventWrapperScroll=this.preventWrapperScroll.bind(this);this.setupEventListeners()},setupEventListeners:function(){this.listenTo(Adapt,{"trickle:steplock":this.onStepLock,"trickle:resize":this.onTrickleResize,"trickle:stepunlock":this.onStepUnlock,"trickle:kill":this.onKill,"trickle:finished":this.onFinished,"remove":this.onRemove})},onAdaptInitialized:function(){this.wrapper=document.getElementById("wrapper");this.wrapper.addEventListener("scroll",this.preventWrapperScroll)},onStepLock:function(view){this.isStepLocking=true;this.stepView=view;$(window).on("resize",this.onResize);$(".page").on("resize",this.onResize);Adapt.trigger("trickle:resize")},preventWrapperScroll:function(event){if(!this.isStepLocking)return;var top=this.wrapper.scrollTop;if(top===0)return;this.wrapper.scrollTop=0;window.scrollTo(0,window.pageYOffset+top)},onResize:function(){if(!this.isStepLocking)return;Adapt.trigger("trickle:resize")},onTrickleResize:function(){if(!this.isStepLocking)return;var offset=this.stepView.$el.offset();var height=this.stepView.$el.height();var $wrapper=$(this.wrapper);var bottom=offset["top"]+height;$wrapper.css("height",bottom)},onStepUnlock:function(view){this.isStepLocking=false;this.stepView=null;$(window).off("resize",this.onResize);$(".page").off("resize",this.onResize)},onKill:function(){this.onFinished();this.onStepUnlock()},onFinished:function(){this.wrapper.removeEventListener("scroll",this.preventWrapperScroll);$(this.wrapper).css("height","")},onRemove:function(){this.onStepUnlock();this.stepView=null}});__AMD("extensions/adapt-contrib-trickle/js/handlers/resize",new TrickleBodyResizeHandler);var TrickleTutorHandler=Backbone.Controller.extend({stepLockedId:null,isStepLocking:false,isTutorOpen:false,initialize:function(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function(){this.setupEventListeners()},setupEventListeners:function(){this.listenTo(Adapt,{"trickle:steplock":this.onStepLock,"tutor:opened":this.onTutorOpened,"tutor:closed":this.onTutorClosed,"trickle:stepunlock":this.onStepUnlock,"remove":this.onRemove})},onStepLock:function(view){if(view){this.stepLockedId=view.model.get("_id")}this.isStepLocking=true},onTutorOpened:function(view,alertObject){if(!this.isStepLocking)return;if(!this.isOriginStepLocked(view))return;this.isTutorOpen=true;Adapt.trigger("trickle:overlay");Adapt.trigger("trickle:wait")},isOriginStepLocked:function(view){if(!view||!this.stepLockedId)return true;var parents=view.model.getAncestorModels();var hasStepLockedParent=_.find(parents,function(ancestor){return ancestor.get("_id")===this.stepLockedId},this);if(!hasStepLockedParent)return false;return true},onTutorClosed:function(view,alertObject){if(!this.isStepLocking)return;if(!this.isTutorOpen)return;if(!this.isOriginStepLocked(view))return;this.isTutorOpen=false;Adapt.trigger("trickle:unoverlay");Adapt.trigger("trickle:unwait")},onStepUnlock:function(){this.isStepLocking=false;this.stepLockedId=null},onRemove:function(){this.onStepUnlock()}});__AMD("extensions/adapt-contrib-trickle/js/handlers/tutor",new TrickleTutorHandler);var TrickleVisibilityHandler=Backbone.Controller.extend({isStepLocking:false,trickleModel:null,initialize:function(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function(){this.setupEventListeners()},setupEventListeners:function(){this.listenTo(Adapt,{"trickle:steplock":this.onStepLock,"trickle:visibility":this.onVisibility,"trickle:stepunlock":this.onStepUnlock,"trickle:kill":this.onKill,"trickle:finished":this.onFinished,"remove":this.onRemove})},onStepLock:function(view){this.isStepLocking=true;this.trickleModel=view.model;Adapt.trigger("trickle:visibility")},onVisibility:function(){if(!this.isStepLocking)return;if(!Adapt.trickle.pageView)return;var descendantsParentFirst=Adapt.trickle.pageView.descendantsParentFirst;var trickleModelId=this.trickleModel.get("_id");var trickleType=this.trickleModel.get("_type");var atIndex=_.findIndex(descendantsParentFirst,function(descendant){if(descendant.get("_id")===trickleModelId)return true});descendantsParentFirst.forEach(function(descendant,index){var components=descendant.findDescendantModels("components");if(index<=atIndex){descendant.set("_isVisible",true,{pluginName:"trickle"});components.forEach(function(componentModel){componentModel.set("_isVisible",true,{pluginName:"trickle"})});return}if(trickleType==="article"&&descendant.get("_type")==="block"){if(descendant.get("_parentId")===trickleModelId){descendant.set("_isVisible",true,{pluginName:"trickle"});components.forEach(function(componentModel){componentModel.set("_isVisible",true,{pluginName:"trickle"})});return}}descendant.set("_isVisible",false,{pluginName:"trickle"});components.forEach(function(componentModel){componentModel.set("_isVisible",false,{pluginName:"trickle"})})})},onStepUnlock:function(view){this.isStepLocking=false;this.trickleModel=null},onKill:function(){this.onFinished();this.onStepUnlock()},onFinished:function(){var descendantsParentFirst=Adapt.trickle.pageView.descendantsParentFirst;descendantsParentFirst.forEach(function(descendant){descendant.set("_isVisible",true,{pluginName:"trickle"});var components=descendant.findDescendantModels("components");components.forEach(function(componentModel){componentModel.set("_isVisible",true,{pluginName:"trickle"})})})},onRemove:function(){this.onStepUnlock()}});__AMD("extensions/adapt-contrib-trickle/js/handlers/visibility",new TrickleVisibilityHandler);var TrickleDone=Backbone.Controller.extend({initialize:function(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function(){this.setupEventListeners()},setupEventListeners:function(){this.onDone=_.debounce(this.onDone.bind(this),50);this.listenTo(Adapt,{"trickle:steplock":this.onDone,"trickle:stepunlock":this.onDone,"trickle:continue":this.onDone,"trickle:finished":this.onDone})},onDone:function(){Adapt.trigger("trickle:done")}});__AMD("extensions/adapt-contrib-trickle/js/handlers/done",new TrickleDone);var Trickle=Backbone.Controller.extend({model:null,pageView:null,initialize:function(){this.listenToOnce(Adapt,{"app:dataReady":this.onAppDataReady})},onAppDataReady:function(){this.getCourseModel();if(!this.isCourseEnabled())return;this.setupListeners()},getCourseModel:function(){this.model=Adapt.course},isCourseEnabled:function(){var trickleConfig=this.getModelConfig(this.model);if(trickleConfig&&trickleConfig._isEnabled===false)return false;return true},getModelConfig:function(model){return model.get("_trickle")},getCompletionAttribute:function(){var trickle=this.getModelConfig(Adapt.config);if(!trickle)return"_isComplete";return trickle._completionAttribute||"_isComplete"},setModelConfig:function(model,config){return model.set("_trickle",config)},setupListeners:function(){this.listenTo(Adapt,"pageView:preRender",this.onPagePreRender)},onPagePreRender:function(view){this.pageView=new PageView$1({model:view.model,el:view.el})},scroll:function(fromModel){if(!this.shouldScrollPage(fromModel))return;fromModel.set("_isTrickleAutoScrollComplete",true);var trickle=Adapt.trickle.getModelConfig(fromModel);var isAutoScrollOff=!trickle._autoScroll;var hasTrickleButton=trickle._button._isEnabled;if(isAutoScrollOff&&!hasTrickleButton){return}var scrollTo=trickle._scrollTo;if(scrollTo===undefined)scrollTo="@block +1";var scrollToId="";switch(scrollTo.substr(0,1)){case"@":var relativeModel=fromModel.findRelativeModel(scrollTo,{filter:function(model){return model.get("_isAvailable")}});if(relativeModel===undefined)return;scrollToId=relativeModel.get("_id");break;case".":scrollToId=scrollTo.substr(1,scrollTo.length-1);break;default:scrollToId=scrollTo;}if(scrollToId==="")return;if(hasTrickleButton){Adapt.a11y.focusFirst($("."+scrollToId))}if(isAutoScrollOff)return;var duration=fromModel.get("_trickle")._scrollDuration||500;Adapt.scrollTo("."+scrollToId,{duration:duration})},shouldScrollPage:function(fromModel){var trickle=Adapt.trickle.getModelConfig(fromModel);if(!trickle||!trickle._isEnabled)return false;var hasScrolled=fromModel.get("_isTrickleAutoScrollComplete");if(hasScrolled)return false;var isArticleWithOnChildren=fromModel.get("_type")==="article"&&trickle._onChildren;if(isArticleWithOnChildren)return false;return true}});__AMD("extensions/adapt-contrib-trickle/js/adapt-contrib-trickle",Adapt.trickle=new Trickle);Adapt.on("questionView:showFeedback",function(view){var alertObject={title:view.model.get("feedbackTitle"),body:view.model.get("feedbackMessage")};var attributes={};var classes=[];if(view.model.has("_isCorrect")){if(view.model.get("_isCorrect")){classes.push("is-correct")}else{if(view.model.has("_isAtLeastOneIncorrectSelection")){if(!view.model.get("_isAtLeastOneIncorrectSelection")){classes.push("is-partially-correct")}else{classes.push("is-incorrect")}}else if(view.model.has("_isAtLeastOneCorrectSelection")){if(view.model.get("_isAtLeastOneCorrectSelection")){classes.push("is-partially-correct")}else{classes.push("is-incorrect")}}else{classes.push("is-incorrect")}}}if(view.model.has("_component")){classes.push("is-component is-"+view.model.get("_component").toLowerCase())}else if(view.model.has("_extension")){classes.push("is-extension is-"+view.model.get("_extension").toLowerCase())}attributes["data-adapt-id"]=view.model.get("_id");alertObject._classes=classes.join(" ");alertObject._attributes=attributes;alertObject._parentView=view;Adapt.once("notify:closed",function(){Adapt.trigger("tutor:closed",view,alertObject)});Adapt.trigger("notify:popup",alertObject);Adapt.trigger("tutor:opened",view,alertObject)});var DDAudioModel=function(_Backbone$Model){_inherits(DDAudioModel,_Backbone$Model);var _super=_createSuper(DDAudioModel);function DDAudioModel(){_classCallCheck(this,DDAudioModel);return _super.apply(this,arguments)}_createClass(DDAudioModel,[{key:"defaults",value:function defaults(){return{_id:"",_sources:[],_isSingleton:true,_isReady:false,_isPlaying:0,_currentTime:-1}}},{key:"initialize",value:function initialize(){}},{key:"play",value:function play(currentTime){if(this.isSingleton()){Adapt.ddAudio.pauseAllSingletons(this)}this.set("_isPlaying",true);this.trigger("change:_isPlaying",this,true);if(currentTime!==undefined){this.set("_currentTime",currentTime);this.trigger("change:_currentTime",this,currentTime)}}},{key:"pause",value:function pause(){this.set("_isPlaying",false);this.trigger("change:_isPlaying",this,false)}},{key:"isSingleton",value:function isSingleton(){return Boolean(this.get("_isSingleton"))}}]);return DDAudioModel}(Backbone.Model);var DDAudioModel$1=__AMD("extensions/adapt-dd-audio/js/dd-audioModel",DDAudioModel);var DDAudioView=function(_Backbone$View){_inherits(DDAudioView,_Backbone$View);var _super=_createSuper(DDAudioView);function DDAudioView(){_classCallCheck(this,DDAudioView);return _super.apply(this,arguments)}_createClass(DDAudioView,[{key:"events",value:function events(){return{}}},{key:"attributes",value:function attributes(){return{"data-adapt-id":this.model.get("_id")}}},{key:"className",value:function className(){var classes=["dd-audio","is-metadata-loading"];return classes.join(" ")}},{key:"initialize",value:function initialize(){this.render();this.setupEventListeners()}},{key:"getAudioEl",value:function getAudioEl(){return this.$(".js-dd-audio-audio")[0]}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model,{"change:_isReady":this.onIsReadyChange,"change:_isPlaying":this.onIsPlayingChange,"change:_currentTime":this.onCurrentTimeChange});this.getAudioEl().addEventListener("load",this.onLoad.bind(this));this.getAudioEl().addEventListener("ended",this.onEnded.bind(this));this.getAudioEl().addEventListener("error",this.onError.bind(this))}},{key:"render",value:function render(){var template=Handlebars.templates["ddAudio"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}},{key:"onError",value:function onError(event){Adapt.log.error(event)}},{key:"onLoad",value:function onLoad(){this.$el.removeClass("is-metadata-loading");this.set("_isReady",true)}},{key:"onEnded",value:function onEnded(){this.model.set("_isPlaying",false)}},{key:"onIsReadyChange",value:function onIsReadyChange(model,isReady){if(!isReady)return;this.onIsPlayingChange(this.model,this.get("_isPlaying"));this.onCurrentTimeChange(this.model,this.get("_currentTime"))}},{key:"onIsPlayingChange",value:function onIsPlayingChange(model,isPlaying){var audio=this.getAudioEl();if(isPlaying){audio.play()}else{audio.pause()}}},{key:"onCurrentTimeChange",value:function onCurrentTimeChange(model,currentTime){var audio=this.getAudioEl();audio.currentTime=currentTime}}]);return DDAudioView}(Backbone.View);var DDAudioView$1=__AMD("extensions/adapt-dd-audio/js/dd-audioView",DDAudioView);var DDAudioInstructionView=function(_Backbone$View){_inherits(DDAudioInstructionView,_Backbone$View);var _super=_createSuper(DDAudioInstructionView);function DDAudioInstructionView(){_classCallCheck(this,DDAudioInstructionView);return _super.apply(this,arguments)}_createClass(DDAudioInstructionView,[{key:"events",value:function events(){return{"click .js-dd-audio-instruction-btn":"onClick"}}},{key:"initialize",value:function initialize(){this.render()}},{key:"render",value:function render(){var template=Handlebars.templates["ddAudioInstructionIcon"];this.$(".js-component-instruction-inner").prepend(new Handlebars.SafeString(template(this.model.toJSON())).string)}},{key:"onClick",value:function onClick(){Adapt.ddVideo.pauseAllMedia()}}]);return DDAudioInstructionView}(Backbone.View);var DDAudioInstructionView$1=__AMD("extensions/adapt-dd-audio/js/dd-audioInstructionView",DDAudioInstructionView);var DDAudio=function(_Backbone$Controller){_inherits(DDAudio,_Backbone$Controller);var _super=_createSuper(DDAudio);function DDAudio(){_classCallCheck(this,DDAudio);return _super.apply(this,arguments)}_createClass(DDAudio,[{key:"initialize",value:function initialize(){this.audios=new Backbone.Collection([],{model:DDAudioModel$1});this.pauseAllMedia=_.debounce(this.pauseAllMedia.bind(this),10,true);this.listenTo(Adapt,{"router:page":this.onRouterPage,"media:pause":this.onGlobalPause});$("body").append($("<div>",{id:"dd-audio"}))}},{key:"onRouterPage",value:function onRouterPage(){}},{key:"playAudio",value:function playAudio(id,currentTime){var audioModel=this.getAudio(id);if(!audioModel)throw"adapt-dd-audio: could not playAudio() for \"".concat(id,"\". It hasn't had loadAudio() called for it yet!");audioModel.play(currentTime)}},{key:"play",value:function play(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this.playAudio.apply(this,args)}},{key:"getAudio",value:function getAudio(id){return this.audios.find(function(audioModel){return audioModel.get("_id")===id})}},{key:"loadAudio",value:function loadAudio(id,sources){var exists=this.getAudio(id);if(exists){return}if(!Array.isArray(sources))sources=[sources];sources=sources.filter(function(e){return Boolean(e)});var model=new DDAudioModel$1({_id:id,_sources:sources,_isSingleton:true});var view=new DDAudioView$1({model:model});$("#dd-audio").append(view.$el);this.audios.push(model);return model}},{key:"pauseAllSingletons",value:function pauseAllSingletons(exceptAudio){var singletons=this.audios.filter(function(audioModel){return audioModel.isSingleton()});singletons.forEach(function(audioModel){if(audioModel===exceptAudio)return;audioModel.pause()})}},{key:"pauseAllAudio",value:function pauseAllAudio(){this.audios.each(function(audioModel){audioModel.pause()})}},{key:"pauseAllMedia",value:function pauseAllMedia(){Adapt.trigger("media:pause")}},{key:"onGlobalPause",value:function onGlobalPause(){this.pauseAllAudio()}},{key:"setComponentAudioStatus",value:function setComponentAudioStatus(componentModel){if(componentModel.get("_hasComponentAudio"))return;componentModel.set("_hasComponentAudio",true);var setupAudioInstruction=function(){var componentView=Adapt.findViewByModelId(componentModel.get("_id"));new DDAudioInstructionView$1({model:new Backbone.Model,el:componentView.$(".js-component-instruction").first()[0]})};if(componentModel.get("_isReady")){setupAudioInstruction()}else{this.listenToOnce(componentModel,"change:_isReady",setupAudioInstruction)}}}]);return DDAudio}(Backbone.Controller);var ddAudio=new DDAudio;Adapt.ddAudio=ddAudio;var FigurePopupView=function(_Backbone$View){_inherits(FigurePopupView,_Backbone$View);var _super=_createSuper(FigurePopupView);function FigurePopupView(){_classCallCheck(this,FigurePopupView);return _super.apply(this,arguments)}_createClass(FigurePopupView,[{key:"className",value:function className(){var classes=["figure-popup",this.model.get("_classes")||""];return classes.join(" ")}},{key:"events",value:function events(){return{}}},{key:"initialize",value:function initialize(){this.setUpEventListeners();this.render()}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenToOnce(Adapt,"notify:opened",this.onOpened);this.listenToOnce(Adapt,"notify:closed",this.onClosed)}},{key:"onOpened",value:function onOpened(){Adapt.scrollfix.disableA11yScroll()}},{key:"onClosed",value:function onClosed(){this.$el.addClass("is-closed");Adapt.scrollfix.enableA11yScroll()}},{key:"remove",value:function remove(){this.model.trigger("remove");_get(_getPrototypeOf(FigurePopupView.prototype),"remove",this).call(this)}},{key:"render",value:function render(){var _this=this;var data=this.model.toJSON();data.view=this;var template=Handlebars.templates["ddFigurePopup"];this.$el.html(template(data));_.delay(function(){Handlebars.fixPlaceholders(_this.$el)},50)}},{key:"closePopup",value:function closePopup(){Adapt.trigger("notify:close")}}]);return FigurePopupView}(Backbone.View);var FigurePopupView$1=__AMD("extensions/adapt-dd-figure/js/figurePopupView",FigurePopupView);var HIDDEN_OBSERVER_DEBOUNCE$1=500;var FigureItemView=function(_Backbone$View){_inherits(FigureItemView,_Backbone$View);var _super=_createSuper(FigureItemView);function FigureItemView(){_classCallCheck(this,FigureItemView);return _super.apply(this,arguments)}_createClass(FigureItemView,[{key:"events",value:function events(){var e={};if(this.model.get("lightbox")){e["click"]="onLightboxClick"}return e}},{key:"initialize",value:function initialize(){this.render();this.setUpModelData();this.setupEventListeners();_.delay(this.postRender.bind(this),0)}},{key:"setUpModelData",value:function setUpModelData(){this.setUpLightboxData();this.model.set("content",this.$(".js-figure-item-inner").html())}},{key:"setupEventListeners",value:function setupEventListeners(){this.onDeviceResize=_.debounce(this.onDeviceResize.bind(this),10);this.listenTo(Adapt,"device:resize",this.onDeviceResize);this.$el.imageready(this.onDeviceResize.bind(this));this.listenTo(this.model,"change:_isTransformed",this.onTransformedChange);this.listenTo(this.model,"change:_isHidden",this.onHiddenChange)}},{key:"onDeviceResize",value:function onDeviceResize(){if(!this.model.get("scaleDown"))return;this.updateScaleDown();this.updateLightbox()}},{key:"isLightboxEnabled",value:function isLightboxEnabled(){var _this$model$get;return Boolean((_this$model$get=this.model.get("lightbox"))===null||_this$model$get===void 0?void 0:_this$model$get._isEnabled)}},{key:"isLightboxActive",value:function isLightboxActive(){var _this$model$get2;return Boolean((_this$model$get2=this.model.get("lightbox"))===null||_this$model$get2===void 0?void 0:_this$model$get2._isActive)}},{key:"onTransformedChange",value:function onTransformedChange(model,isTransformed){var lightbox=this.model.get("lightbox");if(!lightbox)return;lightbox._isActive=isTransformed;this.$el.toggleClass("lightbox-active",isTransformed)}},{key:"setUpLightboxData",value:function setUpLightboxData(){var lightbox=this.model.get("lightbox");if(!lightbox)return;if(lightbox===true)lightbox={};this.model.set("lightbox",{_isEnabled:true,_width:!isNaN(lightbox)?lightbox:lightbox._width||"auto",_backgroundEnabled:lightbox.bg===false?false:true})}},{key:"onLightboxClick",value:function onLightboxClick(){if(!this.isLightboxActive())return;this.openLightbox()}},{key:"openLightbox",value:function openLightbox(){if(this._isPopupOpen)return;this._isPopupOpen=true;this.popupView=new FigurePopupView$1({model:this.model});Adapt.trigger("notify:popup",{_view:this.popupView,_isCancellable:true,_showCloseButton:true,_classes:"figure-lightbox dragscroll"});this.listenToOnce(Adapt,{"popup:closed":this.onLightboxClosed})}},{key:"onLightboxClosed",value:function onLightboxClosed(){this._isPopupOpen=false}},{key:"onHiddenChange",value:function onHiddenChange(model,isHidden){if(isHidden)return;this.updateScaleDown();this.updateLightbox()}},{key:"render",value:function render(){var sizing=this.model.get("sizing");if(!sizing)return;if(typeof sizing=="string"&&/^\d+(\.\d+)?%$/.test(sizing)){this.$el.css("width",sizing);return}this.$el.addClass(Adapt.sizing.getSizingClass(sizing))}},{key:"postRender",value:function postRender(){var _this=this;if(!this.isLightboxEnabled())return;this.model.set("_isHidden",this.$el.is(":hidden"));var callback=_.debounce(function(){_this.model.set("_isHidden",_this.$el.is(":hidden"))},HIDDEN_OBSERVER_DEBOUNCE$1);this._hiddenObserver=new MutationObserver(callback);var closestEl=this.$el.closest(".component")[0];if(!closestEl)closestEl=this.$el.closest(".notify")[0];this._hiddenObserver.observe(closestEl,{attributes:true,subtree:true})}},{key:"updateScaleDown",value:function updateScaleDown(){if(!this.model.get("scaleDown"))return;if(this.model.get("_isHidden"))return;var $item=this.$el;var $itemInner=this.$(".js-figure-item-inner");$item.css("height","");$itemInner.css("transform","");var bb=$item[0].getBoundingClientRect();var bbInner=$itemInner[0].getBoundingClientRect();var xPadding=parseFloat($item.css("padding-left"),10)+parseFloat($item.css("padding-right"),10);var scale=(bb.width-xPadding)/bbInner.width;var isTransformed=scale<1;this.model.set("_isTransformed",isTransformed);this.$el.toggleClass("is-transformed",isTransformed);if(!isTransformed)return;$itemInner.css("transform","scale(".concat(scale,")"));var yPadding=parseFloat($item.css("padding-top"),10)+parseFloat($item.css("padding-bottom"),10);$item.css("height",bbInner.height*scale+yPadding)}},{key:"updateLightbox",value:function updateLightbox(){}}]);return FigureItemView}(Backbone.View);var FigureItemView$1=__AMD("extensions/adapt-dd-figure/js/figureItemView",FigureItemView);function renderFigureItem$1(){var data=Handlebars__default["default"].getContextHash.apply(this,arguments);if(data.scrolling===undefined)data.scrolling=false;if(data.scaledown||data.scaleDown){data.scrolling=false;data.scaleDown=true}if(data.lightbox){data.scrolling=false;data.scaleDown=true;data.lightbox=data.lightbox}var d={scaleDown:data.scaleDown,lightbox:data.lightbox,scrolling:data.scrolling,caption:data.caption,sizing:data.sizing,stack:Boolean(data.stack)};data.data=JSON.stringify(d);var html=Handlebars__default["default"].templates["ddFigureItem"](data);return new Handlebars__default["default"].SafeString(html)}Handlebars__default["default"].registerHelper("item",renderFigureItem$1);Handlebars__default["default"].registerHelper("figureItem",renderFigureItem$1);Handlebars__default["default"].registerHelper("figureitem",renderFigureItem$1);function renderFigureText(){var data=Handlebars__default["default"].getContextHash.apply(this,arguments);if(data.sizing)data.sizing=Adapt.sizing.getSizingClass(data.sizing);var html=Handlebars__default["default"].templates["ddFigureText"](data);return new Handlebars__default["default"].SafeString(html)}Handlebars__default["default"].registerHelper("figureText",renderFigureText);Handlebars__default["default"].registerHelper("figuretext",renderFigureText);function renderBr(){var data=Handlebars__default["default"].getContextHash.apply(this,arguments);var html=Handlebars__default["default"].templates["ddFigureBr"](data);return new Handlebars__default["default"].SafeString(html)}Handlebars__default["default"].registerHelper("br",renderBr);var FigureView=function(_Backbone$View){_inherits(FigureView,_Backbone$View);var _super=_createSuper(FigureView);function FigureView(){_classCallCheck(this,FigureView);return _super.apply(this,arguments)}_createClass(FigureView,[{key:"className",value:function className(){var classes=["figure",this.model.get("class")||"",this.model.get("reverse")?"is-reverse":"",this.model.get("align")?"align-"+this.model.get("align"):"",this.model.get("justify")?"justify-"+this.model.get("justify"):"",this.model.get("wrap")===false?"no-wrap":"",this.model.get("mode")?"is-mode-"+this.model.get("mode"):"",this.model.get("theme")?"theme-"+this.model.get("theme"):""];var direction=this.model.get("direction");if(direction===undefined){direction=this.model.get("column")?"column":"row"}classes.push("is-".concat(direction));return classes.join(" ")}},{key:"tagName",value:function tagName(){return"figure"}},{key:"attributes",value:function attributes(){var attr={};if(this.model.get("style"))attr.style=this.model.get("style");if(this.model.get("name"))attr.name=this.model.get("name");return attr}},{key:"initialize",value:function initialize(){this.render();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){}},{key:"render",value:function render(){var _this=this;var template=Handlebars__default["default"].templates["ddFigure"];this.$el.html(new Handlebars__default["default"].SafeString(template(this.model.toJSON())).string);this.$(".js-figure-item").each(function(i,e){var modelData={};try{modelData=JSON.parse($(e).attr("data-model"));$(e).removeAttr("data-model")}catch(err){modelData={}}modelData=_.extend({sizing:_this.model.get("sizing")||"auto"},modelData,{_parent:_this.model,_index:i});$(e).attr("data-index",i);new FigureItemView$1({model:new Backbone.Model(modelData),el:e})})}}]);return FigureView}(Backbone.View);var FigureView$1=__AMD("extensions/adapt-dd-figure/js/figureView",FigureView);var FigureModel=function(_Backbone$Model){_inherits(FigureModel,_Backbone$Model);var _super=_createSuper(FigureModel);function FigureModel(){_classCallCheck(this,FigureModel);return _super.apply(this,arguments)}_createClass(FigureModel,[{key:"initialize",value:function initialize(){this.initCaption()}},{key:"initCaption",value:function initCaption(){if(!this.get("caption"))return;this.set(Adapt.figure.createCaptionData(this.get("caption"),this.get("content")))}}]);return FigureModel}(Backbone.Model);var FigureModel$1=__AMD("extensions/adapt-dd-figure/js/figureModel",FigureModel);var Figure=function(_Backbone$Controller){_inherits(Figure,_Backbone$Controller);var _super=_createSuper(Figure);function Figure(){_classCallCheck(this,Figure);return _super.apply(this,arguments)}_createClass(Figure,[{key:"initialize",value:function initialize(){Adapt.on("router:page",this.onRouterPage)}},{key:"onRouterPage",value:function onRouterPage(){Handlebars__default["default"].registerHelperEl("figure",function(){var context=arguments[arguments.length-1];var modelJSON=_.extend({},context.hash,{_parent:Handlebars__default["default"].getComponentModelFromContext(context),content:context.fn(this)});return new FigureView$1({model:new FigureModel$1(modelJSON)}).$el})}}]);return Figure}(Backbone.Controller);var figure=new Figure;Adapt.figure=figure;Adapt.isPDFMode=function(){var _Adapt$pdf;return Boolean((_Adapt$pdf=Adapt.pdf)===null||_Adapt$pdf===void 0?void 0:_Adapt$pdf._isEnabled)};Adapt.isEpubMode=function(){var _Adapt$epub;return Boolean((_Adapt$epub=Adapt.epub)===null||_Adapt$epub===void 0?void 0:_Adapt$epub._isEnabled)};Adapt.isDebugEnabled=function(){var _Adapt$debug;return Boolean((_Adapt$debug=Adapt.debug)===null||_Adapt$debug===void 0?void 0:_Adapt$debug._isEnabled)};$.fn.onUnhidden=function(callback){var HIDDEN_OBSERVER_DEBOUNCE=10;var $el=$(this);var closestEl=$el.closest(".component")[0];if(!closestEl)closestEl=$el.closest(".notify")[0];if(!closestEl){Adapt.log.error("$.fn.onUnhidden: Could not set up MutationObserver (could not find closest parent).",$el);return this}var observerCallback=_.debounce(function(){$el.each(function(i,e){var $e=$(e);var isHidden=$e.is(":hidden");var isUnhidden=$e.data("_isUnhidden");if(isHidden===!isUnhidden)return;$e.data("_isUnhidden",!isHidden);if(isHidden)return;callback.apply($e)})},HIDDEN_OBSERVER_DEBOUNCE);var unhiddenObserver=new MutationObserver(observerCallback);unhiddenObserver.observe(closestEl,{attributes:true,attributeFilter:["style","hidden","aria-expanded","class"],subtree:true});return this};requirejs.onError=function(err){if(err.requireType==="timeout"){if(Adapt.ddLoading){Adapt.ddLoading.showError("Load timeout.")}throw err}else{throw err}};var helperElAttr="data-registerhelperel-id";var helperElData={};function getContextHash(args){var context=arguments[arguments.length-1];context.hash=_.mapObject(context.hash,function(val,key){if(val=="true")return true;if(val=="false")return false;if(val===undefined)return false;if(val[0]=="{"&&val[val.length-1]=="}"){var SQUOT_PLACEHOLDER="@@!_S_!@@";var DQUOT_PLACEHOLDER="@@!_D_!@@";val=val.replace(/([^\\]\\(?:\\{2})*)(['"])/g,function(match,$1,$2){return $1+($2==="'"?SQUOT_PLACEHOLDER:DQUOT_PLACEHOLDER)});var regex=new RegExp(/(['"]?)([\w-]*)(\1)\s*?:\s*?((['"]).*?(\5)|(\w+))/g);val=val.replace(regex,function(match,$1,$2,$3,$4){if(!$1)return"'".concat($2,"': ").concat($4);$4=$4.replace(new RegExp(SQUOT_PLACEHOLDER,"g"),"'");$4=$4.replace(new RegExp(DQUOT_PLACEHOLDER,"g"),"\"");return match})}if((typeof val==="string"||val instanceof String)&&(val.match(/^{([^{].*|.?)}$/)!==null||val.match(/^\[.*\]$/)!==null)){try{val=val.replace(/[']/g,"\"");return JSON.parse(val)}catch(err){throw"adapt-dd-helpers could not parse string as JSON: "+val}}return val});context.hash.content=context.fn?context.fn(this):"";return context.hash}var helpers$2={concat:function(){var arg=Array.prototype.slice.call(arguments,0);arg.pop();return arg.join("")},arr:function(){return Array.from(arguments)},theme:function(themeStr){return Handlebars__default["default"].getThemeStr(themeStr)},hyperlink:function(){var data=getContextHash.apply(this,arguments);data.content=data.content.trim();var html=Handlebars__default["default"].templates["ddHyperlink"](data);return new Handlebars__default["default"].SafeString(html)},tel:function(){var data=getContextHash.apply(this,arguments);var html=Handlebars__default["default"].templates["ddTel"](data);return new Handlebars__default["default"].SafeString(html)},kbd:function(){var data=getContextHash.apply(this,arguments);var html=Handlebars__default["default"].templates["ddKbd"](data);return new Handlebars__default["default"].SafeString(html)},clearfix:function(){var data=getContextHash.apply(this,arguments);var html=Handlebars__default["default"].templates["ddClearfix"](data);return new Handlebars__default["default"].SafeString(html)},bubble:function(){var data=getContextHash.apply(this,arguments);var html=Handlebars__default["default"].templates["ddBubble"](data);return new Handlebars__default["default"].SafeString(html)},flex:function(){var data=getContextHash.apply(this,arguments);if(data.gap&&!isNaN(data.gap))data.gap=data.gap+"rem";else if(data.gap===undefined||data.gap===true)data.gap=1.5+"rem";var html=Handlebars__default["default"].templates["ddFlex"](data);return new Handlebars__default["default"].SafeString(html)},"f-line":function(width){var data=getContextHash.apply(this,arguments);if(data.width===undefined&&(!isNaN(width)||typeof width==="string"))data.width=width;if(data.width&&!isNaN(data.width))data.width=data.width+"rem";else if(data.width===undefined||data.width===true)data.width="100%";if(data.width!=="100%")data.hasWidth=true;var html=Handlebars__default["default"].templates["ddFLine"](data);return new Handlebars__default["default"].SafeString(html)},inlineIcon:function(type){var context=arguments[arguments.length-1];var iconType=typeof type==="string"?type:context.hash.type;if(!iconType&&!context.hash.src)throw"{{{#icon}}}: Must have a defined \"type\" or \"src\" property.";var regex=new RegExp(/[\s\S]svg$/);var isSvg=regex.test(context.hash.src);var data=_.extend(context.hash,{"iconClass":"icon-"+iconType,"_isSvg":isSvg});var html=Handlebars__default["default"].templates["ddIcon"](data);return new Handlebars__default["default"].SafeString(html)},blockquote:function(){var context=arguments[arguments.length-1];var html=Handlebars__default["default"].templates["ddBlockquote"](_.extend(context.hash,{content:context.fn(this)}));return new Handlebars__default["default"].SafeString(html)},paper:function(){var context=arguments[arguments.length-1];var html=Handlebars__default["default"].templates["ddPaper"](_.extend(context.hash,{content:context.fn(this)}));return new Handlebars__default["default"].SafeString(html)},error:function(){var context=arguments[arguments.length-1];Adapt.log.error("Page has {{#error}} tag present.");var html=Handlebars__default["default"].templates["ddError"](_.extend(context.hash,{content:context.fn(this)}));return new Handlebars__default["default"].SafeString(html)}};for(var name$2 in helpers$2){if(helpers$2.hasOwnProperty(name$2)){Handlebars__default["default"].registerHelper(name$2,helpers$2[name$2])}}var registeredHelperEls=[];function observePlaceholderRender(placeholderAttrId,el,callback){helperElData[placeholderAttrId]=el;var mutationObserver;var OBSERVER_TIMEOUT=1000;var observerTimeout=setTimeout(function(){var $placeholder=$("["+helperElAttr+"='"+placeholderAttrId+"']");if($placeholder.length){Adapt.log.error("registerHelperEl: Could not be rendered into its placeholder element: ["+helperElAttr+"='"+placeholderAttrId+"']\nMutationObserver could not detect the placeholder being rendered.",$placeholder)}else{Adapt.log.warn("registerHelperEl: Could not be rendered into its placeholder element.\nThis was likely caused by the placeholder being incorrectly rendered as an attribute value.")}mutationObserver.disconnect()},OBSERVER_TIMEOUT);mutationObserver=new MutationObserver(function(mutations){_.each(mutations,function(mutation){if(mutation.type!="childList")return;_.find(mutation.addedNodes,function(node){if(!node)return;var placeholderEl;try{placeholderEl=node.querySelector("["+helperElAttr+"='"+placeholderAttrId+"']");if(!placeholderEl){if(node.getAttribute(helperElAttr)==placeholderAttrId){placeholderEl=node}}}catch(err){placeholderEl=false}if(placeholderEl){clearTimeout(observerTimeout);mutationObserver.disconnect();var $el=$(el);$(placeholderEl).replaceWith($el);if(callback){callback($el)}return true}})})});mutationObserver.observe($("body")[0],{childList:true,subtree:true})}Handlebars__default["default"].fixPlaceholders=function($parentEl){var $placeholders=$parentEl.find(".registerhelperel__placeholder");$placeholders.each(function(i,e){var id=$(e).data("registerhelperel-id");$(e).replaceWith(helperElData[id].clone())})};Handlebars__default["default"].registerHelperEl=function(helperName,helperCallback,postRenderCallback){if(_.includes(registeredHelperEls,helperName))return;if(!helperCallback)throw"helperCallback must be defined";Handlebars__default["default"].registerHelper(helperName,function(){var el=helperCallback.apply(this,Array.prototype.slice.call(arguments));if(typeof el==="string")return el;if(el instanceof Handlebars__default["default"].SafeString)return el;helperName=helperName.toLowerCase();var _uniqueId=_.uniqueId(helperName);var placeholderHTML="<span class=\"registerhelperel__placeholder\" ".concat(helperElAttr,"=\"").concat(_uniqueId,"\">PLACEHOLDER(").concat(helperName,")</span>");observePlaceholderRender(_uniqueId,el,postRenderCallback);return placeholderHTML})};Handlebars__default["default"].getComponentModelFromContext=function(helperContext){var componentData=helperContext.data.root;var model;var isComponentModel=function(m){try{if(m instanceof ComponentModel$3||m.get("_type")==="component"){return true}}catch(err){return false}return false};try{model=componentData.view.model;if(isComponentModel(model))return model}catch(err){model=componentData}var errMsg="Could not find ComponentModel from provided Handlebars Helper context.\nSee the array below for the ancestors (\"_parent\"s) that were traversed.";var path=[];do{try{path.push(model);if(model instanceof Backbone.Model){var _model$getParent;if(isComponentModel(model))break;model=((_model$getParent=model.getParent)===null||_model$getParent===void 0?void 0:_model$getParent.apply(model))||model.get("_parent")}else{model=model._parent}}catch(_unused){Adapt.log.warnOnce(errMsg,path);throw""}}while(Boolean(model));if(!model){Adapt.log.warnOnce(errMsg,path);throw""}return model};Handlebars__default["default"].getThemeStr=function(themeStr){if(!themeStr)return"";return themeStr.split(" ").map(function(classname){return"theme-".concat(classname)}).join(" ")};Handlebars__default["default"].getBlockModelFromContext=function(helperContext){var componentModel=Handlebars__default["default"].getComponentModelFromContext(helperContext);return componentModel.get("_parent")};var createHelperCallback=function(context,name,callback){Adapt.log.error("createHelperCallback has been depractated (had asynchronous bug). Use Handlebars.registerHelperEl instead.");throw""};Handlebars__default["default"].createHelperCallback=createHelperCallback;Handlebars__default["default"].getComponentViewFromContext=function(context){Adapt.log.error("getComponentViewFromContext has been depractated (had asynchronous bug). Use Handlebars.getComponentModelFromContext instead.");var componentView=context.data.root.view;if(componentView.model.get("_type")!="component"){componentView=Adapt.findViewByModelId(componentView.model.get("_parent").get("_id"))}return componentView||undefined};Handlebars__default["default"].getContextHash=getContextHash;var ImgPopupView=function(_Backbone$View){_inherits(ImgPopupView,_Backbone$View);var _super=_createSuper(ImgPopupView);function ImgPopupView(){_classCallCheck(this,ImgPopupView);return _super.apply(this,arguments)}_createClass(ImgPopupView,[{key:"className",value:function className(){var classes=["ddimg-popup",this.model.get("_classes")||""];return classes.join(" ")}},{key:"events",value:function events(){return{}}},{key:"initialize",value:function initialize(){this.setUpImgClasses();this.setUpEventListeners();this.render()}},{key:"setUpImgClasses",value:function setUpImgClasses(){var lightbox=this.model.get("lightbox");var classes=["ddimg-popup__img","ddimg-popup__size-"+lightbox._width,lightbox._backgroundEnabled?"has-bg":""];this.model.set("_imgClasses",classes.join(" "))}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenToOnce(Adapt,"notify:opened",this.onOpened);this.listenToOnce(Adapt,"notify:closed",this.onClosed)}},{key:"onOpened",value:function onOpened(){Adapt.scrollfix.disableA11yScroll()}},{key:"onClosed",value:function onClosed(){this.$el.addClass("is-closed");Adapt.scrollfix.enableA11yScroll()}},{key:"remove",value:function remove(){this.model.trigger("remove");_get(_getPrototypeOf(ImgPopupView.prototype),"remove",this).call(this)}},{key:"render",value:function render(){var data=this.model.toJSON();data.view=this;var template=Handlebars.templates["ddImgPopup"];this.$el.html(template(data))}},{key:"closePopup",value:function closePopup(){Adapt.trigger("notify:close")}}]);return ImgPopupView}(Backbone.View);var ImgPopupView$1=__AMD("extensions/adapt-dd-img/js/imgPopupView",ImgPopupView);var ImgView=function(_Backbone$View){_inherits(ImgView,_Backbone$View);var _super=_createSuper(ImgView);function ImgView(){_classCallCheck(this,ImgView);return _super.apply(this,arguments)}_createClass(ImgView,[{key:"className",value:function className(){var theme=this.model.get("theme");if(theme)theme=theme.split(" ").map(function(classname){return"theme-".concat(classname)}).join(" ");var classes=["ddimg",this.model.get("content").trim().length?"has-content":"",this.model.get("lightbox")?"has-lightbox":"",this.model.get("_widthAuto")?"is-auto-width":"",this.model.get("class")||"",this.model.get("sizing")||"",theme||""];return classes.join(" ")}},{key:"attributes",value:function attributes(){return{id:this.model.get("_id"),name:this.model.get("name")||undefined,style:this.model.get("style")||undefined}}},{key:"events",value:function events(){var _events={};if(this.model.get("lightbox")){_events["click .js-ddimg-click"]="onImgClick"}return _events}},{key:"initialize",value:function initialize(){this.setUpModelData();this.render();this.setUpEventListeners()}},{key:"setUpModelData",value:function setUpModelData(){this.setUpLightboxData()}},{key:"setUpEventListeners",value:function setUpEventListeners(){var _this=this;var $img=this.$(".js-ddimg-img");$img.on("error",function(){_this.$el.addClass("has-error");$img.addClass("has-error")})}},{key:"setUpLightboxData",value:function setUpLightboxData(){var lightbox=this.model.get("lightbox");if(!lightbox)return;this.model.set("lightbox",{_isEnabled:true,_width:!isNaN(lightbox)?lightbox:lightbox._width||"auto",_backgroundEnabled:Boolean(lightbox.bg)})}},{key:"render",value:function render(){var template=Handlebars__default["default"].templates["ddImg"];this.$el.html(new Handlebars__default["default"].SafeString(template(this.model.toJSON())).string)}},{key:"onImgClick",value:function onImgClick(event){event.stopPropagation();this.openLightbox()}},{key:"openLightbox",value:function openLightbox(){if(!this.model.get("lightbox"))return;if(this._isPopupOpen)return;this._isPopupOpen=true;this.popupView=new ImgPopupView$1({model:this.model});Adapt.trigger("notify:popup",{_view:this.popupView,_isCancellable:true,_showCloseButton:true,_classes:"ddimg-lightbox dragscroll"});this.listenToOnce(Adapt,{"popup:closed":this.onLightboxClosed})}},{key:"onLightboxClosed",value:function onLightboxClosed(){this._isPopupOpen=false}}]);return ImgView}(Backbone.View);var ImgView$1=__AMD("extensions/adapt-dd-img/js/imgView",ImgView);var MAX_RESIZE_ATTEMPTS=5;var RESIZE_BUFFER=2;var HIDDEN_OBSERVER_DEBOUNCE=500;var RespImgView=function(_ImgView){_inherits(RespImgView,_ImgView);var _super=_createSuper(RespImgView);function RespImgView(){_classCallCheck(this,RespImgView);return _super.apply(this,arguments)}_createClass(RespImgView,[{key:"className",value:function className(){var classes=_get(_getPrototypeOf(RespImgView.prototype),"className",this).call(this);return classes+" rimg"}},{key:"initialize",value:function initialize(){this.model.set("_isHidden",false);this._fontSizeMulti=1;_get(_getPrototypeOf(RespImgView.prototype),"initialize",this).call(this)}},{key:"_areItemsOverflowing",value:function _areItemsOverflowing(){var overflowing=false;var $items=this.$(".rimg__item");$items.each(function(i,e){var $e=$(e);var bb=_.extend({},$e[0].getBoundingClientRect());var pTop=parseFloat($e.css("padding-top"),10);var pLeft=parseFloat($e.css("padding-left"),10);var pRight=parseFloat($e.css("padding-right"),10);var pBottom=parseFloat($e.css("padding-bottom"),10);bb.top+=pTop;bb.left+=pLeft;bb.width-=pLeft+pRight;bb.height-=pTop+pBottom;var bbInner=$e.find(".rimg__item-inner")[0].getBoundingClientRect();if(bb.top-bbInner.top>RESIZE_BUFFER||bb.left-bbInner.left>RESIZE_BUFFER||bbInner.bottom-bb.bottom>RESIZE_BUFFER||bbInner.right-bb.right>RESIZE_BUFFER){overflowing=$e;return false}});return overflowing}},{key:"setUpRespImgEventListeners",value:function setUpRespImgEventListeners(){var _this=this;$(".rimg__img").imageready(function(){_this.$el.addClass("is-ready")});this.listenTo(Adapt,{"device:resize":_.debounce(this.onDeviceResize,0).bind(this)});this.listenTo(this.model,"change:_isHidden",this.onHiddenChange);var observer=new MutationObserver(function(event){_this._fontSizeMulti=1;_this.onDeviceResize();var attempts=MAX_RESIZE_ATTEMPTS;var $overflowingItem=null;do{$overflowingItem=_this._areItemsOverflowing();if($overflowingItem){_this._fontSizeMulti-=0.05;_this.onDeviceResize()}else{Adapt.log.info("RespImg: text resized after "+(MAX_RESIZE_ATTEMPTS-attempts)+" attempts.",_this.$el);return}attempts--}while(attempts>0);Adapt.log.warn("RespImg: text resize was unsuccessful after "+MAX_RESIZE_ATTEMPTS+" attempts.",_this.$el,$overflowingItem)});observer.observe(this.$(".rimg__inner")[0],{subtree:true,childList:true})}},{key:"onDeviceResize",value:function onDeviceResize(){this.recalculate()}},{key:"recalculate",value:function recalculate(){var width=this.$el.width();var svgWidth=this.model.get("_svgWidth")||1;var em=width/svgWidth*this._fontSizeMulti;this.$el.css("font-size",em+"px")}},{key:"render",value:function render(){var template=Handlebars__default["default"].templates["ddRespImg"];this.$el.html(new Handlebars__default["default"].SafeString(template(this.model.toJSON())).string);this.renderItems()}},{key:"onHiddenChange",value:function onHiddenChange(model,isHidden){if(isHidden)return;this.onDeviceResize();Adapt.log.info("respImgView: :visible event detected.")}},{key:"postRender",value:function postRender(){var _this2=this;this.model.set("_isHidden",this.$el.is(":hidden"));_.delay(function(){_this2.recalculate()},0);var callback=_.debounce(function(){_this2.model.set("_isHidden",_this2.$el.is(":hidden"))},HIDDEN_OBSERVER_DEBOUNCE);this._hiddenObserver=new MutationObserver(callback);var closestEl=this.$el.closest(".component")[0];if(!closestEl)closestEl=this.$el.closest(".notify")[0];this._hiddenObserver.observe(closestEl,{attributes:true,subtree:true})}},{key:"renderItems",value:function renderItems(){var _this3=this;var jsonPath=this.model.get("src").replace(/\.svg$/,".json");$.ajax({dataType:"json",url:jsonPath,cache:true,success:function(data){_this3.model.set("_svgWidth",data._width);_this3.model.set("_svgHeight",data._height);var css=document.createElement("style");css.type="text/css";var styles="";_.each(data._styles,function(props,className){styles+="#"+_this3.model.get("_id")+" "+className+"{";_.each(props,function(e,i){styles+=i+":"+e+";"});styles+="} "});css.appendChild(document.createTextNode(styles));_this3.$el[0].appendChild(css);_.each(data._items,function(item){var $item=$("<div>");$item.addClass("rimg__item");$item.addClass("align-"+(item.align||"center"));$item.css({top:item.top+"%",left:item.left+"%",width:item.width+"%",height:item.height+"%",transform:item.transform});var $itemInner=$("<div>");$itemInner.attr("class",item.class).addClass("rimg__item-inner").html(item.html);_this3.$(".rimg__inner").append($item);$item.append($itemInner)});_this3.setUpRespImgEventListeners();_this3.postRender()},fail:function(){throw"respImgView.js: Could not load \""+jsonPath+"\"."}})}}]);return RespImgView}(ImgView$1);var RespImgView$1=__AMD("extensions/adapt-dd-img/js/respImgView",RespImgView);var ImgMapView=function(_Backbone$View){_inherits(ImgMapView,_Backbone$View);var _super=_createSuper(ImgMapView);function ImgMapView(){_classCallCheck(this,ImgMapView);return _super.apply(this,arguments)}_createClass(ImgMapView,[{key:"events",value:function events(){var _events={};this.onClick=_.debounce(this.onClick.bind(this),0,true);this.onMouseMove=_.throttle(this.onMouseMove.bind(this),50);_events["click"]="onClick";{_events["mousemove"]="onMouseMove";_events["mouseleave"]="onMouseLeave"}return _events}},{key:"initialize",value:function initialize(){this.model.set("_isReady",false);this.setUpModelData();this.render();this.setUpEventListeners()}},{key:"setUpModelData",value:function setUpModelData(){}},{key:"setUpEventListeners",value:function setUpEventListeners(){}},{key:"render",value:function render(){this.$el.addClass("ddimg-map");this.$(".btn-img").addClass("no-hover");this.$el.imageready(this.setupImgCanvas.bind(this))}},{key:"_getContextBoundingBox",value:function _getContextBoundingBox(ctx,alphaThreshold){var w=ctx.canvas.width,h=ctx.canvas.height;var data=ctx.getImageData(0,0,w,h).data;var minX=w;var maxX=0;var minY=h;var maxY=0;for(var y=0;y<h;y++){for(var x=0;x<w;x++){if(data[y*w*4+x*4+3]){minX=Math.min(minX,x);maxX=Math.max(maxX,x);minY=Math.min(minY,y);maxY=y;x=maxX}}}return{x:minX,y:minY,maxX:maxX,maxY:maxY,w:maxX-minX,h:maxY-minY}}},{key:"onCanvasPostRender",value:function onCanvasPostRender($canvas,$img){var bb=this._getContextBoundingBox($canvas[0].getContext("2d"));$canvas.attr("data-bb",[bb.x,bb.y,bb.w,bb.h].join(","));var width=$img.width();var height=$img.height();$img.attr("data-bb",[bb.x/width,bb.y/height,bb.w/width,bb.h/height].join(","));$img.css("transform-origin","".concat((bb.x+bb.w/2)/width*100,"% ").concat((bb.y+bb.h/2)/height*100,"%"))}},{key:"setupImgCanvas",value:function setupImgCanvas(){var _this=this;this._canvases={};var $imgs=this.$(".js-ddimg-img");var setImgReady=function($img){$img.addClass("is-ready");var readyLength=$imgs.filter(".is-ready").length;if(readyLength<$imgs.length)return;_this.model.set("_isReady",true)};$imgs.each(function(i,e){var id=_.uniqueId("ddimg-map-");var $img=$(e);$img.attr("data-ddimg-map-id",id);var isSVG=$img.attr("src").split(".").pop().toLowerCase()==="svg";var width=$img.width();var height=$img.height();var $canvas=$("<canvas>");$canvas.attr("data-ddimg-map-id",id);$canvas.attr("width",width);$canvas.attr("height",height);_this._canvases[id]=$canvas;var ctx=$canvas[0].getContext("2d");ctx.drawImage($img[0],0,0,width,height);if(isSVG){var src=$img.attr("src");require(["libraries/buffer/buffer.min"],function(Buffer){$.ajax({dataType:"xml",url:src,cache:true,success:function(data){var inlineSVG=data.getElementsByTagName("svg")[0];inlineSVG.setAttribute("width",width);inlineSVG.setAttribute("height",height);var str=new XMLSerializer().serializeToString(inlineSVG);var svg64=Buffer.Buffer.from(str,"utf8").toString("base64");var image64="data:image/svg+xml;base64,"+svg64;var img=new Image;img.src=image64;var _me=_this;img.onload=function(){ctx.clearRect(0,0,width,height);ctx.drawImage(this,0,0,width,height);_me.onCanvasPostRender($canvas,$img);setImgReady($img)};img.onerror=function(err){console.log(err)}},error:function(xhr,textStatus,errorThrown){Adapt.log.error(xhr,textStatus,errorThrown)}})})}else{_this.onCanvasPostRender($canvas,$img);setImgReady($img)}})}},{key:"onClick",value:function onClick(event){event.stopPropagation();event.preventDefault();var $img=this.$getImgAtPointer(event);if(!$img){return}$img.trigger("click")}},{key:"onMouseMove",value:function onMouseMove(event){event.stopPropagation();event.preventDefault();var $img=this.$getImgAtPointer(event);if(!$img){this.$(".hover").removeClass("hover");this.$el.removeClass("hover");return}var $btnImg=$img.closest(".btn-img");$btnImg.addClass("hover");this.$el.addClass("hover");var $hover=this.$(".hover");$hover.each(function(i,e){if(!$(e).is($btnImg))$(e).removeClass("hover")})}},{key:"onMouseLeave",value:function onMouseLeave(event){event.stopPropagation();event.preventDefault();this.$(".hover").removeClass("hover");this.$el.removeClass("hover")}},{key:"$getImgAtPointer",value:function $getImgAtPointer(event){var _this2=this;var $imgs=this.$(".js-ddimg-img");var pageX=event.pageX||0;var pageY=event.pageY||0;pageX+=$(window).scrollLeft();pageY+=$(window).scrollTop();var $target=null;$imgs.each(function(i,e){var $img=$(e);var id=$img.attr("data-ddimg-map-id");var x=pageX-$img.offset().left;var y=pageY-$img.offset().top;var width=$img.width();$img.height();var $canvas=_this2._canvases[id];var canvasWidth=$canvas.attr("width");var canvasHeight=$canvas.attr("height");var ratio=width/canvasWidth;x/=ratio;y/=ratio;var dataBB=$img.attr("data-bb");if(dataBB){var _$img$attr$split$map=$img.attr("data-bb").split(",").map(function(e){return parseFloat(e,10)}),_$img$attr$split$map2=_slicedToArray(_$img$attr$split$map,4),bbX=_$img$attr$split$map2[0],bbY=_$img$attr$split$map2[1],bbWidth=_$img$attr$split$map2[2],bbHeight=_$img$attr$split$map2[3];var bb={x:bbX,y:bbY,w:bbWidth,h:bbHeight};if(x/canvasWidth>bb.x+bb.w||x/canvasWidth<bb.x||y/canvasHeight>bb.y+bb.h||y/canvasHeight<bb.y){return true}}var ctx=$canvas[0].getContext("2d",{willReadFrequently:true});var alpha=ctx.getImageData(x,y,1,1).data[3];if(Boolean(alpha)){$target=$img}});return $target}},{key:"then",value:function then(callback){if(!callback)return;var isReady=this.model.get("_isReady");if(isReady){callback();return}this.listenToOnce(this.model,"change:_isReady",callback)}}]);return ImgMapView}(Backbone.View);var ImgMapView$1=__AMD("extensions/adapt-dd-img/js/imgMapView",ImgMapView);var DDImg=function(_Backbone$Controller){_inherits(DDImg,_Backbone$Controller);var _super=_createSuper(DDImg);function DDImg(){_classCallCheck(this,DDImg);return _super.apply(this,arguments)}_createClass(DDImg,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"app:dataReady":this.onDataReady.bind(this)})}},{key:"setupImgMap",value:function setupImgMap($container,options,oncomplete){new ImgMapView$1({model:new Backbone.Model(options),el:$container[0]}).then(oncomplete)}},{key:"getImgBoundingBox",value:function getImgBoundingBox(imgEl){var bb=_.extend({},imgEl.getBoundingClientRect());var mapBB=$(imgEl).attr("data-bb");if(!mapBB){return bb}mapBB=mapBB.split(",").map(function(e){return parseFloat(e,10)});bb.left+=mapBB[0]*bb.width;bb.top+=mapBB[1]*bb.height;bb.width*=mapBB[2];bb.height*=mapBB[3];return bb}},{key:"onDataReady",value:function onDataReady(){Handlebars__default["default"].registerHelperEl("img",function(){var data=Handlebars__default["default"].getContextHash.apply(this,arguments);var context=arguments[arguments.length-1];if(!data.src&&!data.body){Adapt.log.error("{{#img}}: either the \"src\" or \"body\" parameter must be defined.",data);throw""}data._contain=data.contain===undefined?true:Boolean(data.contain);data.sizing=data.sizing?Adapt.sizing.getSizingClass(data.sizing):"";data.mask=Boolean(data.mask);try{data._parent=Handlebars__default["default"].getComponentModelFromContext(context)}catch(err){}if(data.src){data.src=data.src.trim();data._widthAuto=Boolean(data.src.match(/\.svg$/i))?false:true;if(data.src.match(/--r\.svg$/)){var _modelJSON=_.extend({},data,{_id:"rimg-"+_.uniqueId()});return new RespImgView$1({model:new Backbone.Model(_modelJSON)}).$el}}var modelJSON=_.extend({},data,{_id:"ddimg-"+_.uniqueId()});return new ImgView$1({model:new Backbone.Model(modelJSON)}).$el})}}]);return DDImg}(Backbone.Controller);var ddImg=new DDImg;Adapt.ddImg=ddImg;var InputFieldView=function(_Backbone$View){_inherits(InputFieldView,_Backbone$View);var _super=_createSuper(InputFieldView);function InputFieldView(){_classCallCheck(this,InputFieldView);return _super.apply(this,arguments)}_createClass(InputFieldView,[{key:"className",value:function className(){var classes=["inputfield","type-"+this.model.get("_type"),this.model.get("_isHintEnabled")?"hint-enabled":""];return classes.join(" ")}},{key:"attributes",value:function attributes(){return{name:this.model.get("_name"),"data-inputfield-id":this.model.get("_id")}}},{key:"events",value:function events(){return{"focus .js-inputfield-input":"onFocus","blur .js-inputfield-input":"onBlur","change .js-inputfield-input":"onInputChange","keyup .js-inputfield-input":"onInputChange","input .js-inputfield-input":"onInputInput","click .js-inputfield-incorrect-icon":"onIncorrectIconClick","click .js-inputfield-hint-icon":"onHintIconClick"}}},{key:"initialize",value:function initialize(){this.setUpInputAttributes();this.render();this.setUpEventListeners()}},{key:"setUpInputAttributes",value:function setUpInputAttributes(){var type=this.model.get("_type");var attr={};switch(type){case"number":attr.type="number";attr.step="any";attr.pattern="[-+]?[0-9]*[.,]?[0-9]+";break;case"text":attr.type="text";break;default:attr.type="text";Adapt.log.error("{{#inputField}}: \"".concat(type,"\" is not a valid value for the \"type\" attribute of an <input> element! Defaulting to input type: \"text\"."));}this.model.set("_inputAttributes",attr)}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenTo(this.model,"change:_isSubmitted",this.onIsSubmittedChange);this.listenTo(this.model,"change:_isCorrect",this.onIsCorrectChange);this.listenTo(this.model,"change:_isLocked",this.onIsLockedChange);this.listenTo(this.model,"change:_isHintEnabled",this.onIsHintEnabledChange);this.listenTo(this.model,"change:_isFocused",this.onIsFocusedChange);this.listenTo(this.model,"change:_val",this.onValChange)}},{key:"onIsSubmittedChange",value:function onIsSubmittedChange(model,isSubmitted){if(!isSubmitted){this.$el.removeClass("is-correct is-incorrect")}else{var isCorrect=this.model.get("_isCorrect");this.$el.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect)}}},{key:"onIsLockedChange",value:function onIsLockedChange(model,isLocked){this.$(".js-inputfield-input").prop("disabled",isLocked)}},{key:"onFocus",value:function onFocus(){this.model.set("_isFocused",true)}},{key:"onBlur",value:function onBlur(){this.model.set("_isFocused",false)}},{key:"onIsFocusedChange",value:function onIsFocusedChange(model,isFocused){this.$el.toggleClass("is-focused",isFocused);this.updatePseudo(this.model.get("_val"))}},{key:"onValChange",value:function onValChange(model,val){this.$el.toggleClass("has-val",Boolean(val.length));this.$(".js-inputfield-input").attr("title",val);this.updatePseudo(val)}},{key:"onIsCorrectChange",value:function onIsCorrectChange(model,isCorrect){if(!this.model.get("_isSubmitted"))return;this.$el.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect)}},{key:"onIncorrectIconClick",value:function onIncorrectIconClick(event){this.reset()}},{key:"onIsHintEnabledChange",value:function onIsHintEnabledChange(model,isHintEnabled){this.$el.toggleClass("hint-enabled",isHintEnabled)}},{key:"updateComputedStyles",value:function updateComputedStyles(){var css=window.getComputedStyle(this.$el[0]);this._styles={textAlign:css.getPropertyValue("text-align"),fontFamily:css.getPropertyValue("font-family"),fontSize:css.getPropertyValue("font-size")};var alignLeft=this._styles.textAlign!="right";this.$el.add(this.$(".js-inputfield-pseudo, .js-inputfield-placeholder, .js-inputfield-overlay")).toggleClass("align-left",alignLeft).toggleClass("align-right",!alignLeft)}},{key:"render",value:function render(){var _this=this;var data=this.model.toJSON();var template=Handlebars.templates["inputField"];this.$el.html(template(data));this.$(".js-inputfield-placeholder").css({"min-width":this.model.get("_width")+"em"});this._resizeResizeObserver=new ResizeObserver(function(){_this.updateComputedStyles();_this.updatePseudo(_this.model.get("_val"))});this._resizeResizeObserver.observe(this.$el[0])}},{key:"updatePseudo",value:function updatePseudo(val){var isLeft=this._styles.textAlign!="right";this.updatePrefix(val,isLeft);this.updateSuffix(val,isLeft)}},{key:"updatePrefix",value:function updatePrefix(val,isLeft){var prefix=this.model.get(isLeft?"prefix":"suffix");if(!prefix)return;var width=this._getTextWidth(prefix)+3;var $input=this.$(".js-inputfield-input");var $placeholder=this.$(".js-inputfield-placeholder");$input.css({"padding-left":"","padding-right":""});$input.css({"padding-left":isLeft?"".concat(parseFloat($input.css("padding-left"),10)+width,"px"):"","padding-right":!isLeft?"".concat(parseFloat($input.css("padding-right"),10)+width,"px"):""});$placeholder.css({"padding-left":$input.css("padding-left"),"padding-right":$input.css("padding-right")})}},{key:"updateSuffix",value:function updateSuffix(val,isLeft){var suffix=this.model.get(isLeft?"suffix":"prefix");if(!suffix)return;var isFocused=this.model.get("_isFocused");var width=this._getTextWidth(isFocused?val:val||this.model.get("placeholder"))+2;var suffixWidth=this._getTextWidth(this.model.get("suffix"));var phInnerWidth=this.$(".js-inputfield-placeholder-inner").width();width=Math.min(width,phInnerWidth-suffixWidth+8);var $suffix=this.$(".js-inputfield-".concat(isLeft?"suffix":"prefix"));$suffix.css({"margin-left":isLeft?width:"","margin-right":!isLeft?width:""})}},{key:"reset",value:function reset(){var $input=this.$(".js-inputfield-input");$input.val("");$input.trigger("change");this.model.reset()}},{key:"onInputChange",value:function onInputChange(event){var $input=this.$("input");this.model.set("_val",$input.val())}},{key:"onInputInput",value:function onInputInput(event){var $input=this.$("input");this.model.set("_val",$input.val())}},{key:"onHintIconClick",value:function onHintIconClick(){this.showAnswer()}},{key:"showAnswer",value:function showAnswer(){var $input=this.$("input");$input.val(this.model.getCorrectAnswer());$input.trigger("change");this.updatePseudo(this.model.getCorrectAnswer())}},{key:"_getTextWidth",value:function _getTextWidth(text){var canvas=this._textWidthCanvas||(this._textWidthCanvas=document.createElement("canvas"));var ctx=canvas.getContext("2d");ctx.font="".concat(this._styles.fontSize," ").concat(this._styles.fontFamily.split(",")[0]);var metrics=ctx.measureText(text);return metrics.width}}]);return InputFieldView}(Backbone.View);var InputFieldView$1=__AMD("extensions/adapt-dd-inputField/js/inputFieldView",InputFieldView);var InputFieldModel=function(_Backbone$Model){_inherits(InputFieldModel,_Backbone$Model);var _super=_createSuper(InputFieldModel);function InputFieldModel(){_classCallCheck(this,InputFieldModel);return _super.apply(this,arguments)}_createClass(InputFieldModel,[{key:"defaults",value:function defaults(){return{_answers:[],_requireSubmit:true,_canShowMarking:true,_isHintEnabled:false,prefix:"",suffix:"",_allowsAnyCase:true,_allowsPunctuation:true,_width:undefined,_val:"",_isCorrect:false,_isLocked:false,_isSubmitted:false,_incorrectUserAnswers:[],_submitCount:0}}},{key:"getAnswers",value:function getAnswers(){return this.get("_answers")}},{key:"initialize",value:function initialize(){this.setUpWidth();this.checkGroupError();this.setUpEventListeners()}},{key:"setUpWidth",value:function setUpWidth(){var answerLength=2;var explicitWidth=this.get("_width");if(explicitWidth){answerLength=explicitWidth}else{var answers=this.get("_answers");_.each(answers,function(a){var s;try{s=a.toString()}catch(err){s="XXXX"}if(s.length>answerLength)answerLength=s.length})}this.set("_width",answerLength)}},{key:"checkGroupError",value:function checkGroupError(){var _this=this;if(!this.hasAnswers())return;_.delay(function(){var groupItems=_this.getGroupItems();if(!groupItems)return;if(groupItems.length>_this.get("_answers").length){throw"{{#inputField}}: inputField in group \"".concat(_this.get("_group"),"\" must have at least ").concat(groupItems.length," possible answers (currently only has ").concat(_this.get("_answers").length,").")}},0)}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenTo(this,"change:_val",this.onValChange)}},{key:"hasAnswers",value:function hasAnswers(){return Boolean(this.get("_answers").length)}},{key:"onValChange",value:function onValChange(model,val){if(!this.hasAnswers())return;if(this.get("_requireSubmit")){if(this.checkAnswerInArray(this.get("_incorrectUserAnswers"),val)){this.set("_isCorrect",false);this.set("_isSubmitted",true)}else{this.set("_isCorrect",false);this.set("_isSubmitted",false)}}else{this.submit()}}},{key:"submit",value:function submit(){var val=this.get("_val");this.set("_submitCount",this.get("_submitCount")+1);var isCorrect=this.checkAnswerInArray(this.get("_answers"),val);this.set("_isSubmitted",val!==""||isCorrect);this.set("_isCorrect",isCorrect);if(!isCorrect&&this.get("_requireSubmit")){var iua=this.get("_incorrectUserAnswers");iua.push(val);this.set("_incorrectUserAnswers",_.uniq(iua))}}},{key:"reset",value:function reset(){this.set("_isSubmitted",false);this.set("_isCorrect",false);this.set("_val","")}},{key:"lock",value:function lock(){this.set("_isLocked",true)}},{key:"unlock",value:function unlock(){this.set("_isLocked",false)}},{key:"enableHint",value:function enableHint(){this.set("_isHintEnabled",true)}},{key:"disableHint",value:function disableHint(){this.set("_isHintEnabled",false)}},{key:"enableRequireSubmit",value:function enableRequireSubmit(){this.set("_requireSubmit",true)}},{key:"getVal",value:function getVal(){return this.get("_val")}},{key:"isCorrect",value:function isCorrect(){return this.get("_isCorrect")}},{key:"isGrouped",value:function isGrouped(){return this.get("_group")!==undefined}},{key:"getAnswerIndex",value:function getAnswerIndex(){var _this2=this;if(!this.isCorrect())return-1;var groupItems=this.getGroupItems();if(groupItems){return groupItems.indexOf(this)}var idx=-1;_.find(this.model.get("_answers"),function(a,i){var isCorrect=_this2.compareVals(_this2.getVal(),a);if(isCorrect)idx=i;return isCorrect});return idx}},{key:"getNumber",value:function getNumber(){var val=this.get("_val");if(!val)return 0;if(!isNaN(val))return parseFloat(val);Adapt.log.error("inputFieldModel.getNumber(): value \"".concat(val,"\" is not a number. Fallback value of \"0\" used."));return 0}},{key:"getGroupItems",value:function getGroupItems(){var group=this.get("_group");var groupItems=[this];if(group!==undefined){groupItems=this.get("_parent").get("_inputField")._items.filter(function(itemModel){return itemModel.get("_group")===group})}return groupItems}},{key:"compareVals",value:function compareVals(val1,val2){var type=this.get("_type");var decimals=this.get("_decimals");var v1=this.cleanupUserAnswer(val1);var v2=this.cleanupUserAnswer(val2);if(type=="number"){if(decimals!==undefined){return v1.toString()==v2.toString()}var num1=parseFloat(v1);var num2=parseFloat(v2);return num1==num2}return v1==v2}},{key:"checkAnswerInArray",value:function checkAnswerInArray(arr,val){var _this3=this;var group=this.get("_group");var groupItems=this.getGroupItems();var uAnswer=this.cleanupUserAnswer(val);var matched=arr.filter(function(cAnswer,idx){return this.compareVals(uAnswer,cAnswer)},this);var answerIsCorrect=matched&&matched.length>0;if(answerIsCorrect&&group!==undefined){var maxCorrect=matched.length;_.find(groupItems,function(itemModel){if(itemModel==_this3)return true;if(_this3.compareVals(itemModel.getVal(),_this3.getVal())){maxCorrect--;if(maxCorrect<=0){answerIsCorrect=false;return true}}})}if(answerIsCorrect)this.set("_isCorrect",true);return answerIsCorrect}},{key:"getCorrectAnswer",value:function getCorrectAnswer(){var _this4=this;var answers=this.get("_answers");var group=this.get("_group");if(group===undefined){return answers?answers[0]:""}var groupItems=this.getGroupItems();return _.find(answers,function(a){var matchingItem=_.find(groupItems,function(itemModel){if(itemModel===_this4)return false;return _this4.compareVals(itemModel.getVal(),a)});if(!matchingItem)return true;groupItems.splice(groupItems.indexOf(matchingItem),1)})}},{key:"cleanupUserAnswer",value:function cleanupUserAnswer(userAnswer){if(this.get("_type")==="text"){if(this.get("_allowsAnyCase")){userAnswer=userAnswer.toLowerCase()}if(this.get("_allowsPunctuation")){userAnswer=userAnswer.replace(/[\.,-\/#!$£%\^&\*;:{}=\-_`~()]/g,"");userAnswer=userAnswer.replace(/(  +)+/g," ")}}return $.trim(userAnswer)}}]);return InputFieldModel}(Backbone.Model);var InputFieldModel$1=__AMD("extensions/adapt-dd-inputField/js/inputFieldModel",InputFieldModel);var FN_REGEX=new RegExp(/(\${([\w-]*?)})/g);var OutputFieldView=function(_Backbone$View){_inherits(OutputFieldView,_Backbone$View);var _super=_createSuper(OutputFieldView);function OutputFieldView(){_classCallCheck(this,OutputFieldView);return _super.apply(this,arguments)}_createClass(OutputFieldView,[{key:"className",value:function className(){var classes=["outputfield",this.model.get("_hasError")?"has-error":""];return classes.join(" ")}},{key:"events",value:function events(){return{}}},{key:"initialize",value:function initialize(){this.setUpModelData();this.render();this.setUpEventListeners();this.updateResult();this.updateValidationState()}},{key:"setUpModelData",value:function setUpModelData(){var fn=this.model.get("fn");var allItems=this.model.get("_parent").get("_inputField")._items;var names=[];fn.replace(FN_REGEX,function(match,$1,$2){names.push($2);return match});var items=allItems.filter(function(item){return names.indexOf(item.get("_name"))>=0});this.model.set("_inputFields",new Backbone.Collection(items))}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenTo(this.model.get("_inputFields"),{"change:_val":this.onInputFieldValChange,"change:_isCorrect":this.onInputFieldStateChange});this.listenTo(this.model,"change:result",this.onResultChange);this.listenTo(this.model,"change:_hasError",this.onHasErrorChange);this.listenTo(this.model,"change:_isVisited",this.onIsVisitedChange)}},{key:"onInputFieldValChange",value:function onInputFieldValChange(inputFieldModel,val){this.updateResult();this.model.set("_isVisited",true)}},{key:"onIsVisitedChange",value:function onIsVisitedChange(model,isVisited){this.$el.toggleClass("is-visited",isVisited)}},{key:"onInputFieldStateChange",value:function onInputFieldStateChange(inputFieldModel){this.updateValidationState()}},{key:"updateValidationState",value:function updateValidationState(){var isAnyIncorrect=Boolean(this.model.get("_inputFields").find(function(inputField){return!inputField.get("_isCorrect")}));this.model.set("_isCorrect",!isAnyIncorrect);this.model.set("_isIncorrect",isAnyIncorrect);this.$el.toggleClass("is-incorrect",isAnyIncorrect).toggleClass("is-correct",!isAnyIncorrect)}},{key:"updateResult",value:function updateResult(){var _this=this;var fn=this.model.get("fn");var eqn=fn.replace(FN_REGEX,function(match,$1,$2){var inputField=_this.model.get("_inputFields").find(function(inputField){return inputField.get("_name")==$2});if(!inputField)throw"OutputFieldView: could not find inputField with name: \"".concat($2,"\"!\n\nfn: ").concat(fn);var val=inputField.getNumber();return val});var result=eval(eqn);if(isNaN(result)||!isFinite(result)){this.model.set("result","N/A");this.model.set("_hasError",true);return}this.model.set("result",result);this.model.set("_hasError",false)}},{key:"onResultChange",value:function onResultChange(model,result){var r=result;if(!isNaN(r))r=parseFloat(r.toFixed(this.model.get("decimals")||0));this.$(".js-outputfield-result").html(r);this.$(".js-outputfield-content").attr("title","".concat(this.model.get("prefix")||"").concat(result).concat(this.model.get("suffix")||""))}},{key:"onHasErrorChange",value:function onHasErrorChange(model,hasError){this.$el.toggleClass("has-error",hasError)}},{key:"render",value:function render(){var data=this.model.toJSON();var template=Handlebars.templates["outputField"];this.$el.html(template(data))}}]);return OutputFieldView}(Backbone.View);var OutputFieldView$1=__AMD("extensions/adapt-dd-inputField/js/outputFieldView",OutputFieldView);var InputFieldController=function(_Backbone$Controller){_inherits(InputFieldController,_Backbone$Controller);var _super=_createSuper(InputFieldController);function InputFieldController(){_classCallCheck(this,InputFieldController);return _super.apply(this,arguments)}_createClass(InputFieldController,[{key:"initialize",value:function initialize(){Adapt.on("router:page",this.setUpHelpers.bind(this));this._inputFieldViews={}}},{key:"findViewByModelId",value:function findViewByModelId(id){return this._inputFieldViews[id]}},{key:"findViewByEl",value:function findViewByEl(el){return this._inputFieldViews[$(el).attr("data-inputfield-id")]}},{key:"setUpHelpers",value:function setUpHelpers(){var _Adapt$stickyBlock;(_Adapt$stickyBlock=Adapt.stickyBlock)===null||_Adapt$stickyBlock===void 0?void 0:_Adapt$stickyBlock.addResetOnReRender("_inputField");var t=this;Handlebars.registerHelperEl("inputField",function(){var context=arguments[arguments.length-1];var data=Handlebars.getContextHash.apply(this,arguments);var componentModel=Handlebars.getComponentModelFromContext(context);var name=data.name;var id=_.uniqueId("inputfield");data.answers=data.answers||data.correct;data.answers=data.answers===undefined?[]:Array.isArray(data.answers)?data.answers:[data.answers];var isHintEnabled=data.hintEnabled===undefined?Boolean(data.answers.length):data.hintEnabled;if(data.decimals&&isNaN(data.decimals))throw"{{#inputField}}: \"decimals\" property must be a number (value given: ".concat(decimals,").");var modelJSON={_id:id,_parent:componentModel,_name:name,_group:data.group,prefix:data.prefix,suffix:data.suffix,placeholder:data.content||data.placeholder||"?",_type:data.type||"number",_answers:data.answers,_width:data.width,_allowsAnyCase:data.allowsAnyCase||false,_allowsPunctuation:data.allowsPunctuation||false,_decimals:data.decimals||undefined,_requireSubmit:false,_isHintEnabled:isHintEnabled};var model=new InputFieldModel$1(modelJSON);if(!componentModel.get("_inputField")){componentModel.set("_inputField",{_items:new Backbone.Collection(null,{model:InputFieldModel$1})})}var inputFieldCollection=componentModel.get("_inputField")._items;inputFieldCollection.push(model);if(name!==undefined){if(inputFieldCollection.filter(function(inputField){return inputField.get("_name")==name}).length>1){throw"{{#inputField}}: Duplicate names are not allowed (\"".concat(name,"\" name used more than once in block ").concat(componentModel.getParent().get("_id"),".")}}var view=new InputFieldView$1({model:model});if(t._inputFieldViews[id]===undefined){t._inputFieldViews[id]=view}else{Adapt.log.warning("adapt-dd-inputField: duplicate {{#inputField}} detected: ".concat(id))}return view.$el});Handlebars.registerHelperEl("outputField",function(){var context=arguments[arguments.length-1];var data=Handlebars.getContextHash.apply(this,arguments);if(!data.fn)throw"{{#outputField}}: \"fn\" property must be defined!";var componentModel=Handlebars.getComponentModelFromContext(context);data=_.extend({decimals:2},data,{_parent:componentModel});data._parent=componentModel;var model=new Backbone.Model(data);return new OutputFieldView$1({model:model}).$el});var helpers={textarea:function(){var data=Handlebars.getContextHash.apply(this,arguments);var html=Handlebars.templates["textarea"](data);return new Handlebars.SafeString(html)}};for(var name in helpers){if(helpers.hasOwnProperty(name)){Handlebars.registerHelper(name,helpers[name])}}}}]);return InputFieldController}(Backbone.Controller);Adapt.inputField=new InputFieldController;var OPACITY=0.1;var MIN_ACTIVE_TIME=600;var DDLoadingModel=function(_Backbone$Model){_inherits(DDLoadingModel,_Backbone$Model);var _super=_createSuper(DDLoadingModel);function DDLoadingModel(){_classCallCheck(this,DDLoadingModel);return _super.apply(this,arguments)}_createClass(DDLoadingModel,[{key:"defaults",value:function defaults(){return{"_percentLoaded":0,"_hasLoaded":false,"_hasError":false,"_isActive":true,"text":""}}},{key:"initialize",value:function initialize(){this.recalc=_.debounce(this.recalc.bind(this),0);this.initHelpers();this.recalc();this.listenTo(Adapt.getAllComponents(),"change:_isReady",this.onComponentReadyChange.bind(this));this.listenTo(Adapt,"contentObjectView:postReady",this.onLoaded.bind(this))}},{key:"initHelpers",value:function initHelpers(){var helpers={loadingIcon:function(){var context=arguments[arguments.length-1];var template=Handlebars.templates["ddLoadingIcon"];return template(context.hash)}};for(var name in helpers){if(!helpers.hasOwnProperty(name))continue;Handlebars.registerHelper(name,helpers[name])}}},{key:"onLoaded",value:function onLoaded(contentObjectView){this.set("_hasLoaded",true);this.clearText()}},{key:"onComponentReadyChange",value:function onComponentReadyChange(componentModel,_isReady){var componentsReady=this._loadingComponents.filter(function(e){return e.get("_isReady")});var percentage=componentsReady.length/this._loadingComponents.length*100;this.set("_percentLoaded",isNaN(percentage)?0:percentage);if(this._debugCommentEl){this._debugCommentEl.remove();this._debugCommentEl=null}var commentStr="";Adapt.blocks.each(function(blockModel){commentStr+=blockModel.get("_id")+" --- ";var readyComponentCount=0;var waiting=[];blockModel.getChildren().each(function(componentModel){var isReady=componentModel.get("_isReady");if(isReady)readyComponentCount++;else waiting.push(componentModel.get("_id"))});commentStr+="".concat(readyComponentCount,"/").concat(blockModel.getChildren().length).concat(waiting.length?" ["+waiting.join(", ")+"]":"","\n")});this._debugCommentEl=document.createComment("\nComponents loaded\n-----------------\n".concat(commentStr,"\n"));document.body.appendChild(this._debugCommentEl)}},{key:"setText",value:function setText(text){this.set("text",text||"")}},{key:"showError",value:function showError(errorText){$(".js-loading").show();var template=Handlebars.templates["ddLoadingErrorText"];this.set("text",template({text:errorText}));this.set("_hasError",true)}},{key:"clearText",value:function clearText(){this.set("text","")}},{key:"show",value:function show(){this.set("_isActive",true);this.recalc()}},{key:"hide",value:function hide(){this.set("_isActive",false)}},{key:"recalc",value:function recalc(){this.set("_percentLoaded",0);this._loadingComponents=Adapt.getAllComponents().filter(function(e){return e.get("_isAvailable")&&e.getParent().get("_isAvailable")&&!e.get("_isReady")});if(this._loadingComponents.length==0){this.hide()}}}]);return DDLoadingModel}(Backbone.Model);var DDLoadingView=function(_Backbone$View){_inherits(DDLoadingView,_Backbone$View);var _super2=_createSuper(DDLoadingView);function DDLoadingView(){_classCallCheck(this,DDLoadingView);return _super2.apply(this,arguments)}_createClass(DDLoadingView,[{key:"initialize",value:function initialize(){this.setupModelData();this.render();this.setUpEventListeners()}},{key:"setupModelData",value:function setupModelData(){var _this=this;this.__isActive=true;this.model.isActive=function(){return _this.__isActive}}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenTo(this.model,{"change:_isActive":this.onActiveChange.bind(this),"change:_percentLoaded":this.onPercentLoadedChange.bind(this),"change:_hasLoaded":this.onHasLoadedChange.bind(this),"change:_hasError":this.onHasErrorChange.bind(this),"change:text":this.onTextChange.bind(this)})}},{key:"onActiveChange",value:function onActiveChange(model,isActive){this.updateVisibility()}},{key:"updateVisibility",value:function updateVisibility(){var _this2=this;var isActive=Boolean(this.model.get("_isActive"));if(isActive){this.$el.fadeIn(100);this._activeStart=Date.now();$("html").toggleClass("is-loading",true);Adapt.trigger("loading:start");Adapt.log.debug("Firing loading:start");this.__isActive=true}else{var fadeOut=function(){if(Boolean(_this2.model.get("_isActive")))return;_this2.$el.fadeOut(100);$("html").toggleClass("is-loading",false);Adapt.trigger("loading:end");Adapt.log.debug("Firing loading:end");_this2.__isActive=false};if(!this._activeStart){fadeOut();return}var activeTime=Date.now()-this._activeStart;if(activeTime<MIN_ACTIVE_TIME){setTimeout(fadeOut.bind(this),MIN_ACTIVE_TIME-activeTime)}else{fadeOut()}}}},{key:"onHasErrorChange",value:function onHasErrorChange(model,hasError){this.$el.toggleClass("has-error",hasError)}},{key:"onTextChange",value:function onTextChange(model,text){this.$(".js-ddloading-text").html(text)}},{key:"onHasLoadedChange",value:function onHasLoadedChange(model,hasLoaded){}},{key:"onPercentLoadedChange",value:function onPercentLoadedChange(model,percentLoaded){var o=1-OPACITY;var graphicCount=16;var segment=100/graphicCount;var idx=Math.floor(percentLoaded/segment);var opacity=1-o+o*(percentLoaded%segment/segment);var $img=this.$(".js-ddloading-img").filter("[data-logo-index="+idx+"]");$img.css("opacity",opacity);for(var i=0;i<idx-1;i++){this.$(".js-ddloading-img").filter("[data-logo-index="+i+"]").css("opacity",1)}this.$(".js-ddloading-percent").html(Math.floor(percentLoaded)+"%");if(Math.round(percentLoaded)==100){this.model.hide()}}},{key:"render",value:function render(){this.updateVisibility()}}]);return DDLoadingView}(Backbone.View);Adapt.on("router:page",function(){var $loading=$(".js-loading").first();$loading.addClass("ddloading");var model=new DDLoadingModel;new DDLoadingView({model:model,el:$loading[0]});Adapt.ddLoading=model});Adapt.on("notify:opened",function(notifyView){_.delay(function(){Handlebars__default["default"].fixPlaceholders(notifyView.$el)},0)});function getUrlVars(){var vars={};window.location.href.replace(/[?&]+([^=&]+)=([^&#]*)/gi,function(m,key,value){vars[key]=value});return vars}Adapt.on("app:dataLoaded",function(test){var url=window.location.href;var DEBUG_FORCED=url.indexOf("proofingsite.didaskogroup.com")>=0;var DEBUG_DISABLED=getUrlVars().debug==="false";var PAGEMODE_ENABLED=url.indexOf("localhost")>=0||DEBUG_FORCED;if(DEBUG_DISABLED)PAGEMODE_ENABLED=false;var config=getCourseConfig();disablePageNavigation();if(PAGEMODE_ENABLED){if(DEBUG_FORCED)config._mode="debug";_.each(Adapt.blocks.models,function(e,i){e.set("_mode",undefined)})}});function disablePageNavigation(){var url=getUrlVars();if(url.navigationEnabled!=="false")return;$("html").addClass("navigation-hidden");$("body").append("<style>[role='navigation'],.sidemenu{display: none;}.component__container{margin-left: 0;}#app{border-top: 0;}.page::after{content: none;}")}function getCourseConfig(){return Adapt.course.get("_pageMode")||{_mode:"debug"}}var QuestionPlusMultiModel=function(_Backbone$Model){_inherits(QuestionPlusMultiModel,_Backbone$Model);var _super=_createSuper(QuestionPlusMultiModel);function QuestionPlusMultiModel(){_classCallCheck(this,QuestionPlusMultiModel);return _super.apply(this,arguments)}_createClass(QuestionPlusMultiModel,[{key:"defaults",value:function defaults(){return{"_parent":undefined,"_children":undefined}}},{key:"initialize",value:function initialize(){this.hideQuestionRows();this.get("_children").each(function(model,i){if(i==0)return;model.set("_hasDivider",true)});this.listenTo(this.get("_parent").get("_children"),"change:_isComplete",this.onQuestionComponentComplete)}},{key:"hideQuestionRows",value:function hideQuestionRows(){var crVisible=true;_.each(this.get("_children").models,function(componentRow,i){if(crVisible&&!componentRow.get("_isComplete")){crVisible=false;return}componentRow.set("_isVisible",crVisible)})}},{key:"onQuestionComponentComplete",value:function onQuestionComponentComplete(model,_isComplete){if(!_isComplete)return;var nextIncompleteComponent=this.showNextQuestionComponent();if(!nextIncompleteComponent)return;this.listenToOnce(Adapt,"notify:closed",function(){_.debounce(function(){Adapt.navigateToElement("."+nextIncompleteComponent.get("_id"),{duration:400})})()})}},{key:"showNextQuestionComponent",value:function showNextQuestionComponent(){var nextIncompleteComponent=_.find(this.get("_parent").getChildren().models,function(component){if(!component.get("_isComplete"))return true});if(!nextIncompleteComponent)return undefined;nextIncompleteComponent.get("_componentRow").set("_isVisible",true);return nextIncompleteComponent}}]);return QuestionPlusMultiModel}(Backbone.Model);var QuestionPlusMultiModel$1=__AMD("extensions/adapt-dd-questionPlus/js/questionPlusMultiModel",QuestionPlusMultiModel);function _fixString(val){if(!val)return"";if(typeof val==="string")return val.trim();return val}var QuestionPlus=function(_Backbone$Controller){_inherits(QuestionPlus,_Backbone$Controller);var _super=_createSuper(QuestionPlus);function QuestionPlus(){_classCallCheck(this,QuestionPlus);return _super.apply(this,arguments)}_createClass(QuestionPlus,[{key:"initialize",value:function initialize(){Adapt.on({"app:dataReady":this.onDataReady.bind(this)})}},{key:"onDataReady",value:function onDataReady(){this._onDataReady();Adapt.on("blockView:preRender",this.onBlockViewPrerender.bind(this));Adapt.on("blockView:postRender",this.onBlockViewPostRender.bind(this));Adapt.on("componentView:postRender",this.onComponentViewPostRender.bind(this));Adapt.on("questionView:showFeedback",this.onQuestionViewShowFeedback.bind(this))}},{key:"onBlockViewPrerender",value:function onBlockViewPrerender(blockView){var questionRowCount=0;var questionRows=[];try{_.each(blockView.model.get("_componentRow").get("_children").models,function(componentRow){if(componentRow.get("_isQuestionType")){questionRowCount++;questionRows.push(componentRow)}})}catch(err){if(!Adapt.hyb)throw"Could not initialize QuestionPlus (is the 'adapt-componentRow' extension included in the build?)"}if(questionRowCount==0)return;blockView.model.set("_isQuestionType",true);blockView.model.getChildren().first().set("_componentLogo",{src:"assets/questionplus-logo.svg"});if(questionRowCount>1){blockView.model.set("_questionPlusMulti",new QuestionPlusMultiModel$1({_parent:blockView.model,_children:new Backbone.Collection(questionRows)}))}blockView.model.set("_classes",blockView.model.get("_classes")+" is-question");blockView.$el.addClass("is-question")}},{key:"_onDataReady",value:function _onDataReady(){Adapt.getAllComponents().each(function(componentModel){if(!componentModel.get("_isQuestionType"))return;componentModel.set("_canShowModelAnswer",false);componentModel.set("_attempts",999);{_.debounce(function(){componentModel.reset(true,true)})()}var block=componentModel.getParent();block.set("_isQuestionType",true)})}},{key:"onBlockViewPostRender",value:function onBlockViewPostRender(blockView){blockView.$el.toggleClass("is-question",Boolean(blockView.model.get("_isQuestionType")))}},{key:"onComponentViewPreRender",value:function onComponentViewPreRender(componentView){var componentModel=componentView.model;if(!componentModel.get("_isQuestionType"))return;componentModel.reset(true,true)}},{key:"onComponentViewPostRender",value:function onComponentViewPostRender(componentView){var componentModel=componentView.model;if(!componentModel.get("_isQuestionType"))return;if(componentModel.get("_isQuestionPlus"))return;componentModel.set("_isQuestionPlus",true);componentView.$el.addClass("is-questionplus");componentModel.setQuestionAsSubmitted=function(){var isCorrect=componentModel.isCorrect();componentModel.set({_isEnabled:!isCorrect,_isSubmitted:isCorrect})};componentModel.updateAttempts=function(){this.set("_attemptsLeft",999)};this.setUpFeedback(componentModel);var _onSubmitClicked=componentView.onSubmitClicked;if(!_onSubmitClicked.prototype._questionPlusOverride){componentView.onSubmitClicked=function(){_onSubmitClicked.apply(componentView,arguments);this.$(".component__widget").addClass("show-user-answer")};componentView.onSubmitClicked.prototype._questionPlusOverride=true}var buttonsView=componentView.buttonsView;var _onFeedbackMessageChanged=buttonsView.onFeedbackMessageChanged;if(!_onFeedbackMessageChanged.prototype._questionPlusOverride){buttonsView.onFeedbackMessageChanged=function(){var canShowFeedback=buttonsView.model.get("_canShowFeedback");Adapt.a11y.toggleAccessibleEnabled(buttonsView.$(".js-btn-feedback"),canShowFeedback);buttonsView.$(".js-btn-feedback").prop("disabled",!canShowFeedback)};buttonsView.onFeedbackMessageChanged.prototype._questionPlusOverride=true}buttonsView.stopListening(buttonsView.model,"change:feedbackMessage");buttonsView.listenTo(buttonsView.model,"change:feedbackMessage",buttonsView.onFeedbackMessageChanged)}},{key:"setUpFeedback",value:function setUpFeedback(questionModel){var _getFeedbackTitle=questionModel.getFeedbackTitle;var _default=Adapt.course.get("_feedback");if(!_default)throw"\"course._feedback\" must be defined for un-set component._feedback titles to fall back on.";if(!_getFeedbackTitle.prototype._questionPlusOverride){questionModel.getFeedbackTitle=function(){var _feedback=questionModel.get("_feedback");if(Boolean(questionModel.get("_isCorrect"))){if(!_feedback._correct)return _getFeedbackTitle.apply(questionModel,arguments);return _feedback._correct.title||_default._correct.title||_getFeedbackTitle.apply(questionModel,arguments)}if(Boolean(questionModel.get("_isAtLeastOneCorrectSelection"))){if(!_feedback._partlyCorrect)return _getFeedbackTitle.apply(questionModel,arguments);return _feedback._partlyCorrect.title||_default._partlyCorrect.title||_getFeedbackTitle.apply(questionModel,arguments)}if(!_feedback._incorrect)return _getFeedbackTitle.apply(questionModel,arguments);return _feedback._incorrect.title||_default._incorrect.title||_getFeedbackTitle.apply(questionModel,arguments)};questionModel.getFeedbackTitle.prototype._questionPlusOverride=true}var _feedback=questionModel.get("_feedback");var formatMessage=function(body,instruction){return Handlebars.templates["questionPlusFeedbackBody"]({body:body,instruction:instruction})};_feedback=_.extend({},_feedback,{correct:formatMessage((_fixString(_feedback._correct)?_fixString(_feedback._correct.body):"")||""),_incorrect:_.extend({},_feedback._incorrect,{final:formatMessage(_fixString(_feedback._incorrect.body)||"",_fixString(_feedback._incorrect.instruction)||_fixString(_default._incorrect.instruction)||"")}),_partlyCorrect:_.extend({},_feedback._partlyCorrect,{final:formatMessage(_fixString(_feedback._partlyCorrect.body)||_fixString(_feedback._incorrect.body)||"",_fixString(_feedback._partlyCorrect.instruction)||_fixString(_feedback._incorrect.instruction)||_fixString(_default._partlyCorrect.instruction)||"")})});questionModel.set("_feedback",_feedback)}},{key:"onQuestionViewShowFeedback",value:function onQuestionViewShowFeedback(questionView){if(questionView.updateMarking)questionView.updateMarking();if(questionView.model.get("_isComplete"))return;this.listenToOnce(Adapt,{"notify:closed":function(){return}})}}]);return QuestionPlus}(Backbone.Controller);var questionPlus=new QuestionPlus;Adapt.questionPlus=questionPlus;var HYBVideoModel=function(_Backbone$Model){_inherits(HYBVideoModel,_Backbone$Model);var _super=_createSuper(HYBVideoModel);function HYBVideoModel(){_classCallCheck(this,HYBVideoModel);return _super.apply(this,arguments)}_createClass(HYBVideoModel,[{key:"defaults",value:function defaults(){return{_fullscreenEnabled:true,_volumeEnabled:true,_volume:1,_volumeMuted:false,_ccEnabled:true,_isFullscreen:false,_isVisited:false,_isPlaying:false,_isEnded:false,_progress:0,_progressPercent:0,_isWaiting:false,_waitingStartTime:-1}}},{key:"initialize",value:function initialize(){this.set("_id",_.uniqueId("ddvideo-"));this.set("_volume",Adapt.ddVideo.getVolume());this.setupMetadata();if(this.get("_volumeEnabled")===false)return;this.listenTo(this,"change:_volume",this.onVolumeChange)}},{key:"setupMetadata",value:function setupMetadata(){var _pageModel$get,_pageModel$get$_video;var pageModel=Adapt.findById(Adapt.location._currentId);var metadata=(_pageModel$get=pageModel.get("_metadata"))===null||_pageModel$get===void 0?void 0:(_pageModel$get$_video=_pageModel$get._videos)===null||_pageModel$get$_video===void 0?void 0:_pageModel$get$_video[this.get("src")];if(!metadata)return;this.set("_volumeEnabled",metadata._hasAudio!==false)}},{key:"setVolume",value:function setVolume(vol){this.set("_volume",vol)}},{key:"onVolumeChange",value:function onVolumeChange(model,volume){Adapt.ddVideo.setVolume(volume)}},{key:"play",value:function play(){this.set("_isPlaying",true)}}]);return HYBVideoModel}(Backbone.Model);var DDVideoModel=__AMD("extensions/adapt-dd-video/js/dd-videoModel",HYBVideoModel);var HYBTranscriptView=function(_Backbone$View){_inherits(HYBTranscriptView,_Backbone$View);var _super=_createSuper(HYBTranscriptView);function HYBTranscriptView(){_classCallCheck(this,HYBTranscriptView);return _super.apply(this,arguments)}_createClass(HYBTranscriptView,[{key:"events",value:function events(){return{}}},{key:"className",value:function className(){var classes=["hyb-transcript",this.model.get("class")||""];return classes.join(" ")}},{key:"initialize",value:function initialize(){this.render()}},{key:"render",value:function render(){var template=Handlebars.templates["hyb-transcript"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}}]);return HYBTranscriptView}(Backbone.View);var HYBTranscriptView$1=__AMD("extensions/adapt-dd-video/js/hyb-transcriptView",HYBTranscriptView);var TIMESKIP=5;var SMALL_VIEW=25;var REMOVE_MOUSEMOVE_DELAY=1000;var DDVideoView=function(_Backbone$View){_inherits(DDVideoView,_Backbone$View);var _super=_createSuper(DDVideoView);function DDVideoView(){_classCallCheck(this,DDVideoView);return _super.apply(this,arguments)}_createClass(DDVideoView,[{key:"events",value:function events(){return{"click .js-ddvc-play":"onPlayPauseClick","click .js-dd-video-video":"onPlayPauseClick","click .js-ddvc-audio":"onAudioBtnClick","click .js-ddvc-cc":"onCCBtnClick","dblclick .js-dd-video-video":"onFullscreenBtnClick","click .js-ddvc-fullscreen":"onFullscreenBtnClick","webkitfullscreenchange":"onFullscreenEvent","mozfullscreenchange":"onFullscreenEvent","MSFullscreenChange":"onFullscreenEvent","fullscreenchange":"onFullscreenEvent","mousemove":"onMouseMove","click .js-dd-video-transcript-btn":"onTranscriptBtnClick","click .js-dd-video-start":"onStartClick","click":"onClick","keydown":"onKeyDown","keyup":"onKeyUp"}}},{key:"className",value:function className(){var classes=["dd-video","is-metadata-loading",this.model.get("_isFullscreen")?"is-fullscreen":"is-windowed",this.model.get("class")||""];return classes.join(" ")}},{key:"attributes",value:function attributes(){return{"data-adapt-id":this.model.get("_id")}}},{key:"initialize",value:function initialize(){this._removeMouseMove=_.debounce(this._removeMouseMove.bind(this),REMOVE_MOUSEMOVE_DELAY);this.render();_.delay(this.setupTranscript.bind(this),0);this.checkIsFullscreenSupported();this.setupEventListeners()}},{key:"checkIsFullscreenSupported",value:function checkIsFullscreenSupported(){var video=this.$(".js-dd-video-video")[0];if(typeof video.webkitEnterFullscreen==="function")return true;if(typeof video.mozRequestFullScreen==="function")return true;Adapt.log.warn("The current browser does not support fullscreen.");this.set("_fullscreenEnabled",false);return false}},{key:"hasAudio",value:function hasAudio(){return this.model.get("_volumeEnabled")!==false}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model,{"change:_isPlaying":this.onIsPlayingChange,"change:_isFullscreen":this.onIsFullscreenChange,"change:_isWaiting":this.onIsWaitingChange});this.listenTo(Adapt,{"media:pause":this.onGlobalPause});this.onIsPlayingChange(this.model,this.model.get("_isPlaying"));this.onIsFullscreenChange(this.model,this.model.get("_isFullscreen"));this.getVideoEl().addEventListener("progress",this.updateProgressBuffer.bind(this));this.getVideoEl().addEventListener("load",this.updateProgressBuffer.bind(this));this.getVideoEl().addEventListener("loadedmetadata",this.onMetadataLoaded.bind(this));this.getVideoEl().addEventListener("waiting",this.onWaiting.bind(this))}},{key:"render",value:function render(){var template=Handlebars.templates["ddVideo"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}},{key:"setupSizeTheme",value:function setupSizeTheme(){var rem=parseFloat($("html").css("font-size"),10);var videoWidth=this.$(".js-dd-video-video").width();if(videoWidth&&videoWidth<SMALL_VIEW*rem){this.$el.addClass("theme-small")}}},{key:"getVideoEl",value:function getVideoEl(){return this.$(".js-dd-video-video")[0]}},{key:"onGlobalPause",value:function onGlobalPause(){this.pause();if(this.transcript){this.transcript.toggle(false)}}},{key:"onClick",value:function onClick(){this.focusControls()}},{key:"focusControls",value:function focusControls(){var controls=this.$(".js-ddvc-play")[0];controls.focus({preventScroll:true})}},{key:"onKeyDown",value:function onKeyDown(e){var video=this.getVideoEl();var progressPercent=this.model.get("_progressPercent");var time=progressPercent*video.duration;var volume=this.model.get("_volume");switch(e.keyCode){case 32:this.togglePlayPause();return;case 37:time-=TIMESKIP;if(time<0){time=0}video.currentTime=time;return;case 39:time+=TIMESKIP;if(time>video.duration-0.1){time=video.duration-0.1}video.currentTime=time;return;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:var multi=(e.keyCode-48)*0.1;time=video.duration*multi;video.currentTime=time;return;case 38:volume+=0.05;if(volume>1)volume=1;this.model.set("_volume",volume);return;case 40:volume-=0.05;if(volume<0)volume=0;this.model.set("_volume",volume);return;case 70:this.toggleFullscreen();return;}}},{key:"onKeyUp",value:function onKeyUp(e){if(e.code==="Space"||e.keyCode==32){e.preventDefault();return}}},{key:"onMouseMove",value:function onMouseMove(){var $ddvc=this.$(".ddvc");$ddvc.addClass("mousemove");this._removeMouseMove()}},{key:"_removeMouseMove",value:function _removeMouseMove(){var $ddvc=this.$(".ddvc");$ddvc.removeClass("mousemove")}},{key:"_initJQueryUISlider",value:function _initJQueryUISlider($el,trackProp,options){var _this=this;var notches=$el.width();var data=_.extend({},{range:"min",value:0,min:0,max:notches,"ui-slider-handle":"ui-corner-all"},options);data.slide=function(event,ui){var percentValue=ui.value/notches;_this.model.set(trackProp,percentValue);try{if(options.slide)options.slide(event,ui)}catch(err){}};this.listenTo(this.model,"change:".concat(trackProp),function(model,val){$el.slider("value",val*notches)});$el.slider(data)}},{key:"onMetadataLoaded",value:function onMetadataLoaded(){this.setupCaptions();this.setupProgress();this.setupAudio();this.$el.removeClass("is-metadata-loading");this.setupSizeTheme();var hasAudio=this.hasAudio();this.$el.toggleClass("audio-disabled",!hasAudio);if(!hasAudio)this.$(".ddvc__audio").attr("title","This video contains no audio.")}},{key:"setupProgress",value:function setupProgress(){var _this2=this;var video=this.getVideoEl();var $slider=this.$(".js-ddvc-progress-slider");var wasPlaying;var isMax;this._initJQueryUISlider($slider,"_progressPercent",{start:function(){wasPlaying=_this2.model.get("_isPlaying");_this2.pause()},slide:function(event,ui){var video=_this2.getVideoEl();var progressPercent=_this2.model.get("_progressPercent");var time=progressPercent*video.duration;if(time>video.duration-0.1){time=video.duration-0.1;isMax=true}else{isMax=false}video.currentTime=time},stop:function(){if(wasPlaying||isMax){_this2.play()}}});video.addEventListener("timeupdate",this.onVideoTimeUpdate.bind(this),false);video.addEventListener("ended",this.onVideoEnded.bind(this));this.listenTo(this.model,{"change:_progress":this.onProgressChange,"change:_progressPercent":this.onProgressPercentChange,"change:_isEnded":this.onVideoEndedChange});this.updateTimecodeTotal();this.updateTimecodeCur()}},{key:"onProgressChange",value:function onProgressChange(model,progress){var video=this.getVideoEl();var progressPercent=video.currentTime/video.duration;this.model.set("_progressPercent",progressPercent);this.updateTimecodeCur()}},{key:"onVideoTimeUpdate",value:function onVideoTimeUpdate(){var video=this.getVideoEl();this.model.set("_progress",video.currentTime);this.model.set("_isEnded",false);if(this.model.get("_isWaiting")){if(this.model.get("_progress")!=this.model.get("_waitingStartTime")){this.stopWaiting()}}}},{key:"onVideoEnded",value:function onVideoEnded(){this.model.set("_isEnded",true)}},{key:"onVideoEndedChange",value:function onVideoEndedChange(model,isEnded){if(isEnded){this.model.set("_isPlaying",false)}this.$el.toggleClass("is-ended",isEnded)}},{key:"updateTimecodeTotal",value:function updateTimecodeTotal(){var video=this.getVideoEl();var width=this.$(".js-ddvc-duration-total").text(this._getMinutesSecondsString(video.duration)).width();this.$(".js-ddvc-duration-cur").width(width)}},{key:"updateTimecodeCur",value:function updateTimecodeCur(){var video=this.getVideoEl();this.$(".js-ddvc-duration-cur").text(this._getMinutesSecondsString(video.currentTime))}},{key:"_getMinutesSecondsString",value:function _getMinutesSecondsString(secondsNum){var date=new Date(null);date.setSeconds(Math.floor(secondsNum||0));var str=date.toISOString().substring(14,19);return str.trim()}},{key:"setupCaptions",value:function(){var _setupCaptions=_asyncToGenerator(_regeneratorRuntime().mark(function _callee2(){var _this$model$get;var $tracks,_loop,i;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if((_this$model$get=this.model.get("cc"))!==null&&_this$model$get!==void 0&&_this$model$get.length){_context2.next=2;break}return _context2.abrupt("return");case 2:$tracks=this.$(".js-dd-video-track");_loop=_regeneratorRuntime().mark(function _callee(){var $track,track,cues;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:$track=$tracks.eq(i);track=$track[0].track;cues=track.cues;_context.prev=3;if(cues.length){_context.next=7;break}_context.next=7;return Promise.race([new Promise(function(resolve){$track.on("load",resolve)}),new Promise(function(resolve){_.delay(resolve,5000)})]);case 7:_context.next=12;break;case 9:_context.prev=9;_context.t0=_context["catch"](3);Adapt.log.error(_context.t0);case 12:_.each(cues,function(cue){cue.line=-3});case 13:case"end":return _context.stop();}},_callee,null,[[3,9]])});i=0;case 5:if(!(i<$tracks.length)){_context2.next=10;break}return _context2.delegateYield(_loop(),"t0",7);case 7:i++;_context2.next=5;break;case 10:this.listenTo(this.model,"change:_ccEnabled",this.onCCEnabledChange);this.onCCEnabledChange(this.model,this.model.get("_ccEnabled"));case 12:case"end":return _context2.stop();}},_callee2,this)}));function setupCaptions(){return _setupCaptions.apply(this,arguments)}return setupCaptions}()},{key:"onCCBtnClick",value:function onCCBtnClick(event){event.preventDefault();this.model.set("_ccEnabled",!Boolean(this.model.get("_ccEnabled")))}},{key:"onCCEnabledChange",value:function onCCEnabledChange(model,isEnabled){var video=this.getVideoEl();var tracks=video.textTracks;_.each(tracks,function(track){track.mode=isEnabled?"showing":"hidden"});this.$(".js-ddvc-icon-cc").toggle(isEnabled);this.$(".js-ddvc-icon-cc-off").toggle(!isEnabled)}},{key:"setupTranscript",value:function setupTranscript(){var transcript=this.model.get("_transcript");if(!transcript)return;if(transcript._isEnabled===undefined){transcript._isEnabled=Boolean(transcript.body)}if(!transcript._isEnabled)return;transcript.title=transcript.title||"Transcript";var view=new HYBTranscriptView$1({model:new Backbone.Model(transcript)});this.transcript=Adapt.hyb.drawer({_parent:this.model.get("_parent"),_view:view,_$target:this.$(".js-dd-video-container"),title:transcript.title,_targetNestDepth:transcript._nestDepth})}},{key:"onTranscriptBtnClick",value:function onTranscriptBtnClick(){if(!this.transcript){throw"dd-videoView.js: transcript drawer not initialized."}this.transcript.toggle()}},{key:"onFullscreenBtnClick",value:function onFullscreenBtnClick(event){this.toggleFullscreen()}},{key:"toggleFullscreen",value:function toggleFullscreen(isEnabled){this.model.set("_isFullscreen",isEnabled===undefined?!this.model.get("_isFullscreen"):Boolean(isEnabled))}},{key:"onIsFullscreenChange",value:function onIsFullscreenChange(model,isFullscreen){var video=this.getVideoEl();var controls=this.$(".js-dd-video-container")[0];try{if(typeof video.webkitEnterFullscreen==="function"){if(isFullscreen){controls.webkitRequestFullScreen()}else{document.webkitCancelFullScreen()}}else if(typeof video.mozRequestFullScreen==="function"){if(isFullscreen){controls.mozRequestFullScreen()}else{document.mozCancelFullScreen()}}}catch(err){}this.$el.toggleClass("is-fullscreen",isFullscreen);this.$el.toggleClass("is-windowed",!isFullscreen);this.$(".js-ddvc-icon-fullscreen").toggle(!isFullscreen);this.$(".js-ddvc-icon-exit-fullscreen").toggle(isFullscreen)}},{key:"exitFullscreen",value:function exitFullscreen(){var isFullscreen=this.model.get("_isFullscreen");if(isFullscreen)this.toggleFullscreen()}},{key:"onFullscreenEvent",value:function onFullscreenEvent(event){var isFullscreen=document.fullscreenElement||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement;isFullscreen=Boolean(isFullscreen);this.toggleFullscreen(isFullscreen)}},{key:"updateProgressBuffer",value:function updateProgressBuffer(){var MERGE_GAP=1.5;var video=this.getVideoEl();this.$(".js-ddvc-buffer-item").remove();var $buffer=this.$(".js-ddvc-buffer");var bf=video.buffered;_.each(bf,function(item,i){var $item=$("<div>",{class:"ddvc__progress-buffer-item js-ddvc-buffer-item"});var start=bf.start(i);var end=bf.end(i);if(i>0){var endPrev=bf.end(i-1);if(start-endPrev<MERGE_GAP){start=endPrev}}var s=start/video.duration;var e=end/video.duration;$item.css({left:s*100+"%",width:(e-s)*100+"%"});$buffer.append($item)})}},{key:"onWaiting",value:function onWaiting(){this.model.set("_isWaiting",true);this.model.set("_waitingStartTime",this.model.get("_progress"))}},{key:"stopWaiting",value:function stopWaiting(){this.model.set("_isWaiting",false);this.model.set("_waitingStartTime",-1)}},{key:"onIsWaitingChange",value:function onIsWaitingChange(model,isWaiting){this.$el.toggleClass("is-waiting",isWaiting)}},{key:"onAudioBtnClick",value:function onAudioBtnClick(event){event.preventDefault();this.model.set("_volumeMuted",!Boolean(this.model.get("_volumeMuted")))}},{key:"refreshAudioControls",value:function refreshAudioControls(){var volume=this.model.get("_volume");var volumeMuted=this.model.get("_volumeMuted")||volume==0;this.$(".js-ddvc-icon-audio-mute").toggle(volumeMuted);this.$(".js-ddvc-icon-audio-half").toggle(!volumeMuted&&volume>0&&volume<=0.5);this.$(".js-ddvc-icon-audio-full").toggle(!volumeMuted&&volume>0.5)}},{key:"onVolumeChange",value:function onVolumeChange(model,volume){this.model.set("_volumeMuted",volume==0);var video=this.getVideoEl();video.volume=volume;this.refreshAudioControls()}},{key:"onVolumeMutedChange",value:function onVolumeMutedChange(model,volumeMuted){if(this.model.get("_volume")==0&&!volumeMuted){this.model.set("_volume",0.5)}var video=this.getVideoEl();video.muted=volumeMuted;this.refreshAudioControls()}},{key:"setupAudio",value:function setupAudio(){var $slider=this.$(".js-ddvc-audio-slider");this._initJQueryUISlider($slider,"_volume");this.listenTo(this.model,"change:_volume",this.onVolumeChange);this.listenTo(this.model,"change:_volumeMuted",this.onVolumeMutedChange);var video=this.getVideoEl();var gVolume=this.model.get("_volume");var v=gVolume!=1?gVolume:video.volume;this.model.set("_volume",0,{silent:true});this.model.set("_volume",v)}},{key:"onPlayPauseClick",value:function onPlayPauseClick(event){event.preventDefault();this.togglePlayPause()}},{key:"isVideoPlaying",value:function isVideoPlaying(){var video=this.getVideoEl();return!!(video.currentTime>0&&!video.paused&&!video.ended&&video.readyState>2)}},{key:"togglePlayPause",value:function togglePlayPause(){var isPlaying=this.isVideoPlaying();if(isPlaying)this.pause();else this.play()}},{key:"play",value:function play(){this.focusControls();var video=this.getVideoEl();var playPromise=video.play();if(playPromise!==undefined){playPromise.then(function(){this.model.set("_isPlaying",true)}.bind(this)).catch(function(err){this.pause()}.bind(this))}this.hideStart()}},{key:"pause",value:function pause(){var video=this.getVideoEl();video.pause();this.model.set("_isPlaying",false)}},{key:"onIsPlayingChange",value:function onIsPlayingChange(model,isPlaying){this.$el.toggleClass("is-playing",isPlaying).toggleClass("is-paused",!isPlaying);this.$(".ddvc").toggleClass("is-playing",isPlaying).toggleClass("is-paused",!isPlaying);this.$(".js-ddvc-icon-play").toggle(!isPlaying);this.$(".js-ddvc-icon-pause").toggle(isPlaying);if(isPlaying)this.play();else this.pause()}},{key:"onStartClick",value:function onStartClick(){this.play(0)}},{key:"hideStart",value:function hideStart(){var $start=this.$(".js-dd-video-start");$start.fadeOut();$start.addClass("is-start-inactive")}}]);return DDVideoView}(Backbone.View);var DDVideoView$1=__AMD("extensions/adapt-dd-video/js/dd-videoView",DDVideoView);var DDVideo=function(_Backbone$Controller){_inherits(DDVideo,_Backbone$Controller);var _super=_createSuper(DDVideo);function DDVideo(){_classCallCheck(this,DDVideo);return _super.apply(this,arguments)}_createClass(DDVideo,[{key:"initialize",value:function initialize(){this.videos=new Backbone.Collection([],{model:DDVideoModel});this.gVolume=1;this.setVolume=_.debounce(this.setVolume.bind(this),100);this.pauseAllMedia=_.debounce(this.pauseAllMedia.bind(this),10,true);this.listenTo(Adapt,{"router:page":this.onRouterPage})}},{key:"onRouterPage",value:function onRouterPage(){var me=this;Handlebars.registerHelperEl("video",function(){var context=arguments[arguments.length-1];var data=_.extend({},context.hash,{content:context.fn?context.fn(this):""});data._parent=Handlebars.getComponentModelFromContext(context);if(!data.id&&(!data.src||!data.poster)){throw"{{#video}}: if \"id\" isn't being used, then \"src\" and \"poster\" must be defined (or vice-versa)."}if(Boolean(data.src)!=Boolean(data.poster)){throw"{{#video}}: both \"src\" and \"poster\" must be defined if \"id\" isn't being used."}if(data.content&&data._transcript===undefined){data._transcript={_isEnabled:true,body:data.content}}var model=new DDVideoModel(data);var view=new DDVideoView$1({model:model});me.videos.push(model);return view.$el})}},{key:"getVideoModel",value:function getVideoModel($el){var id=$el.closest(".dd-video").attr("data-adapt-id");var videoModel=this.videos.find(function(model){return model.get("_id")==id});return videoModel}},{key:"setVolume",value:function setVolume(vol){if(this.gVolume==vol)return;this.gVolume=vol;this.videos.each(function(model){return model.setVolume(vol)})}},{key:"getVolume",value:function getVolume(){return this.gVolume}},{key:"pauseAllMedia",value:function pauseAllMedia(){Adapt.trigger("media:pause")}}]);return DDVideo}(Backbone.Controller);var ddVideo=new DDVideo;Adapt.ddVideo=ddVideo;var Events=function(_Backbone$Controller){_inherits(Events,_Backbone$Controller);var _super=_createSuper(Events);function Events(){_classCallCheck(this,Events);return _super.apply(this,arguments)}_createClass(Events,[{key:"initialize",value:function initialize(){Adapt.on({"app:dataReady":this.onDataReady.bind(this)})}},{key:"onDataReady",value:function onDataReady(){Adapt.on("componentView:preRender",this.componentViewPreRender.bind(this));Adapt.on("componentView:postRender",this.componentViewPostRender.bind(this));Adapt.on("blockView:preRender",this.blockViewPreRender.bind(this));Adapt.on("blockView:postRender",this.blockViewPostRender.bind(this));Adapt.blocks.each(function(blockModel){blockModel.listenTo(blockModel.getChildren(),{"change:_isReady":function(model){var notReadyChild=blockModel.getChildren().find(function(child){return!child.get("_isReady")});if(notReadyChild){return}var blockView=Adapt.findViewByModelId(blockModel.get("_id"));blockModel.trigger("blockView:childrenReady",blockView);Adapt.trigger("blockView:childrenReady view:childrenReady",blockView)}})})}},{key:"componentViewPreRender",value:function componentViewPreRender(view){view.model.trigger("componentView:preRender",view)}},{key:"componentViewPostRender",value:function componentViewPostRender(view){view.model.trigger("componentView:postRender",view)}},{key:"blockViewPreRender",value:function blockViewPreRender(view){view.model.trigger("blockView:preRender",view)}},{key:"blockViewPostRender",value:function blockViewPostRender(view){view.model.trigger("blockView:postRender",view)}}]);return Events}(Backbone.Controller);new Events;var HYBAudioBtnView=function(_Backbone$View){_inherits(HYBAudioBtnView,_Backbone$View);var _super=_createSuper(HYBAudioBtnView);function HYBAudioBtnView(){_classCallCheck(this,HYBAudioBtnView);return _super.apply(this,arguments)}_createClass(HYBAudioBtnView,[{key:"className",value:function className(){var classes=["hyb-audiobtn","hyb-iconbtn-parent"];return classes.join(" ")}},{key:"events",value:function events(){return{"click .js-hyb-audiobtn-btn":"onClick"}}},{key:"initialize",value:function initialize(){this.loadAudio();this.setupEventListeners();this.render()}},{key:"loadAudio",value:function loadAudio(){this._audioName=_.uniqueId("audiobtn");this._audio=Adapt.ddAudio.loadAudio(this._audioName,[this.model.get("mp3"),this.model.get("ogg")])}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model,"change:_isPlaying",this.onPlayingChange);this.listenTo(this._audio,"change:_isPlaying",this.onAudioPlayingChange.bind(this))}},{key:"onClick",value:function onClick(){this.model.set("_isPlaying",!Boolean(this.model.get("_isPlaying")))}},{key:"onAudioPlayingChange",value:function onAudioPlayingChange(audioModel,isPlaying){this.model.set("_isPlaying",isPlaying)}},{key:"onPlayingChange",value:function onPlayingChange(model,isPlaying){if(isPlaying){var _this$model$get;this._audio.play(0);this.$(".js-hyb-audiobtn-btn").toggleClass("is-complete",true);(_this$model$get=this.model.get("_completionCondition"))===null||_this$model$get===void 0?void 0:_this$model$get()}else{this._audio.pause();Adapt.ddAudio.pauseAllAudio()}this.$(".js-hyb-audiobtn-icon .icon").toggleClass("icon-sound",!isPlaying).toggleClass("icon-sound-mute",isPlaying)}},{key:"render",value:function render(){var template=Handlebars__default["default"].templates["hyb-audioBtn"];this.$el.html(new Handlebars__default["default"].SafeString(template(this.model.toJSON())).string)}}]);return HYBAudioBtnView}(Backbone.View);var HYBAudioBtnView$1=__AMD("extensions/adapt-hyb-audioBtn/js/hyb-audioBtnView",HYBAudioBtnView);Adapt.on("router:page",function(){Handlebars__default["default"].registerHelperEl("audioBtn",function(){var context=arguments[arguments.length-1];var data=Handlebars__default["default"].getContextHash.apply(this,arguments);var componentModel=Handlebars__default["default"].getComponentModelFromContext(context);if(!data.mp3)throw"{{#hyb-audioBtn}}: \"mp3\" property must be set.";if(!data.ogg)throw"{{#hyb-audioBtn}}: \"ogg\" property must be set.";var modelJSON=data;modelJSON._parent=componentModel;modelJSON._completionCondition=componentModel.createCompletionCondition();return new HYBAudioBtnView$1({model:new Backbone.Model(modelJSON)}).$el})});var HYBBackgroundModel=function(_Backbone$Model){_inherits(HYBBackgroundModel,_Backbone$Model);var _super=_createSuper(HYBBackgroundModel);function HYBBackgroundModel(){_classCallCheck(this,HYBBackgroundModel);return _super.apply(this,arguments)}_createClass(HYBBackgroundModel,[{key:"defaults",value:function defaults(){return{"_isBlurred":false}}},{key:"initialize",value:function initialize(){if(this.get("_parent").get("_invertColor")){this.set("_invertColor",true);var color=this.get("color");if(color&&color.toLowerCase()==="#ffffff"){this.set("color","#000000")}}}},{key:"getBlurStyles",value:function getBlurStyles(){var _this$get;var multi=(_this$get=this.get("_blur"))===null||_this$get===void 0?void 0:_this$get._multi;if(multi===undefined)return{};return{"filter":"blur(".concat(multi*5,"px)"),"opacity":multi<1?0.7+0.3*multi:0.7}}},{key:"blur",value:function blur(){var _this$get2;if(((_this$get2=this.get("_blur"))===null||_this$get2===void 0?void 0:_this$get2._isEnabled)===false)return;this.set("_isBlurred",true)}}]);return HYBBackgroundModel}(Backbone.Model);var HYBBackgroundModel$1=__AMD("extensions/adapt-hyb-background/js/hyb-backgroundModel",HYBBackgroundModel);var HYBBackgroundView=function(_Backbone$View){_inherits(HYBBackgroundView,_Backbone$View);var _super=_createSuper(HYBBackgroundView);function HYBBackgroundView(){_classCallCheck(this,HYBBackgroundView);return _super.apply(this,arguments)}_createClass(HYBBackgroundView,[{key:"className",value:function className(){var classes=["hyb-background",this.model.get("_invertColor")?"is-inverted":""];return classes.join(" ")}},{key:"initialize",value:function initialize(){this.render();this.setupEventListeners()}},{key:"attributes",value:function attributes(){return{"aria-hidden":true}}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model,{"change:_isBlurred":this.onBlurredChange})}},{key:"onBlurredChange",value:function onBlurredChange(event,isBlurred){var $el=this.$(".js-hyb-background");$el.toggleClass("is-blurred",isBlurred);$el.css(this.model.getBlurStyles())}},{key:"render",value:function render(){var template=Handlebars.templates["hyb-background"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}}]);return HYBBackgroundView}(Backbone.View);var HYBBackgroundView$1=__AMD("extensions/adapt-hyb-background/js/hyb-backgroundView",HYBBackgroundView);var HYBBackground=function(_Backbone$Controller){_inherits(HYBBackground,_Backbone$Controller);var _super=_createSuper(HYBBackground);function HYBBackground(){_classCallCheck(this,HYBBackground);return _super.apply(this,arguments)}_createClass(HYBBackground,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"router:page":this.onRouterPage,"app:dataReady":this.onDataReady.bind(this),"componentView:postRender":this.onComponentViewPostRender.bind(this)})}},{key:"onRouterPage",value:function onRouterPage(){Handlebars.registerHelperEl("hyb-background",function(){var context=arguments[arguments.length-1];var modelJSON=_.extend({},context.hash,context.hash.background,{content:context.fn(this)});return new HYBBackgroundView$1({model:new Backbone.Model(modelJSON)}).$el})}},{key:"onDataReady",value:function onDataReady(){var _this=this;Adapt.getAllComponents().each(function(model){_this._legacyQuestionBGFix(model);var background=model.get("_background");if(!background||background._isEnabled===false)return;if(model.get("_hybBackground"))return;background._isEnabled=true;var bgModel=new HYBBackgroundModel$1(_.extend({},background,{_parent:model}));model.set("_hybBackground",bgModel)})}},{key:"_legacyQuestionBGFix",value:function _legacyQuestionBGFix(model){if(!model.get("_isQuestionType"))return;var background=model.get("_background");if(background&&background._isEnabled===false)background._isEnabled=true}},{key:"onComponentViewPostRender",value:function onComponentViewPostRender(componentView){var hbModel=componentView.model.get("_hybBackground");if(!hbModel||hbModel.get("_isEnabled")===false||hbModel.get("_hasCustomView"))return;var hbView=new HYBBackgroundView$1({model:hbModel});componentView.$el.addClass("has-hyb-background").prepend(hbView.$el);hbModel.set("_view",hbView)}}]);return HYBBackground}(Backbone.Controller);var hybBackground=new HYBBackground;__AMD("extensions/adapt-hyb-background/js/adapt-hyb-background",hybBackground);var HYBCountdownView=function(_Backbone$View){_inherits(HYBCountdownView,_Backbone$View);var _super=_createSuper(HYBCountdownView);function HYBCountdownView(){_classCallCheck(this,HYBCountdownView);return _super.apply(this,arguments)}_createClass(HYBCountdownView,[{key:"className",value:function className(){return"hyb-countdown"}},{key:"events",value:function events(){return{"click":"onClick"}}},{key:"initialize",value:function initialize(){this.setupEventListeners();this.render()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.getItems(),"change:_isVisited",this.onItemVisitedChange)}},{key:"render",value:function render(){var template=Handlebars.templates["hyb-countdown"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);this.update()}},{key:"getItems",value:function getItems(){var items=this.model.get("_parent").getChildren();if(!items)throw"hyb-countdownView.js: this extension won't work unless its parent component had '_items'.";return items}},{key:"onClick",value:function onClick(){this.showHint()}},{key:"showHint",value:function showHint(){var parent=this.model.get("_parent");var parentView=Adapt.findViewByModelId(parent.get("_id"));var items=this.getItems();var incompleteItem=items.find(function(e){return!e.get("_isVisited")});if(!incompleteItem)return;if(!parentView.$getItem){Adapt.log.error("hyb-countdownView: parent component's View must have a $getItem() function implemented.",parentView);return}var $item=parentView.$getItem(incompleteItem);$item.addClass("u-alert").one("animationend webkitAnimationEnd",function(){$item.removeClass("u-alert")})}},{key:"onItemVisitedChange",value:function onItemVisitedChange(itemModel,isVisited){this.update()}},{key:"update",value:function update(){var items=this.getItems();var visitedItems=items.filter(function(e){return e.get("_isVisited")});var remain=items.length-visitedItems.length;this.$(".js-hyb-countdown-num").text(remain);this.$(".js-hyb-countdown-text").text(remain===1?"Remains":"Remain");this.$el.toggleClass("is-complete",remain===0)}}]);return HYBCountdownView}(Backbone.View);var HYBCountdownView$1=__AMD("extensions/adapt-hyb-countdown/js/hyb-countdownView",HYBCountdownView);Adapt.on("router:page",function(){Handlebars__default["default"].registerHelperEl("countdown",function(){var context=arguments[arguments.length-1];var hash=context.hash;var componentModel=Handlebars__default["default"].getComponentModelFromContext(context);var modelJSON=_.extend({},hash,{_parent:componentModel,content:context.fn?context.fn(this):undefined});return new HYBCountdownView$1({model:new Backbone.Model(_.extend({},hash,modelJSON))}).$el})});var HYBDebugItemModel=function(_Backbone$Model){_inherits(HYBDebugItemModel,_Backbone$Model);var _super=_createSuper(HYBDebugItemModel);function HYBDebugItemModel(){_classCallCheck(this,HYBDebugItemModel);return _super.apply(this,arguments)}_createClass(HYBDebugItemModel,[{key:"initialize",value:function initialize(){}}]);return HYBDebugItemModel}(Backbone.Model);var HYBDebugItemModel$1=__AMD("extensions/adapt-hyb-debug/js/hyb-debugItemModel",HYBDebugItemModel);var HYBDebugPropView=function(_Backbone$View){_inherits(HYBDebugPropView,_Backbone$View);var _super=_createSuper(HYBDebugPropView);function HYBDebugPropView(){_classCallCheck(this,HYBDebugPropView);return _super.apply(this,arguments)}_createClass(HYBDebugPropView,[{key:"events",value:function events(){return{"input .js-hyb-debug-prop-input":"onInputChange","change .js-hyb-debug-prop-input":"onInputChange"}}},{key:"className",value:function className(){var classes=["hyb-debug__prop",this.model.get("_hasError")?"has-error":""];return classes.join(" ")}},{key:"onInputChange",value:function onInputChange(event){var $el=$(event.currentTarget);var val;var type=$el.attr("type");switch(type){case"number":val=$el.val();break;case"checkbox":val=$el.is(":checked");break;case"text":val=$el.val();break;default:throw"hyb-debugPropView: <input> type \"".concat(type,"\" is no yet supported.");}this.setModelVal(val);var changed=this.getModelVal()!=this._initialVal;this.$el.toggleClass("is-changed",changed)}},{key:"initialize",value:function initialize(){this._initialVal=this.getModelVal();this.render();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model,"change:_hasError",this.onHasError);this.onHasError(this.model,this.model.get("_hasError"))}},{key:"onHasError",value:function onHasError(model,hasError){this.$el.toggleClass("has-error",Boolean(hasError))}},{key:"render",value:function render(){var template=Handlebars.templates["hyb-debugProp"];var data=this.model.toJSON();try{data.val=this.getModelVal()}catch(err){Adapt.log.error("hyb-debugPropView.js: Could not initialize View for property: '".concat(this.model.get("_propertyName"),"'"));return}switch(_typeof(data.val)){case"boolean":data.type="checkbox";break;case"string":data.type="text";break;default:data.type="number";data.step=1;}this.$el.html(new Handlebars.SafeString(template(data)).string)}},{key:"getModelVal",value:function getModelVal(){var name=this.model.get("_propertyName").split(".");var val=this.model.get("_model").get(name[0]);name.shift();try{while(name.length){val=val[name[0]];name.shift()}}catch(err){this.model.set("_hasError",true)}return val}},{key:"setModelVal",value:function setModelVal(val){var name=this.model.get("_propertyName").split(".");if(name.length==1){return this.model.get("_model").set(this.model.get("_propertyName"),val)}try{var main=this.model.get("_model").get(name[0]);var prop=main;name.shift();while(name.length>1){prop=prop[name[0]];name.shift()}prop[name[0]]=val;var key=this.model.get("_propertyName").split(".")[0];this.model.get("_model").set(key,main);this.model.get("_model").trigger("change:".concat(key),this.model.get("_model"),main)}catch(err){this.model.set("_hasError",true)}return val}}]);return HYBDebugPropView}(Backbone.View);var HYBDebugPropView$1=__AMD("extensions/adapt-hyb-debug/js/hyb-debugPropView",HYBDebugPropView);var HYBDebugItemView=function(_Backbone$View){_inherits(HYBDebugItemView,_Backbone$View);var _super=_createSuper(HYBDebugItemView);function HYBDebugItemView(){_classCallCheck(this,HYBDebugItemView);return _super.apply(this,arguments)}_createClass(HYBDebugItemView,[{key:"events",value:function events(){return{"click .js-hyb-debug-item-copy":"copyToClipboard"}}},{key:"className",value:function className(){return"hyb-debug__item"}},{key:"initialize",value:function initialize(){this.render();this._items=[]}},{key:"render",value:function render(){var template=Handlebars.templates["hyb-debugItem"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}},{key:"track",value:function track(model,propertyName,title,_$parent){var $items=_$parent||this.$(".js-hyb-debug-props");var view=new HYBDebugPropView$1({model:new Backbone.Model({title:title||propertyName,_model:model,_propertyName:propertyName})});this._items.push(view);$items.append(view.$el);return view}},{key:"trackCollection",value:function trackCollection(collection,propertyName,title){var _this=this;var template=Handlebars.templates["hyb-debugCollection"];var $collection=$(new Handlebars.SafeString(template({title:title})).string);this.$(".js-hyb-debug-props").append($collection);var $props=$collection.find(".js-hyb-debug-collection-props");collection.each(function(model,idx){if(Array.isArray(propertyName)){var $group=$("<div>",{class:"hyb-debug__collection-props-group"});$props.append($group);propertyName.forEach(function(propName){var name=propName.split(".").pop();_this.track(model,propName,"[".concat(idx,"]*.").concat(name),$group)});return}_this.track(model,propertyName,"[".concat(idx,"]"),$props)})}},{key:"setProp",value:function setProp(propId,val){var $prop=this.$("input[data-id=\"".concat(propId,"\"]"));if(!$prop.length)throw"hyb-debugView.js: could not find prop with data-id=".concat(propTitle,".");$prop.val(val).trigger("change")}},{key:"setCopyFunc",value:function setCopyFunc(callback){this._copyFunc=callback;this.$(".js-hyb-debug-item-copy").show(0)}},{key:"copyToClipboard",value:function copyToClipboard(){if(!this._copyFunc)throw"hyb-debugItemView: Could not copy data (setCopyFunc() needs to be called first).";var arr=this._items.map(function(itemView){return itemView.getModelVal()});var copyText=this._copyFunc(arr);navigator.clipboard.writeText(copyText).then(function(){Adapt.log.debug("Debug data copied to clipboard.")},function(){Adapt.log.error("Debug data could not be copied (your browser doesn't support Clipboard API).")});this.$(".js-hyb-debug-item-copy").hide(0).fadeIn(500)}},{key:"remove",value:function remove(){_get(_getPrototypeOf(HYBDebugItemView.prototype),"remove",this).call(this)}}]);return HYBDebugItemView}(Backbone.View);var HYBDebugItemView$1=__AMD("extensions/adapt-hyb-debug/js/hyb-debugItemView",HYBDebugItemView);var HYBDebugView=function(_Backbone$View){_inherits(HYBDebugView,_Backbone$View);var _super=_createSuper(HYBDebugView);function HYBDebugView(){_classCallCheck(this,HYBDebugView);return _super.apply(this,arguments)}_createClass(HYBDebugView,[{key:"className",value:function className(){return"hyb-debug"}},{key:"initialize",value:function initialize(){this.model.set("_items",new Backbone.Collection([],{model:HYBDebugItemModel$1}))}},{key:"addItem",value:function addItem(data){var model=new HYBDebugItemModel$1(data);var view=new HYBDebugItemView$1({model:model});this.$el.append(view.$el);this.model.get("_items").push(model);return view}}]);return HYBDebugView}(Backbone.View);var HYBDebugView$1=__AMD("extensions/adapt-hyb-debug/js/hyb-debugView",HYBDebugView);var HYBDebug=function(_Backbone$Controller){_inherits(HYBDebug,_Backbone$Controller);var _super=_createSuper(HYBDebug);function HYBDebug(){_classCallCheck(this,HYBDebug);return _super.apply(this,arguments)}_createClass(HYBDebug,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"app:dataLoaded":this.onDataLoaded.bind(this),"app:dataReady":this.onDataReady.bind(this),"blockView:postRender":this.onBlockViewPostRender.bind(this),"pageView:ready":this.onPageViewReady.bind(this)})}},{key:"onDataReady",value:function onDataReady(){Adapt.hyb.debug=this}},{key:"onBlockViewPostRender",value:function onBlockViewPostRender(view){}},{key:"onDataLoaded",value:function onDataLoaded(){}},{key:"onPageViewReady",value:function onPageViewReady(pageView){var _menuData$_glossaries;var menuData=pageView.model.get("_menuData")||{};var glossaries=(menuData===null||menuData===void 0?void 0:(_menuData$_glossaries=menuData._glossaries)===null||_menuData$_glossaries===void 0?void 0:_menuData$_glossaries._items)||[];var titles=glossaries.map(function(e){return e.title});var dupeTitles=titles.filter(function(e,i){return titles.indexOf(e)!==i}).map(function(e){return"\"".concat(e,"\"")});if(dupeTitles.length)Adapt.log.error("Duplicate glossary term(s) detected:\n".concat(dupeTitles.join(", ")))}},{key:"initDebugWindow",value:function initDebugWindow(blockModel,title){if(!Adapt.isDebugEnabled()){return new Proxy({},{get:function(target,prop){if(target[prop]===undefined)return function(){};else return target[prop]}})}if(!(blockModel instanceof BlockModel$1)){throw"adapt-hyb-debug: initDebugWindow() 'blockModel' parameter must be an instance of BlockModel"}return this.getBlockModelDebugView(blockModel).addItem({title:title||"UNDEFINED"})}},{key:"getBlockModelDebugView",value:function getBlockModelDebugView(blockModel){if(blockModel.get("_hybDebug")){return blockModel.get("_hybDebug")._view}var view=new HYBDebugView$1({model:new Backbone.Model({_parent:blockModel})});blockModel.set("_hybDebug",{_view:view});Adapt.findViewByModelId(blockModel.get("_id")).$el.after(view.$el);return view}}]);return HYBDebug}(Backbone.Controller);new HYBDebug;var HYBDownloadView=function(_Backbone$View){_inherits(HYBDownloadView,_Backbone$View);var _super=_createSuper(HYBDownloadView);function HYBDownloadView(){_classCallCheck(this,HYBDownloadView);return _super.apply(this,arguments)}_createClass(HYBDownloadView,[{key:"tagName",value:function tagName(){return"div"}},{key:"className",value:function className(){var classes=["hyb-download","hyb-iconbtn-parent"];return classes.join(" ")}},{key:"events",value:function events(){return{"click .js-hyb-download-anchor":"onAnchorClick"}}},{key:"initialize",value:function initialize(){this.render()}},{key:"render",value:function render(){var _this=this;var template=Handlebars__default["default"].templates["hyb-download"];this.$el.html(new Handlebars__default["default"].SafeString(template(this.model.toJSON())).string);_.delay(function(){_this.__attempts=3;_this.setupAnchor()},0)}},{key:"setupAnchor",value:function setupAnchor(){var $parent=this.$(".js-hyb-download-btn");if(!$parent.length){this.__attempts--;if(this.__attempts<0){throw"HYBDownloadView.js: could not setupAnchor after multiple attempts ({{#hyb-iconBtn}} still hasn't rendered)."}_.delay(this.setupAnchor.bind(this),100);return}$parent.append(this.$(".js-hyb-download-anchor"))}},{key:"onAnchorClick",value:function onAnchorClick(){this.$(".js-hyb-download-btn").toggleClass("is-complete",true)}}]);return HYBDownloadView}(Backbone.View);var HYBDownloadView$1=__AMD("extensions/adapt-hyb-download/js/hyb-downloadView",HYBDownloadView);Adapt.on("router:page",function(){Handlebars__default["default"].registerHelperEl("download",function(){var data=Handlebars__default["default"].getContextHash.apply(this,arguments);data._download=data.download;var modelJSON=_.extend({},data,{tooltip:data._isExternal?"Right-click and select \u2018Save link as...\u2019 to save this file to your device.":""});return new HYBDownloadView$1({model:new Backbone.Model(modelJSON)}).$el})});var HYBDragDrop$1=function(_Backbone$Model){_inherits(HYBDragDrop,_Backbone$Model);var _super=_createSuper(HYBDragDrop);function HYBDragDrop(){_classCallCheck(this,HYBDragDrop);return _super.apply(this,arguments)}_createClass(HYBDragDrop,[{key:"defaults",value:function defaults(){return{_drags:null,_drops:null,$getDrag:null,$getDrop:null}}},{key:"initialize",value:function initialize(){var _this$get;this.get("_drags").each(this.setupDrag.bind(this));(_this$get=this.get("_drops"))===null||_this$get===void 0?void 0:_this$get.each(this.setupDrop.bind(this));this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.get("_drags"),{"change:_isGrabbed":this.onDragGrabbedChange,"change:_drop":this.onDragDropChange});this.listenTo(this.get("_drops"),{"change:_isHovered":this.onDropHoveredChange})}},{key:"onDragGrabbedChange",value:function onDragGrabbedChange(dragModel,isGrabbed){this.$getDrag(dragModel).toggleClass("is-grabbed",isGrabbed).toggleClass("is-released",!isGrabbed)}},{key:"onDropHoveredChange",value:function onDropHoveredChange(dropModel,isHovered){this.$getDrop(dropModel).toggleClass("is-hovered",isHovered)}},{key:"onDragDropChange",value:function onDragDropChange(dragModel,dropModel){if(!dropModel){var prevDropModel=dragModel.previousAttributes()._drop;if(!prevDropModel)return;prevDropModel._removeDrag(dragModel);return}dropModel._addDrag(dragModel);var $drag=this.$getDrag(dragModel);var $drop=this.$getDrop(dropModel);$drag.offset($drop.offset())}},{key:"$getDrag",value:function $getDrag(model){return this.get("$getDrag")(model)}},{key:"$getDrop",value:function $getDrop(model){return this.get("$getDrop")(model)}},{key:"setupDrop",value:function setupDrop(dropModel){var $drop=this.$getDrop(dropModel);dropModel.set("_drags",[]);dropModel._removeDrag=function(dragModel){var drags=dropModel.get("_drags");var idx=drags.indexOf(dragModel);if(idx!==-1){drags.splice(idx,1)}dropModel.set("_drags",drags);dropModel.trigger("change:_drags",dropModel,drags)};dropModel._addDrag=function(dragModel){var drags=dropModel.get("_drags");var idx=drags.indexOf(dragModel);if(idx===-1){drags.push(dragModel)}dropModel.set("_drags",drags);dropModel.trigger("change:_drags",dropModel,drags)};dropModel._isFull=function(){return dropModel.get("_drags").length>=dropModel.get("_capacity")};$drop.addClass("hyb-dragdrop__drop")}},{key:"setupDrag",value:function setupDrag(dragModel){var _this2=this;var $drag=this.$getDrag(dragModel);$drag.addClass("hyb-dragdrop__drag").toggleClass("is-graphic",Boolean(this.get("_isGraphic")));var drops=this.get("_drops");dragModel.dragRevert=function(){dragModel.set("_isGrabbed",false);dragModel.set("_drop",null);dragModel.set("_dropHover",null);$drag.css({top:0,left:0})};dragModel.dragLock=function(){dragModel.set("_isLocked",true);$drag.draggable("option","disabled",true);$drag.toggleClass("is-locked",true)};try{$drag.draggable("destroy")}catch(err){}$drag.draggable({containment:this.$el,scroll:false,start:function(event,ui){var _this2$get;dragModel.set("_isGrabbed",true);dragModel.set("_drop",null);drops===null||drops===void 0?void 0:drops.each(function(dropModel){dropModel.$el=_this2.$getDrop(dropModel)});(_this2$get=_this2.get("onStart"))===null||_this2$get===void 0?void 0:_this2$get.call(_this2,dragModel,$drag)},drag:_.throttle(function(event,ui){var _dropModel,_this2$get2;if(!drops)return;var dragBB=$drag[0].getBoundingClientRect();var dragCenter={left:dragBB.left+dragBB.width/2,top:dragBB.top+dragBB.height/2};var dropModel=null;drops.each(function(model){var dropBB=model.$el[0].getBoundingClientRect();model.set("_isHovered",false);if(model._isFull())return;if(dragCenter.left<dropBB.left)return;if(dragCenter.left>dropBB.left+dropBB.width)return;if(dragCenter.top<dropBB.top)return;if(dragCenter.top>dropBB.top+dropBB.height)return;dropModel=model});dragModel.set("_dropHover",dropModel);(_dropModel=dropModel)===null||_dropModel===void 0?void 0:_dropModel.set("_isHovered",true);(_this2$get2=_this2.get("onDrag"))===null||_this2$get2===void 0?void 0:_this2$get2.call(_this2,dragModel,$drag)},10),stop:function(){var _this2$get3;dragModel.set("_isGrabbed",false);$drag.css({left:0,top:0});if(dragModel.get("_dropHover")){dragModel.set("_drop",dragModel.get("_dropHover"));dragModel.set("_dropHover",null)}drops===null||drops===void 0?void 0:drops.each(function(model){model.set("_isHovered",false)});(_this2$get3=_this2.get("onStop"))===null||_this2$get3===void 0?void 0:_this2$get3.call(_this2,dragModel,$drag)}})}}]);return HYBDragDrop}(Backbone.Model);var HYBDragDropController=__AMD("extensions/adapt-hyb-dragDrop/js/hyb-dragDropController",HYBDragDrop$1);var HYBDragDrop=function(_Backbone$Controller){_inherits(HYBDragDrop,_Backbone$Controller);var _super=_createSuper(HYBDragDrop);function HYBDragDrop(){_classCallCheck(this,HYBDragDrop);return _super.apply(this,arguments)}_createClass(HYBDragDrop,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"app:dataReady":this.onDataReady.bind(this)})}},{key:"onDataReady",value:function onDataReady(){Adapt.hyb.dragDrop=function(options){options._drops.each(function(drop){if(!drop.get("_capacity"))drop.set("_capacity",1)});var controller=new HYBDragDropController(options);return controller}}}]);return HYBDragDrop}(Backbone.Controller);new HYBDragDrop;var HYBDrawerModel=function(_Backbone$Model){_inherits(HYBDrawerModel,_Backbone$Model);var _super=_createSuper(HYBDrawerModel);function HYBDrawerModel(){_classCallCheck(this,HYBDrawerModel);return _super.apply(this,arguments)}_createClass(HYBDrawerModel,[{key:"defaults",value:function defaults(){return{"_isActive":false}}},{key:"initialize",value:function initialize(){}},{key:"toggle",value:function toggle(val){this.set("_isActive",val===undefined?!this.get("_isActive"):Boolean(val))}}]);return HYBDrawerModel}(Backbone.Model);var HYBDrawerModel$1=__AMD("extensions/adapt-hyb-drawer/js/hyb-drawerModel",HYBDrawerModel);var HYBDrawerView=function(_Backbone$View){_inherits(HYBDrawerView,_Backbone$View);var _super=_createSuper(HYBDrawerView);function HYBDrawerView(){_classCallCheck(this,HYBDrawerView);return _super.apply(this,arguments)}_createClass(HYBDrawerView,[{key:"className",value:function className(){var classes=["hyb-drawer"];return classes.join(" ")}},{key:"events",value:function events(){return{"click .js-hyb-drawer-controls-close":"onControlsCloseClick"}}},{key:"initialize",value:function initialize(){this.render();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model,{"change:_isActive":this.onActiveChange});this.listenTo(this.model.get("_parent").getParent(),"change:_isHybActive",this.onParentHybActiveChange)}},{key:"onParentHybActiveChange",value:function onParentHybActiveChange(blockModel,isHybActive){if(isHybActive)return;this.toggle(false)}},{key:"onControlsCloseClick",value:function onControlsCloseClick(event){this.toggle(false)}},{key:"onActiveChange",value:function onActiveChange(event,isActive){this.$el.toggleClass("is-active",isActive);$("html").toggleClass("hyb-drawer-active");var $target=this.model.get("_$target");var $parentEl=this.model.get("_isNotifyParent")?$target.closest(".notify"):Adapt.findViewByModelId(this.model.get("_parent").get("_id")).$el;var $targetFigureItem=$target.parents(".hyb-figure__item");var $offsetEl=$target;var targetNestDepth=this.model.get("_targetNestDepth");if(targetNestDepth>0)$offsetEl=$targetFigureItem.eq(targetNestDepth-1);$parentEl.find(".hyb-figure__item").each(function(i,e){if($(e).is($targetFigureItem)){if(isActive){$target.siblings().visibilityOut().addClass("is-hyb-drawer-hidden")}else{$target.siblings().visibilityIn().removeClass("is-hyb-drawer-hidden")}return true}if(isActive){$(e).visibilityOut().addClass("is-hyb-drawer-hidden")}else{$(e).visibilityIn().removeClass("is-hyb-drawer-hidden")}});if(isActive){var myWidth=this.$el.outerWidth();var $block=this.$el.closest(".block, .notify__popup");var targetWidth=$target.outerWidth();var targetHeight=$target.outerHeight();var blockOffset=$block.offset();var targetOffset=$target.offset();targetOffset.left-=blockOffset.left;targetOffset.top-=blockOffset.top;var blockWidth=$block.outerWidth();var blockHeight=$block.outerHeight();var dest={top:(blockHeight-targetHeight)/2,left:(blockWidth-myWidth-targetWidth)/2};$offsetEl.toggleClass("has-hyb-drawer-offset",true).toggleClass("is-hyb-drawer-offset",true).animate({top:dest.top-targetOffset.top,left:dest.left-targetOffset.left},{duration:800,easing:"swing"})}else{$offsetEl.toggleClass("is-hyb-drawer-offset",false).animate({top:0,left:0},{duration:800,easing:"swing"})}}},{key:"render",value:function render(){var _this=this;var template=Handlebars.templates["hyb-drawer"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);this.$(".js-hyb-drawer-content").append(this.model.get("_view").$el);var width=this.model.get("_width");if(width)this.$el.css("width",width+"%");_.delay(function(){Adapt.scrollfix.setupSimpleBar(_this.$el)},1000)}},{key:"toggle",value:function toggle(val){this.model.toggle(val)}}]);return HYBDrawerView}(Backbone.View);var HYBDrawerView$1=__AMD("extensions/adapt-hyb-drawer/js/hyb-drawerView",HYBDrawerView);var HYBDrawer=function(_Backbone$Controller){_inherits(HYBDrawer,_Backbone$Controller);var _super=_createSuper(HYBDrawer);function HYBDrawer(){_classCallCheck(this,HYBDrawer);return _super.apply(this,arguments)}_createClass(HYBDrawer,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"app:dataReady":this.onDataReady.bind(this)})}},{key:"onDataReady",value:function onDataReady(){Adapt.hyb.drawer=function(options){if(!options)throw"Adapt.hyb.drawer: 'options' object must be provided.";if(!options._view||!(options._view instanceof Backbone.View))throw"Adapt.hyb.drawer: 'options._view' must be defined.";if(!options._parent)throw"Adapt.hyb.initSizingGrid: 'options._parent' object must be defined.";if(!options._$target)options._$target=$();if(options._targetNestDepth!==undefined&&(options._targetNestDepth<0||isNaN(options._targetNestDepth)))throw"Adapt.hyb-drawer: If 'options._targetNestDepth' is being used, it must be a whole number >= 0 (".concat(options._targetNestDepth,")");var model=new HYBDrawerModel$1(options);var view=new HYBDrawerView$1({model:model});try{var $notify=options._$target.closest(".notify__popup");if($notify.length){model.set("_isNotifyParent",true);$notify.append(view.$el);return view}}catch(err){}var blockView=Adapt.findViewByModelId(options._parent.getParent().get("_id"));blockView.$(".block__inner").append(view.$el);return view}}}]);return HYBDrawer}(Backbone.Controller);new HYBDrawer;var HYBExtraLearningPopupView=function(_Backbone$View){_inherits(HYBExtraLearningPopupView,_Backbone$View);var _super=_createSuper(HYBExtraLearningPopupView);function HYBExtraLearningPopupView(){_classCallCheck(this,HYBExtraLearningPopupView);return _super.apply(this,arguments)}_createClass(HYBExtraLearningPopupView,[{key:"className",value:function className(){return"hyb-extralearning-popup "+(this.model.get("_classes")||"")}},{key:"events",value:function events(){return{"click .js-extralearning-icon":"closePopup"}}},{key:"initialize",value:function initialize(){this.setUpEventListeners();this.render();this.playAudio()}},{key:"playAudio",value:function playAudio(){Adapt.ddAudio.play(this.model.get("_audioId"),0)}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenToOnce(Adapt,"notify:opened",this.onOpened);this.listenTo(Adapt,"notify:closed",this.onNotifyClosed)}},{key:"closePopup",value:function closePopup(){Adapt.trigger("notify:close")}},{key:"onOpened",value:function onOpened(){this.setUpIconTransition()}},{key:"onNotifyClosed",value:function onNotifyClosed(notifyView){if(notifyView.model.get("_view")!==this)return;this.$el.addClass("is-closed").removeClass("is-active");var $close=this.$el.closest(".notify").find(".js-notify-close-btn");$close.fadeOut()}},{key:"remove",value:function remove(){this.model.trigger("remove");_get(_getPrototypeOf(HYBExtraLearningPopupView.prototype),"remove",this).call(this)}},{key:"render",value:function render(){var data=this.model.toJSON();data.view=this;var template=Handlebars.templates["hyb-extraLearningPopup"];this.$el.html(template(data))}},{key:"setUpIconTransition",value:function setUpIconTransition(){this.alignIconToParent();this.$el.hide(0).addClass("transition-enabled").show(0).addClass("is-active")}},{key:"alignIconToParent",value:function alignIconToParent(){var parentView=this.model.get("_parentView");var $icon=this.$(".js-hyb-extralearning-icon");var $parentIcon=parentView.$(".js-hyb-extralearning-icon");$icon.css({"transform":""});var iconBB=$icon[0].getBoundingClientRect();var parentIconBB=$parentIcon[0].getBoundingClientRect();var offset={top:parentIconBB.top-iconBB.top,left:parentIconBB.left-iconBB.left};var scale=parentIconBB.width/iconBB.width;this.$el.css({"transform":"translate("+offset.left+"px, "+offset.top+"px) scale("+scale+")"});$parentIcon.addClass("u-visibility-hidden");return $icon}}]);return HYBExtraLearningPopupView}(Backbone.View);var ExtraLearningPopupView=__AMD("extensions/adapt-hyb-extraLearning/js/hyb-extraLearningPopupView",HYBExtraLearningPopupView);var ExtraLearningView=function(_Backbone$View){_inherits(ExtraLearningView,_Backbone$View);var _super=_createSuper(ExtraLearningView);function ExtraLearningView(){_classCallCheck(this,ExtraLearningView);return _super.apply(this,arguments)}_createClass(ExtraLearningView,[{key:"className",value:function className(){var classnames=["hyb-extralearning","hyb-extralearning--"+this.model.get("_type"),"hyb-iconbtn-parent"];return classnames.join(" ")}},{key:"tagName",value:function tagName(){return"div"}},{key:"events",value:function events(){return{"click .js-hyb-extralearning-btn":"onClick"}}},{key:"initialize",value:function initialize(){this.loadAnimationData();this.render()}},{key:"setUpViewData",value:function setUpViewData(){this.popupView=null;this._isPopupOpen=false}},{key:"loadAnimationData",value:function loadAnimationData(){var _this=this;var animPath="assets/adapt-hyb-extraLearning/".concat(this.model.get("_type"));this.animLoadedPromise=new Promise(function(resolve){$.getJSON(animPath+"/anim.json",function(json){_this.model.set("_animationData",json);_this.model.set("_animationAssetsPath",animPath+"/images/");resolve()})})}},{key:"render",value:function render(){var template=Handlebars.templates["hyb-extraLearning"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}},{key:"onClick",value:function(){var _onClick=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return this.animLoadedPromise;case 2:this.openPopup();case 3:case"end":return _context.stop();}},_callee,this)}));function onClick(){return _onClick.apply(this,arguments)}return onClick}()},{key:"openPopup",value:function openPopup(){if(this._isPopupOpen)return;this._isPopupOpen=true;var popupModel=new Backbone.Model(_.extend({},this.model.get("_popupData"),{_parent:this.model.get("_componentParent"),_parentView:this,_type:this.model.get("_type"),_animationData:this.model.get("_animationData"),_animationAssetsPath:this.model.get("_animationAssetsPath"),buttonText:this.model.get("buttonText")}));this.popupView=new ExtraLearningPopupView({model:popupModel});this.notifyView=Adapt.notify.popup({_view:this.popupView,_isCancellable:true,_showCloseButton:true,_classes:"hyb-extralearning hyb-extralearning--".concat(this.model.get("_type"))});this.listenTo(Adapt,{"notify:closed":this.onPopupClosed});this.listenToOnce(popupModel,"remove",this.onPopupRemoved)}},{key:"onPopupClosed",value:function onPopupClosed(notifyView){if(notifyView.model.get("_view")!==this.popupView)return;this.stopListening(Adapt,"notify:closed",this.onPopupClosed);this.$el.addClass("is-visited");this._isPopupOpen=false;Adapt.ddAudio.pauseAllAudio()}},{key:"onPopupRemoved",value:function onPopupRemoved(){this.$(".js-hyb-extralearning-icon").removeClass("u-visibility-hidden")}}]);return ExtraLearningView}(Backbone.View);var HYBExtraLearningView=__AMD("extensions/adapt-hyb-extraLearning/js/hyb-extraLearningView",ExtraLearningView);var DEFAULTS={digdeeper:{title:"Dig deeper"},funfact:{title:"Fun fact"},healthychoices:{title:"Healthy choices"},hottip:{title:"Hot tip"},nutshell:{title:"In a nutshell"}};Adapt.on("router:page",function(){_.each(DEFAULTS,function(e,key){Adapt.ddAudio.loadAudio("extraLearning-"+key,["assets/adapt-hyb-extraLearning/"+key+"/audio.mp3","assets/adapt-hyb-extraLearning/"+key+"/audio.ogg"])});Handlebars.registerHelperEl("extraLearning",function(){var context=arguments[arguments.length-1];var hash=context.hash;var componentModel=Handlebars.getComponentModelFromContext(context);var id=hash.id;var popupData=_.find(componentModel.get("_extraLearning")._items,function(extraLearningItem){return extraLearningItem._id==id});if(!popupData)throw"{{#extraLearning}}: Could not find _extraLearning._items element with _id: \""+id+"\"";var type=popupData._type;var buttonText;try{buttonText=DEFAULTS[type].title;if(!buttonText)throw""}catch(err){throw"{{#extraLearning}}: Could not find data for type: ".concat(type)}if(popupData.title&&buttonText.toLowerCase()==popupData.title.toLowerCase()){throw"{{#extraLearning}}: Do not set the \"title\" property to \"".concat(popupData.title,"\" (only set the \"title\" if it's unique).\n\nIn component: ").concat(componentModel.get("_id"))}var audioId="extraLearning-"+type;popupData._audioId=audioId;var modelJSON={content:context.fn?context.fn(this):undefined,buttonText:buttonText,_type:type,_componentParent:componentModel,_popupData:popupData};return new HYBExtraLearningView({model:new Backbone.Model(_.extend({},hash,modelJSON))}).$el})});var HYBFigureItemView=function(_Backbone$View){_inherits(HYBFigureItemView,_Backbone$View);var _super=_createSuper(HYBFigureItemView);function HYBFigureItemView(){_classCallCheck(this,HYBFigureItemView);return _super.apply(this,arguments)}_createClass(HYBFigureItemView,[{key:"events",value:function events(){if(!Adapt.isDebugEnabled())return{};var debugAttr="[data-debug-id='".concat(this.model.get("_debugId"),"']");var e={};e["click .js-hyb-figure-item-debug-btn"+debugAttr]="onDebugBtnClick";e["blur .js-hyb-figure-item-debug-input"+debugAttr]="onDebugInputBlur";e["input .js-hyb-figure-item-debug-input"+debugAttr]="onDebugInputChange";e["change .js-hyb-figure-item-debug-input"+debugAttr]="onDebugInputChange";return e}},{key:"initialize",value:function initialize(){this.setUpModelData();this.setupEventListeners();_.delay(this.postRender.bind(this),0)}},{key:"setUpModelData",value:function setUpModelData(){this.model.set("content",this.$(".js-hyb-figure-item-inner").html())}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model,{"change:_isReady":this.onReady});this.$el.imageready(this.onDeviceResize.bind(this));if(!Adapt.isDebugEnabled())return;this.listenTo(this.model,{"change:_width":this.updateWidth,"change:_rawWidth":this.updateWidth})}},{key:"onDebugBtnClick",value:function onDebugBtnClick(event){var _this$model$get;if($(event.currentTarget).attr("data-debug-id")!==this.model.get("_debugId"))return;var $btn=$(event.currentTarget);var $debug=$btn.closest(".js-hyb-figure-item-debug");$debug.addClass("is-active");$debug.find(".js-hyb-figure-item-debug-input").first().focus().val(parseFloat((_this$model$get=this.model.get("_rawWidth"))!==null&&_this$model$get!==void 0?_this$model$get:"",10)).css("text-indent",this.model.get("_id").length/1.5+"rem")}},{key:"onDebugInputBlur",value:function onDebugInputBlur(event){var $input=$(event.currentTarget);var $debug=$input.closest(".js-hyb-figure-item-debug");$debug.removeClass("is-active")}},{key:"onDebugInputChange",value:function onDebugInputChange(event){var $input=this.$(".js-hyb-figure-item-debug-input[data-debug-id=\"".concat(this.model.get("_debugId"),"\"]"));var $el=$(event.currentTarget);if(!$el.is($input))return;var val=$el.val();if(isNaN(val))return;this.model.set("_rawWidth",val);this.$el.addClass("debug-width-change")}},{key:"updateWidth",value:function updateWidth(){var width=this.model.get("_width");if(width){this.$el.css({width:width+"%"});this.$el.attr("data-hyb-figure-width",this.model.get("_rawWidth"))}}},{key:"onReady",value:function onReady(model,isReady){if(!isReady)return;this.$el.addClass("is-ready")}},{key:"onDeviceResize",value:function onDeviceResize(){}},{key:"postRender",value:function postRender(){this.updateWidth();this.$el.addClass(!isNaN(this.model.get("_justify"))?"justify-".concat(this.model.get("_justify")):"").addClass(!isNaN(this.model.get("_align"))?"align-".concat(this.model.get("_align")):"");this.model.set("_isReady",true)}}]);return HYBFigureItemView}(Backbone.View);var HYBFigureItemView$1=__AMD("extensions/adapt-hyb-figure/js/hyb-figureItemView",HYBFigureItemView);var SCROLLING_THEMES=["bubble"];function renderFigureItem(){var data=Handlebars.getContextHash.apply(this,arguments);if(data.id===undefined)throw"{{#hyb-item}}: \"id\" property must be defined.";var d={_id:data.id};data._id=d._id;var debugEnabled=Adapt.isDebugEnabled();data._debugEnabled=debugEnabled;if(debugEnabled){d._debugId=_.uniqueId("figureItem");data._debugId=d._debugId}data.data=JSON.stringify(d);if(data._id==="s"){data._hasScroll=true}else{var themes=data.theme;if(themes){themes=themes.split(" ");_.find(SCROLLING_THEMES,function(theme){if(themes.indexOf(theme)>=0){data._hasScroll=true;return true}})}}var html=Handlebars.templates["hyb-figureItem"](data);return new Handlebars.SafeString(html)}Handlebars.registerHelper("hyb-item",renderFigureItem);var HYBFigureView=function(_Backbone$View){_inherits(HYBFigureView,_Backbone$View);var _super=_createSuper(HYBFigureView);function HYBFigureView(){_classCallCheck(this,HYBFigureView);return _super.apply(this,arguments)}_createClass(HYBFigureView,[{key:"className",value:function className(){var classes=["hyb-figure",this.model.get("class")||""];return classes.join(" ")}},{key:"tagName",value:function tagName(){return"div"}},{key:"attributes",value:function attributes(){var attr={};if(this.model.get("style"))attr.style=this.model.get("style");if(this.model.get("name"))attr.name=this.model.get("name");return attr}},{key:"initialize",value:function initialize(){this.render();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){}},{key:"render",value:function render(){var _this=this;var template=Handlebars.templates["hyb-figure"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);this.$(".js-hyb-figure-item").each(function(i,e){var modelData={};try{modelData=JSON.parse($(e).attr("data-model"));$(e).removeAttr("data-model")}catch(err){modelData={}}var itemData=_.find(_this.model.get("_items"),function(item){return modelData._id==item._id});if(!itemData){var $parent=_this.$(".js-hyb-figure-group-item").filter("[data-hyb-figure-id=\"".concat(modelData._id,"\"]"));if(!$parent.length){throw"hyb-figureView.js: could not find figure item/group for \"_id\": \"".concat(modelData._id,"\"!\n\n(Did you remember to add \"").concat(modelData._id,"\" into \"_grid._areas\"?)")}$parent.append($(e));return}modelData=_.extend({},modelData,itemData,{_parent:_this.model});var itemModel=new Backbone.Model(modelData);new HYBFigureItemView$1({model:itemModel,el:e});if(!Adapt.isDebugEnabled())return;_this.listenTo(itemModel,"change:_rawWidth",_this.onItemRawWidthChange)})}},{key:"onItemRawWidthChange",value:function onItemRawWidthChange(itemModel,rawWidth){var id=itemModel.get("_id");var justify=itemModel.get("_justify");var $grid=this.$(".js-hyb-figure-grid").first();var gridAutoColumns=$grid.css("grid-auto-columns").split(" ").map(function(e){return parseFloat(e,10)});var areas=$grid.css("grid-template-areas").substring(1);areas=areas.substring(0,areas.length-1);areas=areas.replaceAll("\" \"",",");areas=areas.split(",");areas=areas.map(function(e){return e.split(" ")});var idx=-1;areas.find(function(y,yIdx){y.find(function(x,xIdx){if(x===id){idx=xIdx;return true}});if(idx>=0)return true});if(justify!==1&&gridAutoColumns.length!=1){gridAutoColumns[idx]=rawWidth;if(idx>0)gridAutoColumns[idx-1]=100-rawWidth;if(idx<2)gridAutoColumns[idx+1]=100-rawWidth}else{var colWidth=gridAutoColumns[idx]/gridAutoColumns.reduce(function(a,b){return a+b},0)*100;var fakeWidth=rawWidth/colWidth*100;itemModel.set("_width",fakeWidth)}$grid.css("grid-auto-columns",gridAutoColumns.map(function(e){return e+"fr"}).join(" "))}}]);return HYBFigureView}(Backbone.View);var HYBFigureView$1=__AMD("extensions/adapt-hyb-figure/js/hyb-figureView",HYBFigureView);var alphanumerals=["a","b","c","d","e","f","g","h","i"];var HYBFigureModel=function(_Backbone$Model){_inherits(HYBFigureModel,_Backbone$Model);var _super=_createSuper(HYBFigureModel);function HYBFigureModel(){_classCallCheck(this,HYBFigureModel);return _super.apply(this,arguments)}_createClass(HYBFigureModel,[{key:"initialize",value:function initialize(){this.setUpCustoms();this.setUpGrid()}},{key:"setUpCustoms",value:function setUpCustoms(){var customs=this.get("grid")._customs;if(!customs){this.get("grid")._customs=[];return}if(customs.length>alphanumerals.length){throw"hyb-figureModel.js: \"_grid._customs\" array can't contain more than ".concat(alphanumerals.length," elements (you have ").concat(customs.length,").")}_.each(customs,function(item,idx){if(item._isEnabled===false)return;item._isEnabled=true;item._id=alphanumerals[idx]});this.get("grid")._customs=customs}},{key:"setUpGrid",value:function setUpGrid(){var _this$get,_this=this;var customs=((_this$get=this.get("grid"))===null||_this$get===void 0?void 0:_this$get._customs)||[];var styles=[];var classes=[];var areas=[];var items=[];_.forEach(this.get("grid")._areas,function(row,y){_.forEach(row,function(cell,x){var data=cell.trim().toLowerCase();if(!data)return;var id=data.match(/[a-z]/ig);if(!id){Adapt.log.error("Unsupported value in _grid._area: \"".concat(data,"\""));throw""}id.forEach(function(a){if(alphanumerals.includes(a)){var c=customs.find(function(e){return e._id==a});if(!c)Adapt.log.error("hyb-figureModel.js: Could not find element in \"_grid._customs\" array for area \"".concat(a,"\"."),customs)}});if(id.length>1){if(!_this.get("grid")._groups)_this.get("grid")._groups=[];_this.get("grid")._groups.push({_isEnabled:true,_id:id.join(""),_items:id})}id=id.join("");var width=data.match(/[\d.]+/g);if(width)width=parseFloat(width[0],10);else width=undefined;if(width){var mismatch=_.find(_.filter(areas,function(area){return area.id==id}),function(area){return area.width&&area.width!=width});if(mismatch){Adapt.log.error("The same id cannot have multiple different \"_areas\" widths:\n    ".concat(id).concat(mismatch.width," & ").concat(id).concat(width));throw""}}areas.push({id:id,width:width,x:x,y:y});var item=_.find(items,function(item){return item._id==id});if(!item)items.push({_id:id,_width:width,_justify:x,_align:y});else if(width)items._width=width})});var minX,minY;minX=minY=Infinity;var maxX,maxY;maxX=maxY=-Infinity;_.forEach(areas,function(area){minX=Math.min(minX,area.x);minY=Math.min(minY,area.y);maxX=Math.max(maxX,area.x);maxY=Math.max(maxY,area.y)});var gridWidth=maxX-minX+1;var gridHeight=maxY-minY+1;var grid=new Array(gridHeight).fill(0).map(function(){return new Array(gridWidth).fill(null)});_.forEach(areas,function(area){grid[area.y-minY][area.x-minX]=area});var rows=[];var emptyCount=0;var gridTemplateAreas=[];_.forEach(grid,function(row){var map=_.map(row,function(cell){if(cell){return cell.id}else{return"z".concat(emptyCount++)}});rows.push("\"".concat(map.join(" "),"\""));gridTemplateAreas.push(map)});styles.push("grid-template-areas: ".concat(rows.join(" "),";"));var colWidths=[];var totalColWidth=0;var manualColCount=0;var middleWidth=undefined;_.forEach(areas,function(area){if(area.x==1){middleWidth=area.width||colWidths[area.x-minX]||middleWidth;colWidths[area.x-minX]=-2;return}colWidths[area.x-minX]=area.width||colWidths[area.x-minX]||-1});if(colWidths.length==3&&colWidths[1]===undefined)colWidths[1]=-2;_.forEach(colWidths,function(colWidth){totalColWidth+=colWidth>0?colWidth:0;manualColCount+=colWidth!=-2?1:0});if(totalColWidth>100){Adapt.log.error("hyb-figure: Total combined width of columns cannot exceed 100%",colWidths.join(" "),this.get("_parent").get("_id"));throw""}var autoColWidth=(100-totalColWidth)/(colWidths.length-manualColCount);colWidths=_.map(colWidths,function(e){return e<0||!e?autoColWidth:e});styles.push("grid-auto-columns: ".concat(_.map(colWidths,function(e){return isNaN(e)?"auto":e+"fr"}).join(" "),";"));if(minY!=maxY){var rowHeights=[];for(var i=minY;i<=maxY;i++){switch(i){case 0:case 2:rowHeights.push("min-content");break;default:rowHeights.push("minmax(0px, 1fr)");}}styles.push("grid-auto-rows: ".concat(rowHeights.join(" "),";"))}this.set("_gridClass",classes.join(" "));this.set("_gridStyle",styles.join(" "));_.each(items,function(item){if(!item._width)return;var columns=[];_.each(gridTemplateAreas,function(row){_.each(row,function(cell,col){if(cell==item._id){columns.push(col)}})});columns=_.unique(columns);var parentWidth=0;_.each(columns,function(e){parentWidth+=colWidths[e]});item._rawWidth=item._width;item._width=item._width/(parentWidth/colWidths.reduce(function(a,b){return a+b},0)*100)*100});this.set("_items",items)}}]);return HYBFigureModel}(Backbone.Model);var HYBFigureModel$1=__AMD("extensions/adapt-hyb-figure/js/hyb-figureModel",HYBFigureModel);var HYBFigure=function(_Backbone$Controller){_inherits(HYBFigure,_Backbone$Controller);var _super=_createSuper(HYBFigure);function HYBFigure(){_classCallCheck(this,HYBFigure);return _super.apply(this,arguments)}_createClass(HYBFigure,[{key:"initialize",value:function initialize(){Adapt.on("router:page",this.onRouterPage)}},{key:"onRouterPage",value:function onRouterPage(){Handlebars.registerHelperEl("hyb-figure",function(){var context=arguments[arguments.length-1];var componentModel=Handlebars.getComponentModelFromContext(context);var hash=JSON.parse(JSON.stringify(context.hash));var modelJSON=_.extend({},hash,{content:context.fn(this),_parent:componentModel});return new HYBFigureView$1({model:new HYBFigureModel$1(modelJSON)}).$el})}}]);return HYBFigure}(Backbone.Controller);var hybFigure=new HYBFigure;Adapt.hybFigure=hybFigure;var HYBIconBtnView=function(_Backbone$View){_inherits(HYBIconBtnView,_Backbone$View);var _super=_createSuper(HYBIconBtnView);function HYBIconBtnView(){_classCallCheck(this,HYBIconBtnView);return _super.apply(this,arguments)}_createClass(HYBIconBtnView,[{key:"className",value:function className(){var classes=["hyb-iconbtn",this.model.get("class")||""];return classes.join(" ")}},{key:"initialize",value:function initialize(){this.render();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){}},{key:"render",value:function render(){var template=Handlebars.templates["hyb-iconBtn"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}}]);return HYBIconBtnView}(Backbone.View);var HYBIconBtnView$1=__AMD("extensions/adapt-hyb-iconBtn/js/hyb-iconBtnView",HYBIconBtnView);var HYBIconBtn=function(_Backbone$Controller){_inherits(HYBIconBtn,_Backbone$Controller);var _super=_createSuper(HYBIconBtn);function HYBIconBtn(){_classCallCheck(this,HYBIconBtn);return _super.apply(this,arguments)}_createClass(HYBIconBtn,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"router:page":this.onRouterPage})}},{key:"onRouterPage",value:function onRouterPage(){Handlebars.registerHelperEl("hyb-iconBtn",function(){var context=arguments[arguments.length-1];var modelJSON=_.extend({},context.hash,{content:context.fn(this)});return new HYBIconBtnView$1({model:new Backbone.Model(modelJSON)}).$el})}}]);return HYBIconBtn}(Backbone.Controller);new HYBIconBtn;var HYBMainDebugView=function(_Backbone$View){_inherits(HYBMainDebugView,_Backbone$View);var _super=_createSuper(HYBMainDebugView);function HYBMainDebugView(){_classCallCheck(this,HYBMainDebugView);return _super.apply(this,arguments)}_createClass(HYBMainDebugView,[{key:"className",value:function className(){return"hyb-maindebug"}},{key:"events",value:function events(){return{"click .js-hyb-maindebug-toggle":"onToggleClick","click .js-hyb-maindebug-prev":"onPrevClick","click .js-hyb-maindebug-next":"onNextClick"}}},{key:"initialize",value:function initialize(){this.render();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.__isCtrlDown=false;$(document).on("keydown",this.onKeyDown.bind(this));$(document).on("keyup",this.onKeyUp.bind(this))}},{key:"onKeyDown",value:function onKeyDown(event){if(this.__isCtrlDown)return;if(event.which===17){$("html").toggleClass("mode-debug");this.__isCtrlDown=true;return}}},{key:"onKeyUp",value:function onKeyUp(event){if(event.which===17){$("html").toggleClass("mode-debug");this.__isCtrlDown=false;return}}},{key:"render",value:function render(){var template=Handlebars.templates["hyb-mainDebug"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}},{key:"onToggleClick",value:function onToggleClick(){try{var _Adapt$debug;(_Adapt$debug=Adapt.debug)===null||_Adapt$debug===void 0?void 0:_Adapt$debug.toggle()}catch(_unused){$("html").toggleClass("mode-debug")}}}]);return HYBMainDebugView}(Backbone.View);var HYBMainDebugView$1=__AMD("extensions/adapt-hyb-main/js/hyb-mainDebugView",HYBMainDebugView);var HYB=function(_Backbone$Controller){_inherits(HYB,_Backbone$Controller);var _super=_createSuper(HYB);function HYB(){_classCallCheck(this,HYB);return _super.apply(this,arguments)}_createClass(HYB,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"app:dataReady":this.onDataReady.bind(this),"blockView:postRender":this.onBlockViewPostRender,"componentView:preRender":this.onComponentViewPreRender,"componentView:postRender":this.onComponentViewPostRender,"notify:open":this.onNotifyOpened,"notify:closed":this.onNotifyClosed})}},{key:"onDataReady",value:function onDataReady(){var _Adapt$debug,_this=this;this.renderSVGFilters();this.initHelpers();if((_Adapt$debug=Adapt.debug)!==null&&_Adapt$debug!==void 0&&_Adapt$debug._isEnabled){this.initDebug()}$("html").addClass("mode-hyb hyb");Adapt.blocks.each(function(blockModel){_this.extendBlockModel(blockModel)});Adapt.getAllComponents().each(function(componentModel){_this.extendComponentModel(componentModel)});$.fn.invisible=function(){return this.each(function(){$(this).css("visibility","hidden");$(this).toggleClass("hyb-visibility-hidden",true)})};$.fn.visible=function(){return this.each(function(){$(this).css("visibility","visible");$(this).toggleClass("hyb-visibility-hidden",false)})};$.fn.toggleVisibility=function(val){return this.each(function(){if(val!==undefined){$(this).css("visibility",val?"visible":"hidden")}else{$(this).css("visibility",$(this).css("visibility")=="hidden"?"visible":"hidden")}$(this).toggleClass("hyb-visibility-hidden",$(this).css("visibility")=="hidden")})};$.fn.visibilityOut=function(duration,callback){return this.each(function(){var _this2=this;$(this).toggleClass("hyb-visibility-hidden",true);$(this).css({"visibility":"visible","opacity":1});$(this).animate({"opacity":0},duration===undefined?500:duration,function(){$(_this2).css("visibility","hidden");if(callback)callback()})})};$.fn.visibilityIn=function(duration,callback){return this.each(function(){var _this3=this;$(this).toggleClass("hyb-visibility-hidden",false);$(this).css({"visibility":"visible","opacity":0});$(this).animate({"opacity":1},duration===undefined?500:duration,function(){$(_this3).css("visibility","visible");if(callback)callback()})})}}},{key:"renderSVGFilters",value:function renderSVGFilters(){var template=Handlebars.templates["hyb-filters"];$("body").append($(template()))}},{key:"extendBlockModel",value:function extendBlockModel(blockModel){blockModel.isHybActive=function(){if(!Adapt.hybMenu)return true;return Boolean(this.get("_isHybActive"))};blockModel.isHybVisited=function(){if(!Adapt.hybMenu)return true;return Boolean(this.get("_isHybVisited"))}}},{key:"extendComponentModel",value:function extendComponentModel(componentModel){var blockModel=componentModel.getParent();componentModel.listenTo(blockModel,"change:_isHybActive",function(blockModel,isHybActive){if(Boolean(blockModel._previousAttributes._isHybActive)==Boolean(isHybActive))return;if(!isHybActive){if(componentModel.hybReset){componentModel.hybReset()}}});componentModel.hasCompletionConditions=function(){var _componentModel$get;return Boolean((_componentModel$get=componentModel.get("_completionConditions"))===null||_componentModel$get===void 0?void 0:_componentModel$get.length)};componentModel.onCompletionConditionsComplete=function(callback){if(!componentModel.hasCompletionConditions()||componentModel.get("_isCompletionConditionsComplete")){callback();return}componentModel.listenToOnce(componentModel,"change:_isCompletionConditionsComplete",callback)};componentModel.createCompletionCondition=function(){var conditions=componentModel.get("_completionConditions");if(!conditions){conditions=new Backbone.Collection;var check=_.debounce(function(){var notReady=conditions.find(function(e){return!Boolean(e.get("_isComplete"))});componentModel.set("_isCompletionConditionsComplete",!Boolean(notReady))},10);componentModel.set("_isCompletionConditionsComplete",false);componentModel.set("_completionConditions",conditions);componentModel.listenTo(conditions,"change reset add remove change:_isComplete",check);var _setCompletionStatus=componentModel.setCompletionStatus;componentModel.setCompletionStatus=function(){_.delay(function(){componentModel.onCompletionConditionsComplete(_setCompletionStatus.bind(componentModel))},0)}}var condition=new Backbone.Model({_isComplete:false});conditions.add(condition);Adapt.log.info("Completion condition added to '".concat(componentModel.get("_id"),"'."));return function(){condition.set("_isComplete",true)}}}},{key:"onBlockViewPostRender",value:function onBlockViewPostRender(blockView){}},{key:"onNotifyOpened",value:function onNotifyOpened(view){}},{key:"onNotifyClosed",value:function onNotifyClosed(view){Adapt.ddVideo.pauseAllMedia()}},{key:"onComponentViewPostRender",value:function onComponentViewPostRender(componentView){var view=componentView;var model=componentView.model;var setCompletionOn=model.get("_setCompletionOn");switch(setCompletionOn){case"visited":var block=model.getParent();if(block.isHybVisited())view.setCompletionStatus();else model.listenTo(block,"change:_isHybVisited",view.setCompletionStatus.bind(view));break;case"interact":try{var children=model.getChildren();model.listenTo(children,"change:_isVisited",view.setCompletionStatus.bind(view))}catch(err){Adapt.log.error("\"_setCompletionOn\": \"interact\" is not supported by components of type \"".concat(model.get("_component"),"\"."))}break;}}},{key:"onComponentViewPreRender",value:function onComponentViewPreRender(componentView){var audio=componentView.model.get("_audio");if(!audio)return;var audioId=componentView.model.get("_id")+"-onview";Adapt.ddAudio.loadAudio(audioId,[audio.mp3,audio.ogg]);componentView.listenTo(componentView.model.getParent(),"change:_isHybActive",function(model,isHybActive){if(!isHybActive)return;_.delay(function(){Adapt.ddAudio.play(audioId,0)},10)})}},{key:"initHelpers",value:function initHelpers(){var helpers={"theme":function(themeString){if(!themeString)return"";var themes=themeString.split(" ").map(function(theme){return"theme-".concat(theme)});return themes.join(" ")}};for(var name in helpers){if(helpers.hasOwnProperty(name)){Handlebars.registerHelper(name,helpers[name])}}}},{key:"initDebug",value:function initDebug(){$("body").append(new HYBMainDebugView$1({model:new Backbone.Model}).$el)}}]);return HYB}(Backbone.Controller);var hyb=new HYB;Adapt.hyb=hyb;Adapt.hyb._isEnabled=true;Adapt.hyb._isDecorativeAudioEnabled=true;Adapt.isHYBMode=function(){var _Adapt$hyb;return Boolean((_Adapt$hyb=Adapt.hyb)===null||_Adapt$hyb===void 0?void 0:_Adapt$hyb._isEnabled)};var HYBMenuBuffer=function(_Backbone$Model){_inherits(HYBMenuBuffer,_Backbone$Model);var _super=_createSuper(HYBMenuBuffer);function HYBMenuBuffer(){_classCallCheck(this,HYBMenuBuffer);return _super.apply(this,arguments)}_createClass(HYBMenuBuffer,[{key:"initialize",value:function initialize(){var q;this._isReady=new Promise(function(res){q=res});this._isReady.resolve=q;this.listenTo(Adapt,{"app:dataReady":this.onDataReady,"articleView:postRender":this.onRouterPage,"blockView:postRender":this.onBlockViewPostRender,"loading:start":this.onLoadingStart,"loading:end":this.onLoadingEnd})}},{key:"_postMessage",value:function _postMessage(){this.get("_parent")._postMessage.apply(this,arguments)}},{key:"onLoadingStart",value:function onLoadingStart(){this._postMessage("loading:start")}},{key:"onLoadingEnd",value:function onLoadingEnd(){this._postMessage("loading:end")}},{key:"onDataReady",value:function onDataReady(){var _Adapt$config$get,_Adapt$config$get2;this._bufferPrev=((_Adapt$config$get=Adapt.config.get("_hybMenu"))===null||_Adapt$config$get===void 0?void 0:_Adapt$config$get._blockBufferPrev)||1;this._bufferNext=((_Adapt$config$get2=Adapt.config.get("_hybMenu"))===null||_Adapt$config$get2===void 0?void 0:_Adapt$config$get2._blockBufferNext)||1;Adapt.getAllComponents().each(function(componentModel){componentModel.set("_isAvailable",false)});this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(Adapt.blocks,{"change:_isHybActive":this.onBlockHybActiveChange.bind(this),"change:_isHybRendered":this.onBlockHybRenderedChange.bind(this),"change:_isReady":this.onBlockReadyChange.bind(this)})}},{key:"onRouterPage",value:function onRouterPage(){var _this=this;setTimeout(function(){return _this._isReady.resolve()},0)}},{key:"onBlockReadyChange",value:function onBlockReadyChange(blockModel,isReady){var view=Adapt.findViewByModelId(blockModel.get("_id"));if(!view)return;view.$el.toggleClass("is-not-ready",!isReady)}},{key:"onBlockHybActiveChange",value:function onBlockHybActiveChange(blockModel,isHybActive){if(!isHybActive)return;var idxStart=blockModel.collection.indexOf(blockModel)-this._bufferPrev;var idxEnd=idxStart+this._bufferPrev+this._bufferNext;idxStart=Math.max(idxStart,0);idxEnd=Math.min(idxEnd,blockModel.collection.length-1);for(var i=idxStart;i<=idxEnd;i++){blockModel.collection.at(i).set("_isHybRendered",true)}if(blockModel.getChildren().filter(function(e){return!e.get("_isReady")}).length){var _Adapt$ddLoading;(_Adapt$ddLoading=Adapt.ddLoading)===null||_Adapt$ddLoading===void 0?void 0:_Adapt$ddLoading.show()}}},{key:"onBlockHybRenderedChange",value:function(){var _onBlockHybRenderedChange=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(blockModel,isHybRendered){var _Adapt$ddLoading2;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(isHybRendered){_context.next=2;break}return _context.abrupt("return");case 2:_context.next=4;return this._isReady;case 4:(_Adapt$ddLoading2=Adapt.ddLoading)===null||_Adapt$ddLoading2===void 0?void 0:_Adapt$ddLoading2.recalc();blockModel.getChildren().each(function(componentModel){componentModel.set("_isAvailable",true)});case 6:case"end":return _context.stop();}},_callee,this)}));function onBlockHybRenderedChange(_x,_x2){return _onBlockHybRenderedChange.apply(this,arguments)}return onBlockHybRenderedChange}()},{key:"renderAvailableComponents",value:function(){var _renderAvailableComponents=_asyncToGenerator(_regeneratorRuntime().mark(function _callee2(blockView){var models,ids,forceUntilId,model,template,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return this._isReady;case 2:models=blockView.model.getChildren().filter(function(model){return model.get("_isAvailable")&&!model.get("_isRendered")&&!model.get("_isReady")});ids=_.indexBy(models,function(model){return model.get("_id")});forceUntilId=function(event){var addingId=event.model.get("_id");if(!ids[addingId])return;event.force();event.model.set("_isHybMenuRendered",true);var notRendered=models.find(function(m){return!m.get("_isHybMenuRendered")});if(notRendered)return;Adapt.off("view:addChild",forceUntilId)};Adapt.on("view:addChild",forceUntilId);_context2.prev=6;_context2.next=9;return blockView.addChildren();case 9:_context2.next=11;return blockView.whenReady();case 11:_context2.next=25;break;case 13:_context2.prev=13;_context2.t0=_context2["catch"](6);Adapt.log.error("\nAn unexpected error has occured in block '".concat(blockView.model.get("_id"),"'!\n-------------------------------------------------------------------"),_context2.t0);model=blockView.model;model.set("_isRendered",true);model.set("_isReady",true);model.set("_isFatal",true);model.set("_fatalErr",_context2.t0);model.getChildren().each(function(model){return model.set("_isReady",true)});template=Handlebars.templates["hyb-menu-buffer-blockError"];data={};blockView.$el.append($(new Handlebars.SafeString(template(data)).string));case 25:case"end":return _context2.stop();}},_callee2,this,[[6,13]])}));function renderAvailableComponents(_x3){return _renderAvailableComponents.apply(this,arguments)}return renderAvailableComponents}()},{key:"onBlockViewPostRender",value:function onBlockViewPostRender(blockView){var _this2=this;this.renderAvailableComponents(blockView);blockView.listenTo(blockView.model,"change:_isHybRendered",function(blockModel,isHybRendered){if(!isHybRendered)return;_this2.renderAvailableComponents(blockView)})}}]);return HYBMenuBuffer}(Backbone.Model);var HYBMenuBuffer$1=__AMD("extensions/adapt-hyb-menu/js/adapt-hyb-menu-buffer",HYBMenuBuffer);var HYBMenu=function(_Backbone$Model){_inherits(HYBMenu,_Backbone$Model);var _super=_createSuper(HYBMenu);function HYBMenu(){_classCallCheck(this,HYBMenu);return _super.apply(this,arguments)}_createClass(HYBMenu,[{key:"initialize",value:function initialize(){this.set("_routeBlockId",undefined);this.handleRoute=_.debounce(this.handleRoute.bind(this),0);this.listenTo(Adapt,{"router:plugin":this.handleRoute,"app:dataReady":this.onDataReady,"componentView:preRender":this.onComponentViewPreRender,"blockView:postRender":this.onBlockViewPostRender,"pageView:ready":this.onPageViewReady});this.listenTo(this,"change:_routeBlockId",this.onRouteBlockIdChange);window.addEventListener("message",this.onWindowMessage.bind(this));this.buffer=new HYBMenuBuffer$1({_parent:this})}},{key:"onWindowMessage",value:function onWindowMessage(event){var route=event.data.route;if(!route)return;var blockId=route.split("/");blockId=blockId[blockId.length-1];this.setActiveBlock(blockId)}},{key:"handleRoute",value:function handleRoute(){if(arguments.length<3)return;if((arguments.length<=1?undefined:arguments[1])!=="co-05")return;var blockId=arguments.length<=2?undefined:arguments[2];this.set("_routeBlockId",blockId)}},{key:"onRouteBlockIdChange",value:function onRouteBlockIdChange(model,blockId){var _this=this;Adapt.log.debug("adapt-hyb-menu.js: starting at ".concat(blockId,"."));_.defer(function(){Backbone.history.navigate("#/id/co-05",{trigger:true,replace:false});_this.setActiveBlock(blockId)})}},{key:"setActiveBlock",value:function setActiveBlock(blockId){this.set("_activeBlockId",blockId)}},{key:"onDataReady",value:function onDataReady(){this.extendComponentModels();this.extendBlockModels();this.setupEventListeners();this.listenTo(this,"change:_activeBlockId",this.onActiveBlockIdChange);if(this.get("_activeBlockId")){this.onActiveBlockIdChange(this,this.get("_activeBlockId"))}}},{key:"onComponentViewPreRender",value:function onComponentViewPreRender(componentView){var _setCompletionStatus=componentView.setCompletionStatus;componentView.setCompletionStatus=function(){var _arguments=arguments,_this2=this;var blockModel=componentView.model.getParent();if(blockModel.get("_isHybActive")){_setCompletionStatus.apply(this,arguments);return}var callback=function(blockModel,isHybActive){if(isHybActive){_.delay(function(){_setCompletionStatus.apply(_this2,_arguments)},0);componentView.stopListening(blockModel,"change:_isHybActive",callback)}};componentView.listenTo(blockModel,"change:_isHybActive",callback)}}},{key:"extendComponentModels",value:function extendComponentModels(){}},{key:"extendBlockModels",value:function extendBlockModels(){Adapt.blocks.each(function(blockModel){blockModel.checkIsHybComplete=function(){var isComplete=blockModel.get("_isComplete");var isHybVisited=blockModel.get("_isHybVisited");var incompleteChild=blockModel.getChildren().find(function(e){return!e.get("_isComplete")});if(incompleteChild)isComplete=false;else isComplete=true;blockModel.set("_isComplete",isComplete);var isHybComplete=isComplete&&isHybVisited;if(!isHybComplete)return false;blockModel.set("_isHybComplete",true);return true}})}},{key:"_postMessage",value:function _postMessage(messageStr,data){var parent=window.parent;parent.postMessage({message:messageStr,data:data})}},{key:"setupEventListeners",value:function setupEventListeners(){var _this3=this;Adapt.blocks.each(function(blockModel){blockModel.listenTo(blockModel,"change:_isHybComplete",function(model,isHybComplete){if(!isHybComplete)return;model.getChildren().each(function(child){child.set("_isHybComplete",true)});Adapt.log.info("[COMPLETE] ".concat(blockModel.get("_id")));_this3._postMessage("hyb-block-complete",{_id:blockModel.get("_id")})});blockModel.listenTo(blockModel.getChildren(),"change:_isHybComplete",function(componentModel,isHybComplete){if(!isHybComplete)return;var incomplete=Boolean(blockModel.getChildren().find(function(child){return!Boolean(child.get("_isHybComplete"))}));if(incomplete)return;blockModel.set("_isHybVisited",true);blockModel.set("_isHybComplete",true)},100);blockModel.listenTo(blockModel,"change:_isHybActive",function(blockModel,isHybActive){var _Adapt$notify,_Adapt$notify$_stack;if(!isHybActive)return;Adapt.ddVideo.pauseAllMedia();var notifyCount=((_Adapt$notify=Adapt.notify)===null||_Adapt$notify===void 0?void 0:(_Adapt$notify$_stack=_Adapt$notify._stack)===null||_Adapt$notify$_stack===void 0?void 0:_Adapt$notify$_stack.length)||0;for(var i=0;i<notifyCount;i++){Adapt.trigger("notify:close")}blockModel.set("_isHybVisited",true);blockModel.checkIsHybComplete()});blockModel.listenTo(blockModel,"change:_isComplete",function(blockModel,isComplete){if(!isComplete)return;blockModel.checkIsHybComplete()});blockModel.listenTo(blockModel.getChildren(),"change:_isComplete",function(componentModel,isComplete){if(!isComplete)return;blockModel.checkIsHybComplete()})})}},{key:"onActiveBlockIdChange",value:function onActiveBlockIdChange(model,blockId){var blockModel=Adapt.findById(blockId);if(!blockModel)throw"adapt-hyb-menu.js: could not find blockModel with \"_id\": \"".concat(blockId,"\".");Adapt.blocks.each(function(model){model.set("_isHybActive",model==blockModel)})}},{key:"onBlockViewPostRender",value:function onBlockViewPostRender(blockView){var _this4=this;var blockModel=blockView.model;blockView.listenTo(blockModel,"change:_isHybActive",function(blockModel,isHybActive){blockView.$el.toggleClass("is-hyb-active",isHybActive);if(!isHybActive)return;_this4.scrollToBlock(blockView)});blockModel.checkIsHybComplete()}},{key:"onPageViewReady",value:function onPageViewReady(){this._postMessage("hyb-page-ready");var activeBlock=Adapt.blocks.find(function(blockModel){return blockModel.get("_isHybActive")});if(!activeBlock)return;var blockView=Adapt.findViewByModelId(activeBlock.get("_id"));this.scrollToBlock(blockView);blockView.$el.toggleClass("is-hyb-active",true);activeBlock.checkIsHybComplete()}},{key:"scrollToBlock",value:function scrollToBlock(blockView){$("#app")[0].scrollTop=blockView.$el.offset().top;blockView.model.set("_isHybVisited",true)}},{key:"navToBlockId",value:function navToBlockId(blockId){this._postMessage("hyb-block-nav",{_id:blockId})}},{key:"setBlockHybComplete",value:function setBlockHybComplete(blockModel){blockModel.set("_isHybComplete",true)}}]);return HYBMenu}(Backbone.Model);var hybMenu=new HYBMenu;Adapt.hybMenu=hybMenu;Adapt.on("notify:opened",function(notifyView){notifyView.$(".js-notify-bg").on("click",function(event){if(event.target!=event.currentTarget)return;Adapt.trigger("notify:close")});notifyView.$previousActiveElement=$("body")});var HYBRecipePopupView=function(_Backbone$View){_inherits(HYBRecipePopupView,_Backbone$View);var _super=_createSuper(HYBRecipePopupView);function HYBRecipePopupView(){_classCallCheck(this,HYBRecipePopupView);return _super.apply(this,arguments)}_createClass(HYBRecipePopupView,[{key:"className",value:function className(){return"hyb-recipe-popup "+(this.model.get("_classes")||"")}},{key:"events",value:function events(){return{}}},{key:"initialize",value:function initialize(){this.setUpEventListeners();this.render()}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenToOnce(Adapt,"notify:closed",this.onClosed)}},{key:"onClosed",value:function onClosed(){this.$el.addClass("is-closed")}},{key:"render",value:function render(){var content=this.model.toJSON();var data={};data.view=this;data._content=content;var template=Handlebars.templates["hyb-recipePlus"];this.$el.html(template(data))}}]);return HYBRecipePopupView}(Backbone.View);var HYBRecipePopupView$1=__AMD("extensions/adapt-hyb-recipe/js/hyb-recipePopupView",HYBRecipePopupView);var HYBRecipeBtnView=function(_Backbone$View){_inherits(HYBRecipeBtnView,_Backbone$View);var _super=_createSuper(HYBRecipeBtnView);function HYBRecipeBtnView(){_classCallCheck(this,HYBRecipeBtnView);return _super.apply(this,arguments)}_createClass(HYBRecipeBtnView,[{key:"className",value:function className(){return"hyb-recipe"}},{key:"tagName",value:function tagName(){return"span"}},{key:"events",value:function events(){return{"click .js-hyb-recipe-btn":"onBtnClick"}}},{key:"initialize",value:function initialize(){this.setupEventListeners();this.setUpViewData();this.render()}},{key:"setupEventListeners",value:function setupEventListeners(){}},{key:"setUpViewData",value:function setUpViewData(){this.popupView=null;this._isPopupOpen=false}},{key:"render",value:function render(){var template=Handlebars.templates["hyb-recipe"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}},{key:"onBtnClick",value:function onBtnClick(){this.openPopup()}},{key:"openPopup",value:function openPopup(){this.model.set("_isVisited",true);this.model.set("_isComplete",true);if(this._isPopupOpen)return;this._isPopupOpen=true;this.popupView=new HYBRecipePopupView$1({model:this.model});Adapt.trigger("notify:popup",{_view:this.popupView,_isCancellable:true,_showCloseButton:true,_classes:"hyb-recipepopup "+(this.model.get("_classes")||"")});this.listenToOnce(Adapt,{"popup:closed":this.onPopupClosed})}},{key:"onPopupClosed",value:function onPopupClosed(){this.$el.addClass("is-visited");this._isPopupOpen=false}}]);return HYBRecipeBtnView}(Backbone.View);var HYBRecipeView=__AMD("extensions/adapt-hyb-recipe/js/hyb-recipeView",HYBRecipeBtnView);function getRecipeData(id){var pageModel=Adapt.findById(Adapt.location._currentId);var recipes=pageModel.get("_menuData")._recipes;var recipeData=_.find(recipes._items,function(g){return g._id==id});if(!recipeData){Adapt.log.error("{{#recipe}}: Could not find recipe in contentObjects.json with \"_id\": \"".concat(id,"\""));return{}}if(!recipeData._graphic){recipeData._graphic={src:"course/en/images/recipes/".concat(id,".jpg")}}recipeData.num="#"+recipeData._id;return recipeData}var hybRecipeCallback=function(){var context=arguments[arguments.length-1];var data=context.hash;var content=context.fn?context.fn(this):undefined;var componentModel;try{componentModel=Handlebars__default["default"].getComponentModelFromContext(context)}catch(err){}if(!data.id)throw"{{#recipe}}: \"id\" property must be defined.";var pageModel=Adapt.findById(Adapt.location._currentId);pageModel.get("_menuData")._recipes;var recipeData=getRecipeData(data.id);if(!recipeData||!Object.keys(recipeData).length)content="<span class=\"hyb-recipe__broken icon icon-link-broken\"></span> ".concat(content);var modelJSON=_.extend({},recipeData,{_parent:componentModel,content:content});return new HYBRecipeView({model:new Backbone.Model(modelJSON)}).$el};var recipeContentCallback=function(){var context=arguments[arguments.length-1];var data=context.hash;if(!data.id)throw"{{#recipeContent}}: \"id\" property must be defined.";var recipeData=getRecipeData(data.id);var template=Handlebars__default["default"].templates["hyb-recipePlus"];return"<div class=\"hyb-recipecontent ".concat(data.class||"","\">").concat(template({_content:recipeData}),"</div>")};Adapt.on("router:page",function(){Handlebars__default["default"].registerHelperEl("recipe",hybRecipeCallback);Handlebars__default["default"].registerHelperEl("hyb-recipe",hybRecipeCallback);Handlebars__default["default"].registerHelper("recipeContent",recipeContentCallback)});var HYBSectionBanner=function(_Backbone$Controller){_inherits(HYBSectionBanner,_Backbone$Controller);var _super=_createSuper(HYBSectionBanner);function HYBSectionBanner(){_classCallCheck(this,HYBSectionBanner);return _super.apply(this,arguments)}_createClass(HYBSectionBanner,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"router:page":this.onRouterPage})}},{key:"onRouterPage",value:function onRouterPage(){Handlebars.registerHelperEl("hyb-sectionBanner",function(){var context=arguments[arguments.length-1];var modelJSON=_.extend({},context.hash,{content:context.fn(this)});var template=Handlebars.templates["hyb-sectionBanner"];return new Handlebars.SafeString(template(modelJSON)).string})}}]);return HYBSectionBanner}(Backbone.Controller);new HYBSectionBanner;var HYBSizingView=function(_Backbone$View){_inherits(HYBSizingView,_Backbone$View);var _super=_createSuper(HYBSizingView);function HYBSizingView(){_classCallCheck(this,HYBSizingView);return _super.apply(this,arguments)}_createClass(HYBSizingView,[{key:"initialize",value:function initialize(){this.setupModelData();this.render();this.setupEventListeners()}},{key:"setupModelData",value:function setupModelData(){this.model.set("_debugBaseEnabled",false)}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model,{"change:_baseWidth":this.updateItemSizing,"change:_baseHeightRatio":this.updateItemSizing,"change:_debugBaseEnabled":this.onDebugBaseToggle});this.listenTo(this.model.get("_itemSizings"),{"change:_whRatio":this.updateItemSizing})}},{key:"onDebugBaseToggle",value:function onDebugBaseToggle(model,debugBaseEnabled){this.$el.find(".hyb-sizing-grid__debug-base").toggle(debugBaseEnabled)}},{key:"render",value:function render(){var cols=this.model.get("_cols");var hasCustomCols=false;try{hasCustomCols=Boolean(cols.length)}catch(err){}this.$el.addClass("hyb-sizing-grid").toggleClass("has-breaks",hasCustomCols).children().addClass("hyb-sizing-grid__item").addClass("js-hyb-sizing-grid-item");this.updateItemCols();var debugWindow=Adapt.hyb.debug.initDebugWindow(this.model.get("_parent").getParent(),"_itemSizing");debugWindow.track(this.model,"_debugBaseEnabled","Show base box");debugWindow.track(this.model,"_baseWidth","_base._width");debugWindow.track(this.model,"_baseHeightRatio","_base._heightRatio");debugWindow.trackCollection(this.model.get("_itemSizings"),"_whRatio","_item[*]._whRatio");this.updateItemSizing()}},{key:"updateItemCols",value:function updateItemCols(){var _this=this;var cols=this.model.get("_cols");if(!cols)return;if(!Array.isArray(cols)){if(typeof cols==="number"){var length=this.$(".js-hyb-sizing-grid-item").length;var _cols=[];while(length>0){_cols.push(Math.min(cols,length));length-=cols}cols=_cols;this.model.set("_cols",cols)}else{throw"hyb-sizingGridView.js: \"_cols\" property must be a numer | number array."}}var curIdx=0;cols.forEach(function(col){var $item=_this.$(".js-hyb-sizing-grid-item").filter("[data-index=".concat(curIdx+col-1,"]"));if(!$item.length){var _this$model$get;Adapt.log.error("hyb-sizingGridView.js: \"_cols\" values exceed number of items.",(_this$model$get=_this.model.get("_parent"))===null||_this$model$get===void 0?void 0:_this$model$get.get("_id"));return}if(curIdx+col==_this.model.get("_itemSizings").length)return;$item.after($("<div>",{class:"hyb-sizing-grid__break","aria-hidden":true}));curIdx+=col})}},{key:"updateItemSizing",value:function updateItemSizing(){var _this2=this;this.$el.imageready(function(){var baseWidth=_this2.model.get("_baseWidth");var baseHeightRatio=_this2.model.get("_baseHeightRatio");var itemSizings=_this2.model.get("_itemSizings");var absWidth=_this2.$el.outerWidth()*baseWidth/100;var absHeight=absWidth*baseHeightRatio;if(Adapt.isDebugEnabled()){var $debugBase=$("<div>",{class:"hyb-sizing-grid__debug-base debug",style:"width: ".concat(absWidth,"px; height: ").concat(absHeight,"px;")});_this2.$el.find(".hyb-sizing-grid__debug-base").remove();_this2.$el.prepend($debugBase);$debugBase.toggle(_this2.model.get("_debugBaseEnabled"))}itemSizings.each(function(sizingModel,idx){var sizing=sizingModel.toJSON();var $item=_this2.$el.children().filter("[data-index=".concat(idx,"]"));if($item.length!==1){Adapt.log.warn("hyb-sizingGridView: Could not find $item in $target (does the item have its 'data-index' attribute defined?)");return}$item.css({"width":"100%"});var $img=$item.find("img");var whRatio,ratio,wh;try{whRatio=sizing._whRatio.match(/([wh])([\d.]+)/);wh=whRatio[1];ratio=parseFloat(whRatio[2],10)}catch(err){Adapt.log.warnOnce("hyb-sizingGridView: _itemSizing._whRatio incorrectly formatted. Format must be: \"h*\" | \"w*\"",sizing);throw""}if(wh=="w"){var w=baseWidth*ratio;$item.css("width",w+"%");return}if(wh=="h"){var innerHeight=$img.outerHeight()||$item.outerHeight();var innerWidth=$img.outerWidth()||$item.outerWidth();var hRatio=absHeight/innerHeight;var wRatio=innerWidth/$item.outerWidth();var _w=hRatio*wRatio*100*ratio;$item.css("width",_w+"%");return}throw"hyb-sizingGridView: all _itemSizings must have a '_whRatio' defined!"});_this2.model.set("_isReady",true);_this2.model.trigger("update")})}},{key:"onReady",value:function onReady(onSuccess){if(this.model.get("_isReady")){onSuccess();return this}this.listenToOnce(this.model,"change:_isReady",onSuccess);return this}},{key:"onUpdate",value:function onUpdate(callback){this.listenTo(this.model,"update",callback);return this}}]);return HYBSizingView}(Backbone.View);var HYBSizingGridView=__AMD("extensions/adapt-hyb-sizing/js/hyb-sizingGridView",HYBSizingView);var HYBSizing=function(_Backbone$Controller){_inherits(HYBSizing,_Backbone$Controller);var _super=_createSuper(HYBSizing);function HYBSizing(){_classCallCheck(this,HYBSizing);return _super.apply(this,arguments)}_createClass(HYBSizing,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"app:dataReady":this.onDataReady.bind(this)})}},{key:"onDataReady",value:function onDataReady(){Adapt.hyb.initSizingGrid=function($target,options){if(!options)throw"Adapt.hyb.initSizingGrid: 'options' object must be provided.";if(!options._parent)throw"Adapt.hyb.initSizingGrid: 'options._parent' object must be defined.";if(!(options._parent instanceof ComponentModel$3))throw"Adapt.hyb.initSizingGrid: 'options._parent' must be a reference to a ComponentModel.";if(!options._itemSizings)throw"Adapt.hyb.initSizingGrid: 'options._itemSizings' must be defined.";if(!options._base||!options._base._width)throw"Adapt.hyb.initSizingGrid: 'options._base' must be defined.";options._base._heightRatio=options._base._heightRatio||1;var itemSizings=new Backbone.Collection(options._itemSizings,{model:Backbone.Model});var data={_parent:options._parent,_itemSizings:itemSizings,_cols:options._cols,_baseWidth:options._base._width,_baseHeightRatio:options._base._heightRatio};var model=new Backbone.Model(data);var view=new HYBSizingGridView({model:model,el:$target[0]});return view}}}]);return HYBSizing}(Backbone.Controller);new HYBSizing;var HYBSkipView=function(_Backbone$View){_inherits(HYBSkipView,_Backbone$View);var _super=_createSuper(HYBSkipView);function HYBSkipView(){_classCallCheck(this,HYBSkipView);return _super.apply(this,arguments)}_createClass(HYBSkipView,[{key:"className",value:function className(){return"hyb-skip hyb-iconbtn-parent"}},{key:"events",value:function events(){return{"click .js-hyb-skip-btn":"onBtnClick"}}},{key:"initialize",value:function initialize(){this.setupEventListeners();this.render()}},{key:"setupEventListeners",value:function setupEventListeners(){}},{key:"render",value:function render(){var template=Handlebars.templates["hyb-skip"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}},{key:"onBtnClick",value:function onBtnClick(){if(!Adapt.hybMenu){if(Adapt.isDebugEnabled())alert("adapt-hyb-skip: button disabled when not in menu build.");else Adapt.log.error("hyb-skip: could not change current block (adapt-hyb-menu extension not included in build).");return}var blockFrom=this.model.get("_blockFrom");var blockTo=this.model.get("_blockTo");var blockFromIdx=Adapt.blocks.indexOf(blockFrom);var blockToIdx=Adapt.blocks.indexOf(blockTo);Adapt.hybMenu.navToBlockId(blockTo.get("_id"));if(blockFromIdx>blockToIdx)return;for(var i=blockFromIdx;i<blockToIdx;i++){Adapt.hybMenu.setBlockHybComplete(Adapt.blocks.at(i))}}}]);return HYBSkipView}(Backbone.View);var HYBSkipView$1=__AMD("extensions/adapt-hyb-skip/js/hyb-skipView",HYBSkipView);Adapt.on("router:page",function(){Handlebars__default["default"].registerHelperEl("hyb-skip",function(){var context=arguments[arguments.length-1];var hash=context.hash;var componentModel=Handlebars__default["default"].getComponentModelFromContext(context);var id=hash.id;if(!id)throw"{{#hyb-skip}}: 'id' must be defined.";var targetBlock=Adapt.findById(id);if(!targetBlock)throw"{{#hyb-skip}}: Could not find block with \"_id\": \"".concat(id,"\".");var modelJSON=_.extend({},hash,{_parent:componentModel,_blockFrom:componentModel.getParent(),_blockTo:targetBlock,content:context.fn?context.fn(this):undefined});return new HYBSkipView$1({model:new Backbone.Model(_.extend({},hash,modelJSON))}).$el})});var HYBSlidePanelModel=function(_Backbone$Model){_inherits(HYBSlidePanelModel,_Backbone$Model);var _super=_createSuper(HYBSlidePanelModel);function HYBSlidePanelModel(){_classCallCheck(this,HYBSlidePanelModel);return _super.apply(this,arguments)}_createClass(HYBSlidePanelModel,[{key:"initialize",value:function initialize(){this.setupGrid();this.setupTheme();this.setupAudio()}},{key:"setupGrid",value:function setupGrid(){var grid=this.get("_grid");if(grid)return;grid={};grid._areas=[["","",""],["","s".concat(this.get("_width")||100),""],["","",""]];this.set("_grid",grid)}},{key:"setupTheme",value:function setupTheme(){var theme=this.get("_theme");if(theme===undefined)theme="bubble";this.set("_theme",theme)}},{key:"setupAudio",value:function setupAudio(){var audio=_.extend({},this.get("_audio"));if(!this.get("_audio")||audio._isEnabled===false)return;var audioName=_.uniqueId("slidePanelAudio");Adapt.ddAudio.loadAudio(audioName,[audio.mp3,audio.ogg]);audio._id=audioName;this.set("_audio",audio);this.set("_hasAudio",true)}},{key:"playAudio",value:function playAudio(){if(!this.get("_hasAudio"))return;var audioId=this.get("_audio")._id;Adapt.ddAudio.play(audioId,0)}}]);return HYBSlidePanelModel}(Backbone.Model);var HYBSlidePanelModel$1=__AMD("extensions/adapt-hyb-slidePanel/js/hyb-slidePanelModel",HYBSlidePanelModel);var HYBSlidePanelPopupView=function(_Backbone$View){_inherits(HYBSlidePanelPopupView,_Backbone$View);var _super=_createSuper(HYBSlidePanelPopupView);function HYBSlidePanelPopupView(){_classCallCheck(this,HYBSlidePanelPopupView);return _super.apply(this,arguments)}_createClass(HYBSlidePanelPopupView,[{key:"className",value:function className(){var classes=["hyb-slidepanel-popup",this.model.get("_classes")||""];return classes.join(" ")}},{key:"attributes",value:function attributes(){}},{key:"events",value:function events(){return{}}},{key:"initialize",value:function initialize(){this.setUpEventListeners();this.render()}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenToOnce(Adapt,"notify:closed",this.onClosed)}},{key:"onClosed",value:function onClosed(){this.$el.addClass("is-closed")}},{key:"render",value:function render(){var data=this.model.toJSON();data.view=this;var template=Handlebars.templates["hyb-slidePanelPopup"];this.$el.html(template(data))}}]);return HYBSlidePanelPopupView}(Backbone.View);var HYBSlidePanelPopupView$1=__AMD("extensions/adapt-hyb-slidePanel/js/hyb-slidePanelPopupView",HYBSlidePanelPopupView);var HYBSlidePanelBtnView=function(_Backbone$View){_inherits(HYBSlidePanelBtnView,_Backbone$View);var _super=_createSuper(HYBSlidePanelBtnView);function HYBSlidePanelBtnView(){_classCallCheck(this,HYBSlidePanelBtnView);return _super.apply(this,arguments)}_createClass(HYBSlidePanelBtnView,[{key:"className",value:function className(){var classes=["hyb-slidepanel","hyb-iconbtn-parent",this.model.get("_hasAudio")?"has-audio":""];return classes.join(" ")}},{key:"events",value:function events(){return{"click .js-hyb-slidepanel-btn":"onBtnClick"}}},{key:"initialize",value:function initialize(){this.setupEventListeners();this.setUpViewData();this.render()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model,{"change:_isComplete":this.onIsComplete,"change:_isActive":this.onActivechange})}},{key:"onActivechange",value:function onActivechange(model,isActive){this.$el.toggleClass("is-active",isActive)}},{key:"onIsComplete",value:function onIsComplete(model,isComplete){var _this$model$get;this.$(".js-hyb-slidepanel-btn").toggleClass("is-complete",isComplete);(_this$model$get=this.model.get("_completionCondition"))===null||_this$model$get===void 0?void 0:_this$model$get()}},{key:"setUpViewData",value:function setUpViewData(){this.popupView=null;this._isPopupOpen=false}},{key:"render",value:function render(){var _this=this;var template=Handlebars.templates["hyb-slidePanel"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);_.delay(function(){if(_this.$el.closest("[class*='u-oncomplete']").length){var _this$model$get2;Adapt.log.warn("hyb-slidePanel: triggering auto-completion due to ancestor .u-oncomplete-* element.");(_this$model$get2=_this.model.get("_completionCondition"))===null||_this$model$get2===void 0?void 0:_this$model$get2()}},100)}},{key:"onBtnClick",value:function onBtnClick(){this.openPopup()}},{key:"openPopup",value:function openPopup(){this.model.set("_isVisited",true);this.model.set("_isComplete",true);this.model.set("_isActive",true);if(this._isPopupOpen)return;this._isPopupOpen=true;this.popupView=new HYBSlidePanelPopupView$1({model:this.model});this.model.playAudio();Adapt.trigger("notify:popup",{_view:this.popupView,_isCancellable:true,_showCloseButton:true,_classes:"hyb-slidepanelpopup "+(this.model.get("_classes")||"")});this.listenToOnce(Adapt,{"popup:closed":this.onPopupClosed})}},{key:"onPopupClosed",value:function onPopupClosed(){this.model.set("_isActive",false);this.$el.addClass("is-visited");this.$el.addClass("is-complete");this._isPopupOpen=false}}]);return HYBSlidePanelBtnView}(Backbone.View);var HYBSlidePanelView=__AMD("extensions/adapt-hyb-slidePanel/js/hyb-slidePanelView",HYBSlidePanelBtnView);Adapt.on("router:page",function(){Handlebars__default["default"].registerHelperEl("hyb-slidePanel",function(){var context=arguments[arguments.length-1];var hash=context.hash;var componentModel=Handlebars__default["default"].getComponentModelFromContext(context);var id=hash.id;var popupData=_.find(componentModel.get("_hybSlidePanel")._items,function(spItem){return spItem._id==id});if(!popupData)throw"{{#hyb-slidePanel}}: Could not find '_hybSlidePanel._items' element with _id: \""+id+"\"";if(!componentModel.get("_isQuestionType")){if(!popupData._completionCondition){popupData._completionCondition=componentModel.createCompletionCondition()}}var title=popupData.title||"";var modelJSON=_.extend({},popupData,{_parent:componentModel,content:context.fn?context.fn(this):undefined,title:title});return new HYBSlidePanelView({model:new HYBSlidePanelModel$1(_.extend({},hash,modelJSON))}).$el})});var HYBSliderModel=function(_Backbone$Model){_inherits(HYBSliderModel,_Backbone$Model);var _super=_createSuper(HYBSliderModel);function HYBSliderModel(){_classCallCheck(this,HYBSliderModel);return _super.apply(this,arguments)}_createClass(HYBSliderModel,[{key:"defaults",value:function defaults(){return{_isActive:false,_controls:{_hideClose:false,_hideNav:false,_hideProgress:false}}}},{key:"initialize",value:function initialize(){this.set("_items",this.get("_parent").getChildren());this.set("_itemCount",this.getChildren().length);if(this.get("_itemCount")<=1){this.get("_controls")._hideNav=true;this.get("_controls")._hideProgress=true}this.setupBackgrounds()}},{key:"setupBackgrounds",value:function setupBackgrounds(){var items=this.getChildren();if(this.get("_hasBackgroundOffsets")===undefined){var hasBGOffset=Boolean(items.find(function(itemModel){var _itemModel$get;return Boolean((_itemModel$get=itemModel.get("_background"))===null||_itemModel$get===void 0?void 0:_itemModel$get._offset)}));if(hasBGOffset)this.set("_hasBackgroundOffsets")}var hasBody=Boolean(items.find(function(item){var _item$get;return Boolean((_item$get=item.get("_background"))===null||_item$get===void 0?void 0:_item$get.body)}));this.set("_hasBackgroundBody",hasBody);items.each(function(itemModel){try{var bg=itemModel.get("_background");if(!bg||!bg.src)return;bg._srcType=bg.src.split(".").slice(-1)[0];if(bg._srcType==="svg"){Adapt.log.warnOnce("hyb-sliderModel.js: SVGs as slider backgrounds can be unpredictable on iOS.","'".concat(bg.src,"'"))}itemModel.set("_background",bg)}catch(err){}})}},{key:"toggle",value:function toggle(val){if(val===undefined){this.set("_isActive",!this.get("_isActive"));return}this.set("_isActive",val)}},{key:"toJSON",value:function toJSON(){var json=_get(_getPrototypeOf(HYBSliderModel.prototype),"toJSON",this).call(this);json._items=this.getChildren().toJSON();return json}},{key:"getChildren",value:function getChildren(){return this.get("_items")}},{key:"getItem",value:function getItem(idx){return this.get("_parent").getItem.apply(this.get("_parent"),arguments)}},{key:"getActiveItem",value:function getActiveItem(){return this.get("_parent").getActiveItem.apply(this.get("_parent"),arguments)}},{key:"setActiveItem",value:function setActiveItem(){return this.get("_parent").setActiveItem.apply(this.get("_parent"),arguments)}},{key:"resetActiveItems",value:function resetActiveItems(){return this.get("_parent").resetActiveItems.apply(this.get("_parent"),arguments)}}]);return HYBSliderModel}(Backbone.Model);var HYBSliderModel$1=__AMD("extensions/adapt-hyb-slider/js/hyb-sliderModel",HYBSliderModel);var HYBSliderView=function(_Backbone$View){_inherits(HYBSliderView,_Backbone$View);var _super=_createSuper(HYBSliderView);function HYBSliderView(){_classCallCheck(this,HYBSliderView);return _super.apply(this,arguments)}_createClass(HYBSliderView,[{key:"events",value:function events(){return{"click .js-hyb-slider-controls-left":"onNavigationClick","click .js-hyb-slider-controls-right":"onNavigationClick","click .js-hyb-slider-progress":"onProgressClick","click .js-hyb-slider-controls-close":"onClickControlsClose"}}},{key:"initialize",value:function initialize(){this.render();this.setupEventListeners();this.setupBG=_.debounce(this.setupBG.bind(this),100);this.$(".js-hyb-slider-bg").first().imageready(this.setupBG.bind(this))}},{key:"setupEventListeners",value:function setupEventListeners(){this.setActiveDebounced=_.debounce(this.setActiveDebounced.bind(this),0);this.listenTo(this.model,{"change:_isActive":this.onActiveChange});this.listenTo(this.model.getChildren(),{"change:_isActive":this.onItemActiveChange,"change:_isComplete":this.onItemCompleteChange,"change:_background":this.onItemBackgroundChange})}},{key:"onActiveChange",value:function onActiveChange(model,isActive){this.$el.toggleClass("is-active",isActive);if(isActive){var $sliderElm=this.$(".js-hyb-slider-slider");$sliderElm.hide(0).show(0);this.$(".js-hyb-slider-bg").first().hide(0).show(0)}if(isActive){this.$el.visibilityIn()}else{this.$el.visibilityOut()}}},{key:"onItemBackgroundChange",value:function onItemBackgroundChange(itemModel,background){if(!itemModel.get("_isActive"))return;var $bg=this.$(".js-hyb-slider-bg").first();$bg.css({opacity:(background===null||background===void 0?void 0:background.opacity)!==undefined?background.opacity:1,transform:(background===null||background===void 0?void 0:background._offset)!==undefined?"translateX(".concat(background._offset,"%)"):"none"})}},{key:"setActiveDebounced",value:function setActiveDebounced(isActive){this.model.set("_isActive",isActive)}},{key:"onItemActiveChange",value:function onItemActiveChange(itemModel,isActive){Adapt.ddVideo.pauseAllMedia();var itemIdx=itemModel.get("_index");this.$getItemProgress(itemModel).toggleClass("is-active",isActive);var $item=this.$(".js-hyb-slider-item").filter("[data-index=".concat(itemIdx,"]")).first();$item.toggleClass("is-active",isActive);if(isActive)$item.removeAttr("aria-hidden");else $item.attr("aria-hidden",true);var $bg=this.$(".js-hyb-slider-bg").first();var $bgItem=this.$(".js-hyb-slider-bg-item").filter("[data-index=".concat(itemIdx,"]")).first();$bgItem.toggleClass("is-active",isActive);var background=itemModel.get("_background");$bg.css({opacity:(background===null||background===void 0?void 0:background.opacity)!==undefined?background.opacity:1,transform:(background===null||background===void 0?void 0:background._offset)!==undefined?"translateX(".concat(background._offset,"%)"):"none"});if(!this.model.getActiveItem()){this.setActiveDebounced(false);return}if(!isActive)return;this.moveSliderToIndex(itemModel.get("_index"));this.setActiveDebounced(true)}},{key:"setupBG",value:function setupBG(){var _this=this;var hasOffsets=Boolean(this.model.getChildren().find(function(itemModel){var _itemModel$get;return(_itemModel$get=itemModel.get("_background"))===null||_itemModel$get===void 0?void 0:_itemModel$get._offset}));if(!hasOffsets)return;this.model.getChildren().each(function(itemModel){var bg=itemModel.get("_background");if(!bg)return;var $bgItem=_this.$(".js-hyb-slider-bg-item").filter("[data-index=".concat(itemModel.get("_index"),"]")).first();var color="inherit";if(bg.src){var $img=$bgItem.find(".js-hyb-slider-bg-item-img").first();color=_this._getImgPixel($img[0],bg._offset>0?0:($img[0].naturalWidth||$img[0].clientWidth)-1,0)}var $ext=$("<div>",{class:"hyb-slider__bg-item-ext is-".concat(bg._offset>0?"left":"right"),style:"background-color: ".concat(color,";")});$bgItem.append($ext)})}},{key:"_getImgPixel",value:function _getImgPixel(imgEl,x,y){var canvas=document.createElement("canvas");canvas.width=1;canvas.height=1;canvas.getContext("2d").drawImage(imgEl,x,y,1,1,0,0,1,1);var data=canvas.getContext("2d").getImageData(0,0,1,1).data;return"rgba(".concat(data[0],", ").concat(data[1],", ").concat(data[2],", ").concat(data[3]/255,")")}},{key:"onItemCompleteChange",value:function onItemCompleteChange(itemModel,isComplete){this.$getItemProgress(itemModel).toggleClass("is-complete",isComplete)}},{key:"$getItemProgress",value:function $getItemProgress(itemModel){return this.$(".js-hyb-slider-progress").filter("[data-index=".concat(itemModel.get("_index"),"]"))}},{key:"onClickControlsClose",value:function onClickControlsClose(){this.model.resetActiveItems()}},{key:"moveSliderToIndex",value:function moveSliderToIndex(itemIndex){var offset=this.model.get("_itemWidth")*itemIndex;if(Adapt.config.get("_defaultDirection")==="ltr"){offset*=-1}var cssValue="translateX("+offset+"%)";var $sliderElm=this.$(".js-hyb-slider-slider").first();$sliderElm.css("transform",cssValue);if(Adapt.config.get("_disableAnimation")||this._isInitial){this.onTransitionEnd()}else{$sliderElm.one("transitionend",this.onTransitionEnd.bind(this))}this.$el.attr("data-active-index",itemIndex);this.$(".js-hyb-slider-controls-left").toggleClass("is-hidden",itemIndex===0);this.$(".js-hyb-slider-controls-right").toggleClass("is-hidden",itemIndex===this.model.getChildren().length-1)}},{key:"onTransitionEnd",value:function onTransitionEnd(){}},{key:"onNavigationClick",value:function onNavigationClick(event){var activeItem=this.model.getActiveItem();if(!activeItem){this.model.setActiveItem(0);return}var stage=activeItem.get("_index");if($(event.currentTarget).hasClass("js-hyb-slider-controls-right")){if(!Adapt.isDebugEnabled()&&this.model.get("_forceCompletion")&&!activeItem.get("_isComplete")){this.shakeElement($(event.currentTarget));return}this.model.setActiveItem(++stage)}else if($(event.currentTarget).hasClass("js-hyb-slider-controls-left")){this.model.setActiveItem(--stage)}}},{key:"shakeElement",value:function shakeElement($el){$el.addClass("is-shake").one("animationend webkitAnimationEnd",function(){$el.removeClass("is-shake")})}},{key:"onProgressClick",value:function onProgressClick(event){var idx=$(event.currentTarget).data("index");if(!Adapt.isDebugEnabled()&&this.model.get("_forceCompletion")&&idx!==0&&!this.model.getItem(idx-1).get("_isComplete")){this.shakeElement($(event.currentTarget));return}this.model.setActiveItem(idx)}},{key:"calculateWidths",value:function calculateWidths(){var itemCount=this.model.getChildren().length;this.model.set({"_totalWidth":100*itemCount,"_itemWidth":100/itemCount})}},{key:"render",value:function render(){var _this2=this;if(this.$el.hasClass("hyb-slider")){Adapt.log.error("hyb-slideView: Extension has already been applied to this element.",this.$el);throw""}var $children=this.$el.children();this.calculateWidths();var template=Handlebars.templates["hyb-slider"];var data=this.model.toJSON();this.$el.append(new Handlebars.SafeString(template(data)).string);$children.each(function(i,e){_this2.$(".hyb-slider__item").eq(i).append($(e))});this.$el.addClass("hyb-slider").addClass("is-".concat(this.model.get("_size"))).toggleClass("has-controls-close",!this.model.get("_controls")._hideClose).toggleClass("has-controls-nav",!this.model.get("_controls")._hideNav).toggleClass("has-controls-progress",!this.model.get("_controls")._hideProgress).toggleClass("is-controls-external",Boolean(this.model.get("_controls")._isExternal)).toggleClass("is-active",this.model.get("_isActive")).toggleClass("has-bgbody",this.model.get("_hasBackgroundBody")).toggleVisibility(this.model.get("_isActive"));Adapt.scrollfix.setupSimpleBar(this.$el)}}]);return HYBSliderView}(Backbone.View);var HYBSliderView$1=__AMD("extensions/adapt-hyb-slider/js/hyb-sliderView",HYBSliderView);var HYBSlider=function(_Backbone$Controller){_inherits(HYBSlider,_Backbone$Controller);var _super=_createSuper(HYBSlider);function HYBSlider(){_classCallCheck(this,HYBSlider);return _super.apply(this,arguments)}_createClass(HYBSlider,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"app:dataReady":this.onDataReady.bind(this)})}},{key:"onDataReady",value:function onDataReady(){Adapt.hyb.initSlider=function($target,options){if(!options._parent)throw"adapt-hyb-slider: options._parent must be defined.";var data=_.extend({},options);data._controls=_.extend({},{_hideClose:false,_hideNav:false,_hideProgress:false},data._controls);data._size=data._size||"large";data._hasBackground=!(data._hasBackground===false);var model=new HYBSliderModel$1(data);new HYBSliderView$1({el:$target[0],model:model});return model}}}]);return HYBSlider}(Backbone.Controller);new HYBSlider;var HYBSpeechBubbleView=function(_Backbone$View){_inherits(HYBSpeechBubbleView,_Backbone$View);var _super=_createSuper(HYBSpeechBubbleView);function HYBSpeechBubbleView(){_classCallCheck(this,HYBSpeechBubbleView);return _super.apply(this,arguments)}_createClass(HYBSpeechBubbleView,[{key:"className",value:function className(){var classes=["hyb-speechbubble",this.model.get("class")||"",this.model.get("_isLegacyDir")?"is-legacy-dir":"",Handlebars.getThemeStr(this.model.get("theme"))];return classes.join(" ")}},{key:"attributes",value:function attributes(){return{"style":this.model.get("style")||""}}},{key:"initialize",value:function initialize(){this.render();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){var _this=this;this.setupTail=_.debounce(this.setupTail.bind(this),0);var debugWindow=Adapt.hyb.debug.initDebugWindow(this.model.get("_parent").getParent(),"Speechbubble");debugWindow.track(this.model,"dir","dir");debugWindow.track(this.model,"size","size");this._debugWindow=debugWindow;this.listenTo(this.model,{"change:dir":this.setupTail,"change:size":this.setupTail});var componentModel=this.model.get("_parent");if(componentModel){this.listenTo(componentModel,{"change:_isReady":this.setupTail})}var resizeObserver=new ResizeObserver(function(entries){var existsInDom=document.body.contains(_this.$el[0]);if(!existsInDom){var _this$_debugWindow;_this._resizeObserver.disconnect();(_this$_debugWindow=_this._debugWindow)===null||_this$_debugWindow===void 0?void 0:_this$_debugWindow.remove();return}_this.setupTail()});resizeObserver.observe(this.$el[0]);this._resizeObserver=resizeObserver}},{key:"render",value:function render(){var template=Handlebars.templates["hyb-speechBubble"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);_.delay(this.setupTail.bind(this),0)}},{key:"_getLineIntersection",value:function _getLineIntersection(a1,a2,b1,b2){var a={x:a2.x-a1.x,y:a2.y-a1.y};var b={x:b2.x-b1.x,y:b2.y-b1.y};var dot=a.x*b.y-a.y*b.x;if(dot==0)return false;var c={x:b1.x-a1.x,y:b1.y-a1.y};var t=(c.x*b.y-c.y*b.x)/dot;if(t<0||t>1)return false;var u=(c.x*a.y-c.y*a.x)/dot;if(u<0||u>1)return false;return{x:a1.x+t*a.x,y:a1.y+t*a.y}}},{key:"_getLineRectIntersection",value:function _getLineRectIntersection(a1,a2,r1,r2,r3,r4){var intersection=null;if(!intersection)intersection=this._getLineIntersection(a1,a2,r1,r2);if(!intersection)intersection=this._getLineIntersection(a1,a2,r2,r3);if(!intersection)intersection=this._getLineIntersection(a1,a2,r3,r4);if(!intersection)intersection=this._getLineIntersection(a1,a2,r4,r1);if(!intersection){Adapt.log.error("hyb-speechBubbleView: could not find line intersection with rectangle after checking all sides.");return}return intersection}},{key:"_getVectorAngle",value:function _getVectorAngle(v){return Math.atan2(v.y,v.x)*180/Math.PI}},{key:"setupTail",value:function setupTail(){var isLegacy=this.model.get("_isLegacyDir");var $figureItemInner=this.$el.closest(".js-hyb-figure-item .js-hyb-figure-item-inner");_.delay(function(){var BUFFER=5;if($figureItemInner.closest(".js-hyb-figure-grid")[0].scrollHeight>$figureItemInner[0].scrollHeight-BUFFER){$figureItemInner.parent().addClass("theme-no-overflow");Adapt.scrollfix.disableScroll($figureItemInner)}},50);if(isLegacy)this.setupTailLegacy();else this.setupTailNew()}},{key:"setupTailNew",value:function setupTailNew(){var rect=_.extend({},this.$el[0].getBoundingClientRect());if(this.$el.closest(".component").length){rect.top+=$(window).scrollTop();rect.left+=$(window).scrollLeft()}var size=this.model.get("size");var s0={x:rect.left,y:rect.top};var s1={x:rect.left+rect.width,y:rect.top};({x:rect.left+rect.width,y:rect.top+rect.height});var s3={x:rect.left,y:rect.top+rect.height};rect.left-=size;rect.top-=size;rect.width+=size*2;rect.height+=size*2;var r0={x:rect.left,y:rect.top};var r1={x:rect.left+rect.width,y:rect.top};var r2={x:rect.left+rect.width,y:rect.top+rect.height};var r3={x:rect.left,y:rect.top+rect.height};var dir=this.model.get("dir");dir=dir*Math.PI/180;var vec={x:Math.cos(dir),y:-Math.sin(dir)};var p1={x:rect.left+rect.width/2,y:rect.top+rect.height/2};var p2={x:p1.x+vec.x*1000,y:p1.y+vec.y*1000};var ir=this._getLineRectIntersection(p1,p2,r0,r1,r2,r3);var near={x:Math.max(s0.x,Math.min(ir.x,s1.x)),y:Math.max(s0.y,Math.min(ir.y,s3.y))};var angle=this._getVectorAngle({x:ir.x-near.x,y:ir.y-near.y});this.$(".js-hyb-speechbubble-tail").offset({left:near.x,top:near.y}).css({transform:"rotate(".concat(angle+180,"deg)"),"border-width":size});this.$(".js-hyb-speechbubble-tail-inner").css({"border-width":size});this.$(".js-hyb-speechbubble-thought-inner").css({"width":size,"height":size})}},{key:"setupTailLegacy",value:function setupTailLegacy(){var rect=_.extend({},this.$el[0].getBoundingClientRect());if(this.$el.closest(".component").length){rect.top+=$(window).scrollTop();rect.left+=$(window).scrollLeft()}var size=this.model.get("size");var s0={x:rect.left,y:rect.top};var s1={x:rect.left+rect.width,y:rect.top};var s2={x:rect.left+rect.width,y:rect.top+rect.height};var s3={x:rect.left,y:rect.top+rect.height};rect.left-=size;rect.top-=size;rect.width+=size*2;rect.height+=size*2;var r0={x:rect.left,y:rect.top};var r1={x:rect.left+rect.width,y:rect.top};var r2={x:rect.left+rect.width,y:rect.top+rect.height};var r3={x:rect.left,y:rect.top+rect.height};var dir=this.model.get("dir");dir=dir*Math.PI/180;var vec={x:Math.cos(dir),y:-Math.sin(dir)};var p1={x:rect.left+rect.width/2,y:rect.top+rect.height/2};var p2={x:p1.x+vec.x*1000,y:p1.y+vec.y*1000};var intersection1=this._getLineRectIntersection(p1,p2,r0,r1,r2,r3);var intersection2=this._getLineRectIntersection(p1,p2,s0,s1,s2,s3);var length=Math.sqrt(Math.pow(intersection2.x-intersection1.x,2)+Math.pow(intersection2.y-intersection1.y,2));this.$(".js-hyb-speechbubble-test").css({"transform":"rotate(".concat(-this.model.get("dir"),"deg)")});this.$(".js-hyb-speechbubble-tail").offset({left:intersection1.x,top:intersection1.y}).css({transform:"rotate(".concat(-this.model.get("dir")+180,"deg)"),"border-width":length});this.$(".js-hyb-speechbubble-tail-inner").css({"border-width":length*1.25});this.$(".js-hyb-speechbubble-thought-inner").css({"width":length,"height":length})}}]);return HYBSpeechBubbleView}(Backbone.View);var HYBSpeechBubbleView$1=__AMD("extensions/adapt-hyb-speechBubble/js/hyb-speechBubbleView",HYBSpeechBubbleView);var HYBSpeechBubble=function(_Backbone$Controller){_inherits(HYBSpeechBubble,_Backbone$Controller);var _super=_createSuper(HYBSpeechBubble);function HYBSpeechBubble(){_classCallCheck(this,HYBSpeechBubble);return _super.apply(this,arguments)}_createClass(HYBSpeechBubble,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"router:page":this.onRouterPage})}},{key:"onRouterPage",value:function onRouterPage(){Handlebars.registerHelperEl("speechBubble",function(){var context=arguments[arguments.length-1];var data=context.hash;if(data.deg!==undefined){data.dir=parseFloat(data.deg,10)}else if(data.dir!==undefined){data.dir=parseFloat(data.dir,10);data._isLegacyDir=true}var parent=Handlebars.getComponentModelFromContext(context);var isThought=Boolean((data.theme||"").split(" ").includes("thought"));var modelJSON=_.extend({dir:0,size:isThought?48:32},data,{content:context.fn(this),_parent:parent,_isThought:isThought});return new HYBSpeechBubbleView$1({model:new Backbone.Model(modelJSON)}).$el})}}]);return HYBSpeechBubble}(Backbone.Controller);new HYBSpeechBubble;var HYBStoreView=function(_Backbone$View){_inherits(HYBStoreView,_Backbone$View);var _super=_createSuper(HYBStoreView);function HYBStoreView(){_classCallCheck(this,HYBStoreView);return _super.apply(this,arguments)}_createClass(HYBStoreView,[{key:"className",value:function className(){var classes=["hyb-store"];return classes.join(" ")}},{key:"attributes",value:function attributes(){return{"for":this.model.get("for")}}},{key:"initialize",value:function initialize(){this.render()}},{key:"render",value:function render(){var _this=this;var id=this.model.get("_parent").get("_id");_.delay(function(){var componentView=Adapt.findViewByModelId(id);var name=_this.model.get("for");var $target=componentView.$("[data-name=\"".concat(name,"\"]"));var $figureItem=$target.closest(".js-hyb-figure-group-item");if(!$target.length){throw"{{#hyb-store}}: could not find element with [data-name=\"".concat(name,"\"]")}_this.$el.append($target);$figureItem.hide()},0)}}]);return HYBStoreView}(Backbone.View);var HYBStoreView$1=__AMD("extensions/adapt-hyb-store/js/hyb-storeView",HYBStoreView);var HYBStore=function(_Backbone$Controller){_inherits(HYBStore,_Backbone$Controller);var _super=_createSuper(HYBStore);function HYBStore(){_classCallCheck(this,HYBStore);return _super.apply(this,arguments)}_createClass(HYBStore,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"router:page":this.onRouterPage})}},{key:"onRouterPage",value:function onRouterPage(){Handlebars.registerHelperEl("hyb-store",function(){var context=arguments[arguments.length-1];var componentModel=Handlebars.getComponentModelFromContext(context);var modelJSON=_.extend({},context.hash,{_parent:componentModel});return new HYBStoreView$1({model:new Backbone.Model(modelJSON)}).$el})}}]);return HYBStore}(Backbone.Controller);new HYBStore;var HYBTabGridView=function(_Backbone$View){_inherits(HYBTabGridView,_Backbone$View);var _super=_createSuper(HYBTabGridView);function HYBTabGridView(){_classCallCheck(this,HYBTabGridView);return _super.apply(this,arguments)}_createClass(HYBTabGridView,[{key:"className",value:function className(){var rowHeight=this.model.get("rowHeight");var classes=["hyb-tabgrid","cols-".concat(this.model.get("cols")||0),this.model.get("itemWidth")?"justify-center":"",this.model.get("class")||"",rowHeight&&typeof rowHeight==="string"?"rowheight-".concat(rowHeight):""];return classes.join(" ")}},{key:"attributes",value:function attributes(){return{"role":"tablist"}}},{key:"initialize",value:function initialize(){this.render();this.setupEventListeners()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this.model.get("_parent"),"change:_isReady",this.calcOverflow)}},{key:"render",value:function render(){var template=Handlebars.templates["hyb-tabGrid"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string)}},{key:"calcOverflow",value:function calcOverflow(){var $figureItem=this.$el.closest(".js-hyb-figure-item");var height=this.$el[0].getBoundingClientRect().height;var parentHeight=$figureItem[0].getBoundingClientRect().height;if(height>parentHeight){this.$el.addClass("is-overflow")}}}]);return HYBTabGridView}(Backbone.View);var HYBTabGridView$1=__AMD("extensions/adapt-hyb-tabGrid/js/hyb-tabGridView",HYBTabGridView);var HYBTabGrid=function(_Backbone$Controller){_inherits(HYBTabGrid,_Backbone$Controller);var _super=_createSuper(HYBTabGrid);function HYBTabGrid(){_classCallCheck(this,HYBTabGrid);return _super.apply(this,arguments)}_createClass(HYBTabGrid,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"router:page":this.onRouterPage})}},{key:"onRouterPage",value:function onRouterPage(){Handlebars.registerHelperEl("hyb-tabGrid",function(){var context=arguments[arguments.length-1];var data=context.hash;var componentModel=Handlebars.getComponentModelFromContext(context);var modelJSON=_.extend({},data,{content:context.fn(this),_parent:componentModel});return new HYBTabGridView$1({model:new Backbone.Model(modelJSON)}).$el})}}]);return HYBTabGrid}(Backbone.Controller);new HYBTabGrid;Adapt.indexString=function(idxString,arr){var count=arr?arr.length:-1;var indexes=[];var selectors=idxString.split(",");_.each(selectors,function(selector){selector=selector.trim();var group=[];var isNegative=selector[0]==="!";if(isNegative){selector=selector.substring(1)}if(selector.includes("+")){if(count<0){throw"Adapt.indexString: cannot process \"".concat(selector,"\" if 'count' is undefined.")}var from=selector.split("+")[0];for(var i=parseInt(from);i<count;i++){group.push(i+"")}}else if(selector.includes("-")){var _from=selector.split("-")[0];var to=selector.split("-")[1];for(var _i=parseInt(_from);_i<=parseInt(to);_i++){group.push(_i+"")}}else{group.push(selector+"")}if(!isNegative){indexes=indexes.concat(group)}else{indexes=indexes.filter(function(index){return group.indexOf(index)<0})}});return _.uniq(indexes)};Adapt.blockString=function(idxString){var selectors=idxString.split(",");_.each(selectors,function(selector,idx){selector=selector.trim();var isNegative=selector[0]==="!";if(isNegative){selector=selector.substring(1)}var from,to=null;if(selector.includes("-")){from=selector.split("-")[0];to=selector.split("-")[1]}else if(selector.includes("+")){from=selector.split("+")[0];to=Adapt.blocks.last().get("_id").split("-")[1]}else if(selector==="r"){var recipeBlocks=Adapt.blocks.filter(function(blockModel){return blockModel.get("_isRecipe")});from=recipeBlocks[0].get("_id").split("-")[1];to=recipeBlocks[recipeBlocks.length-1].get("_id").split("-")[1]}else{return}var hasStarted=false;var indexes=[];Adapt.blocks.find(function(blockModel){var blockId=blockModel.get("_id").substring(2);if(!hasStarted){if(blockId==from)hasStarted=true;else return false}indexes.push((isNegative?"!":"")+blockId);if(blockId==to){return true}});selectors[idx]=indexes.join(",")});return Adapt.indexString(selectors.join(","),Adapt.blocks.models)};var LottieModel=function(_Backbone$Model){_inherits(LottieModel,_Backbone$Model);var _super=_createSuper(LottieModel);function LottieModel(){_classCallCheck(this,LottieModel);return _super.apply(this,arguments)}_createClass(LottieModel,[{key:"defaults",value:function defaults(){return{"anim":null,"loops":1,"_controlsType":"none","isDecorative":true,"_isPlaying":true,"_duration":0,"_loopsNum":0,"_isComplete":false,"_resetOnOutview":true,"_resetOnOutviewEnabled":true}}},{key:"initialize",value:function initialize(){this.set("_id",_.uniqueId("lottie-"));this.setUpEventListeners()}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenToOnce(this,"change:anim",this.onAnimLoad);this.listenTo(this,"change:_isPlaying",this.onIsPlayingChange);this.listenTo(this,"change:_isComplete",this.onIsCompleteChange)}},{key:"onIsPlayingChange",value:function onIsPlayingChange(model,isPlaying){var anim=this.get("anim");if(!anim)return;if(!isPlaying){anim.pause()}else{anim.play()}}},{key:"onIsCompleteChange",value:function onIsCompleteChange(model,isComplete){if(isComplete){if(this.get("_controlsType")=="basic"){this.set("_resetOnOutviewEnabled",false)}}else{if(this.get("_controlsType")=="basic"){this.set("_resetOnOutviewEnabled",true)}}}},{key:"checkResetOnOutview",value:function checkResetOnOutview(){return this.get("_resetOnOutview")&&this.get("_resetOnOutviewEnabled")}},{key:"setUpAnimEventListeners",value:function setUpAnimEventListeners(){var anim=this.get("anim");anim.addEventListener("loopComplete",this.onAnimLoopComplete.bind(this));anim.addEventListener("enterFrame",this.onAnimEnterFrame.bind(this))}},{key:"onAnimLoopComplete",value:function onAnimLoopComplete(){this.set("_loopsNum",this.get("_loopsNum")+1);if(this.get("_loopsNum")>=this.get("loops")){this.pause(this.get("_duration")-1);this.set("_isComplete",true)}}},{key:"getProgressPercent",value:function getProgressPercent(){var anim=this.get("anim");if(!anim)return 0;return anim.currentFrame/anim.totalFrames}},{key:"onAnimEnterFrame",value:function onAnimEnterFrame(event){if(!this.get("_isPlaying"))return;var currentProgressPercent=event.currentTime/event.totalTime;this.set("_currentProgressPercent",currentProgressPercent);if(this.get("loops")%1!==0&&this.get("_loopsNum")+currentProgressPercent>this.get("loops")){var duration=this.get("_duration");var pauseTime=duration*(this.get("loops")%1)-1;if(pauseTime<0)pauseTime=duration-1;this.pause(pauseTime);this.set("_isComplete",true)}}},{key:"onAnimLoad",value:function onAnimLoad(model,anim){if(!anim)throw"lottieModel: an unexpected error has occured (Lottie animation object is falsy).";this.set("_duration",anim.getDuration()*1000);this.onIsPlayingChange(this,this.get("_isPlaying"));this.setUpAnimEventListeners()}},{key:"pause",value:function pause(time){this.set("_isPlaying",false);if(time!==undefined){var _this$get;(_this$get=this.get("anim"))===null||_this$get===void 0?void 0:_this$get.goToAndStop(time,false)}}},{key:"play",value:function play(time){this.set("_isPlaying",true);if(time!==undefined){var _this$get2;(_this$get2=this.get("anim"))===null||_this$get2===void 0?void 0:_this$get2.goToAndPlay(time,false)}}},{key:"toggle",value:function toggle(){this.set("_isPlaying",!this.get("_isPlaying"))}},{key:"isLoopsComplete",value:function isLoopsComplete(){return Boolean(this.get("_isComplete"))}},{key:"isComplete",value:function isComplete(){return Boolean(this.get("_isComplete"))}},{key:"isDecorative",value:function isDecorative(){return Boolean(this.get("isDecorative"))}},{key:"reset",value:function reset(){this.set("_loopsNum",0);this.set("_isComplete",false);this.play(0)}}]);return LottieModel}(Backbone.Model);var LottieModel$1=__AMD("extensions/adapt-lottie/js/lottieModel",LottieModel);var LottieControlsView=function(_Backbone$View){_inherits(LottieControlsView,_Backbone$View);var _super=_createSuper(LottieControlsView);function LottieControlsView(){_classCallCheck(this,LottieControlsView);return _super.apply(this,arguments)}_createClass(LottieControlsView,[{key:"className",value:function className(){return"lottie__controls"}},{key:"events",value:function events(){return{"click .js-controls-playpause":"onPlayPauseClick"}}},{key:"initialize",value:function initialize(){this.setUpEventListeners();this.render()}},{key:"onPlayPauseClick",value:function onPlayPauseClick(){if(this.model.isLoopsComplete()){this.model.reset();return}if(this.model.isDecorative())return;this.model.toggle()}},{key:"setUpEventListeners",value:function setUpEventListeners(){}},{key:"render",value:function render(){this.$el.html(new Handlebars.SafeString(Handlebars.templates["lottieControls"](this.model.toJSON())).string)}}]);return LottieControlsView}(Backbone.View);var LottieControlsView$1=__AMD("extensions/adapt-lottie/js/lottieControlsView",LottieControlsView);var INTERSECTION_THRESHOLD=0.99;Lottie__default["default"].setQuality("high");var LottieView=function(_Backbone$View){_inherits(LottieView,_Backbone$View);var _super=_createSuper(LottieView);function LottieView(){_classCallCheck(this,LottieView);return _super.apply(this,arguments)}_createClass(LottieView,[{key:"className",value:function className(){var classNames=["lottie",this.model.get("class")||"",this.model.get("theme")?"theme-"+this.model.get("theme"):"",this.model.get("_controlsType")?"controls-type-"+this.model.get("_controlsType"):"",this.model.get("isDecorative")?"is-decorative":""];return classNames.join(" ")}},{key:"attributes",value:function attributes(){return{"data-adapt-id":this.model.get("_id")}}},{key:"initialize",value:function initialize(){this.setUpModelData();this.setUpEventListeners();this.render();if(this.model.get("autoplay")){this.setUpIntersectionObserver()}}},{key:"setUpModelData",value:function setUpModelData(){this.model.set("_isPlaying",false)}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenTo(this.model,"change:_isPlaying",this.onIsPlayingChange);this.listenTo(this.model,"change:_isComplete",this.onIsCompleteChange);this.listenTo(this.model.get("_parent"),"stickyBlock:inview",this.onParentStickyBlockInview);this.listenTo(this.model.get("_parent"),"stickyBlock:outview",this.onParentStickyBlockOutview)}},{key:"setUpIntersectionObserver",value:function setUpIntersectionObserver(){var _this=this;var observer=new IntersectionObserver(function(entries){entries.forEach(_this.onAutoplayIntersection.bind(_this))},{root:null,rootMargin:"0px",threshold:[INTERSECTION_THRESHOLD,0]});observer.observe(this.$(".js-lottie-container")[0])}},{key:"onAutoplayIntersection",value:function onAutoplayIntersection(entry){if(entry.isIntersecting&&entry.intersectionRatio>=INTERSECTION_THRESHOLD)this.onAutoplayInview();else if(!entry.isIntersecting&&entry.intersectionRatio==0)this.onAutoplayOutview()}},{key:"onAutoplayOutview",value:function onAutoplayOutview(){if(this.model.checkResetOnOutview()){this.model.reset();this.model.pause()}}},{key:"onAutoplayInview",value:function onAutoplayInview(){if(!this.model.get("_isPlaying")){if(this.model.checkResetOnOutview()){this.model.reset()}}}},{key:"onParentStickyBlockInview",value:function onParentStickyBlockInview(){if(this.model.checkResetOnOutview()){this.model.reset()}}},{key:"onParentStickyBlockOutview",value:function onParentStickyBlockOutview(){if(this.model.checkResetOnOutview()){this.model.reset();this.model.pause()}}},{key:"onIsPlayingChange",value:function onIsPlayingChange(model,isPlaying){this.$el.toggleClass("is-playing",isPlaying);this.$el.toggleClass("is-paused",!isPlaying)}},{key:"onIsCompleteChange",value:function onIsCompleteChange(model,isComplete){this.$el.toggleClass("is-complete",isComplete)}},{key:"render",value:function render(){this.$el.html(new Handlebars.SafeString(Handlebars.templates["lottie"](this.model.toJSON())).string);this.renderLottie()}},{key:"renderLottie",value:function renderLottie(){var _this2=this;var anim=Lottie__default["default"].loadAnimation({container:this.$(".js-lottie-container")[0],animationData:this.model.get("animationData")||undefined,assetsPath:this.model.get("assetsPath")||undefined,path:this.model.get("src")||undefined,renderer:"svg",loop:true,autoplay:false,name:this.model.get("src")});anim.setSpeed(this.model.get("speed")||1);anim.addEventListener("DOMLoaded",function(){var callback=function(){_this2.model.set("anim",anim);_this2.$(".lottie__controls-container").html(new LottieControlsView$1({model:_this2.model}).$el)};callback()})}}]);return LottieView}(Backbone.View);var LottieView$1=__AMD("extensions/adapt-lottie/js/lottieView",LottieView);var Lottie=function(_Backbone$Controller){_inherits(Lottie,_Backbone$Controller);var _super=_createSuper(Lottie);function Lottie(){_classCallCheck(this,Lottie);return _super.apply(this,arguments)}_createClass(Lottie,[{key:"initialize",value:function initialize(){this.lotties=new Backbone.Collection([],{model:LottieModel$1});this.listenTo(Adapt,{"router:page":this.onRouterPage})}},{key:"onRouterPage",value:function onRouterPage(){var _me=this;Handlebars__default["default"].registerHelperEl("lottie",function(){var context=arguments[arguments.length-1];if(!context.hash.src&&!context.hash.animationData){throw"{{#lottie}}: The \"src\" or \"animationData\" property must be defined."}if(context.hash.animationData){if(!context.hash.assetsPath)throw"{{#lottie}}: if \"animationData\" property is being used, the \"assetsPath\" property must also be defined."}var componentModel;try{componentModel=Handlebars__default["default"].getComponentModelFromContext(context)}catch(err){}var modelJSON=_.extend({_parent:componentModel,_controlsType:context.hash.controls||"none",autoplay:false,loops:context.hash.loops!==undefined?context.hash.loops:1,theme:context.hash.theme||""},context.hash);var model=new LottieModel$1(modelJSON);_me.lotties.push(model);return new LottieView$1({model:model}).$el})}},{key:"getLottieModel",value:function getLottieModel($el){var id=$el.closest(".lottie").attr("data-adapt-id");var lottieModel=this.lotties.find(function(model){return model.get("_id")==id});return lottieModel}},{key:"createLottieView",value:function createLottieView(parent,options){var modelJSON=_.extend({_parent:parent,_controlsType:options.controls||"none",autoplay:false,loops:options.loops!==undefined?options.loops:1,theme:options.theme||""},options);var model=new LottieModel$1(modelJSON);this.lotties.push(model);return new LottieView$1({model:model})}}]);return Lottie}(Backbone.Controller);var lottie=new Lottie;Adapt.lottie=lottie;var MarkChainModel=function(_Backbone$Model){_inherits(MarkChainModel,_Backbone$Model);var _super=_createSuper(MarkChainModel);function MarkChainModel(){_classCallCheck(this,MarkChainModel);return _super.apply(this,arguments)}_createClass(MarkChainModel,[{key:"defaults",value:function defaults(){return{"_name":"","_isReady":false,"_prev":null,"_next":null}}},{key:"initialize",value:function initialize(){this.setUpLabel();this.setUpEventListeners()}},{key:"setUpLabel",value:function setUpLabel(){var label=this.get("label");if(!label)return;if(label.length>=1&&label.length<=3){this.set("_isSmallLabel",true)}}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenToOnce(this,"change:_isReady",this.onReadyChange)}},{key:"onReadyChange",value:function onReadyChange(model,isReady){if(!isReady)throw"An unexpected error has occurred (\"_isReady\" should not be false).";var prev=this.collection.at(this.collection.indexOf(this)-1);this.set("_prev",prev);var next=this.collection.at(this.collection.indexOf(this)+1);this.set("_next",next)}}]);return MarkChainModel}(Backbone.Model);var MarkChainModel$1=__AMD("extensions/adapt-markChain/js/markChainModel",MarkChainModel);var MarkChainView=function(_Backbone$View){_inherits(MarkChainView,_Backbone$View);var _super=_createSuper(MarkChainView);function MarkChainView(){_classCallCheck(this,MarkChainView);return _super.apply(this,arguments)}_createClass(MarkChainView,[{key:"className",value:function className(){var classes=["markchain",this.model.get("theme")?"theme-".concat(this.model.get("theme")):"",this.model.get("class")||""];return classes.join(" ")}},{key:"attributes",value:function attributes(){var attr={"name":this.model.get("name"),"style":this.model.get("style"),"data-markchain-idx":this.model.get("_idx")||-1};return attr}},{key:"tagName",value:function tagName(){return"span"}},{key:"events",value:function events(){return{}}},{key:"initialize",value:function(){var _initialize=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:this.render();this.setUpEventListeners();case 2:case"end":return _context.stop();}},_callee,this)}));function initialize(){return _initialize.apply(this,arguments)}return initialize}()},{key:"setUpEventListeners",value:function setUpEventListeners(){this.onDeviceResized=_.debounce(this.onDeviceResized.bind(this),50);this.listenTo(this.model,"change:_next",this.onNextChanged);this.listenTo(Adapt,"device:resize",this.onDeviceResized)}},{key:"render",value:function render(){var data=this.model.toJSON();var template=Handlebars__default["default"].templates["markChain"];this.$el.html(new Handlebars__default["default"].SafeString(template(data)).string)}},{key:"setUpHiddenObserver",value:function setUpHiddenObserver(){var _this=this;this.$el.onUnhidden(function(){_.delay(function(){_this.updateArrow()},0)})}},{key:"onDeviceResized",value:function onDeviceResized(){this.updateArrow()}},{key:"onNextChanged",value:function onNextChanged(model,nextModel){this.updateArrow();if(!nextModel)return;this.setUpHiddenObserver()}},{key:"_getVectorIntersection",value:function _getVectorIntersection(p0,v0,p1,v1){var c=-v1.x*v0.y+v0.x*v1.y;var s=(-v0.y*(p0.x-p1.x)+v0.x*(p0.y-p1.y))/c;var t=(v1.x*(p0.y-p1.y)-v1.y*(p0.x-p1.x))/c;if(s>=0&&s<=1&&t>=0&&t<=1){return{x:p0.x+t*v0.x,y:p0.y+t*v0.y}}return null}},{key:"_getVectorBoxIntersection",value:function _getVectorBoxIntersection(p0,v0,bb){var intersection=this._getVectorIntersection(p0,v0,{x:bb.left,y:bb.top},{x:bb.width,y:0});if(!intersection)intersection=this._getVectorIntersection(p0,v0,{x:bb.left+bb.width,y:bb.top+bb.height},{x:-bb.width,y:0});if(!intersection)intersection=this._getVectorIntersection(p0,v0,{x:bb.left+bb.width,y:bb.top},{x:0,y:bb.height});if(!intersection)intersection=this._getVectorIntersection(p0,v0,{x:bb.left,y:bb.top+bb.height},{x:0,y:-bb.height});if(!intersection)intersection={x:bb.left+bb.width/2,y:bb.top+bb.height/2};return intersection}},{key:"_getVectorLength",value:function _getVectorLength(v){return Math.sqrt(Math.pow(v.x,2)+Math.pow(v.y,2))}},{key:"_subtractVector",value:function _subtractVector(v0,v1){return{x:v0.x-v1.x,y:v0.y-v1.y}}},{key:"updateArrow",value:function updateArrow(){var nextModel=this.model.get("_next");var $arrow=this.$(".js-markchain-arrow");if(!nextModel){$arrow.hide();return}var $scaled=this.$el.closest("[style*='scale('");var scale=1;if($scaled.length){var transform=$scaled.css("transform");var matrix=transform.replace("matrix(","").split(",");scale=parseFloat(matrix[0])}$arrow.show();var fromBB=_.extend({},this.$(".js-markchain-sizing")[0].getBoundingClientRect());var toBB=_.extend({},nextModel.get("_view").$(".js-markchain-sizing")[0].getBoundingClientRect());var fromMid={x:fromBB.left+fromBB.width/2,y:fromBB.top+fromBB.height/2};var toMid={y:toBB.top+toBB.height/2,x:toBB.left+toBB.width/2};var v={x:toMid.x-fromMid.x,y:toMid.y-fromMid.y};var fromIn=this._getVectorBoxIntersection(fromMid,v,fromBB);var toIn=this._getVectorBoxIntersection(fromMid,v,toBB);var final={x:toIn.x-fromIn.x,y:toIn.y-fromIn.y};var angle=Math.atan2(final.y,final.x)*180/Math.PI;var length=this._getVectorLength(final);var offset=this._getVectorLength(this._subtractVector(fromMid,fromIn));$arrow.css({"width":length/scale,"transform":"rotate(".concat(angle,"deg) translateX(").concat(offset/scale,"px)")});var $label=this.$(".js-markchain-label");$label.css({"transform":"translateY(-50%) rotate(".concat(-angle,"deg)")})}}]);return MarkChainView}(Backbone.View);var MarkChainView$1=__AMD("extensions/adapt-markChain/js/markChainView",MarkChainView);var MarkChain=function(_Backbone$Controller){_inherits(MarkChain,_Backbone$Controller);var _super=_createSuper(MarkChain);function MarkChain(){_classCallCheck(this,MarkChain);return _super.apply(this,arguments)}_createClass(MarkChain,[{key:"initialize",value:function initialize(){Adapt.on("router:page",this.setUpHelpers.bind(this))}},{key:"setUpHelpers",value:function setUpHelpers(){var _Adapt$stickyBlock;(_Adapt$stickyBlock=Adapt.stickyBlock)===null||_Adapt$stickyBlock===void 0?void 0:_Adapt$stickyBlock.addResetOnReRender("_markChain");Handlebars.registerHelperEl("markChain",function(){var context=arguments[arguments.length-1];var data=Handlebars.getContextHash.apply(this,arguments);if(!data.name)throw"{{#markChain}}: \"name\" property must be defined!";var componentModel=Handlebars.getComponentModelFromContext(context);if(!componentModel.get("_markChain")){componentModel.set("_markChain",{})}var groupsCollection=componentModel.get("_markChain")._groups;if(!groupsCollection){componentModel.get("_markChain")._groups=new Backbone.Collection;groupsCollection=componentModel.get("_markChain")._groups}var group=groupsCollection.find(function(g){return g.get("_name")==data.name});if(!group){group=new Backbone.Model({_name:data.name,_items:new Backbone.Collection(null,{model:MarkChainModel$1,comparator:"_idx"})});groupsCollection.push(group);_.delay(function(){var items=group.get("_items");items.sort();items.each(function(markChainModel){markChainModel.set("_isReady",true)})},1)}data._idx=data.idx;if(!data.content||!data.content.length)data.content="&#8203;";var model=new MarkChainModel$1(data);group.get("_items").push(model);var view=new MarkChainView$1({model:model});model.set("_view",view);return view.$el})}}]);return MarkChain}(Backbone.Controller);var markChain=new MarkChain;Adapt.markChain=markChain;var NestComponentParentModel=function(_Backbone$Model){_inherits(NestComponentParentModel,_Backbone$Model);var _super=_createSuper(NestComponentParentModel);function NestComponentParentModel(){_classCallCheck(this,NestComponentParentModel);return _super.apply(this,arguments)}_createClass(NestComponentParentModel,[{key:"defaults",value:function defaults(){return{_parent:undefined,_isReady:false,_children:new Backbone.Collection}}},{key:"initialize",value:function initialize(){this.listenTo(this.get("_children"),"change:_isReady",this.onChildReadyChange);this.update();this._timeoutError()}},{key:"_timeoutError",value:function _timeoutError(){var _this=this,_parent$getParent;var parent=this.get("_parent");var errCheck=_.debounce(function(){if(!_this.get("_children").length){Adapt.log.error("nestComponentParentModel: component \"".concat(parent.get("_id"),"\" set as a nest parent, but has not been assigned any nest child Components."),parent)}},1000);if(parent!==null&&parent!==void 0&&parent.get("_isAvailable")&&parent!==null&&parent!==void 0&&(_parent$getParent=parent.getParent())!==null&&_parent$getParent!==void 0&&_parent$getParent.get("_isAvailable")){errCheck();return}this.listenToOnce(parent,"change:_isAvailable",errCheck.bind(this))}},{key:"registerChild",value:function registerChild(componentModel){this.get("_children").add(componentModel)}},{key:"onChildReadyChange",value:function onChildReadyChange(childModel,isReady){this.update()}},{key:"update",value:function update(){this.set("_isReady",!Boolean(this.get("_children").find(function(child){return!child.get("_isReady")})));var parentView=this.get("_parentView");if(parentView){parentView.setReadyStatus()}else{this.listenToOnce(this,"change:_parentView",this.update.bind(this))}}},{key:"extendParentView",value:function extendParentView(componentView){var _arguments=arguments,_this2=this;if(this.get("_parentView"))return;var parentView=componentView;var _setReadyStatus=parentView.setReadyStatus;if(!_setReadyStatus.prototype._nestComponentOverride){parentView.setReadyStatus=function(){if(_this2.get("_isReady")){return _setReadyStatus.apply(parentView,_arguments)}};parentView.setReadyStatus.prototype._nestComponentOverride=true}this.set("_parentView",parentView)}}]);return NestComponentParentModel}(Backbone.Model);var NestComponentParentModel$1=__AMD("extensions/adapt-nestComponent/js/NestComponentParentModel",NestComponentParentModel);Adapt.on("router:page",function(){Handlebars__default["default"].registerHelperEl("nestComponent",function(){var context=arguments[arguments.length-1];var hash=context.hash;var id=hash.id;if(!id)throw"{{#nestComponent}} helper must have an \"id\" property.";var childModel=Adapt.findById(id);if(!childModel)throw"{{#nestComponent}} could not find component with \"_id\": \""+id+"\"";var parentModel=Handlebars__default["default"].getComponentModelFromContext(context);var parentNestComponent=parentModel.get("_nestComponent");if(!parentNestComponent){throw"{{#nestComponent}}: Component with \"_id\": \""+parentModel.get("_id")+"\" contains {{#nestComponent}} elements, but does not have the \"_nestComponent\" partial added."}try{parentNestComponent.registerChild(childModel)}catch(err){throw"adapt-nestComponent: parent component \"_nestComponent\" incorrectly applied. Must be: \"_nestComponent\": {\"_isParent\": true}"}if(childModel.get("_nestComponent"))throw"{{#nestComponent}}: Child with \"_id\": \""+id+"\" cannot also be a nestComponent parent / cannot be nested in multiple parents at once.";if(childModel.get("_layout")!="full")throw"{{#nestComponent}} only supports components with \"_layout\": \"full\" at this time (\""+id+"\").";childModel.set("_nestComponent",{_isChild:true,_parent:parentModel});return $("<div class='nestcomponent' data-nestcomponent-id='"+id+"'>")})});var NestComponent=function(_Backbone$Controller){_inherits(NestComponent,_Backbone$Controller);var _super=_createSuper(NestComponent);function NestComponent(){_classCallCheck(this,NestComponent);return _super.apply(this,arguments)}_createClass(NestComponent,[{key:"initialize",value:function initialize(){Adapt.on({"app:dataReady":this.onDataReady.bind(this)})}},{key:"onDataReady",value:function onDataReady(){var _this=this;Adapt.getAllComponents().each(function(componentModel){_this.setUpComponentModel(componentModel)});Adapt.on("componentView:preRender",this.onParentComponentViewPreRender.bind(this));Adapt.on("componentView:postRender",this.onChildComponentViewPostRender.bind(this))}},{key:"setUpComponentModel",value:function setUpComponentModel(componentModel){var nestComponent=componentModel.get("_nestComponent");if(!nestComponent||!nestComponent._isParent)return;componentModel.set("_isReady",false);componentModel.set("_nestComponent",new NestComponentParentModel$1({_parent:componentModel}))}},{key:"onParentComponentViewPreRender",value:function onParentComponentViewPreRender(componentView){var componentModel=componentView.model;var nestComponent=componentModel.get("_nestComponent");if(!nestComponent||nestComponent._isChild)return;nestComponent.extendParentView(componentView)}},{key:"onChildComponentViewPostRender",value:function onChildComponentViewPostRender(componentView){var componentModel=componentView.model;var nestComponent=componentModel.get("_nestComponent");if(!nestComponent||!nestComponent._isChild)return;var parentView=Adapt.findViewByModelId(nestComponent._parent.get("_id"));parentView.$(".nestcomponent[data-nestcomponent-id="+componentModel.get("_id")+"]").append(componentModel.get("_componentRow")?componentView.$el.closest(".componentrow"):componentView.$el)}}]);return NestComponent}(Backbone.Controller);new NestComponent;var PlaybackControlsView=function(_Backbone$View){_inherits(PlaybackControlsView,_Backbone$View);var _super=_createSuper(PlaybackControlsView);function PlaybackControlsView(){_classCallCheck(this,PlaybackControlsView);return _super.apply(this,arguments)}_createClass(PlaybackControlsView,[{key:"className",value:function className(){return"playbackcontrols"}},{key:"events",value:function events(){return{"input .playbackcontrols__range":"onRangeChange","click .playbackcontrols__next":"onClickNext","click .playbackcontrols__playpause":"onClickPlayPause","click .playbackcontrols__back":"onClickBack","change .playbackcontrols__range":"onRangeChange"}}},{key:"initialize",value:function initialize(){this.render();this.setUpEventListeners();this.model.set("frameIdx",0)}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenTo(this.model,"change:frameIdx",this.onFrameIdxChange);this.listenTo(this.model,"change:isPlaying",this.onIsPlayingChange);this.listenTo(this.model,"change:isComplete",this.onIsCompleteChange)}},{key:"render",value:function render(){var data=this.model.toJSON();data.view=this;var template=Handlebars.templates["playbackControls"];this.$el.html(template(data))}},{key:"onFrameIdxChange",value:function onFrameIdxChange(model,frameIdx){this.$(".playbackcontrols__range").val(frameIdx);this.$(".playbackcontrols__back").attr("disabled",function(){return frameIdx==0});this.$(".playbackcontrols__next").attr("disabled",function(){return frameIdx==this.model.get("frameCount")-1}.bind(this))}},{key:"onClickBack",value:function onClickBack(event){this.model.pause();if(this.model.get("frameIdx")-1<0)return;this.model.set("frameIdx",this.model.get("frameIdx")-1)}},{key:"onClickNext",value:function onClickNext(event){this.model.pause();var framesCount=this.model.get("framesCount")-1;if(this.model.get("frameIdx")+1>framesCount)return;this.model.set("frameIdx",this.model.get("frameIdx")+1)}},{key:"onRangeChange",value:function onRangeChange(event){this.model.pause();this.model.set("frameIdx",parseInt($(event.currentTarget).val()))}},{key:"onClickPlayPause",value:function onClickPlayPause(){this.togglePlayPause()}},{key:"togglePlayPause",value:function togglePlayPause(){this.model.togglePlayPause()}},{key:"onIsPlayingChange",value:function onIsPlayingChange(model,isPlaying){if(isPlaying){this.$(".playbackcontrols__playpause").removeClass("playbackcontrols__play").addClass("playbackcontrols__pause")}else{this.$(".playbackcontrols__playpause").removeClass("playbackcontrols__pause").addClass("playbackcontrols__play")}}},{key:"onIsCompleteChange",value:function onIsCompleteChange(model,isComplete){this.$(".playbackcontrols__playpause").toggleClass("playbackcontrols__replay",isComplete)}}]);return PlaybackControlsView}(Backbone.View);var PlaybackControlsView$1=__AMD("extensions/adapt-playbackControls/js/playbackControlsView",PlaybackControlsView);var TimelineModel=function(_Backbone$Model){_inherits(TimelineModel,_Backbone$Model);var _super=_createSuper(TimelineModel);function TimelineModel(){_classCallCheck(this,TimelineModel);return _super.apply(this,arguments)}_createClass(TimelineModel,[{key:"defaults",value:function defaults(){return{frameCount:0,frameIdx:-1,frameDuration:500,mode:"steps",duration:undefined,position:0,isPlaying:false,isComplete:false,_prevTimestamp:undefined}}},{key:"initialize",value:function initialize(){this.setupFrames();this.setupEventListeners()}},{key:"setupFrames",value:function setupFrames(){if(this.get("mode")=="steps"){var frameCount=this.get("frameCount");var frameDuration=this.get("frameDuration");var duration=this.get("duration");if(frameCount&&frameDuration){duration=frameCount*frameDuration}else if(frameDuration&&duration){frameCount=frameDuration/duration}else{frameDuration=frameCount/duration}this.set("frameCount",frameCount);this.set("frameDuration",frameDuration);this.set("duration",duration);if(frameCount<=0)throw"Timeline calculated frameCount cannot be <= 0 (ensure the \"frameDuration\" and \"duration\" properties are manually set).";return}throw"Non-\"steps\" mode support has not yet been implemented."}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(this,"change:isPlaying",this.onIsPlayingChange);this.listenTo(this,"change:position",this.onPositionChange);this.listenTo(this,"change:frameIdx",this.onFrameIdxChange)}},{key:"onIsPlayingChange",value:function onIsPlayingChange(model,isPlaying){if(isPlaying){if(this.get("isComplete")){this.set("position",0)}this.set("_prevTimestamp",undefined);window.requestAnimationFrame(this.step.bind(this))}}},{key:"onFrameIdxChange",value:function onFrameIdxChange(model,frameIdx){this.set("position",frameIdx*this.get("frameDuration"));this.set("isComplete",frameIdx==this.get("frameCount")-1)}},{key:"onPositionChange",value:function onPositionChange(model,position){var frameIdx=Math.floor(position/this.get("frameDuration"));if(frameIdx>=this.get("frameCount"))frameIdx=this.get("frameCount")-1;this.set("frameIdx",frameIdx)}},{key:"step",value:function step(timestamp){if(!this.get("isPlaying"))return;if(this.get("_prevTimestamp")===undefined){this.set("_prevTimestamp",timestamp)}var delta=timestamp-this.get("_prevTimestamp");var position=this.get("position")+delta;this.set("_prevTimestamp",timestamp);var duration=this.get("duration");if(position>duration){this.set("position",duration);this.pause();return}this.set("position",position);window.requestAnimationFrame(this.step.bind(this))}},{key:"togglePlayPause",value:function togglePlayPause(){this.set("isPlaying",!this.get("isPlaying"))}},{key:"reset",value:function reset(){this.set("isPlaying",false);this.set("isComplete",false);this.set("position",0);this.set("_prevTimestamp",undefined)}},{key:"pause",value:function pause(){this.set("isPlaying",false)}},{key:"play",value:function play(){this.set("isPlaying",true)}}]);return TimelineModel}(Backbone.Model);var PlaybackControlsModel=__AMD("extensions/adapt-playbackControls/js/playbackControlsModel",TimelineModel);__AMD("extensions/adapt-playbackControls/js/adapt-playbackControls",function(modelSettings){var model=new PlaybackControlsModel(modelSettings);var view=new PlaybackControlsView$1({model:model});return view});var SCROLL_MARGIN=48;var SCROLL_DURATION=400;var SCROLL_ROUNDING=4;var isScrolling=false;var scrollPriority=-Infinity;var Scrollfix=function(_Backbone$Controller){_inherits(Scrollfix,_Backbone$Controller);var _super=_createSuper(Scrollfix);function Scrollfix(){_classCallCheck(this,Scrollfix);return _super.apply(this,arguments)}_createClass(Scrollfix,[{key:"initialize",value:function initialize(){this._items={};Adapt.on({"router:page":this.onRouterPage,"componentView:postRender":this.onComponentPostRender,"popup:opened":this.onPopupOpened})}},{key:"onComponentPostRender",value:function onComponentPostRender(componentView){Adapt.scrollfix.setupSimpleBar(componentView.$el)}},{key:"onPopupOpened",value:function onPopupOpened(){Adapt.scrollfix.setupSimpleBar($(".notify"))}},{key:"onRouterPage",value:function onRouterPage(){}},{key:"setupSimpleBar",value:function setupSimpleBar($el){var _arguments=arguments,_this=this;_.delay(function(){$el.imageready(function(){_this._setupSimpleBar.apply(_this,_arguments)})},0)}},{key:"_setupSimpleBar",value:function _setupSimpleBar($el){var _this2=this;$el.find("[data-scroll]:not(.has-simplebar)").each(function(i,e){var $e=$(e);var dataScroll=$e.attr("data-scroll");var scroll="";switch(dataScroll){case"visible":case"hidden":case"scroll":case"auto":scroll=dataScroll;break;default:scroll="auto";break;}var enableSimplebar=scroll==="scroll";if(scroll==="auto"){enableSimplebar=Math.abs($e[0].scrollHeight-$e.height())>SCROLL_ROUNDING}if(enableSimplebar){var id=_.uniqueId("sb");_this2._items[id]=new SimpleBar__default["default"]($(e)[0],{autoHide:false});$e.addClass("has-simplebar").attr("data-simplebar-id",id)}$e.addClass("scrollfix-ready");if($e.parent().hasClass("js-hyb-figure-item")){$e.parent().addClass("contains-simplebar")}})}},{key:"disableScroll",value:function disableScroll($el){var _this3=this;_.delay(function(){var sbId=$el.attr("data-simplebar-id");if(!sbId){$el.addClass("disable-scroll");return}var simpleBar=_this3._items[sbId];var $parentEl=$(simpleBar.el);var $contentEl=$(simpleBar.contentEl).children();simpleBar.unMount();$parentEl.append($contentEl);$parentEl.find("[class*=\"simplebar-\"]").remove();$el.removeAttr("data-simplebar-id")},0)}}]);return Scrollfix}(Backbone.Controller);var scrollfix=new Scrollfix;Adapt.scrollfix=scrollfix;Adapt.on("offlineStorage:prepare",function(){if(/Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){Adapt.log.info("adapt-scrollfix.js: Mobile device detected.");$("html").addClass("device-mobile");return}});Adapt.on("app:dataReady",function(){overrideNavigateToElement();overridePreventScroll();Adapt.navigateToRelOffset=navigateToRelOffset});var disableA11yPreventScroll=false;function overridePreventScroll(){var _preventScroll=Adapt.a11y._scroll._preventScroll;Adapt.a11y._scroll._preventScroll=function(){if(disableA11yPreventScroll)return;return _preventScroll.apply(Adapt.a11y._scroll,arguments)};Adapt.scrollfix.disableA11yScroll=function(){disableA11yPreventScroll=true};Adapt.scrollfix.enableA11yScroll=function(){disableA11yPreventScroll=false}}function navigateToRelOffset(offset,settings){var $target=$("<div class='scrollfix__target'>");$("#app").append($target);$target.offset({top:offset.top?$(window).scrollTop()+offset.top:undefined,left:offset.left?$(window).scrollLeft()+offset.left:undefined});var s=_.extend({offset:{top:0,left:0},ignoreNav:true},settings);Adapt.navigateToElement($target,s);$target.remove()}function overrideNavigateToElement(){var _navigateToElement=Adapt.navigateToElement;Adapt.navigateToElement=function(selector,settings){if(Adapt.isPDFMode())return;settings.priority=settings.priority||0;if(!isScrolling){scrollPriority=settings.priority}else{if(settings.priority<scrollPriority)return;scrollPriority=settings.priority}if(!settings)settings={};if(settings.duration===undefined)settings.duration=SCROLL_DURATION;if(settings.offset===undefined)settings.offset={top:-SCROLL_MARGIN,left:0};if(settings.fail===undefined)settings.fail=onScrollFail;if(settings.onAfter===undefined){settings.onAfter=onScrollAfter}else{var onAfter=settings.onAfter;settings.onAfter=function(){onAfter();onScrollAfter()}}if(!settings.ignoreNav&&Adapt.device.screenSize!=="large"){settings.offset.top-=$(".nav").height()}var $obj=$();var uniqueId=_.uniqueId("scrollfix");if(selector instanceof jQuery){$obj=selector.addClass(uniqueId);selector="."+uniqueId;arguments[0]=selector}var scrollNestedCallback=undefined;if(settings.scrollNested===true){var $scrollParent=$obj.scrollParent();var scrollParentId=$scrollParent.attr("id");if(scrollParentId!="adapt"&&scrollParentId!="app"&&!$scrollParent.hasClass("notify__popup")&&(!Adapt.hyb||$scrollParent[0]!==window.document)){var scrollTop=$scrollParent.scrollTop();$scrollParent.scrollTo($obj,{axis:"y",duration:0});scrollNestedCallback=function(){var destScrollTop=$scrollParent.scrollTop();$scrollParent.scrollTop(scrollTop);$scrollParent.scrollTo(destScrollTop,{axis:"y",duration:SCROLL_DURATION})}}}var cleanup=function(){if(scrollNestedCallback)scrollNestedCallback();$obj.removeClass(uniqueId)};if(settings.align=="inview"){var inview=getElementInview(selector,settings.offset);if(inview.inview===0){cleanup();onScrollAfter();return}$obj.removeClass(uniqueId);inview.$topObj.addClass(uniqueId);if(inview.inview===1){settings.offset.top=-Adapt.device.screenHeight+inview.height+SCROLL_MARGIN;if(_useIphoneFix()){settings.offset.top+=SCROLL_MARGIN*2}}}if($obj.closest(".notify").length&&settings.notifyEnabled===true){$(".notify__popup").scrollTo($obj,_.extend(settings,{axis:"y",duration:SCROLL_DURATION}))}else{_navigateToElement.apply(this,arguments)}isScrolling=true;cleanup()}}function onScrollFail(){isScrolling=false;scrollPriority=-Infinity}function onScrollAfter(){isScrolling=false;scrollPriority=-Infinity}function getScreenTop(){if(Adapt.device.screenSize==="small"){return SCROLL_MARGIN+$(".nav").height()}return SCROLL_MARGIN}function _useIphoneFix(){return $("html").hasClass("iphone")}function getScreenBottom(){if(_useIphoneFix()){return Adapt.device.screenHeight-SCROLL_MARGIN*3}return Adapt.device.screenHeight-SCROLL_MARGIN}function getElementInview(selector,offset){var $obj=$(selector);if(!$obj.length){Adapt.log.error("adapt-scrollfix.getElementInview() could not find any elements with the provided selector: "+selector);return}var bbs=[];$obj.each(function(i,e){if($(e).hasClass("component")){var componentView=Adapt.findViewByModelId($(e).data("adapt-id"));if(componentView.getBoundingClientRect){var bb=componentView.getBoundingClientRect();bb.$obj=$(e);bbs.push(bb)}else{var _bb=$(e)[0].getBoundingClientRect();_bb.$obj=$(e);bbs.push(_bb)}}else{var _bb2=$(e)[0].getBoundingClientRect();_bb2.$obj=$(e);bbs.push(_bb2)}});var minTop=Infinity;var maxBottom=-Infinity;var $topObj=$obj.first();_.each(bbs,function(bb){if(bb.top<minTop){minTop=bb.top;$topObj=bb.$obj}if(bb.bottom>maxBottom){maxBottom=bb.bottom}});var screenTop=getScreenTop()-1;var screenBottom=getScreenBottom()+1;var inview=0;var height=maxBottom-minTop;if(offset.height!==undefined){height=Math.max(height,offset.height)}if(maxBottom-minTop>screenBottom-screenTop){inview=-1}else{if(maxBottom>screenBottom)inview=1;if(minTop<screenTop)inview=-1}return{inview:inview,height:height,$topObj:$topObj}}var Sizing=function(_Backbone$Controller){_inherits(Sizing,_Backbone$Controller);var _super=_createSuper(Sizing);function Sizing(){_classCallCheck(this,Sizing);return _super.apply(this,arguments)}_createClass(Sizing,[{key:"initialize",value:function initialize(){Adapt.on("componentView:postRender",this.componentViewPostRender.bind(this))}},{key:"componentViewPostRender",value:function componentViewPostRender(componentView){var sizing=componentView.model.get("_sizing");if(!sizing||sizing._isEnabled===false)return;componentView.$el.addClass(this.getSizingClasses(sizing))}},{key:"_validateProperty",value:function _validateProperty(sizingObj,propName,isBoolValid){var prop=sizingObj[propName];if(prop===undefined||prop===""||isBoolValid&&prop===false)return false;if(prop=="auto")return true;if(isNaN(prop)&&(isBoolValid?typeof prop!=="boolean":true)||prop<=0||prop>12){Adapt.log.error("Invalid value provided for _sizing."+propName+": "+prop+"\n(value must be: [1-12|\"auto\"]"+(isBoolValid?" | true | false":"")+").");return false}return true}},{key:"_getSizingObj",value:function _getSizingObj(sizing){if(!sizing)return{};if(Array.isArray(sizing))return{_width:sizing[0],_maxWidth:sizing[1]};if(_typeof(sizing)==="object")return sizing;if(typeof sizing==="number")return{_width:sizing};if(typeof sizing==="string"){if(sizing.match(/^![0-9]+$/g)){sizing=sizing.substring(1);if(!isNaN(sizing))return{_width:parseInt(sizing),_maxWidth:false};else{Adapt.log.error("adapt-sizing: 'sizing' parameter provided does not match any of the accepted formats.\n\nSizing value provided: "+JSON.stringify(sizing))}}return{_width:isNaN(sizing)?sizing:parseInt(sizing)}}Adapt.log.error("adapt-sizing: 'sizing' parameter provided does not match any of the accepted formats.\n\nSizing value provided: "+JSON.stringify(sizing))}},{key:"getSizingClasses",value:function getSizingClasses(sizing){sizing=this._getSizingObj(sizing);var classNames=[];classNames.push("col");classNames.push(this._validateProperty(sizing,"_width",false)?"col-"+sizing._width:undefined);if(sizing._maxWidthInner!==undefined){classNames.push("col-maxwidth-inner");if(sizing._maxWidth===undefined||!isNaN(sizing._maxWidthInner)){sizing._maxWidth=sizing._maxWidthInner}}if(sizing._maxWidth===undefined){sizing._maxWidth=sizing._width=="auto"?false:sizing._width!==undefined}else if(sizing._maxWidth===true&&sizing._width===undefined){sizing._width=6}classNames.push(this._validateProperty(sizing,"_maxWidth",true)?"col-maxwidth"+(sizing._maxWidth===true?"":"-"+sizing._maxWidth):undefined);if(sizing._minWidth===undefined)sizing._minWidth=false;classNames.push(this._validateProperty(sizing,"_minWidth",true)?"col-minwidth"+(sizing._minWidth===true?"":"-"+sizing._minWidth):undefined);if(sizing._float){classNames.push("col-float");switch(sizing._float){case"left":classNames.push("col-float-left");break;default:classNames.push("col-float-right");}}return classNames.join(" ").trim()}},{key:"getSizingGridClasses",value:function getSizingGridClasses(sizing){var classNames=[];classNames.push(this._validateProperty(sizing,"_maxCols",false)?"sg-maxcols-"+sizing._maxCols:undefined);classNames.push(this._validateProperty(sizing,"_width",false)?"sg-cols-"+sizing._width:undefined);return classNames.join(" ").trim()}},{key:"setUpGridListeners",value:function setUpGridListeners($grid){var _this=this;if(!$grid.length){Adapt.log.error("adapt-sizing: Could not initialize $grid listeners ($grid element not found).");return}Adapt.on("device:resize",function(){_this.updateGridEl($grid)});_.delay(function(){_this.updateGridEl($grid)})}},{key:"updateGridEl",value:function updateGridEl($grid){var $items=$grid.children();$items.removeClass(function(idx,className){return(className.match(/(^|\s)sg-orphan-\S+/g)||[]).join(" ")});var columnGap=parseInt($grid.css("column-gap"),10);var THRESHOLD=columnGap/2;var gridWidth=$grid.outerWidth();var itemWidth=$items.first().outerWidth();var itemCount=$items.length;var w=-columnGap;var columnCount=0;while(Math.round(w)<gridWidth-THRESHOLD){w+=itemWidth+columnGap;columnCount++}var orphanCount=itemCount%columnCount;if(orphanCount==0)return;$items.eq(itemCount-orphanCount).addClass("sg-orphan-"+(columnCount-orphanCount))}},{key:"getParentClasses",value:function getParentClasses(sizing){sizing=this._getSizingObj(sizing);var classNames=[];if(Boolean(sizing._float)){classNames.push("par-contains-float");classNames.push("u-clearfix")}else{classNames.push("par-contains-flex")}return classNames.join(" ").trim()}},{key:"getSizingClass",value:function getSizingClass(){return this.getSizingClasses.apply(this,arguments)}},{key:"hasFloatingChildren",value:function hasFloatingChildren(sizing){return Boolean(sizing._float)}},{key:"hasFloat",value:function hasFloat(){return this.hasFloatingChildren.apply(this,arguments)}}]);return Sizing}(Backbone.Controller);var sizing=new Sizing;Adapt.sizing=sizing;var StickyElementAttributeClasses={"data-stickyelement-active-idx":"is-se-active","data-stickyelement-mark-idx":"is-se-mark","data-stickyelement-hide-idx":"is-se-hide","data-stickyelement-fold-idx":"is-se-fold","data-stickyelement-slideleft-idx":"is-se-slideleft","data-stickyelement-slidedown-idx":"is-se-slidedown"};var StickyElementItemView=function(_Backbone$View){_inherits(StickyElementItemView,_Backbone$View);var _super=_createSuper(StickyElementItemView);function StickyElementItemView(){_classCallCheck(this,StickyElementItemView);return _super.apply(this,arguments)}_createClass(StickyElementItemView,[{key:"className",value:function className(){return"stickyelement u-visibility-hidden"}},{key:"attributes",value:function attributes(){return{"data-stickyelement-id":this.model.get("_id"),"data-item-index":this.model.get("_componentItem").get("_index")}}},{key:"initialize",value:function initialize(){var _this=this;this._toggleCount=0;this.setUpEventListeners();this.render();if(this.model.get("_isActive")){this.onActiveChange(this.model,this.model.get("_isActive"))}else{_.delay(function(){_this.toggleAttributes(_this.$el,_this.model.get("_componentItemIndex"),_this._stickyBlockPrevIdx)},0)}}},{key:"render",value:function render(){var template=Handlebars.templates["stickyElement"];this.$el.html(new Handlebars.SafeString(template(this.model.toJSON())).string);this.postRender()}},{key:"postRender",value:function postRender(){var _this2=this;_.defer(function(){_.defer(function(){_this2.setupClone()})});_.delay(this.setUpScrolling.bind(this),0)}},{key:"showClone",value:function showClone(){this.$clone.removeClass("u-visibility-hidden")}},{key:"hideClone",value:function hideClone(){this.$clone.addClass("u-visibility-hidden")}},{key:"isCloneActive",value:function isCloneActive(){return!this.$clone.hasClass("u-visibility-hidden")}},{key:"setUpEventListeners",value:function setUpEventListeners(){var _this3=this;if(this.model.get("_parentHasTransitions")){this.onActiveChange=_.debounce(this.onActiveChange.bind(this),0)}this.listenTo(this.model,"change:_isActive",this.onActiveChange);this.listenTo(this.model,"change:_componentItemIndex",this.onComponentItemIndexChange);this.listenTo(this.getParentModel(),"change:_itemScrollTop",this.synchronizeScrollTop.bind(this));this.listenTo(this.getParentModel(),"change:_itemScrollLeft",this.synchronizeScrollLeft.bind(this));this.listenTo(this.getParentModel(),{"$clone:transitionstart":function(){_this3.$el.addClass("u-visibility-hidden")},"$clone:transitionend":function(){_this3.$el.removeClass("u-visibility-hidden");_.delay(function(){_this3.hideClone()},0)}})}},{key:"setupClone",value:function setupClone(){var parentModel=this.getParentModel();if(parentModel.get("_$clone")){this.$clone=parentModel.get("_$clone");return}var layer=this.getParentModel().get("_layer");var $clone=this.$el.clone();$clone.addClass("is-clone");var $cloneParent=this.$el.closest(".component__widget");switch(layer){case"bg":var $bg=this.$el.closest(".js-stickyelement-layer-bg");if(!$bg.length){Adapt.log.error("{{#stickyElement}}: Could not find closest element with class 'js-stickyelement-layer-bg'.\n('_layer: \"".concat(layer,"\"' setting was used)."))}else{$cloneParent=$bg;$cloneParent.prepend($clone.addClass("layer-".concat(layer)))}break;default:$cloneParent.append($clone);}parentModel.set("_$clone",$clone);this.$clone=$clone}},{key:"_isPropertyScrollable",value:function _isPropertyScrollable(propertyVal){if(propertyVal=="auto"||propertyVal=="scroll")return true;return false}},{key:"synchronizeScrollLeft",value:function synchronizeScrollLeft(model,scrollLeft){var _this$$scroll;if(!((_this$$scroll=this.$scroll)!==null&&_this$$scroll!==void 0&&_this$$scroll.length))return;this.$scroll[0].scrollLeft=scrollLeft}},{key:"synchronizeScrollTop",value:function synchronizeScrollTop(model,scrollTop){var _this$$scroll2;if(!((_this$$scroll2=this.$scroll)!==null&&_this$$scroll2!==void 0&&_this$$scroll2.length))return;this.$scroll[0].scrollTop=scrollTop}},{key:"setUpScrolling",value:function setUpScrolling(){var _this4=this;var found=false;this.$scroll=this.$("*").filter(function(i,e){if(found)return;if(_this4._isPropertyScrollable($(e).css("overflow"))){found=true;return true}if(_this4._isPropertyScrollable($(e).css("overflow-x"))){found=true;return true}if(_this4._isPropertyScrollable($(e).css("overflow-y"))){found=true;return true}return false}).first();if(!this.$scroll.length)return;this.$scroll.addClass("js-stickyelement-scroll");this.$scroll[0].addEventListener("scroll",_.debounce(function(event){_this4.getParentModel().set("_itemScrollTop",event.target.scrollTop);_this4.getParentModel().set("_itemScrollLeft",event.target.scrollLeft)},100),{passive:true})}},{key:"onComponentItemIndexChange",value:function onComponentItemIndexChange(model,itemIdx){this._stickyBlockPrevIdx=model.previous("_componentItemIndex");this.onActiveChange(this.model,true)}},{key:"onActiveChange",value:function onActiveChange(model,isActive,_force){if(isActive){this.$el.toggleClass("u-visibility-hidden",false)}this.$el.toggleClass("is-stickyelement-active",isActive);if(!isActive)return;var curCIndex=this.model.get("_componentItemIndex");this.$el.attr("data-stickyelement-curidx",curCIndex);var itemPrevModel=this.model.getItemPrev();if(!itemPrevModel){this.toggleAttributes(this.$el,curCIndex,this._stickyBlockPrevIdx);return}var prevCIndex=itemPrevModel.get("_componentItemIndex");if(curCIndex==prevCIndex)return;this.transitionFromEl(itemPrevModel.get("_view").$el,curCIndex,prevCIndex)}},{key:"getActiveIdxs",value:function getActiveIdxs(attrString){var itemsCount=this.model.getItemsCount();var inverted=false;if(attrString[0]=="!"){inverted=true;attrString=attrString.substring(1)}var _idxs=attrString.split(",");var idxs=[];_.each(_idxs,function(idx){if(idx.includes("+")){var from=idx.split("+")[0];for(var i=parseInt(from);i<itemsCount;i++){idxs.push(i+"")}}else if(idx.includes("-")){var _from=idx.split("-")[0];var to=idx.split("-")[1];for(var _i=parseInt(_from);_i<=parseInt(to);_i++){idxs.push(_i+"")}}else{idxs.push(idx+"")}});if(!inverted)return idxs;var invertedIdxs=[];for(var i=0;i<itemsCount;i++)invertedIdxs.push(i+"");invertedIdxs=_.filter(invertedIdxs,function(e){return!_.contains(idxs,e)});return invertedIdxs}},{key:"toggleAttributes",value:function toggleAttributes($targetEl,curCIndex,prevCIndex){var _this5=this;var isStickyBlock=this.model.get("_isStickyBlock");_.each(StickyElementAttributeClasses,function(className,attrName){var $els=$targetEl.find("["+attrName+"]");$els.each(function(i,e){var activeIdxs=_this5.getActiveIdxs($(e).attr(attrName));var curActive=_.includes(activeIdxs,""+curCIndex);if(prevCIndex===undefined){$(e).toggleClass(className+"-transition",false).toggleClass(className,curActive);if(className=="is-se-slidedown"){if(_this5._toggleCount===0){$(e).toggle(curActive)}else{if(curActive){$(e).hide(0).slideDown(400)}else{$(e).show(0).slideUp(400)}}}return}var prevActive=_.includes(activeIdxs,""+prevCIndex);var hasTransition=prevActive!=curActive;if(isStickyBlock)hasTransition=true;if(hasTransition){if(!isStickyBlock){$(e).toggleClass(className+"-transition",false).toggleClass(className,!curActive)}_.debounce(function(){$(e).toggleClass(className+"-transition",hasTransition).toggleClass(className,curActive)},0)();if(className=="is-se-slidedown"){if(curActive){$(e).hide(0).slideDown(400)}else{$(e).show(0).slideUp(400)}}}else{$(e).toggleClass(className+"-transition",hasTransition).toggleClass(className,curActive);if(className=="is-se-slidedown"){$(e).toggle(curActive)}}})});this._toggleCount++}},{key:"getParentModel",value:function getParentModel(){return this.model.get("_parent")}},{key:"transitionFromEl",value:function transitionFromEl($otherEl,curCIndex,prevCIndex){var _this6=this;var isCloneActive=this.isCloneActive();this.showClone();var $clone=this.$clone;if(!isCloneActive){$clone.attr("style","").finish().hide(0).show(0)}this.getParentModel().startTransition();this.$clone.width(this.$el.width());var $cloneScroll=$clone.find(".js-stickyelement-scroll");if($cloneScroll.length){$cloneScroll[0].scrollTop=this.getParentModel().get("_itemScrollTop");$cloneScroll[0].scrollLeft=this.getParentModel().get("_itemScrollLeft")}_.delay(function(){_this6.$el.toggleClass("u-visibility-hidden",true);$otherEl.toggleClass("u-visibility-hidden",true)},0);if(!isCloneActive){var thisBB=this.$el[0].getBoundingClientRect();var cloneBB=_.extend({},$clone[0].getBoundingClientRect());var cloneInnerBB=$clone.find(".js-stickelement-inner")[0].getBoundingClientRect();var otherBB=$otherEl[0].getBoundingClientRect();var topMarginFix=cloneBB.top-cloneInnerBB.top||0;var cloneOffsetBefore={top:Math.round(otherBB.top-cloneBB.top+topMarginFix),left:Math.round(otherBB.left-cloneBB.left)};var cloneOffsetAfter={top:Math.round(thisBB.top-cloneBB.top+topMarginFix),left:Math.round(thisBB.left-cloneBB.left)};var scale=1;$clone.css({"left":cloneOffsetBefore.left+"px","top":cloneOffsetBefore.top+"px","transform":"scale(".concat(scale,")")});$clone.hide(0).show(0);cloneOffsetAfter.left+=otherBB.left-thisBB.left;$clone.css({"left":cloneOffsetAfter.left+"px","top":cloneOffsetAfter.top+"px","transform":"scale(".concat(scale,")")})}this.toggleAttributes($clone,curCIndex,prevCIndex);this.toggleAttributes(this.$el,curCIndex,undefined)}}]);return StickyElementItemView}(Backbone.View);var StickyElementItemView$1=__AMD("extensions/adapt-stickyElement/js/stickyElementItemView",StickyElementItemView);var StickyElementItemModel=function(_Backbone$Model){_inherits(StickyElementItemModel,_Backbone$Model);var _super=_createSuper(StickyElementItemModel);function StickyElementItemModel(){_classCallCheck(this,StickyElementItemModel);return _super.apply(this,arguments)}_createClass(StickyElementItemModel,[{key:"defaults",value:function defaults(){return{_parent:undefined,_id:"",_componentItemIndex:"",_componentItem:undefined,_view:undefined,_isActive:false,_isStickyBlock:false}}},{key:"initialize",value:function initialize(){var componentItem=this.get("_componentItem");this.set("_componentItemIndex",componentItem.get("_index"));this.set("_isActive",componentItem.get(this.get("_isStickyBlock")?"_isVisible":"_isActive"));this.setUpEventListeners()}},{key:"getItemsCount",value:function getItemsCount(){if(this.get("_isStickyBlock")){var _this$get$get;return(_this$get$get=this.get("_componentItem").get("_stickyBlockSiblings"))===null||_this$get$get===void 0?void 0:_this$get$get.length}return this.get("_parent").get("_items").length}},{key:"setUpEventListeners",value:function setUpEventListeners(){if(!this.get("_isStickyBlock")){this.listenTo(this.get("_componentItem"),"change:_isActive",this.onComponentItemActiveChange)}else{this.listenTo(this.get("_componentItem"),"stickyBlock:inview",this.onStickyBlockInview)}this.listenTo(this,"change:_isActive",this.onActiveChange)}},{key:"onComponentItemActiveChange",value:function onComponentItemActiveChange(itemModel,isActive){this.set("_isActive",isActive)}},{key:"onStickyBlockInview",value:function onStickyBlockInview(){var view=this.get("_view");if(!view)return;var activeIndex=view.$el.getParentStickyBlockIndex();this.set("_isActive",true);this.set("_componentItemIndex",activeIndex)}},{key:"onActiveChange",value:function onActiveChange(model,isActive){if(isActive)this.get("_parent").setItemActive(this)}},{key:"getItemPrev",value:function getItemPrev(){return this.get("_parent").get("_itemPrev")}},{key:"refresh",value:function refresh(){console.log("REFRESH WON'T DO ANYTHING YET")}},{key:"getPrevActiveStickyElementItem",value:function getPrevActiveStickyElementItem(){}}]);return StickyElementItemModel}(Backbone.Model);var StickyElementItemModel$1=__AMD("extensions/adapt-stickyElement/js/stickyElementItemModel",StickyElementItemModel);var CompatibleComponents={"tabs":{"_hasTransitions":false},"narrativePlus":{"_hasTransitions":true}};var StickyElementModel=function(_Backbone$Model){_inherits(StickyElementModel,_Backbone$Model);var _super=_createSuper(StickyElementModel);function StickyElementModel(){_classCallCheck(this,StickyElementModel);return _super.apply(this,arguments)}_createClass(StickyElementModel,[{key:"defaults",value:function defaults(){return{_parent:undefined,_id:"",body:"",_items:new Backbone.Collection,_itemScrollTop:0,_itemScrollLeft:0,_itemActive:undefined,_itemPrev:undefined}}},{key:"initialize",value:function initialize(){this.listenTo(this.get("_parent").getChildren(),"change:_isActive",this.onComponentItemActiveChange);this.listenTo(this,"change:_itemActive",this.onItemActiveChange);this._endTransition=_.debounce(this._endTransition.bind(this),700)}},{key:"checkValidParent",value:function checkValidParent(){var parentType=this.get("_parent").get("_component");var cc=CompatibleComponents[parentType];if(cc===undefined){throw"adapt-stickyElement: this extension is not compatible with the \""+parentType+"\" component."}this.set("_parentHasTransitions",cc._hasTransitions)}},{key:"setItemActive",value:function setItemActive(itemActiveModel){this.set("_itemActive",itemActiveModel)}},{key:"onComponentItemActiveChange",value:function onComponentItemActiveChange(componentItem,isActive){if(this.get("_items").find(function(item){return item.get("_componentItem")===componentItem}))return;this.setItemActive(undefined)}},{key:"onItemActiveChange",value:function onItemActiveChange(model){this.set("_itemPrev",model._previousAttributes._itemActive)}},{key:"registerStaticItemModel",value:function registerStaticItemModel(componentModel,options){var model=new Backbone.Model({_id:this.get("_id"),body:this.get("body")});var template=Handlebars.templates["stickyElement"];var html=new Handlebars.SafeString(template(model.toJSON())).string;return new Backbone.View({model:model,el:html})}},{key:"registerComponentItemModel",value:function registerComponentItemModel(componentItemModel,options){var model=new StickyElementItemModel$1({_parent:this,_id:this.get("_id"),body:this.get("body"),_componentItem:componentItemModel,_isStickyBlock:Boolean(options===null||options===void 0?void 0:options._isStickyBlock)});var view=new StickyElementItemView$1({model:model});model.set("_view",view);this.get("_items").push(model);return view}},{key:"refresh",value:function refresh(){var _this=this;this.get("_itemModels").find(function(model){if(model.get("_isActive")){_this.trigger("stickyElement:itemShow",model.get("_index"));_this.set("_itemCur",model);return true}})}},{key:"_endTransition",value:function _endTransition(){this.trigger("$clone:transitionend")}},{key:"startTransition",value:function startTransition(){this.trigger("$clone:transitionstart");this._endTransition()}}]);return StickyElementModel}(Backbone.Model);var StickyElementModel$1=__AMD("extensions/adapt-stickyElement/js/stickyElementModel",StickyElementModel);Adapt.on("router:page",function(){Handlebars__default["default"].registerHelperEl("stickyElement",function(){var context=arguments[arguments.length-1];var hash=context.hash;var id=hash.id;if(id===undefined)throw"{{#stickyElement}} helper must have the \"id\" parameter defined.";var itemIdx=hash.itemIdx;var isStickyBlock=itemIdx=="stickyBlock";if(!isStickyBlock){itemIdx=parseInt(itemIdx);if(hash.itemIdx===undefined)throw"{{#stickyElement}} helper must have the \"itemIdx\" parameter defined."}var componentModel=Handlebars__default["default"].getComponentModelFromContext(context);var se=componentModel.get("_stickyElement");if(!se){throw"Could not render {{#stickyElement}} helper in component "+componentModel.get("_id")+": component has no \"_stickyElement\" property defined."}if(!se._isEnabled)return $();var item=_.find(se._items,function(item){return item._id==id});if(item===undefined){throw componentModel.get("_id")+": component._stickyElement._items does not have an item with \"_id\": \""+id+"\""}if(!item._model){item._model=new StickyElementModel$1({_id:id,_parent:componentModel,_layer:item._layer||"",body:item.body})}if(itemIdx<0){return item._model.registerStaticItemModel(componentModel).$el}if(componentModel.getChildren===undefined)throw"The {{#stickyElement}} helper cannot be used in a \""+componentModel.get("_component")+"\" component.";if(isStickyBlock){return item._model.registerComponentItemModel(componentModel,{_isStickyBlock:true}).$el}var m=componentModel.getChildren().models[itemIdx];if(!m)Adapt.log.error("stickyElement: could not find component item with _index \"".concat(itemIdx,"\" (it may be out of bounds).\nRemember that the first ITEM's index is \"0\"."));return item._model.registerComponentItemModel(m).$el})});var helpers$1={se_active:function(idx){var context=arguments[arguments.length-1];var _idx=context.hash.idx!==undefined?context.hash.idx:idx;return"data-stickyelement-active-idx=\""+_idx+"\""},se_mark:function(idx){var context=arguments[arguments.length-1];var _idx=context.hash.idx!==undefined?context.hash.idx:idx;return"data-stickyelement-mark-idx=\"".concat(_idx,"\"").concat(context.hash.theme?"data-theme=\"".concat(context.hash.theme,"\""):"")},se_hide:function(idx){var context=arguments[arguments.length-1];var _idx=context.hash.idx!==undefined?context.hash.idx:idx;return"data-stickyelement-hide-idx=\""+_idx+"\""},se_fold:function(idx){var context=arguments[arguments.length-1];var _idx=context.hash.idx!==undefined?context.hash.idx:idx;return"data-stickyelement-fold-idx=\""+_idx+"\""},se_slideleft:function(idx){var context=arguments[arguments.length-1];var _idx=context.hash.idx!==undefined?context.hash.idx:idx;return"data-stickyelement-slideleft-idx=\""+_idx+"\""},se_slidedown:function(idx){var context=arguments[arguments.length-1];var _idx=context.hash.idx!==undefined?context.hash.idx:idx;return"data-stickyelement-slidedown-idx=\""+_idx+"\""}};for(var name$1 in helpers$1){if(!helpers$1.hasOwnProperty(name$1))continue;Handlebars__default["default"].registerHelper(name$1,helpers$1[name$1])}var CLICK_ANYWHERE_EVENTS="click touch mouseup touchend";var VIEWPORT_PADDING=32;var TooltipPopupView=function(_Backbone$View){_inherits(TooltipPopupView,_Backbone$View);var _super=_createSuper(TooltipPopupView);function TooltipPopupView(){_classCallCheck(this,TooltipPopupView);return _super.apply(this,arguments)}_createClass(TooltipPopupView,[{key:"tagName",value:function tagName(){return"div"}},{key:"className",value:function className(){var classes=["tooltip-popup",this.model.get("_classes")||"",this.model.get("type")||this.model.get("_type")?"is-"+(this.model.get("type")||this.model.get("_type")):""];return classes.join(" ")}},{key:"events",value:function events(){return{}}},{key:"initialize",value:function initialize(){this.setUpEventListeners();this.render()}},{key:"setUpEventListeners",value:function setUpEventListeners(){var _this=this;this.listenTo(Adapt,{"device:resize":this.onDeviceResize});_.debounce(function(){_this.onClickAnywhereEvent=_this.onClickAnywhere.bind(_this);$(document).on(CLICK_ANYWHERE_EVENTS,_this.onClickAnywhereEvent)},0)()}},{key:"onClickAnywhere",value:function onClickAnywhere(event){var innerEl=this.$(".tooltip-popup__inner")[0];if(event.target==innerEl||$.contains(innerEl,event.target))return;this.close()}},{key:"onDeviceResize",value:function onDeviceResize(){this.close()}},{key:"close",value:function close(){this.model.set("_isActive",false);this.remove()}},{key:"remove",value:function remove(){this.model.set("_isActive",false);$(document).off(CLICK_ANYWHERE_EVENTS,this.onClickAnywhereEvent);Backbone.View.prototype.remove.apply(this,arguments)}},{key:"render",value:function render(){this.$el.html(new Handlebars.SafeString(Handlebars.templates["tooltipPopup"](this.model.toJSON())).string);this.$parent=this.model.get("$target").closest(".notify__popup, #app, .sidemenu");this.$parent.append(this.$el);this.alignToTarget()}},{key:"alignToTarget",value:function alignToTarget(){var $target=this.model.get("$target");if(!$target||!$target.length){throw"toolipPopupView needs an existing $target element to align to"}$target=$target.first();var targetBB=$target[0].getClientRects()[0];var elBB=this.el.getBoundingClientRect();var parentWidth=this.$parent[0].clientWidth;var left=targetBB.left-(elBB.width-targetBB.width)/2;var _left=left;left=Math.min(parentWidth-elBB.width,left);left=Math.max(0,left);var tailOffset=_left-left;this.$(".tooltip-popup__tail-container").css({"transform":"translateX("+tailOffset+"px)"});this.$el.offset({left:left,top:$target.offset().top});elBB=this.el.getBoundingClientRect();if(elBB.top-elBB.height<VIEWPORT_PADDING){this.$el.addClass("is-flipped").offset({left:left,top:$target.offset().top+$target.outerHeight()})}return}}]);return TooltipPopupView}(Backbone.View);var TooltipPopupView$1=__AMD("extensions/adapt-tooltip/js/tooltipPopupView",TooltipPopupView);var TooltipView=function(_Backbone$View){_inherits(TooltipView,_Backbone$View);var _super=_createSuper(TooltipView);function TooltipView(){_classCallCheck(this,TooltipView);return _super.apply(this,arguments)}_createClass(TooltipView,[{key:"tagName",value:function tagName(){return"span"}},{key:"className",value:function className(){return"tooltip"}},{key:"events",value:function events(){return{"click .js-tooltip":"onClick"}}},{key:"initialize",value:function initialize(){this.setUpEventListeners();this.render()}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenTo(this.model,"change:_isActive",this.onActiveChange)}},{key:"render",value:function render(){this.$el.html(new Handlebars.SafeString(Handlebars.templates["tooltip"](this.model.toJSON())).string)}},{key:"onClick",value:function onClick(event){if(Adapt.config.get("_isEpub")){event.stopPropagation()}Adapt.createTooltip(this.$(".js-tooltip-target"),this.model.attributes)}},{key:"onActiveChange",value:function onActiveChange(model,isActive){this.$(".tooltip__content").toggleClass("is-active",isActive);if(isActive){Adapt.createTooltip(this.$el,this.model.attributes);return}}}]);return TooltipView}(Backbone.View);var TooltipView$1=__AMD("extensions/adapt-tooltip/js/tooltipView",TooltipView);Adapt.on("router:page",function(){Handlebars__default["default"].registerHelperEl("reference",function(){var context=arguments[arguments.length-1];if(Adapt.isPDFMode()){var html=Handlebars__default["default"].templates["reference-pdf"]({example:"EXAMPLE"});return new Handlebars__default["default"].SafeString(html)}var content=context.fn(this).trim();if(content[0]!=="(")content="("+content;if(content[content.length-1]!==")")content=content+")";var modelJSON=_.extend({},context.hash,{buttonText:"",content:content,_icon:"hm-references",type:"reference"});return new TooltipView$1({model:new Backbone.Model(modelJSON)}).$el});Handlebars__default["default"].registerHelperEl("glossary",function(){var context=arguments[arguments.length-1];var glossaryTerm=context.hash.term||context.fn(this);glossaryTerm=glossaryTerm.trim();if(!glossaryTerm)throw"{{#glossary}}: Must have a valid 'term' property.";var buttonText=context.fn(this);var pageModel=Adapt.findById(Adapt.location._currentId);var glossaries=pageModel.get("_menuData")._glossaries;var glossaryData=_.find(glossaries._items,function(g){return g.title.toLowerCase()==glossaryTerm.toLowerCase()});if(!glossaryData){Adapt.log.error("{{#glossary}}: Could not find glossary definition for \""+glossaryTerm+"\".");glossaryData={title:"#ERROR"};buttonText="<span class=\"tooltip__broken icon icon-link-broken\"></span> ".concat(buttonText)}var modelJSON=_.extend({},context.hash,{buttonText:buttonText,title:glossaryData.title,content:glossaryData.body,_icon:"",type:"glossary"});return new TooltipView$1({model:new Backbone.Model(modelJSON)}).$el})});Adapt.createTooltip=function(element){var settings=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(typeof settings==="string"){settings={content:settings}}var tooltipPopupView=new TooltipPopupView$1({model:new Backbone.Model(_.extend(settings||{},{$target:$(element)}))});return tooltipPopupView};var MenuItemView=function(_AdaptView){_inherits(MenuItemView,_AdaptView);var _super=_createSuper(MenuItemView);function MenuItemView(){_classCallCheck(this,MenuItemView);return _super.apply(this,arguments)}_createClass(MenuItemView,[{key:"attributes",value:function attributes(){return AdaptView$1.resultExtend("attributes",{"role":"listitem","aria-labelledby":this.model.get("_id")+"-heading"},this)}},{key:"className",value:function className(){return["menu-item",this.constructor.className,this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isVisited")?"is-visited":"",this.model.get("_isComplete")?"is-complete":"",this.model.get("_isLocked")?"is-locked":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}},{key:"preRender",value:function preRender(){this.model.checkCompletionStatus();this.model.checkInteractionCompletionStatus()}},{key:"postRender",value:function postRender(){this.$el.imageready(this.setReadyStatus.bind(this))}}]);return MenuItemView}(AdaptView$1);MenuItemView.type="menuItem";var MenuItemView$1=__AMD("core/js/views/menuItemView",MenuItemView);var MenuView=function(_ContentObjectView){_inherits(MenuView,_ContentObjectView);var _super=_createSuper(MenuView);function MenuView(){_classCallCheck(this,MenuView);return _super.apply(this,arguments)}return _createClass(MenuView)}(ContentObjectView);Object.assign(MenuView,{childContainer:".js-children",childView:MenuItemView$1,type:"menu",template:"menu"});var MenuView$1=__AMD("core/js/views/menuView",MenuView);var BoxMenuItemView=MenuItemView$1.extend({events:{"click .js-btn-click":"onClickMenuItemButton"},onClickMenuItemButton:function(event){if(event&&event.preventDefault)event.preventDefault();if(this.model.get("_isLocked"))return;Backbone.history.navigate("#/id/"+this.model.get("_id"),{trigger:true})}},{className:"boxmenu-item",template:"boxMenuItem"});var BoxMenuItemView$1=__AMD("menu/adapt-contrib-boxMenu/js/adapt-contrib-boxMenuItemView",BoxMenuItemView);var BoxMenuView=MenuView$1.extend({initialize:function(){MenuView$1.prototype.initialize.apply(this);this.setStyles();this.listenTo(Adapt,{"device:changed":this.onDeviceResize})},onDeviceResize:function(){this.setStyles()},setStyles:function(){this.setBackgroundImage();this.setBackgroundStyles();this.processHeader()},setBackgroundImage:function(){var config=this.model.get("_boxMenu");var backgroundImages=config&&config._backgroundImage;if(!backgroundImages)return;var backgroundImage;switch(Adapt.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){this.$el.addClass("has-bg-image").css("background-image","url("+backgroundImage+")")}else{this.$el.removeClass("has-bg-image").css("background-image","")}},setBackgroundStyles:function(){var config=this.model.get("_boxMenu");var styles=config&&config._backgroundStyles;if(!styles)return;this.$el.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})},processHeader:function(){var config=this.model.get("_boxMenu");var header=config&&config._menuHeader;if(!header)return;var $header=this.$(".menu__header");this.setHeaderBackgroundImage(header,$header);this.setHeaderBackgroundStyles(header,$header);this.setHeaderMinimumHeight(header,$header)},setHeaderBackgroundImage:function(config,$header){var backgroundImages=config._backgroundImage;if(!backgroundImages)return;var backgroundImage;switch(Adapt.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){$header.addClass("has-bg-image").css("background-image","url("+backgroundImage+")")}else{$header.removeClass("has-bg-image").css("background-image","")}},setHeaderBackgroundStyles:function(config,$header){var styles=config._backgroundStyles;if(!styles)return;$header.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})},setHeaderMinimumHeight:function(config,$header){var minimumHeights=config._minimumHeights;if(!minimumHeights)return;var minimumHeight;switch(Adapt.device.screenSize){case"large":minimumHeight=minimumHeights._large;break;case"medium":minimumHeight=minimumHeights._medium;break;default:minimumHeight=minimumHeights._small;}if(minimumHeight){$header.addClass("has-min-height").css("min-height",minimumHeight+"px")}else{$header.removeClass("has-min-height").css("min-height","")}}},{childView:BoxMenuItemView$1,className:"boxmenu",template:"boxMenu"});Adapt.on("router:menu",function(model){$("#wrapper").append(new BoxMenuView({model:model}).$el);_.debounce(function(){Adapt.router.model.set("_canNavigate",true,{pluginName:"adapt"});var newRouteId="co-05";Backbone.history.navigate("#/id/"+newRouteId,true)},0)()});var ThemeView=Backbone.View.extend({className:function(){},initialize:function(){this.init();this.setStyles();this.listenTo(Adapt,{"device:changed":this.onDeviceResize,"remove":this.remove})},onDeviceResize:function(){this.setStyles()},remove:function(){Backbone.View.prototype.remove.call(this);this.onRemove()},setStyles:function(){this.setClasses();this.setBackgroundImage();this.setBackgroundStyles();this.setMinimumHeight();this.setCustomStyles()},setClasses:function(){this.$el.addClass(this.className())},setBackgroundImage:function(){var backgroundImages=this.model.get("_backgroundImage");if(!backgroundImages)return;var backgroundImage;var backgroundRepeat=backgroundImages._repeat?"repeat":"";var backgroundSize=backgroundImages._repeat?"auto":"";switch(Adapt.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){this.$el.addClass("has-bg-image").css("background-image","url("+backgroundImage+")").css("background-repeat",backgroundRepeat).css("background-size",backgroundSize)}else{this.$el.removeClass("has-bg-image").css("background-image","").css("background-repeat","").css("background-size","")}},setBackgroundStyles:function(){var styles=this.model.get("_backgroundStyles");if(!styles)return;this.$el.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})},setMinimumHeight:function(){var minimumHeights=this.model.get("_minimumHeights");if(!minimumHeights)return;var minimumHeight;switch(Adapt.device.screenSize){case"large":minimumHeight=minimumHeights._large;break;case"medium":minimumHeight=minimumHeights._medium;break;default:minimumHeight=minimumHeights._small;}if(minimumHeight){this.$el.addClass("has-min-height").css("min-height",minimumHeight+"px")}else{this.$el.removeClass("has-min-height").css("min-height","")}},init:function(){},setCustomStyles:function(){},onRemove:function(){}});var ThemeView$1=__AMD("theme/adapt-didasko/js/themeView",ThemeView);var ThemePageView=ThemeView$1.extend({className:function(){},setCustomStyles:function(){this.processHeader()},processHeader:function(){var header=this.model.get("_pageHeader");if(!header||header._isEnabled===false){this.$(".page__header, .page__overview").hide();return}var $header=this.$(".page__header");var $headerBG=this.$(".page__header-bg");this.setHeaderBackgroundImage(header,$headerBG);this.setHeaderBackgroundStyles(header,$headerBG);this.setHeaderMinimumHeight(header,$header)},setHeaderBackgroundImage:function(config,$header){var backgroundImages=config._backgroundImage;if(!backgroundImages)return;var backgroundImage;switch(Adapt.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){$header.css("background-image","url("+backgroundImage+")").parent().addClass("has-bg-image")}else{$header.css("background-image","").parent().removeClass("has-bg-image")}},setHeaderBackgroundStyles:function(config,$header){var styles=config._backgroundStyles;if(!styles)return;$header.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})},setHeaderMinimumHeight:function(config,$header){var minimumHeights=config._minimumHeights;if(!minimumHeights)return;var minimumHeight;switch(Adapt.device.screenSize){case"large":minimumHeight=minimumHeights._large;break;case"medium":minimumHeight=minimumHeights._medium;break;default:minimumHeight=minimumHeights._small;}if(minimumHeight){$header.addClass("has-min-height").css("min-height",minimumHeight+"px")}else{$header.removeClass("has-min-height").css("min-height","")}},onRemove:function(){}});var ThemePageView$1=__AMD("theme/adapt-didasko/js/themePageView",ThemePageView);var ThemeArticleView=ThemeView$1.extend({className:function(){},setCustomStyles:function(){},onRemove:function(){}});var ThemeArticleView$1=__AMD("theme/adapt-didasko/js/themeArticleView",ThemeArticleView);var ThemeBlockView=ThemeView$1.extend({className:function(){return this.model.get("_isDividerBlock")?"is-divider-block":""},setCustomStyles:function(){},onRemove:function(){}});var ThemeBlockView$1=__AMD("theme/adapt-didasko/js/themeBlockView",ThemeBlockView);var ThemeComponentView=ThemeView$1.extend({className:function(){return this.model.get("_isDividerBlock")?"is-divider-block":""},init:function(){},onRemove:function(){}});var ThemeComponentView$1=__AMD("theme/adapt-didasko/js/themeComponentView",ThemeComponentView);function onDataReady(){var _Adapt$course$get;$("html").addClass(Adapt.course.get("_courseStyle"));var propOverrides=((_Adapt$course$get=Adapt.course.get("_propOverride"))===null||_Adapt$course$get===void 0?void 0:_Adapt$course$get._items)||[];Adapt.log.debug("Build overrides: ",propOverrides)}function onPostRender(view){var model=view.model;var theme=model.get("_didasko");if(!theme)return;switch(model.get("_type")){case"page":new ThemePageView$1({model:new Backbone.Model(theme),el:view.$el});break;case"article":new ThemeArticleView$1({model:new Backbone.Model(theme),el:view.$el});break;case"block":new ThemeBlockView$1({model:new Backbone.Model(theme),el:view.$el});break;case"component":new ThemeComponentView$1({model:new Backbone.Model(theme),el:view.$el});break;default:new ThemeView$1({model:new Backbone.Model(theme),el:view.$el});}}Adapt.on({"app:dataReady":onDataReady,"pageView:postRender articleView:postRender blockView:postRender componentView:postRender":onPostRender});var helpers={"c-example":function(){var context=arguments[arguments.length-1];var content=context.fn(this);var html=Handlebars.templates["c-example"](_.extend(context.hash,{content:content}));return new Handlebars.SafeString(html)}};for(var name in helpers){if(helpers.hasOwnProperty(name)){Handlebars.registerHelper(name,helpers[name])}}var partials={"c-partial":"<strong><u>Shortcut!</u></strong>","c-withParam":"<strong><u>{{./param}}</u></strong>"};for(var name in partials){Handlebars.registerPartial(name,partials[name])}register("header",function Header(props){var jsxHeading=React.useRef(null);var jsxComponentDescription=React.useRef(null);var _id=props._id,displayTitle=props.displayTitle,body=props.body,instruction=props.instruction,mobileInstruction=props.mobileInstruction,_type=props._type,_component=props._component,_disableAccessibilityState=props._disableAccessibilityState,_props$classNamePrefi=props.classNamePrefixes,classNamePrefixes=_props$classNamePrefi===void 0?[_type&&_type.toLowerCase(),_component&&_component.toLowerCase()].filter(Boolean):_props$classNamePrefi;var sizedInstruction=mobileInstruction&&Adapt.device.screenSize!=="large"?mobileInstruction:instruction;var isSet=displayTitle||body||sizedInstruction;if(!isSet)return null;return React__default["default"].createElement("div",{id:"".concat(_id,"-header"),className:prefixClasses(classNamePrefixes,["__header"])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__header-inner"])},displayTitle&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__title"])},!_disableAccessibilityState&&React__default["default"].createElement("div",{className:"js-heading",ref:jsxHeading}),React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__title-inner"]),"aria-hidden":!_disableAccessibilityState},html(compile(displayTitle,props)))),html(helper("component_description",props),jsxComponentDescription),body&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__body"])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__body-inner"])},html(compile(body,props)))),sizedInstruction&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__instruction"])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__instruction-inner"])},html(compile(sizedInstruction,props))))))});register("image",function Image(props){var screenSize=Adapt.device.screenSize;var src=props["_".concat(screenSize)]||props["".concat(screenSize)]||props._src||props.src;var hasSource=Boolean(src);if(!hasSource)return null;var attributionClassNamePrefixes=props.attributionClassNamePrefixes||props.classNamePrefixes;return React__default["default"].createElement("div",{className:classes([prefixClasses(props.classNamePrefixes,["-image-container"]),props.attribution&&"has-attribution"])},React__default["default"].createElement("img",{className:prefixClasses(props.classNamePrefixes,["-image"]),src:src,"aria-label":Adapt.a11y.normalize(props.alt),"aria-hidden":!props.alt,loading:"eager"}),props.attribution&&React__default["default"].createElement("div",{className:prefixClasses(attributionClassNamePrefixes,["__attribution"])},React__default["default"].createElement("div",{className:prefixClasses(attributionClassNamePrefixes,["__attribution-inner"])},html(props.attribution))))});$("body").append(Handlebars.templates.loading());Adapt.data.on("ready",function triggerInit(){Adapt.log.debug("Calling Adapt.init");Adapt.init();Adapt.off("adaptCollection:dataLoaded courseModel:dataLoaded")}).init()});window.__AMD=function(id,value){window.define(id,function(){return value});window.require([id]);return value};
